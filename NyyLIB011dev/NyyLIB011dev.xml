<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.000">
    <TriggerPackage>
        <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
            <name>NyyLIB</name>
            <script></script>
            <triggerType>0</triggerType>
            <conditonLineDelta>0</conditonLineDelta>
            <mStayOpen>0</mStayOpen>
            <mCommand></mCommand>
            <packageName></packageName>
            <mFgColor>#ff0000</mFgColor>
            <mBgColor>#ffff00</mBgColor>
            <mSoundFile></mSoundFile>
            <colorTriggerFgColor>#000000</colorTriggerFgColor>
            <colorTriggerBgColor>#000000</colorTriggerBgColor>
            <regexCodeList/>
            <regexCodePropertyList/>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Mud Setup</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>replace tab trigger</name>
                    <script>while selectString(&quot;\t&quot;,1) &gt; -1 do
  replace(&quot;     &quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>\t</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>topgags</name>
                    <script>-- You lack the proper component to use this power.

eraseLine()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>YiPeE! You can't see me</string>
                        <string>Unsplit Coins: </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Capture Prompt</name>
                    <script>-- &lt; 416h/416H 110v/110V T: Zusuk TC: excellent E: ultrumm EC: nasty wounds EP: sit P: std &gt; 
-- &lt; 1037h/1037H 134v/134V P: std &gt;

NyyLIB = NyyLIB or {}

if matches[2] ~= &quot;&quot; then
	prompt:set(&quot;hp&quot;, tonumber(matches[2]))
end

if matches[3] ~= &quot;&quot; then
	prompt:set(&quot;maxhp&quot;, tonumber(matches[3]))
end

if matches[4] ~= &quot;&quot; then
	prompt:set(&quot;psp&quot;, tonumber(matches[4]))
else
	prompt:set(&quot;psp&quot;, nil)
end

if matches[5] ~= &quot;&quot; then
	prompt:set(&quot;maxpsp&quot;, tonumber(matches[5]))
else
	prompt:set(&quot;maxpsp&quot;, nil)
end

if matches[6] ~= &quot;&quot; then
	prompt:set(&quot;mv&quot;, tonumber(matches[6]))
end

if matches[7] ~= &quot;&quot; then
	prompt:set(&quot;maxmv&quot;, tonumber(matches[7]))
end

prompt:set(&quot;tank&quot;, matches[8]:trim())
prompt:set(&quot;tankcondition&quot;, matches[9]:trim())
prompt:set(&quot;enemy&quot;, matches[10]:trim())

if prompt:get(&quot;enemy&quot;) ~= &quot;&quot; then
	setEnemy( prompt:get(&quot;enemy&quot;) )
end

prompt:set(&quot;enemycondition&quot;, matches[11]:trim())
prompt:set(&quot;enemyposition&quot;, matches[12]:trim())
prompt:set(&quot;position&quot;, matches[13]:trim())

groupList:setHP(whoami(), prompt:get(&quot;hp&quot;), prompt:get(&quot;maxhp&quot;) )

raiseEvent(&quot;promptEvent&quot;)


-- if no-one is known tanking, and the prompt shows combat look at the room

if groupList:whoTanking() == false and prompt:get(&quot;tank&quot;) ~= &quot;&quot; then
	groupList:incTanking(prompt:get(&quot;tank&quot;))
	sendLook()
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>&lt; (?:(\d+)h)?\/?(?:(\d+)H)? ?(?:(\d+)p)?\/?(?:(\d+)P)? ?(?:(\d+)v)?\/?(?:(\d+)V)? ?(?:T: ([A-Za-z ]+))? ?(?:TC: ([A-Za-z ]+))? ?(?:E: ([A-Za-z ]+))? ?(?:EC: ([A-Za-z ]+))? ?(?:EP: ([A-Za-z ]+))? (?:P: (.*)) &gt;</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Reconnect to Toril</name>
                    <script>-- Initialization trigger on reconnect to toril.

-- reset any previously queued spells / commands
mud.varsendqueue={}
spell:clear()

NyyLIB.initgui=false

--mount:set(nil)

-- erase current value of assassinate timer
timer:set(&quot;assassinatetimer&quot;, nil)

mud:send(&quot;display enemypos&quot;, false)
mud:send(&quot;display position&quot;, false)
mud:send(&quot;display twoline&quot;, false)
mud:send(&quot;att&quot;, false)
mud:send(&quot;sc&quot;, false)
mud:send(&quot;equip&quot;, false)
mud:send(&quot;group&quot;, false)
mud:send(&quot;exp&quot;, true)
mud:send(&quot;consent&quot;, false)

local assocchar = charData:get(&quot;assocchar&quot;, true)

if assocchar ~= &quot;&quot; then
	mud:send(&quot;assoc chat &quot; .. assocchar, false )
	mud:send(&quot;storage access &quot; .. assocchar, false )
end

tempTimer(1.5, [[mud:send(&quot;look&quot;, false)]])

tempTimer(4, [[expandAlias(&quot;resettrain&quot;, false)]])



</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Reconnecting...</string>
                        <string>Restoring items from crash save info...</string>
                        <string>^Find us on the web[:]$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Twoline display turned ON.</name>
                    <script>-- mud configuration

send(&quot;display twoline&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Twoline display turned ON.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Type the # or name of a character above to login or choose an action below.</name>
                    <script>if whoami() ~= nil then
	if charData:get(&quot;reconnect&quot;) ~= false then
		send(charData:get(&quot;reconnect&quot;) )
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Type the # or name of a character above to login or choose an action below.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Enemy position display turned OFF.</name>
                    <script>-- mud configuration

mud:send(&quot;display enemypos&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Enemy position display turned OFF.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>to get started. You can then link all of your characters to your new account</name>
                    <script>map:hide()
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>  to get started. You can then link all of your characters to your new account$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Anti-Timeout</name>
                    <script>if 	NyyLIB.initgui then
	sendLook()
end

checkVoteButton()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Autosaving...</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Position display turned OFF.</name>
                    <script>send(&quot;display position&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Position display turned OFF.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>identify mob</name>
                <script>--&lt; 814h/814H 110v/110V T: Vori TC: excellent E: lavis EC: nasty wounds EP: std P: std &gt;

--Vori sends Lavis Ryl sprawling with a powerful bash.
--[Error: Trying to set Vori as enemy!]
-- &quot;&lt; 814h/814H 110v/110V T: Vori TC: excellent E: forell EC: small wounds EP: std P: std &gt; Vori&quot;


-- Dagrathigon barely wounds a githyanki soldier with his massive pierce.
-- error, same


local enemy

if groupList:ingroup(matches[2]) then
	enemy=matches[3]
else
	enemy=matches[2]
end

enemy=idMob(enemy)

if groupList:ingroup(enemy) then
	cecho(&quot;&lt;red&gt;\n[Error: Trying to set &quot; .. enemy .. &quot; as enemy!]\n&quot;)
	--display( matches[2] )
	--display( matches[3] )

	return
end

if getEnemy() == &quot;&quot; then
	setEnemy( enemy )
end
</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>([A-Za-z]+) sends (.*) sprawling with a powerful bash.</string>
                    <string>([A-Za-z]+) barely wounds (.*) with .*</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>1</integer>
                    <integer>1</integer>
                </regexCodePropertyList>
            </Trigger>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>reset variables</name>
                <script>-- clear enteredportal count

enteredPortal = {}

assistSent = nil

-- spell:setCurrent()
-- it's possible to send look+cast, and have look return first

fleeAttempt = 0

sendingStatus = false</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>^Exits: (.*)</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>1</integer>
                </regexCodePropertyList>
            </Trigger>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Demonnic</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Tabbed Chat</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>GSAY</name>
                        <script>demonnic.chat:append(&quot;GSAY&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>group-say</string>
                            <string>group-project</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>OOC</name>
                        <script>demonnic.chat:append(&quot;OOC&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>OOC:</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>NHC</name>
                        <script>demonnic.chat:append(&quot;NHC&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>NHC:</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>ACC</name>
                        <script>demonnic.chat:append(&quot;ACC&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>ASSOC:</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>GCC</name>
                        <script>demonnic.chat:append(&quot;GCC&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>GCC:</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>TELLS</name>
                        <script>demonnic.chat:append(&quot;TELLS&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>39</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>tells you</string>
                            <string>You tell</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Skill</name>
                        <script>demonnic.chat:append(&quot;SKILL&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You have learned something new about</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Gruumsh responds to your petition with</name>
                        <script>-- Beshaba responds to your petition with

demonnic.chat:append(&quot;TELLS&quot;)

sound(&quot;365641__furbyguy__8-bit-alarm.wav&quot;,nil,true) </script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) responds to your petition with</string>
                            <string>You petition</string>
                            <string>responds to your group with</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>SAYS</name>
                        <script>-- stuff to not capture. psi.
-- A fire elemental sulkily says 'Your wish is my command, master!


demonnic.chat:append(&quot;SAYS&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^[A-Za-z]+ says '.*</string>
                            <string>^[A-Za-z]+ projects '.*</string>
                            <string>You say '</string>
                            <string>You project '</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>AUCTION</name>
                        <script>-- Auction: a silvery war axe term ended with NO SALE
demonnic.chat:append(&quot;AUC&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Auction: </string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>SpellTracker</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You have finished praying for</name>
                    <script>local spellname = to_snake(matches[2])

charData:init(&quot;memcount&quot;, 1)

if charData:get(&quot;memcount&quot;) == 0 then
	charData:set(&quot;memcount&quot;, 1)
end

incSpellCount(spellname)

-- update spell button/ spells to memorize

if charData:get(&quot;memcount&quot;) &gt; 0 then
	charData:set(&quot;memcount&quot;, charData:get(&quot;memcount&quot;)-1 )
	MemButton(&quot;update&quot;)
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You have finished praying for ([A-Za-z ]+)[.]</string>
                        <string>You have finished memorizing ([A-Za-z ]+)[.]</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Memorized Spells</name>
                    <script>--               12 - Magic Missile

setSpellCount(to_snake(matches[3]), tonumber(matches[2]))</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^\( [0-9][snrt][dth] circle\) +([0-9]+) - ([A-Za-z ]+)$</string>
                        <string>^\(10th circle\)  ([0-9]) - ([A-Za-z ]+)$</string>
                        <string>^               ?([0-9]+) - ([A-Za-z ]+)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>And you are currently praying for the following spells:</name>
                    <script>-- enable counter

charData:set(&quot;memcount&quot;, 0)

spell:setMem(true)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>And you are currently praying for the following spells:</string>
                        <string>You are currently memorizing the following spells:</string>
                        <string>And you are currently memorizing the following spells:</string>
                        <string>You are currently praying for the following spells:</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>spells to memorize</name>
                    <script>-- 146 seconds:  ( 3rd) Jar The Soul
--  89 seconds:  (10th) Ancestral Fury

if charData:get(&quot;memcount&quot;) == nil then
	charData:set(&quot;memcount&quot;, 0)
end

charData:set(&quot;memcount&quot;, charData:get(&quot;memcount&quot;)+1)
MemButton(&quot;update&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^    [0-9] seconds:  \([1 ][0-9][snrt][tdh]\) ([A-Za-z ]+)$</string>
                        <string>^   [0-9][0-9] seconds:  \([1 ][0-9][snrt][tdh]\) ([A-Za-z ]+)$</string>
                        <string>^  [0-9][0-9 ][0-9] seconds:  \([1 ][0-9][snrt][tdh]\) ([A-Za-z ]+)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your prayers are complete.</name>
                    <script>-- finish mem

spell:setMem(false)

charData:set(&quot;memcount&quot;, 0)
MemButton(&quot;update&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Your prayers are complete.$</string>
                        <string>^Your studies are complete.$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You can pray for no more spells.</name>
                    <script>if prompt:get(&quot;position&quot;) == &quot;sit&quot; and charData:get(&quot;memcount&quot;) == 0 then
	send(&quot;st&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You can pray for no more spells.</string>
                        <string>You can memorize no more spells.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You have memorized the following spells:</name>
                    <script>charData:set(&quot;spells&quot;, {})</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You have memorized the following spells:</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>A feeling of immense power flows through you.</name>
                    <script>if checkMask(&quot;priest&quot;) then
	charData:set(&quot;dprm&quot;, &quot;rm&quot;)
	setLabelImage(&quot;nestDPRM&quot;, &quot;righteous_might-on.png&quot;)
end



</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>A feeling of immense power flows through you.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are praying for Dispel Magic, which will take about 4 seconds.</name>
                    <script>if charData:get(&quot;memcount&quot;) == 0 then
	charData:set(&quot;memcount&quot;, 1)
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are praying for</string>
                        <string>You are memorizing</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You start chanting...</name>
                    <script>-- casting spell
local castspell=spell:getCurrent()

if castspell == nil then
	if command ~= &quot;group&quot; and command ~= &quot;look&quot; then
		spell:setCurrent(command)
		echoDebug(&quot;&lt;red&gt;[Setting spell.casting to &quot; .. command .. &quot;]&quot;)
		castspell=command
	else
		spell:setCurrent(&quot;unknown&quot;)
		echoDebug(&quot;&lt;red&gt;[Setting spell.casting to unknown command: &quot; .. command .. &quot;]&quot;)
		castspell=&quot;unknown&quot;
	end
end

local displayname = to_english(powerAliases:toSpell(castspell))

cecho(&quot;&lt;red&gt; [Casting: &lt;green&gt;&quot; .. castspell .. &quot; (&quot; .. displayname .. &quot;)&lt;red&gt;]&quot;)

-- Update local spellcount

local spellname= powerAliases:toSpell(castspell)

if spellname ~= nil then
	if matches[2] == &quot;chanting&quot; then
   		decSpellCount(spellname)
	elseif matches[2] == &quot;memorized&quot; or matches[2] == &quot;available&quot; then
   		echoDebug(&quot;\n&lt;red&gt;[ Setting spell count for: &quot; .. spellname .. &quot; to 0 after 'Dont have that spell memorized message'.]&quot; )
   		setSpellCount(spellname, 0)

		-- if that spell is currently queued clear it
		-- clear would need to be power alone (not target)

		--spell:clear(spellname)
	end
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You start (chanting)...</string>
                        <string>You don't have that spell (memorized).*</string>
                        <string>You don't have any more spells (available) at that circle!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>spell completed - updated hp</name>
                    <script>-- and hp to local database if heal spells cast

local spellname= spell:getCurrent()

charData:set(&quot;memcount&quot;, charData:get(&quot;memcount&quot;)+1)

if spellname ~= nil then
	local displayname = to_english(powerAliases:toSpell(spellname))

	cecho(&quot;&lt;green&gt; [Completed spell: &quot; .. spellname .. &quot; (&quot; .. displayname .. &quot;) ]&quot;)

	-- [Completed spell: dopple Bombum (Doppleganger) ]

	-- if spellname dopple add buff

	local dopplechar = string.match(spellname, &quot;^dopple (.*)&quot;)

	if groupList:ingroup(dopplechar) then
		buff:set(dopplechar, &quot;doppleganger&quot;, 1000)
	end

	-- if spellname ff or faerie fire mark as cast

	if string.find(spellname, &quot;^ff&quot;) or string.find(spellname, &quot;faerie fire&quot;) then
		spell:setCast(&quot;ff&quot;)
	end

	-- if spell cast was groupheal clear all blind
	if spellname == &quot;gh&quot; then
		for k,char in pairs(groupList:pc()) do
			buff:del(char, &quot;blind&quot;)
			buff:del(char, &quot;blindness&quot;)
		end

		-- is this sending abort?
		spell:setCurrent(nil)
		spell:clear(&quot;gh&quot;)
	end

	local realmchar = string.match(spellname, &quot;^realm (.*)&quot;)

	if groupList:ingroup(realmchar) then
		buff:set(realmchar, &quot;greater_realm_of_protecti&quot;, 45*60)
	end

	local cbchar = string.match(spellname, &quot;^cb (.*)&quot;)

	if groupList:ingroup(cbchar) then
		-- remove blind
		buff:del(cbchar, &quot;blind&quot;)
		buff:del(cbchar, &quot;blindness&quot;)
	end

	local dpuchar = string.match(spellname, &quot;^dpu (.*)&quot;)

	if groupList:ingroup(dpuchar) then
		-- remove blind, para, poison flag on divine purify
		buff:del(dpuchar, &quot;blind&quot;)
		buff:del(dpuchar, &quot;blindness&quot;)
		buff:del(dpuchar, &quot;minor_paralysis&quot;)
		buff:del(dpuchar, &quot;major_paralysis&quot;)
	end

	local fhchar = string.match(spellname, &quot;^fh (.*)&quot;)

	if groupList:ingroup(fhchar) then
		-- remove blind flag on fullheal
		buff:del(fhchar, &quot;blind&quot;)
		buff:del(fhchar, &quot;blindness&quot;)

		local hp=tonumber(groupList:getHP(fhchar))
		local maxhp= tonumber(groupList:getMaxHP(fhchar))

		if hp == nil or maxhp == nil then
			return
		end

		if hp &lt; maxhp then
			hp=hp+300

			if hp &gt; maxhp then
				hp=maxhp
			end

			groupList:setHP(fhchar, hp, maxhp)
		end
	end
else
	cecho(&quot; &lt;green&gt;[Completed spell: &lt;red&gt;unknown&lt;green&gt;]&quot; )
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You complete your spell.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>failed spellcast</name>
                    <script>-- You abort your prayer before it's done! if moving gsay

if matches[2] == &quot;are already affected by&quot; then
	if spell:getCurrent() == nil then
		echoDebug(&quot;&lt;red&gt;[Failed spellcast, but current is nil]&quot;)
	else
		local castString = spell:getCurrent()

		failedSpell = castString

		echoDebug(&quot;\n&lt;red&gt;[ &quot; .. castString .. &quot; : Already affected by this spell ]&quot; )

		-- send status on spell target: only works if grouped
		for k,v in pairs( string.split(castString, &quot; &quot;) ) do
			if k == 2 and groupList:ingroup(v) then
				sendStatus(v)
			end
		end
	end
end

spell:setMem(false)

if spell:getMoving() == false then
	spell:stop()
	spell:cast()
else
	spell:setCurrent(nil)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>They (are already affected by)</string>
                        <string>You (are already affected by) that spell!</string>
                        <string>You don't have that spell memorized.</string>
                        <string>You don't see them here!</string>
                        <string>You have to be standing up to do that!</string>
                        <string>You (are already affected by) Stoneskin!</string>
                        <string>You abort your prayer before it's done!</string>
                        <string>That power hasn't recharged yet!</string>
                        <string>That spell cannot be cast for another</string>
                        <string>You are stunned and unable to concentrate enough for that!</string>
                        <string>You need their consent to do that.</string>
                        <string>You abort your spell before it's done!</string>
                        <string>Impossible! You can't concentrate enough!</string>
                        <string>seems to be just a BIT out of reach.</string>
                        <string>You don't see that item here.</string>
                        <string>Standing would be a good first step.</string>
                        <string>Nobody here by that name.</string>
                        <string>You don't have any more spells available at that circle!</string>
                        <string>Who should the spell be cast upon?</string>
                        <string>You can't use this power on NPCs.</string>
                        <string>You would pass right through them!</string>
                        <string>That power would have no effect on them!</string>
                        <string>You need to be able to speak to do that!</string>
                        <string>You can't do that without solid ground underneath you!</string>
                        <string>You are already maintaining that power!</string>
                        <string>The magic gathers, then fades away.</string>
                        <string>Nobody playing by that name.</string>
                        <string>You can't see a thing, you're blinded!</string>
                        <string>They have too much health to be affected by that.</string>
                        <string>You can't teleport there.</string>
                        <string>You must be in the same room as the group leader to do that.</string>
                        <string>You can't do that underwater!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You're busy spellcasting! </name>
                    <script>if spell:getCurrent() ~= nil then
	echoDebug(&quot;&lt;red&gt;[Busy casting: &quot; .. spell:getCurrent() .. &quot;]&quot;)
else
	echoDebug(&quot;&lt;red&gt;[Unknown spell being cast]&quot;)
end

cecho(&quot;&lt;red&gt; [command: &quot; .. command .. &quot;]\n&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You're busy spellcasting! </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You complete your spell...</name>
                    <script>-- sets to nil

--charData:set(&quot;memcount&quot;, 0)

if matches[2] == &quot;You clamber to your feet.&quot; or matches[2] == &quot;Your prayers are complete.&quot; then
	if checkMask(&quot;casterPsi&quot;) then
		MemButton(&quot;init&quot;)
	end
end

if checkMask(&quot;singer&quot;) == false then
	MemButton(&quot;update&quot;)
end

if matches[2] == &quot;That spell cannot be cast for another&quot; then
	send(&quot;recharge&quot;)
end

groupSent=nil
NyyLIB.tolook=0

spell:stop() -- set spell.casting=nil

-- only have priests send group command after casting
if checkMask(&quot;pray&quot;) then
	sendGroup()
end

sendLook()
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You complete your spell...).*</string>
                        <string>(You clamber to your feet.)</string>
                        <string>(Your prayers are complete.)</string>
                        <string>(You finish scribing spell)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>[A-Za-z]+ group-says 'moving.*</name>
                    <script>-- reset variable
NyyLIB.escapedir = nil

spell:setMoving(true)

if checkMask(&quot;psi&quot;) then
	if getHide() then
		echo(&quot;\n[Not standing, currently hidden.]\n&quot;)
	else
		mud:send(&quot;st&quot;)
	end
end

if checkMask(&quot;caster&quot;) or checkMask(&quot;nonPriestCaster&quot;) or checkMask(&quot;pray&quot;) then

--if checkMask(&quot;caster&quot;) or checkMask(&quot;pray&quot;) then
	--setLabelImage(&quot;SpellsButton&quot;, &quot;encSpells-off.png&quot;)

	spell:clear()

	if getHide() then
		echo(&quot;\n[Not standing, currently hidden.]\n&quot;)
	else
		mud:send(&quot;st&quot;)
	end
end

if mount:getMounted() then
	mud:send(&quot;dismount&quot;)
end

automem = 0

--expandAlias(&quot;#debug&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>[A-Za-z]+ group-says 'movin|mving|omving|dmoving|mvoing.*</string>
                        <string>([A-Za-z]+) group-says '(Adud|adud|tanks) ([nsewud]).*'</string>
                        <string>.* group-says '\[Moving to: .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>gsay memorize trigger</name>
                    <script>if matches[2] == NyyLIB.leader then
	if checkMask(&quot;casterPsi&quot;) or checkMask(&quot;nonPriestCaster&quot;) then
	--if checkMask(&quot;casterPsi&quot;) then
		if not getHide() then
			if memsent == true then
				echo(&quot;\n&quot;)
			end

			mud:send(&quot;mem&quot;)
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) group-says 'mem.*</string>
                        <string>([A-Za-z]+) group-says 'quick mem'</string>
                        <string>([A-Za-z]+) group-says 'dmem.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You continue your study.</name>
                    <script>local label=findlabel(&quot;MemButton&quot;)

if label ~= nil then
	label:setStyleSheet([[border-image: url(]] .. iconpath(&quot;stand.png&quot;) .. [[)]])
end

echoDebug(&quot;&lt;red&gt;[Setting membutton to stand]&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You continue your study.</string>
                        <string>You continue your praying.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You abandon your studies.</name>
                    <script>-- reset variable
NyyLIB.escapedir = nil

mud:send(&quot;st&quot;)

spell:setMem(false)

automem=0

MemButton(&quot;init&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You abandon your studies.</string>
                        <string>You abandon your prayers.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>The world starts spinning, and your ears are ringing!</name>
                    <script>-- stunned

sound(&quot;274736__sforsman__distort-ring-2.wav&quot;)

buff:set(whoami(), &quot;stun&quot;, 2)
spell:clear()
sendStatus()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The world starts spinning, and your ears are ringing!</string>
                        <string>You are stunned and unable to concentrate enough for that!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You purge 'Healing Aura' spell from your thoughts.</name>
                    <script>local spellname= to_snake(matches[2])

decSpellCount(spellname)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You purge '(.*)' spell from your thoughts.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You can't concentrate with all the racket!</name>
                    <script>-- set as currently moving

-- You clamber to your feet. &lt;- Can't use, won't cast

spell:setMoving(true)
sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You can't concentrate with all the racket!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are already affected by that spell!</name>
                    <script>sendStatus()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are already affected by that spell!</string>
                        <string>Your form begins to</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are in a dead magic area and cannot cast spells!</name>
                    <script>-- this room is !cast (either magically or beholder proc)

-- The magic gathers, then fades away.

nomagic = true

spell:clear()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are in a dead magic area and cannot cast spells!</string>
                        <string>You need to be able to speak to do that!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You seem to have misplaced your spell book during memorization.</name>
                    <script>-- disable automem
charData:set(&quot;autocast&quot;, false)
SpellsButton(&quot;init&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You seem to have misplaced your spell book during memorization.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You've created a devastating sandstorm!</name>
                    <script>-- sandstorm - add 12 minute cooldown
timer:set(&quot;sandstorm&quot;, 12*60)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You've created a devastating sandstorm!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>recharge - sandstorm</name>
                    <script>--  - Sandstorm in 5 minutes 45 seconds 1 pulse 
--  - Sandstorm in 2 minutes 2 seconds 2 pulses 

local timeleft

if matches[2] == &quot;recharging&quot; then
	timeleft=0
else
	if matches[3] == nil then
		timeleft = tonumber(matches[2])
	else
		timeleft = tonumber(matches[2])*60 + tonumber(matches[3])
	end
end

timer:set(&quot;sandstorm&quot;, timeleft)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Sandstorm in ([0-9]+) seconds .*</string>
                        <string> - Sandstorm in ([0-9]) minutes ([0-9]+) seconds</string>
                        <string>You do not have any powers (recharging).</string>
                        <string> - Sandstorm in ([0-9]) minute ([0-9]+) seconds</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>ClassTriggers</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Bard</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are not composed enough to sing.</name>
                        <script>tempTimer(3, playsong)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are not composed enough to sing.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You decide not to expend the mana required to keep your song.</name>
                        <script>charData:set(&quot;_instrument&quot;, charData:get(&quot;instrument&quot;) )

charData:set(&quot;_song&quot;, charData:get(&quot;song&quot;) )

echoDebug(&quot;\n&lt;red&gt;[Previous song set: &quot; .. charData:get(&quot;_song&quot;) .. &quot;]&quot; )

tempTimer(3, tr_renew)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You decide not to expend the mana required to keep your song.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Resume singing</name>
                        <script>if checkMask(&quot;singer&quot;) then
	playsong()
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The world stops spinning.</string>
                            <string>You are no longer attractive to pigeons.</string>
                            <string>You feel able to speak again.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Heal vs Dragons</name>
                        <script>-- if you get attacked by a dragon and aren't singing heal, switch to heal
if checkMask(&quot;singer&quot;) then
	if charData:get(&quot;song&quot;) ~= &quot;song of healing&quot; then
 		send(&quot;st&quot;)
 		send(&quot;rem ravenous&quot;)
 		music( charData:get(&quot;lute&quot;), &quot;song of healing&quot;, &quot;&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You reel backwards in pain as the massive tail smashes into you!</string>
                            <string>breathes Fire!</string>
                            <string>breathes a cone of frost!</string>
                            <string>staggers in pain as the massive tail smashes into</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Songs</name>
                        <script></script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList/>
                        <regexCodePropertyList/>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish a verse of the song of healing.</name>
                            <script>if NyyLIB.active ~= &quot;HealSong&quot; then
	resetSongs()

	setLabelImage(&quot;HealSong&quot;, &quot;barHeal-on.png&quot;)

	NyyLIB.active = &quot;HealSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish a verse of the song of healing.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish a verse of the song of protection.</name>
                            <script>if NyyLIB.active ~= &quot;ProtectSong&quot; then
	resetSongs()

	setLabelImage(&quot;ProtectSong&quot;, &quot;protect-on.png&quot;)

	NyyLIB.active = &quot;ProtectSong&quot;
end

NyyLIB.songtimer=12
</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish a verse of the song of protection.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish a verse of the song of renewal.</name>
                            <script>if NyyLIB.active ~= &quot;RenewSong&quot; then
	resetSongs()

	setLabelImage(&quot;RenewSong&quot;, &quot;renew-on.png&quot;)

	NyyLIB.active = &quot;RenewSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish a verse of the song of renewal.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish a verse of the song of sorcery.</name>
                            <script>NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish a verse of the song of sorcery.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish a verse of the song of travel.</name>
                            <script>if NyyLIB.active ~= &quot;TravelSong&quot; then
	resetSongs()

	--setLabelImage(&quot;TravelSong&quot;, &quot;travel-on.png&quot;)

	NyyLIB.active = &quot;TravelSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish a verse of the song of travel.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You finish belting out a verse of the song of harming.</name>
                            <script>if NyyLIB.active ~= &quot;HarmSong&quot; then
	resetSongs()

	setLabelImage(&quot;HarmSong&quot;, &quot;barHarm-on.png&quot;)

	NyyLIB.active = &quot;HarmSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You finish belting out a verse of the song of harming.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Your bellowing blast deadens the reflexes of your foes.</name>
                            <script>if NyyLIB.active ~= &quot;SlowSong&quot; then
	resetSongs()

	setLabelImage(&quot;SlowSong&quot;, &quot;slow-on.png&quot;)

	NyyLIB.active = &quot;SlowSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Your bellowing blast deadens the reflexes of your foes.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Your harmonious notes flood the room, inspiring your companions.</name>
                            <script>NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Your harmonious notes flood the room, inspiring your companions.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Your quickening chant fills your cohort with awesome determination.</name>
                            <script>if NyyLIB.active ~= &quot;HasteSong&quot; then
	resetSongs()

	setLabelImage(&quot;HasteSong&quot;, &quot;barHaste-on.png&quot;)

	NyyLIB.active = &quot;HasteSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Your quickening chant fills your cohort with awesome determination.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Your voice lifts the spirits of your companions.</name>
                            <script>if NyyLIB.active ~= &quot;RecoverySong&quot; then
	resetSongs()

	--	setLabelImage(&quot;RecoverySong&quot;, &quot;recover-on.png&quot;)

	-- label=findlabel(&quot;RecoverySong&quot;)
	-- label:setStyleSheet([[border-image: url(]] .. iconpath(&quot;recover-on.png&quot;) .. [[)]])

	NyyLIB.active = &quot;RecoverySong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Your voice lifts the spirits of your companions.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You complete another verse, of the song of regeneration.</name>
                            <script>if NyyLIB.active ~= &quot;RegenSong&quot; then
	resetSongs()

	setLabelImage(&quot;RegenSong&quot;, &quot;barRegen-on.png&quot;)

	NyyLIB.active = &quot;RegenSong&quot;
end

NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You complete another verse, of the song of regeneration.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Your solemn chant steadies your cohort with stalwart determination.</name>
                            <script>NyyLIB.songtimer=12</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Your solemn chant steadies your cohort with stalwart determination.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                    </TriggerGroup>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body becomes more in tune with your mind!</name>
                        <script>--setLabelImage(&quot;barBless&quot;, &quot;barBless-on.png&quot;)
buff:set(whoami(), &quot;harmonious_blessing&quot;, 780) -- 30 seconds extra</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body becomes more in tune with your mind!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel less in tune with your body!</name>
                        <script>--setLabelImage(&quot;barBless&quot;, &quot;barBless-off.png&quot;)
buff:del(whoami(), &quot;harmonious_blessing&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel less in tune with your body!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your song has no affect here!</name>
                        <script>mud:send(&quot;stopmusic&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your song has no affect here!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You begin singing.</name>
                        <script>setLabelImage(&quot;StopMusic&quot;, &quot;barStopMusic-timer.png&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You begin singing.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You stop your song.</name>
                        <script>setLabelImage(&quot;StopMusic&quot;, &quot;stopmusic.png&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You stop your song.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your spells have replenished.</name>
                        <script>setSpellCount(&quot;harmonious_blessing&quot;, 3)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your spells have replenished.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Determine char class level</name>
                    <script>charData:set(&quot;level&quot;, tonumber(matches[2]))

sqlinwho(whoami())

if inwho(whoami()) == false then
	for k, v in pairs(NyyLIB.fullclasslist) do
		if v[1] == matches[4]:trim()	 then
			whoadd(whoami(), v[2], matches[3]:trim())
		end
	end
end

-- Change from necro to lich in wholist

if matches[4]:trim() == &quot;Lich&quot; then
	if NyyLIB.WhoClass.wholist[whoami()] ~= nil then
		NyyLIB.WhoClass.wholist[whoami()][1] = &quot;Lic&quot;
	end
end

if NyyLIB.initgui == false then
	initFullData()
end

checkVoteButton()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Level: ([0-9]+)[ ]+Race: ([A-Z a-z-]+)[ ]+Class: ([A-Za-z-]*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Psi</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>^([A-Za-z]+) tells you '(worm|well|hole) ([A-Za-z]+)'</name>
                        <script>if charData:get(&quot;disableworm&quot;) then
	if checkMask(&quot;psi&quot;) then
		send(&quot;t &quot; .. matches[2] .. &quot; &quot; .. string.title(matches[2]) .. &quot;, lack of voting on TMC (http://www.mudconnect.com/cgi-bin/vote_rank.cgi?mud=TorilMud,+the+Sojourner%27s+Home) has disabled this trigger. 30+ people are online free daily, but not willing to vote.&quot;)
		return
	end
end

if checkMask(&quot;psi&quot;) then
	if not getHide() then
		if charData:get(&quot;wormhole&quot;) then
			eraseLine()
			noSound = true

			if matches[4] == &quot;me&quot; or matches[4] == &quot;please&quot; then
				mud:send(&quot;worm &quot; .. matches[2])
			else
				mud:send(&quot;worm &quot; .. matches[4])
			end

			NyyLIB.psilag=&quot;wormhole&quot;

			tempTimer(1.5, [[mud:send(&quot;mem&quot;)]])
	
			sendLook()
		end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^([A-Za-z]+) tells you '(worm|well|hole|wormhole|hol) ([A-Za-z]+)( .*)?'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>^([A-Za-z]+) tells you '(rift|gate) ([A-Za-z]+)'</name>
                        <script>if charData:get(&quot;disableworm&quot;) then
	if checkMask(&quot;psi&quot;) then
		send(&quot;t &quot; .. matches[2] .. &quot; &quot; .. string.title(matches[2]) .. &quot;, lack of voting on TMC (http://www.mudconnect.com/cgi-bin/vote_rank.cgi?mud=TorilMud,+the+Sojourner%27s+Home) has disabled this trigger. 30+ people are online free daily, but not willing to vote.&quot;)
		return
	end
end

if not getHide() then
	if charData:get(&quot;wormhole&quot;) then
		eraseLine()
		noSound = true

		mud:send(&quot;rift &quot; .. matches[4])
		NyyLIB.psilag=&quot;rift&quot;

		tempTimer(1.5, [[mud:send(&quot;mem&quot;)]])

		sendLook()
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^([A-Za-z]+) tells you '(rift|gate) ([A-Za-z]+)( .*)?'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your ultrablast hits [A-Za-z0-9]+ target[s.]+</name>
                        <script>charData:set(&quot;ultraquested&quot;, true)
NyyLIB.psilag=&quot;ultra&quot;
sendLook()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your ultrablast hits [A-Za-z0-9]+ target[s.]+</string>
                            <string>You feel a field of lethal energy start expanding outward.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Exits: .*</name>
                        <script>if NyyLIB.psilag == &quot;ultra&quot; then
	if setLabelImage(&quot;ultrablast&quot;, &quot;ultrablast-off.png&quot;) == nil then
		addbutton(&quot;ultrablast&quot;, 6, 47)
	end
end

if NyyLIB.psilag == &quot;death&quot; then
	if setLabelImage(&quot;deathfield&quot;, &quot;deathfield-off.png&quot;)	== nil then
		addbutton(&quot;deathfield&quot;, 6, 20)
	end
end 

NyyLIB.psilag = &quot;none&quot;</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^Exits: .*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You envelop your mind in a protective tower.</name>
                        <script>if charData:get(&quot;autotower&quot;) then
	setBackgroundColor(&quot;tower&quot;, 0,0,150,255)
end

NyyLIB.tower = 1
sendLook()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You envelop your mind in a protective tower.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel more vulnerable to psionic attack.</name>
                        <script>NyyLIB.tower=0

if charData:get(&quot;autotower&quot;) then
	send(&quot;tower me&quot;, false)
	setBackgroundColor(&quot;tower&quot;,32,32,32,255)
	NyyLIB.psilag=&quot;tower&quot;
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel more vulnerable to psionic attack.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>becomes more alert, evaluating possible targets.</name>
                        <script>local xchar = matches[2]
local nx

if groupList:ingroup(xchar) then
	buff:set(xchar, &quot;combatmind&quot;, 600)
	sendLook()
end

for k,char in pairs(groupList:pc(&quot;hitterSinger&quot;)) do
	if not buff:get(&quot;combatmind&quot;, char) then
		return
	end
end

setBackgroundColor(&quot;combatmind&quot;, 0,0,150,255)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Z][a-z]+) becomes more alert, evaluating possible targets.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Drawing darkness itself around you,</name>
                        <script>setHide(true)
sendLook()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Drawing darkness itself around you,</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>projection improves your fighting ability.</name>
                        <script>-- batletrance on
setBackgroundColor(&quot;battletrance&quot;, 0,0,150,255)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>projection improves your fighting ability.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel a little confused as your augmented knowledge of battle tactics fades.</name>
                        <script>-- battletrance off
setBackgroundColor(&quot;battletrance&quot;,32,32,32,255)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel a little confused as your augmented knowledge of battle tactics fades.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>[A-Za-z]+ group-says 'tower'</name>
                        <script>if not getHide() then
	mud:send(&quot;tower me&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>[A-Za-z]+ group-says 'tower'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name> group-says 'hole|worm ([A-Za-z])''</name>
                        <script>if checkMask(&quot;psi&quot;) then
	if getHide() then
		echo(&quot;[Not worming, currently hidden.]\n&quot;)
	else
		mud:send(&quot;worm &quot; .. matches[2])
	end
end

</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string> group-says 'hole|worm ([A-Za-z]+)''</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The air in the immediate area darkens abruptly as a result of your projection!</name>
                        <script>NyyLIB.psilag=&quot;death&quot;
sendLook()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The air in the immediate area darkens abruptly as a result of your projection!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You start meditating...</name>
                        <script>spell:setMem(true)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You start meditating...</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You stop meditating.</name>
                        <script>spell:setMem(false)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You stop meditating.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body grows taller as you complete your projection.</name>
                        <script>if whosize() == &quot;L&quot; then
	charData:set(&quot;bodysize&quot;, &quot;H&quot;)
elseif whosize() == &quot;M&quot; then
	charData:set(&quot;bodysize&quot;, &quot;L&quot;)
elseif whosize() == &quot;S&quot; then
	charData:set(&quot;bodysize&quot;, &quot;M&quot;)
end

setLabelImage(&quot;mysizeDisplay&quot;, &quot;size&quot; .. charData:get(&quot;bodysize&quot;) .. &quot;.png&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body grows taller as you complete your projection.</string>
                            <string>Your body grows to gigantic heights!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You flee (.*)ward!</name>
                        <script>if NyyLIB.escapedir ~= nil then
	-- send reverse

	if NyyLIB.escapedir ~= matches[2] then
		expandAlias(NyyLIB.reversedirs[matches[2]], false)
		expandAlias(NyyLIB.escapedir, false)
	end

	NyyLIB.escapedir = nil

end

if checkMask(&quot;psi&quot;) then
	if charData:get(&quot;autohide&quot;) then
		send(&quot;darkness&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You flee ([nsewud]).*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You focus your mind and force your body to return to its natural size.</name>
                        <script>charData:set(&quot;bodysize&quot;, whosize())

setLabelImage(&quot;mysizeDisplay&quot;, &quot;size&quot; .. charData:get(&quot;bodysize&quot;) .. &quot;.png&quot;)

if table.contains( {&quot;psi&quot;, &quot;Enc&quot; }, whoclass() ) then
	-- size change, no echo needed
else
	mud:send(&quot;gsay [[ SPELLOUT - NOW SIZE=&quot; .. charData:get(&quot;bodysize&quot;) .. &quot;]]&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You focus your mind and force your body to return to its natural size.</string>
                            <string>Your body size returns to normal.</string>
                            <string>Your body returns to its normal size.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body shrinks substantially as you complete your projection.</name>
                        <script>if whosize() == &quot;L&quot; then
	charData:set(&quot;bodysize&quot;, &quot;M&quot;)
elseif whosize() == &quot;M&quot; then
	charData:set(&quot;bodysize&quot;, &quot;S&quot;)
elseif whosize() == &quot;S&quot; then
	charData:set(&quot;bodysize&quot;, &quot;T&quot;)
end

setLabelImage(&quot;mysizeDisplay&quot;, &quot;size&quot; .. charData:get(&quot;bodysize&quot;) .. &quot;.png&quot;)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body shrinks substantially as you complete your projection.</string>
                            <string>Your body shrinks substantially.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>War</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>EC: ([A-Za-z ]+) EP: (std|sit|rcl) P: (std)</name>
                        <script>-- Being the ferocious sort, you charge at the enemy!

-- trip (rogue)

-- EC: ([A-Za-z ]+) EP: (std|sit|rcl) P: (std|sit|rcl)

if checkMask(&quot;rog&quot;) then
	if charData:get(&quot;autotrip&quot;) then
		if matches[3] == &quot;std&quot; then
			sendTrip()			
		end
	end
end

-- bash (fighter)

if checkMask(&quot;fighter&quot;) == false then
	return
end

if NyyLIB.escapedir ~= nil then
	return
end

if matches[3] == &quot;std&quot; then
	if charData:get(&quot;autobash&quot;) then
		--if matches[2] ~= &quot;awful&quot; then
			sendBash()
		--end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>EC: ([A-Za-z ]+) EP: (std|sit|rcl) P: (std|sit|rcl)</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You miss an elderly priest of Mielikki with your clumsy shieldpunch!</name>
                        <script>if checkMask(&quot;fighter&quot;) then
	if prompt:get(&quot;enemycondition&quot;) ~= &quot;awful&quot; then
		if charData:get(&quot;autoshieldpunch&quot;) then
			send(&quot;shieldpunch&quot;)
		end	
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>with your clumsy shieldpunch!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Bash</name>
                        <script></script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList/>
                        <regexCodePropertyList/>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Elaith Waterstill clambers to his feet.</name>
                            <script>if not inCombat() then
	return
end

if checkMask(&quot;rog&quot;) then
	if groupList:ingroup(matches[2]) == false and whoclass(matches[2]) == nil then
		if charData:get(&quot;autotrip&quot;) then
			sendTrip()			
		end
	end
end

if checkMask(&quot;fighter&quot;) == false then
	return
end

if NyyLIB.escapedir ~= nil then
	return
end

if groupList:ingroup(matches[2]) == false and whoclass(matches[2]) == nil then
	if charData:get(&quot;autobash&quot;) then
		sendBash()
	end
end</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>^(.*) clambers to .*</string>
                                <string>^(.*) rises to (his|her|its) feet.$</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Ulosa, in a show of awesome skill, manages to trip up herself!</name>
                            <script>-- missed trips

NyyLIB.failedtrip = NyyLIB.failedtrip or 0

if NyyLIB.escapedir ~= nil then
	return
end

if checkMask(&quot;fighter&quot;) then
	if groupList:ingroup(matches[2]) then
		NyyLIB.failedtrip = NyyLIB.failedtrip + 1

		if NyyLIB.failedtrip == 1 then
			sendBash()
		end
	end
end</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>([A-Za-z]+), in a show of awesome skill, manages to trip up .*</string>
                                <string>avoids being bashed by ([A-Za-z]+), who loses his balance and falls.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>failed rescues or bashes</name>
                            <script>setBashing(false)</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>Sorry, you can't do that while lying around.</string>
                                <string>you topple over and fall to the ground.</string>
                                <string>You haven't reoriented yourself yet enough for another bash!</string>
                                <string>Maybe you should get on your feet first?</string>
                                <string>nimbly avoids your powerful shield bash!</string>
                                <string>You are too stunned to do that!</string>
                                <string>Your mount misses</string>
                                <string>You have to be mounted to do that!</string>
                                <string>Your mount refuses to trample!</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Ulosa does an acrobatic maneuver in battle, and trips up</name>
                            <script>if groupList:ingroup(matches[2]) then
	NyyLIB.failedtrip=0
end</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>([A-Za-z]+) does an acrobatic maneuver in battle, and trips up</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>You assist a dapper noble heroically.</name>
                            <script>-- assisting someone
setBashing(false)
setTripping(false)

spell:setMem(false)


-- rogue: circle
if charData:get(&quot;autocircle&quot;) then
	expandAlias(&quot;cr&quot;, false)
end
</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>You assist (.*) heroically.</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                    </TriggerGroup>
                    <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>KegorRescue</name>
                        <script></script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList/>
                        <regexCodePropertyList/>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>visible fighting</name>
                            <script>-- Bafog dodges an ice troll's attack.

-- A burly bouncer deflects Aliha's blow, and strikes back at Aliha!
-- A burly bouncer severely wounds Aliha with his massive bludgeon.

-- if prior line = deflect, return



local torescue=matches[3]

if NyyLIB == nil then
	return
end

if charData:get(whoami(), true) == nil then
	return
end

if checkMask(&quot;fighter&quot;) == false then
	return
end

if NyyLIB.escapedir ~= nil then
	return
end

if torescue == whoami() then
	return
end

if prompt:get(&quot;hp&quot;) &lt; 300 then
	return
end

if string.find(previousLine(), &quot;deflects&quot;) then
	echoDebug(&quot;deflect detected\n&quot;)
	return
end


-- rescue wuss

if torescue == charData:get(&quot;wuss&quot;) then
	sendRescue(torescue)
	return
end


-- autorescue code


if charData:get(&quot;rescuetype&quot;) ~= &quot;off&quot; then
	if groupList:ingroup(torescue) then
		if checkMask(&quot;warrior&quot;, torescue) and charData:get(&quot;rescuetype&quot;) == &quot;basic&quot; then
			return
		end

		sendRescue(torescue)
	end
end</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>.*(,\sfighting|wounds|knocks|misses|a\smirror\simage\sof|tried\sto\sbackstab|tries\sto\srescue|attacks|beat|beats|choke|chokes|touch|touches|hit|hits|slash|slashes|crush|crushes|whip|whips|pierce|pierces|smash|smashes|sting|stings|drain|drains|strike|strikes|pummel|pummels|pound|pounds|claw|claws|nip|nips|burn|burns|bite|bites) ([A-Za-z]+)</string>
                                <string>in (the back) of ([A-Za-z]+), resulting in some strange noises</string>
                                <string>(.*) sends ([A-Za-z]+) sprawling with a powerful bash.</string>
                                <string>(&lt; ).* T: ([A-Za-z]+) TC: .* E: .* EC: .* EP: .* P: .* &gt; </string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                                <integer>1</integer>
                                <integer>1</integer>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>rescue messages</name>
                            <script>rescueSent=false
sendLook()</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>But nobody is fighting him?</string>
                                <string>You fail the rescue.</string>
                                <string>Banzai! To the rescue...</string>
                                <string>You don't see them here!</string>
                                <string>But nobody is fighting her?</string>
                                <string>Who do you want to rescue?</string>
                                <string>Sorry, you can't do that while lying around.</string>
                                <string>But nobody is fighting it?</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                                <integer>0</integer>
                            </regexCodePropertyList>
                        </Trigger>
                    </TriggerGroup>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Rescue tank</name>
                        <script>local tank=prompt:get(&quot;tank&quot;)
local tankcondition= prompt:get(&quot;tankcondition&quot;)
local hp=prompt:get(&quot;hp&quot;)
local maxhp=prompt:get(&quot;maxhp&quot;)

if tank == whoami() then
	return
end

if hp == nil then
	return
end

if hp &lt; (.40 * maxhp ) then
	return
end

if checkMask(&quot;fighter&quot;) == false then
	return
end

if NyyLIB.escapedir ~= nil then
	return
end

if tank == &quot;ghost&quot; then
	sendRescue(tank)
	return
end

if (charData:get(&quot;rescuetype&quot;) == &quot;basic&quot; or charData:get(&quot;rescuetype&quot;) == &quot;all&quot;) and
 table.contains( {&quot;awful&quot;, &quot;pretty hurt&quot;}, tankcondition ) then
	sendRescue(tank)	

	return
end

if charData:get(&quot;rescuetype&quot;) == &quot;all&quot; then
	sendRescue(tank)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>&lt; .* T: ([A-Za-z]+) TC: ([A-Za-z ]+) .*&gt; </string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Impossible to get to now!</name>
                        <script>send(&quot;get all&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Impossible to get to now!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You make a great effort, and send a training dummy's weapon crashing to the floor.</name>
                        <script>send(&quot;get all&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You make a great effort, and send .* weapon crashing to the floor.</string>
                            <string>You have managed to get FAR TOO CLOSE to .*</string>
                            <string>.* steps directly in front of your path.  No way to get it now.</string>
                            <string>.* hurtles itself into close vicinity of the .*  Impossible to get to now!</string>
                            <string>You fail miserably in your attempt to disarm .*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Autotank</name>
                        <script></script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList/>
                        <regexCodePropertyList/>
                        <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                            <name>Lilithelle group-says 'tanks ([nsewud])'</name>
                            <script>if checkMask(&quot;fighter&quot;) == false then
	return
end

if ( matches[3] == &quot;Adud&quot; or matches[3] == &quot;adud&quot; ) and whoami() ~= &quot;Adud&quot; then
	return
end

if charData:get(&quot;autotank&quot;) then
	-- If less then 75% hp, grep and don't move
	if prompt:get(&quot;hp&quot;) &lt; .75 * prompt:get(&quot;maxhp&quot;) then
		mud:send(&quot;tackle &quot; .. matches[2])
		mud:send(&quot;grep&quot;)
		return
	end

	if matches[2] == NyyLIB.leader then
		if matches[4] == &quot;en&quot; then
			mud:send(&quot;enter &quot; .. matches[5])
		else
			mud:send(matches[4])
		end
	end
end</script>
                            <triggerType>0</triggerType>
                            <conditonLineDelta>0</conditonLineDelta>
                            <mStayOpen>0</mStayOpen>
                            <mCommand></mCommand>
                            <packageName></packageName>
                            <mFgColor>#ff0000</mFgColor>
                            <mBgColor>#ffff00</mBgColor>
                            <mSoundFile></mSoundFile>
                            <colorTriggerFgColor>#000000</colorTriggerFgColor>
                            <colorTriggerBgColor>#000000</colorTriggerBgColor>
                            <regexCodeList>
                                <string>([A-Za-z]+) group-says '(Adud|adud|tanks) ([nsewud])( .*)?'</string>
                                <string>([A-Za-z]+) group-says '(Adud|adud|tanks) (north|south|east|west|up|down)'</string>
                                <string>([A-Za-z]+) group-says '(Adud|adud|tanks) (en) (.*)'</string>
                            </regexCodeList>
                            <regexCodePropertyList>
                                <integer>1</integer>
                                <integer>1</integer>
                                <integer>1</integer>
                            </regexCodePropertyList>
                        </Trigger>
                    </TriggerGroup>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A wall of rotting flesh and carrion plows through the corridor.</name>
                        <script>if whoami() == &quot;Adud&quot; then
	mud:send(&quot;bh wall&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A wall of rotting flesh and carrion plows through the corridor.</string>
                            <string>A living wall stands here</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>kick trigger</name>
                        <script>-- if autokick enabled send kick
--TODO: should change to recognize group leader bashing (trains). Can't kick if mounted

if charData:get(&quot;autokick&quot;) then
	if groupList:ingroup(matches[2]) or matches[2] == &quot;Your&quot; then
		mud:send(&quot;kc&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(Your) bash at .* sends (him|her|it) sprawling.</string>
                            <string>(.*) sends .* sprawling with a powerful bash.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You get a rune graven adamantine longsword.</name>
                        <script>mud:send(&quot;wield graven&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You get a rune graven adamantine longsword.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Enc</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Lic</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>RotTrigger</name>
                        <script>local nx
local ix


for nx=1,4,1 do
	for ix=1,7,1 do
		send(&quot;time&quot;)
	end

	if nx &gt; 1 then
		for ix=1,7,1 do
			send(&quot;time&quot;)
		end
	end	 

	send(&quot;enter rift&quot;)
	send(&quot;enter rift&quot;)

	--send(NyyLIB.rotmovedir)

	--if NyyLIB.rotmovedir == &quot;n&quot; then
	--	send(&quot;s&quot;)
	--end
end

disableTrigger(&quot;RotTrigger&quot;)

--#LOOP 3 {
--  #LOOP 7 {time}

--  #IF (%i&gt;1) {#LOOP 7 {time}}
  
--  @CreepingDoomMoveDir
--  %reversedir(@CreepingDoomMoveDir)
--}
--#T- CreepingDoomTrig</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^You complete</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Stephan recoils in fear from the sudden assault of baleful sound.</name>
                        <script>-- banshee wail took effect</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>recoils in fear from the sudden assault of baleful sound.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A black aura surrounds A burly bouncer briefly, then dissipates.</name>
                        <script>-- blackmantle</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A black aura surrounds .* briefly, then dissipates.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your contagion wave washes over A naked woman, causing her to sag feebly.</name>
                        <script>-- contagion</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your contagion wave washes over</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Cle</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>HA countdown timer</name>
                        <script>-- cast healing aura if cleric and #mtank set (countdown timer)

-- mark as ha when heal proc happens

spell:setMoving(false)

NyyLIB.mtank=matches[2]

if checkMask(&quot;Cle&quot;) then
	--if charData:get(&quot;autoheal&quot;) then
		if spell:getMem() then
			send(&quot;st&quot;)
		end

		--spell:cast(&quot;ha &quot; .. NyyLIB.mtank)
	--end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '&lt;4&gt;'</string>
                            <string>([A-Za-z]+) group-says ''-=4=-'</string>
                            <string>([A-Za-z]+) group-says 'Killing dragon in:'</string>
                            <string>([A-Za-z]+) group-says '-5'</string>
                            <string>([A-Za-z]+) group-says '5!'</string>
                            <string>([A-Za-z]+) group-says '5'</string>
                            <string>([A-Za-z]+) group-says 'Going in: 5'</string>
                            <string>([A-Za-z]+) group-says 'going in 5'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Autoquake triggers</name>
                        <script>-- Flag earthquake to be cast

-- The ghost of Talrinim stands in mid-air here, fighting Brammithizzar.&quot;set quake&quot;
-- true


if not checkMask(&quot;priest&quot;) or not charData:get(&quot;autoquake&quot;) then
	return
end

-- last command entered was look direction or scan - return
if string.find(command, &quot;l &quot;) == 1 or string.find(command, &quot;look &quot;) == 1 or command == &quot;scan&quot; then
	return
end

setQuake(true)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^A frost giant jarl stands.*, fighting</string>
                            <string>^A member of the Smoking Beard battalion stands.*, fighting</string>
                            <string>^A fire giant captain stands.*, fighting</string>
                            <string>^A sandman stands.*, fighting</string>
                            <string>^A frost giant spirit-seeker stands.*, fighting</string>
                            <string>^A vine of thorns stands.*, fighting</string>
                            <string>^A hideous choker stands.*, fighting</string>
                            <string>^Talrinim stands.*, fighting</string>
                            <string>^A living wall stands.*, fighting</string>
                            <string>^A minion of Moander stands.*, fighting</string>
                            <string>^Goortok stands.*, fighting</string>
                            <string>^A carnivorous vine stands.*, fighting</string>
                            <string>^Thrym stands.*, fighting</string>
                            <string>A tower apprentice stands.*, fighting</string>
                            <string>A busy clerk stands.*, fighting</string>
                            <string>Yamel Rerraser stands.*, fighting</string>
                            <string>^Granak .* here, fighting .*</string>
                            <string>The Tarrasque stands here, fighting</string>
                            <string>Blintim Trilamir stands here, fighting</string>
                            <string>A Spellguard apprentice stands in mid-air here, fighting</string>
                            <string>An ancient guardian stands in mid-air here, fighting</string>
                            <string>A toad demon stands in mid-air here, fighting</string>
                            <string>^A .*(mage|warlock|druid|shaman|cleric|priest|priestess|invoker|oracle|seer|hierophant|wizard) .*, fighting .*</string>
                            <string>A member of the Smoking Beard battalion flies in from</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Healing aura on lich</name>
                        <script>-- healing aura after lich proc

-- mark char as liched for when heal proc happens

if getSpellCount(&quot;healing_aura&quot;) &gt; 0 then
	if not buff:get(&quot;healing_aura&quot;, matches[2]) then
		spell:setNext(&quot;ha &quot; .. matches[2])
	end
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>.* literally sucks the life force from ([A-Za-z]+), who crumples into a ball of lifeless </string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Remove poison on venom</name>
                        <script>-- venom

-- mark char as venomed for heal proc

local charname = matches[2]

if not checkMask(&quot;priest&quot;) then
	return
end

if getSpellCount(&quot;remove_poison&quot;) &gt; 0 then
	sendStatus(charname)
	spell:setNext(&quot;rp &quot; .. charname)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) writhes in agony.</string>
                            <string>([A-Za-z]+) shudders in pain, and looks very pale.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Sha</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel the presense of an otherworldly being enter the room.</name>
                        <script>mud:send(&quot;followers&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel the presense of an otherworldly being enter the room.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Rog</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You use the last of the poison.</name>
                        <script>mud:send( &quot;GET blind &quot; .. charData:get(&quot;poisonbag&quot;))</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You use the last of the poison.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You can't seem to find that!</name>
                        <script>mud:send(&quot;get slow hole&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You can't seem to find that!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your assassination attempt goes wide of the mark.</name>
                        <script>-- You may only attempt to assassinate someone once a day!

timer:set(&quot;assassinatetimer&quot;, 24*60)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your assassination attempt goes wide of the mark.</string>
                            <string>With practiced ease and lightning reflexes,</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You attempt to hide yourself.</name>
                        <script>sendStatus()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You attempt to hide yourself.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Ill</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The illusion covering your group is shattered!</name>
                        <script>mud:send(&quot;gsay Massmorph DOWN!&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The illusion covering your group is shattered!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>An Ashstone noble's outline is illuminated by brilliant scarlet flames!</name>
                        <script>-- sct scarlet outline</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>An Ashstone noble's outline is illuminated by brilliant scarlet flames!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You create a swirling rainbow pattern in front of an Ashstone noble, who seems distracted...</name>
                        <script>-- rainbow pattern</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You create a swirling rainbow pattern in front of an Ashstone noble, who seems distracted...</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Ele</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                </TriggerGroup>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>RaceTriggers</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Yuan-Ti</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You concentrate and harden your body into thick scales.</name>
                        <script>-- scaleskin enabled (yuanti)
-- innate scaleskin - You concentrate and harden your body into thick scales.

charData:set(&quot;scaleskin&quot;, true)
scale_skin(&quot;update&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You concentrate and harden your body into thick scales.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your scales become soft once more.</name>
                        <script>-- Your scales become soft once more.

charData:set(&quot;scaleskin&quot;, false)
scale_skin(&quot;update&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your scales become soft once more.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>WhoClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Capture from wholist</name>
                    <script>sqlinwho(matches[3])
whoadd(matches[3], matches[2], matches[4])

-- echo profile name after character

local profile=getProfile(matches[3])

if profile then
	cecho( &quot;&lt;slate_grey&gt; [@&quot; .. profile .. &quot;]&quot; )

	if profile == &quot;unknown&quot; or profile == 1 then
		-- TODO needs to be corrected to not send when in paging mode
		mud:send(&quot;who &quot; .. matches[3])
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^\[[0-9 ]+([a-zA-Z-]+)\] ([a-zA-Z]+)[,a-zA-Z '-]+\(([a-zA-Z- ]+)\)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Save wholist</name>
                    <script>savewholist()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Record number of players on this boot</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Capture charname</name>
                    <script>NyyLIB.charname = matches[2]</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Character attributes for ([a-zA-Z]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Katumi tells you</name>
                    <script>if inwho(matches[3]) == false then
	whoadd(matches[3], matches[2], matches[4], matches[5])

	echoDebug(&quot;\n[Adding &quot; .. matches[3] .. &quot; to wholist]&quot;)

	setProfile(matches[3], matches[5])
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Katumi tells you '\[[0-9]+ (.*)\] ([A-Za-z]+) \((.*)\) \(@([A-Za-z]+)\) seen .*'</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Capture from individual who</name>
                    <script>if inwho(matches[3]) == false then
	for k, v in pairs(NyyLIB.fullclasslist) do
		if v[1] == matches[2]:trim()	 then
			whoadd(matches[3], v[2], matches[4], matches[5])
			return
		end
	end
end

if inwho(matches[3]) == &quot;unknown&quot; then
	setProfile(matches[3], matches[5])
	echoDebug(&quot; [Setting &quot; .. matches[3] .. &quot; profile name to &quot; .. matches[5] .. &quot;]\n&quot;)
end

-- getProfile(matches[3]) this command errors if not in database

if getProfile(matches[3]) ~= matches[5] then
	echoDebug(&quot; [Profile Error: &quot; .. getProfile(matches[3]) .. &quot; : &quot; .. matches[5] .. &quot;]\n&quot;)
	setProfile(matches[3], matches[5])
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>\[ ?[0-9]+ (.*) *\] ([A-Za-z]+) +.*\((.*)\) \(@([A-Za-z]+)\)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Total players online: 20.</name>
                    <script>-- end of who list</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Total players online: [0-9]+[.]</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>GroupClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Add from group display</name>
                    <script>local temp = whoclass(matches[8]) or &quot;UNK&quot;

if 	groupSent == nil then
	groupList:display(matches[8], matches[6], matches[7], matches[4], matches[5], matches[2], matches[3] )
else
	eraseLine()
end

groupList:add( idMob(matches[8]),temp,matches[6],matches[7])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([0-9]+)/([0-9]+) +man +([0-9]+)/([0-9]+) +move +([0-9]+)/([0-9]+) +hit - ([A-Za-z ]+)</string>
                        <string>([0-9]+)/([0-9]+) +psp +([0-9]+)/([0-9]+) +move +([0-9]+)/([0-9]+) +hit - ([A-Za-z ]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Reset grouplist</name>
                    <script>groupRedraw = false

groupList:reset()

NyyLIB.groupname = matches[2]

if groupSent == nil then
	if charData:get(&quot;group&quot;, true) then
		cecho(&quot;                                 &lt;yellow&gt;[Stats: &quot; .. charData:get(&quot;statname&quot;) .. &quot;]\n&quot;)
	end
else
	eraseLine()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Group information for (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>But you are a member of no group?!</name>
                    <script>groupRedraw = nil

groupList:reset()

if groupSent then
	sendGroup(false)
	eraseLine()
	echoDebug(&quot;\n&lt;red&gt;[empty group received]&quot;)
end

groupList:add(whoami(), whoclass(), prompt:get(&quot;hp&quot;), prompt:get(&quot;maxhp&quot;) )

rescuelist:generate()

RedrawGroupStatus()

resizeGroupWindow(true)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>But you are a member of no group?!</string>
                        <string>You are no longer a member of the group.</string>
                        <string>You are now a member of</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Joined group</name>
                    <script>sendGroup()
tempTimer(2, [[resizeGroupWindow(true)]])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>now a member of</string>
                        <string>([A-Za-z]+) has left the group.</string>
                        <string>has disbanded the group.</string>
                        <string>You disband the group.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Add when not in same room</name>
                    <script>local temp = whoclass(matches[2]) or &quot;UNK&quot;

if 	groupSent == nil then
	groupList:display(matches[2])
else
	eraseLine()
end

groupList:add( idMob(matches[2]),temp, 0, 0)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>                                                        [-] ([A-Za-z ]+)</string>
                        <string>[(]Head[)]   [ ]+[-] ([A-Za-z]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>add from group no mana</name>
                    <script>local temp = whoclass(matches[6]) or &quot;UNK&quot;

if 	groupSent == nil then
	groupList:display(matches[6], matches[4], matches[5], matches[2], matches[3] )
else
	eraseLine()
end

groupList:add( idMob(matches[6]),temp,matches[4],matches[5])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>        +([0-9]+)/([0-9]+) +move +([0-9]+)/([0-9]+) +hit - ([A-Za-z ]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Autogroup</name>
                    <script>-- Dlabble has just given you his consent.
local consentchar= matches[2]


consent:set( consentchar, true )

if matches[2] ~= &quot;slaad&quot; then
	if inwho(matches[2]) == false then
		mud:send(&quot;who &quot; .. consentchar)
	end
end

-- Send group command if char isn't currently grouped
if groupList:ingroup(consentchar) then
	--
else
	mud:send(&quot;group &quot; .. consentchar)
	sendGroup()
end

sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) has just given you (his|her|its) consent[.]</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>remove dead people</name>
                    <script>-- open and ([A-Za-z]+) takes a deep breath. The radiance dissipates, leaving
-- hand reaching down to touch ([A-Za-z]+) and .*
-- When it at last clears ([A-Za-z]+) stands before you, looking extremely tired!
-- ([A-Za-z]+) takes a first shuddering breath and rises from the dead. 

local matchchar=matches[2]

-- Misi has returned to the land of the living.

-- if grouplist doesn't have hp send group
if groupList:ingroup(matchchar) then
	if groupList:getHP(matchchar) == 0 then
		sendGroup()
	end
end

if table.contains(NyyLIB.deadpeople, matches[2]) then
	echoDebug(&quot;\n&quot; .. matchchar .. &quot; is alive!\n&quot;)

	table.remove(NyyLIB.deadpeople, table.index_of(NyyLIB.deadpeople, matchchar))

	sendGroup()
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) .* stands here.</string>
                        <string>([A-Za-z]+) .* sits resting.</string>
                        <string>([A-Za-z]+) .* stands in mid-air here.</string>
                        <string>([A-Za-z]+) .* stands, inches above the surface here.</string>
                        <string>([A-Za-z]+) steps out of a wormhole.</string>
                        <string>([A-Za-z]+) flies in from the (north|south|east|west).</string>
                        <string>([A-Za-z]+) .* hulks here.</string>
                        <string>open and ([A-Za-z]+) takes a deep breath. The radiance dissipates, leaving</string>
                        <string>hand reaching down to touch ([A-Za-z]+) and .*</string>
                        <string>When it at last clears ([A-Za-z]+) stands before you, looking extremely tired!</string>
                        <string>([A-Za-z]+) has returned to the land of the living.</string>
                        <string>([A-Za-z]+) .* is stretched out, sound asleep.</string>
                        <string>([A-Za-z]+) takes a first shuddering breath and rises from the dead. </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Dogmasa has died!</name>
                    <script>if groupList:ingroup(matches[2]) then
	if table.contains(NyyLIB.deadpeople, matches[2]) == false then
		table.insert(NyyLIB.deadpeople, 1, matches[2])
	end

	buff:del(matches[2])

	if inwho(matches[2]) == &quot;Lilithelle&quot; then
		sound(&quot;209740__yummie__minion-yahoo-2.wav&quot;)
	else
		sound(&quot;195954_minian89_death-blood-splatter.wav&quot;)
	end

	sendGroup()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) has died!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>([A-Za-z]+) group-says '.*</name>
                    <script>inwho(matches[2])

if not groupList:ingroup( idMob(matches[2]) ) then
	if whoclass(matches[2]) ~= nil then
		groupList:add( idMob(matches[2]), whoclass(matches[2]), 0, 0)
		resizeGroupWindow(true)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) group-says '.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>add group leader</name>
                    <script>-- setting group leader

if matches[2] ~= &quot;Someone&quot; then
	NyyLIB.leader = matches[2]
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^\(Head\) .* - ([A-Za-z]+)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Size:</name>
                    <script>currentsize = currentsize or 0

-- if groupsize has changed or blind, gui will need forced resize
if currentsize ~= matches[2] or buff:get(&quot;blind&quot;) or buff:get(&quot;blindness&quot;) then 
	currentsize = matches[2]

	display(&quot;enable forceresize&quot;)

	tempTimer(1, [[resizeGroupWindow(true)]])
end

enableTrigger(&quot;endprompt&quot;)

if 	groupSent == nil then
	if charData:get(&quot;group&quot;, true) then
		eraseLine()

		cecho(string.format(&quot;\n&lt;yellow&gt;  HP/Max           [Group Size:%2d]              MV/Max  PSP/Max    &quot; .. 
	    &quot;Hit (Total) Rescue (Total)&quot;,
			matches[2]))
	end
else
	eraseLine()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Size: +([0-9]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>endprompt</name>
                    <script>disableTrigger(&quot;endprompt&quot;)
rescuelist:generate()
echoDebug(&quot;&lt;red&gt;\n[Group received]\n&quot;)
sendGroup(false)
groupRedraw = nil
raiseEvent(&quot;promptEvent&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^&lt; .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>is already a member of another group!</name>
                    <script>if NyyLIB.leader == whoami() then
	mud:send(&quot;t &quot; .. matches[2] .. &quot; &quot; .. matches[2] .. &quot; is already a member of another group!&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^([A-Za-z]+) is already a member of another group!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Update grouped players fighting</name>
                    <script>-- Add any grouped players tanking a mob to the list

--The ghoul of an opulent merchant stands here, fighting an opulent merchant.
--An opulent merchant stands here, fighting the ghoul of an opulent merchant.

if matches[2] == &quot;YOU&quot; then
	groupList:incTanking(whoami())
end

if groupList:ingroup( idMob(matches[2]) ) then
	groupList:incTanking( idMob(matches[2]) )
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.*[,] fighting ([A-Za-z ]+)[.]</string>
                        <string>.*[,] fighting (YOU)!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Reset tanking list</name>
                    <script>-- Since a room is being looked at, the table of players tanking mobs is reset

groupList:resetTanking()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Exits: (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>MiscTriggers</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>PANIC!  You couldn't escape!</name>
                    <script>-- Send flee again on failed attempt to flee

fleeAttempt = fleeAttempt or 0

if charData:get(&quot;flee&quot;) ~= &quot;off&quot; and charData:get(&quot;flee&quot;) ~= &quot;dragon&quot;  or NyyLIB.escapedir ~= nil then
	fleeAttempt = fleeAttempt + 1

	if fleeAttempt &lt; 4 then
		-- abort spell if casting

		spell:clear()

		mud:send(&quot;flee&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>PANIC!  You couldn't escape!</string>
                        <string>You scramble madly to your feet!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Stand Triggers</name>
                    <script>-- Various reasons to send a stand command

sound(&quot;123753__vicces1212__collapse.wav&quot;)

spell:setMem(false)

if spell:getCurrent() then
	spell:setCurrent(nil)
end

mud:send(&quot;st&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>fall to your knees</string>
                        <string>sends you sprawling</string>
                        <string>The shockwave sends you crashing to the ground!</string>
                        <string>tripping you.</string>
                        <string>You are knocked</string>
                        <string>You are slammed</string>
                        <string>You are swept off your feed by the size of the wave!</string>
                        <string>You fall and injure yourself!</string>
                        <string>You get hit by a giant boulder and fall to the ground!</string>
                        <string>You lose your balance</string>
                        <string>You stagger about, then fall sprawling!</string>
                        <string>Your hasty hamstring causes you to slip and fall to the ground!</string>
                        <string>Your head slams into the ground, stunning you!</string>
                        <string>You flail about wildly and crash to the ground!</string>
                        <string>Boldly taking the impact, you are still knocked aside!</string>
                        <string>You simply bounce off</string>
                        <string>You have to be standing up to do that!</string>
                        <string>you topple over and fall to the ground.</string>
                        <string>only to sprawl completely THROUGH</string>
                        <string>You are swept off your feet by the size of the wave!</string>
                        <string>Who can concentrate with all that clanging and screaming?</string>
                        <string>You can't concentrate with all the racket!</string>
                        <string>You crash to the ground beneath the powerful strike!</string>
                        <string>around your limbs. It yanks your feet out from under you, sending you crashing</string>
                        <string>You manage to, with complete incompetence, throw yourself head first directly into the ground!</string>
                        <string>Get off your knees!</string>
                        <string>In your haste to slam people around, you slip and fall!</string>
                        <string>only to fall onto your face THROUGH</string>
                        <string>The violent winds pick you up and toss you aside!</string>
                        <string>Intense pain runs through your body as your ribs fracture from the impact.</string>
                        <string>You collapse in a heap on the ground.</string>
                        <string>is too huge for you to trip! You go crashing to the ground.</string>
                        <string>And just for the attempt, you fall down.</string>
                        <string>and you go down as well.</string>
                        <string>Standing would be a good first step.</string>
                        <string>You fall to the ground.  You stop riding.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Flee Lich'd</name>
                    <script>-- Flee if hit by lich proc

if charData:get(&quot;flee&quot;) == &quot;lich&quot; then
	mud:send(&quot;flee&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As you fall, you see a stream of your own life force flowing away from you..</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Return after fleeing</name>
                    <script>-- If a room is fleed (for example, by dragon roar) return to the previous room
-- If autohide is turned on, you won't return - You'll attempt to hide
-- If your current hp is less then your wimpy, you also won't return.

local temp = matches[2]:lower()

if checkMask(&quot;psi&quot;) then
	if charData:get(&quot;autohide&quot;) then
		return
	end
end

if charData:get(&quot;wimpy&quot;) ~= nil then
	if prompt:get(&quot;hp&quot;) &lt;= charData:get(&quot;wimpy&quot;) then
		return
	end
end

if NyyLIB.escapedir ~= nil then
	return
end


if charData:get(&quot;flee&quot;) == &quot;dragon&quot; then
	if temp == &quot;north&quot; then
		mud:send(&quot;s&quot;)
	elseif temp == &quot;south&quot; then
		mud:send(&quot;n&quot;)
	elseif temp == &quot;east&quot; then
		mud:send(&quot;w&quot;)
	elseif temp == &quot;west&quot; then
		mud:send(&quot;e&quot;)
	elseif temp == &quot;up&quot; then
		mud:send(&quot;d&quot;)
	elseif temp == &quot;down&quot; then
		mud:send(&quot;u&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You flee (.*)ward!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Looting</name>
                    <script>-- Loot if autoloot enabled, update xp display and dismount if mounted
-- Reset various variables, and send a look command to the mud

prompt:set(&quot;tank&quot;, nil)

if not getHide() then
	if charData:get(&quot;autoloot&quot;) == &quot;coins&quot; then
		mud:send(&quot;get coins corpse&quot;)
	elseif charData:get(&quot;autoloot&quot;) == &quot;all&quot; then
		mud:send(&quot;get all corpse&quot;)
	end
end

if charData:get(&quot;level&quot;) &lt; 50 then
	mud:send(&quot;exp&quot;, false)
	NyyLIB.delxpline = true
end

--if mount:get() ~= nil then
--	mud:send(&quot;dismount&quot;)
--end

setBashing(false)
setTripping(false)
rescueSent=false
NyyLIB.failedtrip=0

assistSent=nil

sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^You receive .* XP .* experience.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Any prompt</name>
                    <script>-- raise status event
if NyyLIB.statuschar ~= &quot;&quot; then
	raiseEvent(&quot;statusEvent&quot;, NyyLIB.statuschar)
end

NyyLIB.statuschar=&quot;&quot;

disableTrigger(&quot;RoomCapture&quot;)

--copy(&quot;roomwindow&quot;)
--appendBuffer(&quot;gRoomWindow&quot;)

disableTrigger(&quot;lootlist&quot;)

enableTrigger(&quot;StartRoomCapture&quot;)

if Geyser.Label:getWindow(&quot;gIconBarWindow&quot;) == nil then
	return
end

if NyyLIB.gRoomWindow ~= nil then
	local var=getLastLineNumber(&quot;gRoomWindow&quot;)

	if var ~= nil and var ~= -1 then
		if charData:get(&quot;roomwindow&quot;) then
			NyyLIB.gRoomWindow:resize(nil, var .. &quot;c&quot;)
			NyyLIB.gRoomWindow:move(&quot;60%&quot;, &quot;8%&quot;)
			NyyLIB.gRoomWindow:show()
		end
	end
end

if NyyLIB.lookstart == 1 then
	NyyLIB.tolook=0
	NyyLIB.haslooked=1
	NyyLIB.lookstart=0

	-- re-raise prompt event
	raiseEvent(&quot;promptEvent&quot;)

	-- TODO look has been recieved if trying to circle

	-- rogue: circle
	if charData:get(&quot;autocircle&quot;) then
		if prompt:get(&quot;tank&quot;) ~= whoami() and inCombat() then
			if prompt:get(&quot;enemycondition&quot;) ~= &quot;awful&quot; then
				expandAlias(&quot;cr&quot;, false)
			end
		end
	end
end

RedrawGroupStatus()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^&lt; (.*) &gt;</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are getting hungry.</name>
                    <script>-- If not hidden, eat food

if inCombat() then
	return
end

if not getHide() then
	if checkMask(&quot;psi&quot;) then
		if charData:get(&quot;autosustain&quot;) then
			send(&quot;sustain&quot;)
		end
	else
		mud:send(&quot;eat &quot; .. charData:get(&quot;food&quot;) .. &quot; &quot; .. charData:get(&quot;container&quot;) )
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^You are getting hungry[.]$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are getting thirsty.</name>
                    <script>-- If not hidden, drink water

if not getHide() then
	if checkMask(&quot;psi&quot;) then
		--
	else
		if not inCombat() then
			mud:send(&quot;drink &quot; .. charData:get(&quot;canteen&quot;) )
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^You are getting thirsty[.]$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>The ([A-Za-z]+) seems to be closed.</name>
                    <script>-- If an attempt is made to walk through a closed door, and autoopen is enabled - Open it

if charData:get(&quot;autoopen&quot;) then
	send(&quot;open &quot; .. matches[2])
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The ([A-Za-z]+) seems to be closed.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You stop trying to hide.</name>
                    <script>setHide(false)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You stop trying to hide.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>misc sendLook triggers</name>
                    <script>sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>A dark shape springs out of the darkness at you!</string>
                        <string>causes an EARTHQUAKE!</string>
                        <string>utters a single word and disappears.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your bash at a young alligator sends him sprawling.</name>
                    <script>setBashing(false)
setTripping(false)
NyyLIB.failedtrip=0

sound(&quot;241280__sonictechtonic__gooeybashes.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your bash at .* sends (him|her|it) sprawling.</string>
                        <string>They have to be standing up for you to do that!</string>
                        <string>You can't do that without solid ground underneath you!</string>
                        <string>Your icy bash at .* sends (him|her|it) sprawling.</string>
                        <string>But they're already on the ground!</string>
                        <string>You manage to, with complete incompetence, throw yourself head first directly into the ground!</string>
                        <string>You do a fancy maneuver, tripping</string>
                        <string> is too huge for you to trip! You go crashing to the ground.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You raise a level!</name>
                    <script>send(&quot;score&quot;)
mud:send(&quot;gsay &lt;&lt;&lt; Level &quot; .. (charData:get(&quot;level&quot;))+1 .. &quot;! &gt;&gt;&gt;&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You raise a level!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are 6,256,116 XP (83.75%) away from your next level.</name>
                    <script>-- Your guildmaster says 'You have just begun the trek to your next level!' - l1/0%

if NyyLIB.xpwindow == nil then
	return
end

local xppercent = 100 - tonumber(matches[3])

NyyLIB.xpwindow:echo([[&lt;p style=&quot;font-size:20px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;L:]] .. charData:get(&quot;level&quot;) .. &quot; &quot; .. xppercent .. [[%&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])	

if NyyLIB.delxpline then
	eraseLine()
	NyyLIB.delxpline = false
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are ([0-9,]+) XP \(([0-9.]+)%\) away from your next level.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>anti-spellguard</name>
                    <script>-- Spellguard (aggro evil race) entering room in Silverymoon

if whoami() == &quot;Nyyrazzilyss&quot; then
	mud:send(&quot;slaad&quot;)
	mud:send(&quot;o slaad bash spellguard&quot;)
	mud:send(&quot;project schism&quot;)
	mud:send(&quot;protect&quot;)
end

if whoclass() == &quot;Psi&quot; then
	mud:send(&quot;ultra spellguard&quot;)
	mud:send(&quot;ultra&quot;)
	mud:send(&quot;ultra&quot;)
end

if whoami() == &quot;Adud&quot; then
	mud:send(&quot;say aid of mage&quot;)
	mud:send(&quot;say strength of stone&quot;)
	mud:send(&quot;vitme&quot;)
	mud:send(&quot;bh spellguard&quot;)
end

if whoami() == &quot;Rrissun&quot; then
	mud:send(&quot;slaad&quot;)
	mud:send(&quot;o slaad bash spellguard&quot;)
	spell:cast(&quot;ha slaad&quot;)
	spell:cast(&quot;ha me&quot;)
	spell:cast(&quot;cr spellguard&quot;)
	spell:cast(&quot;sp spellguard&quot;)
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>A mage in the Spellguard flies in from</string>
                        <string>A mage in the Spellguard snaps into visibility.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>.* switches targets[.][.]$</name>
                    <script>sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* switches targets[.][.]$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You give your consent to Lilithelle.</name>
                    <script>if groupList:size() &gt; 1 then
	send(&quot;t &quot; .. matches[2] .. &quot; &quot; .. matches[2] .. &quot; now has consent.&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You give your consent to ([A-Za-z]+).</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You now flee at 200 hit points or less!</name>
                    <script>if matches[2] == nil then
	charData:set(&quot;wimpy&quot;, 0)
else
	charData:set(&quot;wimpy&quot;, tonumber(matches[2]) )
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You now flee at ([0-9]+) hit points or less!</string>
                        <string>You now feel like a true hero, no auto-fleeing here! :-)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Resurrection triggers</name>
                    <script>if matches[2] == nil then
	cecho(&quot;&lt;red&gt;[Error: nil consent match]\n&quot;)
end

mud:send(&quot;consent &quot; .. matches[2])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(Thamos) tells you 'I will now RESURRECT you, make sure I have your CONSENT'</string>
                        <string>^(Osheara) tells you 'Get ready for the BLUEST resurrection ever!'</string>
                        <string>^([A-Za-z]+) tells you 'consent'</string>
                        <string>^([A-Za-z]+) tells you 'ressing, consent .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Every line of text</name>
                    <script>local gag = charData:get(&quot;gags&quot;, true)

if gag ~= nil then
	for key,val in pairs(gag) do
		if string.findPattern(matches[2]:lower(), val) then
				eraseLine()
				return
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(.*)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You think Coburaxximus has spotted you!</name>
                    <script>setHide(false)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You think .* has spotted you!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You escape ([nsewud]).*</name>
                    <script>NyyLIB.escapedir = nil

if NyyLIB.roguereturn ~= nil then
	mud:send(NyyLIB.reversedirs[matches[2]], false)

	local attacktarget

	if NyyLIB.target == nil then
		attacktarget = getEnemy()
	else
		attacktarget = NyyLIB.target
	end

	if attacktarget ~= &quot;&quot; then
		if NyyLIB.roguereturn == &quot;c&quot; then
			NyyLIB.tosend = &quot;circle &quot; .. attacktarget
		elseif NyyLIB.roguereturn == &quot;b&quot; then
			NyyLIB.tosend = &quot;backstab &quot; .. attacktarget
		elseif NyyLIB.roguereturn == &quot;p&quot; then
			NyyLIB.tosend = &quot;bs &quot; .. attacktarget
		end
	else
		cecho(&quot;&lt;red&gt;[No target is currently set. Use #target name to set targets.]\n&quot;)
	end

	NyyLIB.roguereturn = nil
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You escape ([nsewud]).*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You get the dust of a shadow from corpse of a shadow.</name>
                    <script>send(&quot;put dust &quot; .. charData:get(&quot;container&quot;) )</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You get the dust of a shadow from corpse of a shadow.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>poke - haste</name>
                    <script>-- haste on poke

if charData:get(&quot;pokehaste&quot;) then
	if groupList:ingroup(matches[2]) then
		local level = charData:get(&quot;level&quot;)

		if whoclass() == &quot;Enc&quot; and level &gt;= 16 then
			spell:cast(&quot;hs &quot; .. matches[2])
		elseif whoclass() == &quot;Ele&quot; and level &gt;= 31 then
			spell:cast(&quot;hs &quot; .. matches[2])
		elseif whoclass() == &quot;Nec&quot; and level &gt;= 31 then
			spell:cast(&quot;hs &quot; .. matches[2])
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) pokes you in the ribs. What!?</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>That power hasn't recharged yet!</name>
                    <script>mud:send(&quot;recharge&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>That power hasn't recharged yet!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Why?  You are not fighting anyone.</name>
                    <script>display(NyyLIB.escapedir)

if NyyLIB.escapedir ~= nil then
	mud:send(NyyLIB.escapedir, false)

	NyyLIB.escapedir = nil
end

</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Why?  You are not fighting anyone.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your account contains</name>
                    <script>-- display(&quot;disabling&quot;)
disableTrigger(&quot;DepositTrigger&quot;)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.*Your account contains:$</string>
                        <string>I don't see a banker around here.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>DepositTrigger</name>
                    <script>-- display(&quot;trigger matches&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>There were[:] .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([0-9]+) platinum coin</name>
                        <script>mud:send(&quot;deposit &quot; .. matches[2] .. &quot; p&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([0-9]+) platinum coin</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([0-9]+) gold coin</name>
                        <script>mud:send(&quot;deposit &quot; .. matches[2] .. &quot; g&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([0-9]+) gold coin</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([0-9]+) silver coin</name>
                        <script>mud:send(&quot;deposit &quot; .. matches[2] .. &quot; s&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([0-9]+) silver coin</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([0-9]+) copper coin</name>
                        <script>mud:send(&quot;deposit &quot; .. matches[2] .. &quot; c&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([0-9]+) copper coin</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>player enter room</name>
                    <script>local matchchar = matches[2]

enteredPortal = enteredPortal or {}

-- clear mtank if not in group

if NyyLIB.mtank ~= nil then
	if not groupList:ingroup(NyyLIB.mtank) then
		NyyLIB.mtank=nil
	end
end

-- visible in room so has not entered portal

if groupList:ingroup(matchchar) then
	enteredPortal[matchchar] = nil

	if groupList:getHP(matchchar) == 0 then
		sendGroup()
		return
	end
end

-- use #mtank to check hp (send group) when a particular char enters the room

if NyyLIB.mtank ~= nil then
	if NyyLIB.mtank == matchchar then
		sendGroup()
		return
	end
end

-- update group info if autoheal enabled

if charData:get(&quot;autoheal&quot;) then
	if groupList:ingroup(matchchar) then
		sendGroup()
		return
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) lumbers in .*</string>
                        <string>([A-Za-z]+) enters from .*</string>
                        <string>([A-Za-z]+) flies in .*</string>
                        <string>([A-Za-z]+) prowls in from .*</string>
                        <string>([A-Za-z]+) skulks in from .*</string>
                        <string>([A-Za-z]+) sneaks in from .*</string>
                        <string>([A-Za-z]+) slowly fades into existence.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Katumi NHC: (H) 'Welcome,</name>
                    <script>-- Katumi NHC: (H) 'Welcome, Aminmag. If
local charname = matches[2]

if getProfile ( whoami() ) == &quot;Nyyrazzilyss&quot; then
	mud:send(&quot;advert&quot;)
end

mud:send(&quot;who &quot; .. charname)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Katumi NHC: .* 'Welcome, ([A-Za-z]+).*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>^([A-Za-z]+) tells you 'version'</name>
                    <script>-- send version
mud:send(&quot;TELL &quot; .. matches[2] .. &quot; Script version: 11dev 6/3/2017&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^([A-Za-z]+) tells you 'version'</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>EquipProcs</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TiaSleeves</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your utterance brings about an instantanious mending of</name>
                        <script>-- sleeves went off (not charged)
setLabelImage(&quot;TiaSleeves&quot;, &quot;TiaSleeves-off.png&quot;)

timer:set(&quot;TiaSleeves&quot;, 24*60)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your utterance brings about an instantaneous mending of</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Baatorian</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Smoke begins to pour out of your bracer, swirling around you in a dizzying</name>
                        <script>rescuelist:generate()
mud:send(&quot;o slaad consent &quot; .. whoami(), false)
timer:set(&quot;baatorian&quot;, 24*60)
baatorian(&quot;init&quot;)
pet_rescue(&quot;init&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Smoke begins to pour out of your bracer, swirling around you in a dizzying</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A gray slaad has just given you its consent.</name>
                        <script>NyyLIB.slaadname=&quot;anvil&quot;

mud:send(&quot;followers name slaad &quot; .. NyyLIB.slaadname)

sendLook()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^A gray slaad has just given you its consent.$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A gray slaad stops following you.</name>
                        <script>if matches[2] == &quot;A gray slaad&quot; then
	if not getHide() then
		mud:send(&quot;get all gray&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^(.*) stops following you.$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are using:</name>
                    <script>local nx
local label


for nx=1, #NyyLIB.equip, 1 do
	-- disable folder in equipprocs representing specific item triggers
	disableTrigger(NyyLIB.equip[nx][1])
end

-- hide all equipment icons associated with the item

for nx=0, 20, 1 do
	label=findlabel(&quot;lbutton&quot; .. nx)

	if label ~= nil then
		label:show()
		label:hide()
	end
end

enableTrigger(&quot;CaptureWorn&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are using:$</string>
                        <string>You aren't wearing anything!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>CaptureWorn</name>
                    <script>for nx=1, #NyyLIB.equip, 1 do
	local match = string.findPattern(matches[2], NyyLIB.equip[nx][2])

	if match then
   		local var=NyyLIB.equip[nx][1]
		enableTrigger(var)
		
		if var == &quot;TiaWarder&quot; then
			addLeftbutton(&quot;TiaWarder&quot;, 0, 0)
		end

		if var == &quot;DragonCult&quot; then
			addLeftbutton(&quot;DragonCult&quot;, 0, 0)
		end

		if var == &quot;Baatorian&quot; then
			addLeftbutton(&quot;baatorian&quot;, 1, 0)
		end

		if var == &quot;TiaVolance&quot; then
			addLeftbutton(&quot;TiaVolance&quot;, 1, 0)
		end

		if var == &quot;TiaStaff&quot; then
			addLeftbutton(&quot;TiaStaff&quot;, 2, 0)
		end

		if var == &quot;TiaBane&quot; then
			addLeftbutton(&quot;TiaBane&quot;, 2, 0)
		end

		if var == &quot;TiaWarmaul&quot; then
			addLeftbutton(&quot;TiaWarmaul&quot;, 2, 0)
		end

		if var == &quot;TiaLoop&quot; then
			addLeftbutton(&quot;TiaLoop&quot;, 2, 0)
		end

		if var == &quot;TiaSandals&quot; then
			addLeftbutton(&quot;TiaSandals&quot;, 3, 0)
		end

		if var == &quot;SuppleGirdle&quot; then
			addLeftbutton(&quot;SuppleGirdle&quot;, 3, 0)
		end

		if var == &quot;TiaCincture&quot; then
			addLeftbutton(&quot;TiaCincture&quot;, 3, 0)
		end

		if var == &quot;TiaBracers&quot; then
			addLeftbutton(&quot;TiaBracers&quot;, 4, 0)
		end

		if var == &quot;TiaValhalla&quot; then
			addLeftbutton(&quot;TiaValhalla&quot;, 4, 0)
		end

		if var == &quot;TiaSleeves&quot; then
			addLeftbutton(&quot;TiaSleeves&quot;, 4, 0)
		end

		if var == &quot;TiaManacle&quot; then
			addLeftbutton(&quot;TiaManacle&quot;, 5, 0)
		end

		if var == &quot;TiaStability&quot; then
			addLeftbutton(&quot;TiaStability&quot;, 5, 0)
		end

		if var == &quot;TiaScale&quot; then
			addLeftbutton(&quot;TiaScale&quot;, 5, 0)
		end

		-- tentacle rings - psi only
		if var == &quot;TiaMask&quot; then
			addLeftbutton(&quot;TiaMask&quot;, 5, 0)
		end

		-- gelugon claws
		if var == &quot;TiaClaws&quot; then
			addLeftbutton(&quot;TiaClaws&quot;, 6, 0)
		end


		-- frenzied grin
		if var == &quot;FrenziedGrin&quot; then
			addLeftbutton(&quot;FrenziedGrin&quot;, 7, 0)
		end

		-- vermellion sleeves
		if var == &quot;VermSleeves&quot; then
			addLeftbutton(&quot;VermSleeves&quot;, 8, 0)
		end

		if var == &quot;TiaOcular&quot; then
			addLeftbutton(&quot;TiaOcular&quot;, 9, 0)
		end





	end
end

if string.ends(matches[2], &quot;&gt; &quot;) then
	disableTrigger(&quot;CaptureWorn&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(&lt;.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TiaStaff</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>nimbus flares about your body.  The magic buffers against the glowing sphere,</name>
                        <script>-- spell captured
setLabelImage(&quot;TiaStaff&quot;, &quot;TiaStaff-loaded.png&quot;)

charData:set(&quot;TiaStaff&quot;, &quot;charged&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>nimbus flares about your body.  The magic buffers against the glowing sphere,</string>
                            <string>You have no target for your released spell, very dangerous...</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You lift an ancient staff of the arch-magi high above your head, calling</name>
                        <script>-- spell release
setLabelImage(&quot;TiaStaff&quot;, &quot;TiaStaff-off.png&quot;)

charData:set(&quot;TiaStaff&quot;, &quot;&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You lift an ancient staff of the arch-magi high above your head, calling</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You whisper quietly to an ancient staff of the arch-magi, hefting it in</name>
                        <script>-- spell capture enabled
setLabelImage(&quot;TiaStaff&quot;, &quot;TiaStaff-waiting.png&quot;)

charData:set(&quot;TiaStaff&quot;, &quot;&quot;)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You whisper quietly to an ancient staff of the arch-magi, hefting it in</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TiaMask</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A set of gem studded tentacle rings glows with a soft light as its charge is fully replenished.</name>
                        <script>-- tiamask charged
setLabelImage(&quot;TiaMask&quot;, &quot;TiaMask-charged.png&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A set of gem studded tentacle rings glows with a soft light as its charge is fully replenished.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The three ioun stones of a set of gem studded tentacle rings glow</name>
                        <script>-- mask  invoked
setLabelImage(&quot;TiaMask&quot;, &quot;TiaMask-on.png&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The three ioun stones of a set of gem studded tentacle rings glow</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TiaBane</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A ([A-Za-z]+) notch appears along the handle of your blade.</name>
                        <script>if matches[2] == &quot;single&quot; then
	charData:set(&quot;banecharges&quot;, 1)
elseif matches[2] == &quot;second&quot; then
	charData:set(&quot;banecharges&quot;, 2)
elseif matches[2] == &quot;third&quot; then
	charData:set(&quot;banecharges&quot;, 3)
elseif matches[2] == &quot;fourth&quot; then
	charData:set(&quot;banecharges&quot;, 4)
end

TiaBane(&quot;update&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A ([A-Za-z]+) notch appears along the handle of your blade.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>As you shout to the infernal stiletto of Bane, the weapon begins to glow</name>
                        <script>-- bane - dragonstrike

local label=findlabel(&quot;TiaBane&quot;)

charData:set(&quot;banecharges&quot;, 0)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>As you shout to the infernal stiletto of Bane, the weapon begins to glow</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The handle of your blade glows brightly.</name>
                        <script>local label=findlabel(&quot;TiaBane&quot;)
charData:set(&quot;banecharges&quot;, 5)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The handle of your blade glows brightly.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>see the hand of Bane himself emerge from the blade of your stiletto and point at</name>
                        <script>-- bane - blind

local label=findlabel(&quot;TiaBane&quot;)
charData:set(&quot;banecharges&quot;, charData:get(&quot;banecharges&quot;)-3)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>see the hand of Bane himself emerge from the blade of your stiletto and point at</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>around the blade before the stiletto flies back to your hand.</name>
                        <script>-- bane - slow

local label=findlabel(&quot;TiaBane&quot;)
charData:set(&quot;banecharges&quot;, charData:get(&quot;banecharges&quot;)-2)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>around the blade before the stiletto flies back to your hand.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>As you whisper under your breath your blade makes a faint noise, and shudders</name>
                        <script>-- failed

local label=findlabel(&quot;TiaBane&quot;)
charData:set(&quot;banecharges&quot;, 0)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>As you whisper under your breath your blade makes a faint noise, and shudders</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>the infernal stiletto of bane glows for a brief second before poison begins to drip down one of it's edges.</name>
                        <script>local label=findlabel(&quot;TiaBane&quot;)
charData:set(&quot;banecharges&quot;, charData:get(&quot;banecharges&quot;)-1)

if label ~= nil then
	TiaBane(&quot;update&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>the infernal stiletto of bane glows for a brief second before poison begins to drip down one of it's edges.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>The frenzy begins to stir in your heart anew!</name>
                    <script>-- grin recharged
setLabelImage(&quot;FrenziedGrin&quot;, &quot;equipGrin-on.png&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The frenzy begins to stir in your heart anew!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As you whisper a prayer to the heavens, you are quickly</name>
                    <script>setLabelImage(&quot;TiaSandals&quot;, &quot;TiaSandals-off.png&quot;)
timer:set(&quot;TiaSandals&quot;, 24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As you whisper a prayer to the heavens, you are quickly</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>The corner of your mouth spasms with bloodthirsty frenzy!</name>
                    <script>setLabelImage(&quot;FrenziedGrin&quot;, &quot;equipGrin-off.png&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The corner of your mouth spasms with bloodthirsty frenzy!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As you whisper to yourself the words of power, you are caught up</name>
                    <script>setLabelImage(&quot;TiaLoop&quot;, &quot;equipTiaLoop-off.png&quot;)
timer:set(&quot;TiaLoop&quot;, 24*60)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As you whisper to yourself the words of power, you are caught up</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You raise your hands above your head, whispering words of power to your sleeves.</name>
                    <script>-- haste proc vermillion sleeves

--setLabelImage(&quot;VermSleeves&quot;, &quot;equipVerm-active.png&quot;)

timer:set(&quot;VermSleeves&quot;, 24*60)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You raise your hands above your head, whispering words of power to your sleeves.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You call upon the magics contained within your volant band</name>
                    <script>-- volance on

setLabelImage(&quot;TiaVolance&quot;, &quot;TiaVolance-on.png&quot;)
timer:set(&quot;TiaVolance&quot;, 24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You call upon the magics contained within your volant band</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your entire body begins to slow down.  All your movements become sluggish as total physical</name>
                    <script>-- vermillion sleeves - drop</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your entire body begins to slow down.  All your movements become sluggish as total physical</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>All of your mirror images have been destroyed!</name>
                    <script>-- mirrors dropped
if findlabel(&quot;TiaMask&quot;) ~= nil then
	setLabelImage(&quot;TiaMask&quot;, &quot;TiaMask-off.png&quot;)
end

-- volance

if findlabel(&quot;TiaVolance&quot;) ~= nil then
	setLabelImage(&quot;TiaVolance&quot;, &quot;TiaVolance-off.png&quot;)
end

buff:del(whoami(), &quot;mirror_image&quot; )

sound(&quot;86324__timbre__smashing-1b.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>All of your mirror images have been destroyed!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TiaWarmaul</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your %w bludgeon</name>
                        <script>-- Your powerful bludgeon barely wounds Corland Deepforge.
-- the warmaul of celestial glory seems to hum with energy as it connects with
-- You critically wound Shalyssa Lurialar with a mighty bludgeon!


-- #TRIGGER {{You crushed|Your mighty bludgeon|Your strong bludgeon|Your average bludgeon|Your powerful bludgeon|Your massive bludgeon}} {#add wmhits 1;#STATUS Hit Count: @wmhits}


NyyLIB.warmaul = NyyLIB.warmaul or 0
NyyLIB.warmaul = NyyLIB.warmaul + 1

TiaWarmaul(&quot;update&quot;)

echoDebug(&quot;&lt;red&gt; (&quot; .. NyyLIB.warmaul .. &quot;)&quot;)

if NyyLIB.warmaul &gt; 12 then
	local tmpvar=charData:get(&quot;warmaul&quot;)

	if tmpvar == &quot;aid&quot; then
		mud:send(&quot;aid&quot;)
	elseif tmpvar == &quot;restore&quot; then
		mud:send(&quot;restore&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your .* bludgeon .*</string>
                            <string>You critically wound .* with a mighty bludgeon!</string>
                            <string>.* staggers from your .* bludgeon!</string>
                            <string>You crushed</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You swing the warmaul of celestial glory in a mighty arc, crushing into</name>
                        <script>-- You swing the warmaul of celestial glory in a mighty arc, colliding solidly (dead)
-- You swing the warmaul of celestial glory in a mighty arc, crushing into (damaged)
cecho(&quot;&lt;red&gt; [Warmaul proc: &quot; .. NyyLIB.warmaul .. &quot;]\n&quot;)

NyyLIB.warmaul=-1

TiaWarmaul(&quot;update&quot;)
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You swing the warmaul of celestial glory in a mighty arc, colliding solidly</string>
                            <string>^under the impact.$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You mutter under your breath to your the warmaul of celestial glory and watch</name>
                        <script>echoDebug(&quot;[Warmaul called proc at &quot; .. NyyLIB.warmaul .. &quot;]\n&quot;)

NyyLIB.warmaul=0

TiaWarmaul(&quot;update&quot;)

sendGroup()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You mutter under your breath to your the warmaul of celestial glory and watch</string>
                            <string>You call upon your deity to restore your health!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>the warmaul of celestial glory from the glowing corpse.</name>
                        <script>NyyLIB.warmaul=0

TiaWarmaul(&quot;update&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>the warmaul of celestial glory from the glowing corpse.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your manacle shoots out visible strands of magic which interlace</name>
                    <script>--
setLabelImage(&quot;TiaManacle&quot;, &quot;TiaManacle-off.png&quot;)

timer:set(&quot;TiaManacle&quot;, 24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your manacle shoots out visible strands of magic which interlace</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You scream in pain as your wrists are sliced open within your own gauntlets!</name>
                    <script>-- You scream in pain as your wrists are sliced open within your own gauntlets!
-- As the nasty spikes on your gauntlets tear into the flesh of your opponent     &lt;hitall&gt;

send(&quot;att&quot;, false)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You scream in pain as your wrists are sliced open within your own gauntlets!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You feel yourself growing, in strength and size as magic fills you.  Your body gains a</name>
                    <script>-- supple girdle
timer:set(&quot;SuppleGirdle&quot;, 24*60*3)
sound(&quot;105308__kovrov__rumble.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You feel yourself growing, in strength and size as magic fills you.  Your body gains a</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You swirl your cloak around and blend into the background.</name>
                    <script>-- warder cloak
timer:set(&quot;TiaWarder&quot;, 24*60)
setHide(true)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You swirl your cloak around and blend into the background.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As you say 'blend' to a dark gray cloak with a rune embroidered hem,</name>
                    <script>-- warder cloak still isn't charged
timer:set(&quot;TiaWarder&quot;, 2*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As you say 'blend' to a dark gray cloak with a rune embroidered hem,</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You shiver from unnatural cold.</name>
                    <script>-- You shiver from unnatural cold.
-- You are burned as you hit a half-dragon kobold!

-- proc globe if not globed or warded and &lt; 80% hp

if not buff:get(&quot;globe_of_invulnerability&quot;) and not buff:get(&quot;elemental_ward&quot;) then
	if prompt:get(&quot;hp&quot;) &lt; (.80 * prompt:get(&quot;maxhp&quot;) ) then

		-- fighters loop (warrior)
		if isIconActive(&quot;TiaLoop&quot;) and timer:get(&quot;TiaLoop&quot;) == nil then
			TiaLoop()
		end

		-- silvered scale (rogue)
		if isIconActive(&quot;TiaScale&quot;) and timer:get(&quot;TiaScale&quot;) == nil then
			TiaScale()
		end
	end
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You shiver from unnatural cold.</string>
                        <string>You are burned as you hit</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As Ozay takes a viscious wound, the mighty scepter of valhalla begins to hum</name>
                    <script>-- As Ofug takes a viscious wound, the mighty scepter of valhalla begins to hum

-- valhalla blur
if groupList:ingroup(matches[2]) then
	buff:set(matches[2], &quot;blur&quot;, 570)
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As ([A-Za-z]+) takes a viscious wound, the mighty scepter of valhalla begins to hum</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Upon being struck, a mirror image of Adud shatters into a million particles of light!</name>
                    <script>if matches[2] == whoami() then
	sound(&quot;86324__timbre__smashing-1a.wav&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Upon being struck, a mirror image of ([A-za-z]+) shatters into a million particles of light!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As the magic of your bracers saturates your body, they begin</name>
                    <script>-- As the magic of your bracers saturates your body, they begin

mud:send(&quot;GSAY [TIMESTOP UP]&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As the magic of your bracers saturates your body, they begin</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>As you invoke your deep blue silvered scale, a transluscent field</name>
                    <script>-- silvered scale

setLabelImage(&quot;TiaScale&quot;, &quot;TiaScale-off.png&quot;)
timer:set(&quot;TiaScale&quot;, 24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>As you invoke your deep blue silvered scale, a transluscent field</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your cincture glows brightly for a moment while the magics tied to</name>
                    <script>-- cincture

setLabelImage(&quot;TiaCincture&quot;, &quot;TiaCincture-off.png&quot;)
timer:set(&quot;TiaCincture&quot;, 24*60)

buff:set(whoami(), &quot;displacement&quot;, 24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your cincture glows brightly for a moment while the magics tied to</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You begin to speak in a devilish tongue, grinding out</name>
                    <script>-- gelugon claws
setLabelImage(&quot;TiaClaws&quot;, &quot;TiaClaws-off.png&quot;)

timer:set(&quot;TiaClaws&quot;, 12*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You begin to speak in a devilish tongue, grinding out</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You kneel to the ground, wrapping your cloak about your body, chanting softly.</name>
                    <script>-- dcult robes

setLabelImage(&quot;DragonCult&quot;, &quot;equipdcult-off.png&quot;)

timer:set(&quot;DragonCult&quot;, 3*24*60)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You kneel to the ground, wrapping your cloak about your body, chanting softly.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>RoomClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>StartRoomCapture</name>
                    <script>if NyyLIB.gRoomWindow == nil then
	return
end

NyyLIB.gRoomWindow:hide()

clearWindow(&quot;gRoomWindow&quot;)
--clearWindow(&quot;roomwindow&quot;)
enableTrigger(&quot;RoomCapture&quot;)

local roomline = getLines(getLineNumber()-1, getLineNumber())[1]

local linecheck = string.find(roomline, &quot;&gt; &quot;)

moveCursor(0, getLineNumber()-1)

if linecheck ~= nil then
	selectSection(linecheck+1, string.len(roomline)-linecheck-1)
else
	-- include full line in capture window
	selectCurrentLine()
end

copy()
appendBuffer(&quot;gRoomWindow&quot;)
--appendBuffer(&quot;roomwindow&quot;)
moveCursor(0, getLineNumber()+1)


-- in case roomname was on same line as prompt (it happens!)
--if string.find(NyyLIB.Mapper.roomname, &quot;&gt; &quot;) ~= nil then
--	NyyLIB.Mapper.roomname = string.sub(NyyLIB.Mapper.roomname, string.find(NyyLIB.Mapper.roomname, &quot;&gt; &quot;)+2)
--end





NyyLIB.lookstart=1</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#aa007f</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Exits: (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>RoomCapture</name>
                    <script>selectCurrentLine()
copy()
appendBuffer(&quot;gRoomWindow&quot;)
--appendBuffer(&quot;roomwindow&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>PetRescueClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>&lt; ([0-9]+)h/([0-9]+)H</name>
                    <script>if checkMask(&quot;fighter&quot;) then
	return
end

if charData:get(&quot;petrescue&quot;) == &quot;NONE&quot; then
	NyyLIB.torescue=&quot;&quot;
end

if getHide() then
	NyyLIB.torescue=&quot;&quot;
	return
end

if spell[&quot;casting&quot;] ~= nil then
	return
end

if NyyLIB.escapedir ~= nil then
	return
end

if NyyLIB.torescue ~= &quot;&quot; and pet:status() then
	if pet:status(&quot;spectre&quot;) then
		cecho(&quot;&lt;red&gt;\n[Queuing: order spectre rescue &lt;green&gt;&quot; .. NyyLIB.torescue .. &quot;&lt;red&gt;]\n&quot;)
		mud:send(&quot;o spectre rescue &quot; .. NyyLIB.torescue)
	else
		cecho(&quot;&lt;red&gt;\n[Queuing: order followers rescue &lt;green&gt;&quot; .. NyyLIB.torescue .. &quot;&lt;red&gt;]\n&quot;)
		mud:send(&quot;o followers rescue &quot; .. NyyLIB.torescue)
	end
end

NyyLIB.torescue = &quot;&quot;</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>&lt; ([0-9]+)h/([0-9]+)H</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>^Exits: .*</name>
                    <script>NyyLIB.torescue=&quot;&quot;

roomCombat=false</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Exits: .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>*, fighting ({@NyyLIB/RescueListClass/rescuelist|YOU}){!|.}</name>
                    <script>local who = matches[2]

local petrescue=rescuelist:get()

-- last command entered was too look in a direction - return
if string.find(command, &quot;look &quot;) == 1 or string.find(command, &quot;l &quot;) == 1 then
	return
end

-- combat is occuring in this room
roomCombat=true

if petrescue == nil then
	return
end

if who == &quot;YOU&quot; then
  who = whoami()
else
	if table.contains(petrescue, who) == false then
		return
	end
end

if charData:get(&quot;petrescue&quot;) ~= &quot;NONE&quot; then
	if who == whoami() then
		NyyLIB.torescue=whoami()
		return
	end
end

if charData:get(&quot;petrescue&quot;) == &quot;ALL&quot; then
	if NyyLIB.torescue ~= whoami() then
		local member  = table.index_of(petrescue, who)
		local already = table.index_of(petrescue, NyyLIB.torescue)

		if NyyLIB.torescue == &quot;&quot; then
			already=30
		end

		if member &lt; already then
			NyyLIB.torescue = who
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.*[,] fighting (.*)[.]</string>
                        <string>.*[,] fighting (YOU)!.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>One, is the loneliest number...</name>
                    <script>pet.followers = {}

if checkMask(&quot;fighter&quot;) then
	mount:setMounted(false)
	mount:set(nil)
end

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>One, is the loneliest number...</string>
                        <string>You have no followers.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>BuffClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>BuffTriggers</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>(.*)'s skin seems to turn to stone.</name>
                        <script>if matches[2] == &quot;You&quot; then
	buff:set(whoami(), &quot;stoneskin&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;stoneskin&quot;)
	end
end	
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(.*)'s skin seems to turn to stone.</string>
                            <string>(You) feel your skin harden to stone.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>^Your flesh loses its stony texture.$</name>
                        <script>mud:send(&quot;gsay &quot; .. charData:get(&quot;stoneout&quot;, true) )

buff:del(whoami(), &quot;stoneskin&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^Your flesh loses its stony texture.$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your form begins to blur!</name>
                        <script>if matches[2] == &quot;Your&quot; then
	buff:set(whoami(), &quot;blur&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;blur&quot;)
	end
end	
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(Your) form begins to blur!$</string>
                            <string>([A-Za-z]+)'s form becomes blurred and difficult to make out!$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel your heart start to race REALLY FAST!</name>
                        <script>if matches[2] == &quot;You&quot; then
	buff:set(whoami(), &quot;haste&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;haste&quot;)
	end
end	</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(You) feel your heart start to race REALLY FAST!$</string>
                            <string>([A-Za-z]+) starts to move with uncanny speed!$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You begin to shimmer.</name>
                        <script>if matches[2] == &quot;You&quot; then
	buff:set(whoami(), &quot;globe_of_invulnerability&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;globe_of_invulnerability&quot;)
	end
end	</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(You) begin to shimmer.$</string>
                            <string>([A-Za-z]+) begins to shimmer.$</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel your skin transform into dragon scales.</name>
                        <script>if matches[2] == &quot;You&quot; then
	buff:set(whoami(), &quot;dragonscales&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;dragonscales&quot;)
	end
end	</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(You) feel your skin transform into dragon scales.</string>
                            <string>([A-za-z]+)'s skin transforms into hard-plated dragon scales.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The world slows down around you!</name>
                        <script>-- timestop

if checkMask(&quot;priest&quot;) then
	setLabelImage(&quot;TiaBracers&quot;, &quot;tiaBracers-on.png&quot;)
else
	setLabelImage(&quot;time_stop&quot;, &quot;time_stop-active.png&quot;)
end

buff:set(whoami(), &quot;time_stop&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The world slows down around you!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Time speeds up suddenly!</name>
                        <script>if checkMask(&quot;priest&quot;) then
	setLabelImage(&quot;TiaBracers&quot;, &quot;tiaBracers-off.png&quot;)
else
	local label

	if charData:get(&quot;autots&quot;) then
		label=setLabelImage(&quot;time_stop&quot;, &quot;time_stop-on.png&quot;)
	else
		label=setLabelImage(&quot;time_stop&quot;, &quot;time_stop-off.png&quot;)
	end

	label:echo([[&lt;p style=&quot;font-size:14px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;     &lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
end

buff:del(whoami(), &quot;time_stop&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Time speeds up suddenly!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your form stops blurring.</name>
                        <script>if matches[2] == &quot;Your&quot; then
	mud:send(&quot;gsay &quot; .. charData:get(&quot;blurout&quot;, true) )
	buff:del(whoami(), &quot;blur&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:del(matches[2], &quot;blur&quot;)	
	end
end	</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(Your) form stops blurring.</string>
                            <string>([A-Za-z]+) group-says '.*(blur|Blur|BLUR) .+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your dragon scales melt back into your regular flesh.</name>
                        <script>mud:send(&quot;gsay &quot; .. charData:get(&quot;scaleout&quot;, true) )

buff:del(whoami(), &quot;dragonscales&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your dragon scales melt back into your regular flesh.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*globe.*'</name>
                        <script>if groupList:ingroup(matches[2]) then
	buff:del(matches[2], &quot;globe_of_invulnerability&quot;, &quot;x&quot;)	
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(globe|Globe|GLOBE).+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*haste.*'</name>
                        <script>if groupList:ingroup(matches[2]) then
	buff:del(matches[2], &quot;haste&quot;, &quot;x&quot;)	
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(haste|HASTE|Haste).+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*scale.*'</name>
                        <script>if groupList:ingroup(matches[2]) then
	buff:del(matches[2], &quot;dragonscales&quot;, &quot;x&quot;)	
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(scale|Scale|SCALE).+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*stone.*'</name>
                        <script>local var=buff:get(&quot;stoneskin&quot;, matches[2])

if not var then
	return
end

if var &gt; 220 then
	return
end

if groupList:ingroup(matches[2]) then
	buff:del(matches[2], &quot;stoneskin&quot;, &quot;x&quot;)	
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(stone|Stone|STONE).+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*vitality.*'</name>
                        <script>if groupList:ingroup(matches[2]) then
	-- display(&quot;removing vitality from &quot; .. matches[2])


	buff:del(matches[2], &quot;vitality&quot;, &quot;x&quot;)	
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(vit|Vit|VIT).+'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The world speeds up around you.</name>
                        <script>mud:send(&quot;gsay &quot; .. charData:get(&quot;hasteout&quot;, true) )

buff:del(whoami(), &quot;haste&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The world speeds up around you.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your globe shimmers, and fades into the air.</name>
                        <script>mud:send(&quot;gsay &quot; .. charData:get(&quot;globeout&quot;, true) )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your globe shimmers, and fades into the air.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your vitality drains away.</name>
                        <script>buff:del(whoami(), &quot;vitality&quot;)	
mud:send(&quot;gsay &quot; .. charData:get(&quot;vitout&quot;, true) )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your vitality drains away.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are suddenly filled with knowledge of battle tactics!</name>
                        <script>buff:set(whoami(), &quot;combatmind&quot;, 600)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are suddenly filled with knowledge of battle tactics!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel less wooden.</name>
                        <script>mud:send(&quot;gsay &quot; .. charData:get(&quot;barkout&quot;, true) )

buff:del(whoami(), &quot;barkskin&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel less wooden.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your magic armor fades away.</name>
                        <script>mud:send(&quot;gsay [[ ARMOR OUT ]]&quot; )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your magic armor fades away.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The elemental ward protecting you shudders and disappears.</name>
                        <script>-- elemental ward      

mud:send(&quot;gsay [[ WARD OUT ]]&quot; )
buff:del(whoami(), &quot;elemental_ward&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The elemental ward protecting you shudders and disappears.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>image of a Valkyrie appears to partially conceal and protect you.</name>
                        <script>-- valhalla blur
buff:set(whoami(), &quot;blur&quot;, 600 )
mud:send(&quot;gsay [[ VALHALLA UP ]]&quot; )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>image of a Valkyrie appears to partially conceal and protect you.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Invisible things vanish again.</name>
                        <script>mud:send(&quot;gsay &lt;&lt; DET INVIS OUT &gt;&gt;&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Invisible things vanish again.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A crackling purple nimbus of light pops into being around your arms and weapons.</name>
                        <script>-- ward

-- Peri begins to glow with an eerie purple light.


if matches[2] == &quot;your&quot; then
	buff:set(whoami(), &quot;elemental_ward&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;elemental_ward&quot;, 240)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A crackling purple nimbus of light pops into being around (your) arms and weapons.</string>
                            <string>([A-Za-z]+) begins to glow with an eerie purple light.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body shimmers and sheds its elemental form, returning to normal.</name>
                        <script>mud:send(&quot;gsay [[ ELEMENTAL EMBODIMENT OUT ]]&quot; )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body shimmers and sheds its elemental form, returning to normal.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body becomes infused with the divine power of your god!</name>
                        <script>if checkMask(&quot;priest&quot;) then
	setLabelImage(&quot;nestDPRM&quot;, &quot;divine_power-on.png&quot;)
	charData:set(&quot;dprm&quot;, &quot;dp&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body becomes infused with the divine power of your god!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A wave of exhaustion washes over you as your divine power fades.</name>
                        <script>if checkMask(&quot;priest&quot;) then
	setLabelImage(&quot;nestDPRM&quot;, &quot;divine_power-off.png&quot;)
	charData:set(&quot;dprm&quot;, &quot;dp&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A wave of exhaustion washes over you as your divine power fades.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The feeling of power fades as your deity departs.</name>
                        <script>--
if checkMask(&quot;priest&quot;) then
	charData:set(&quot;dprm&quot;, &quot;rm&quot;)
	setLabelImage(&quot;nestDPRM&quot;, &quot;righteous_might-off.png&quot;)
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The feeling of power fades as your deity departs.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Tatris is infused with vitality.</name>
                        <script>if matches[2] == &quot;You&quot; then
	buff:set(whoami(), &quot;vitality&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;vitality&quot;)
	end
end

sendGroup()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) is infused with vitality.</string>
                            <string>(You) feel vitalized.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Onut's form is displaced.</name>
                        <script>if matches[2] == &quot;Your&quot; then
	buff:set(whoami(), &quot;displacement&quot;, 1440)
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;displacement&quot;, 1440)
	end
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+)'s form is displaced.</string>
                            <string>(Your) form is displaced!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>([A-Za-z]+) group-says '.*(displacement|DISPLACEMENT).+'</name>
                        <script>if matches[2] == &quot;Your&quot; then
	mud:send(&quot;gsay &quot; .. charData:get(&quot;displaceout&quot;, true) )
	buff:del(whoami(), &quot;displacement&quot;, &quot;x&quot;)
else
	if groupList:ingroup(matches[2]) then
		buff:del(matches[2], &quot;displacement&quot;, &quot;x&quot;)	
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says '.*(Displacement|displacement|DISPLACEMENT|DISPLACE).+'</string>
                            <string>(Your) displaced form snaps back to your physical location!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Several mirror images of you pop into existence at your side!</name>
                        <script>buff:set(whoami(), &quot;mirror_image&quot;, 31*60 )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Several mirror images of you pop into existence at your side!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>earth embo</name>
                        <script>-- Hetat's form begins to harden and solidify as he is transformed into an earth elemental.
-- Hirple's form begins to harden and solidify as he is transformed into an earth elemental.
-- &quot;elemental_earth_embodiment&quot;

if groupList:ingroup(matches[2]) then
	buff:set(matches[2], &quot;elemental_earth_embodiment&quot;, 600)
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+)'s form begins to harden and solidify as .* is transformed into an earth elemental.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The ancestral spirits depart, dissipating your shield.</name>
                        <script>-- remove ancestral shield
buff:del(whoami(), &quot;ancestral_shield&quot;, &quot;x&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The ancestral spirits depart, dissipating your shield.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A shimmering spiritual shield hovers over you.</name>
                        <script>-- add ancestral shield
buff:set(whoami(), &quot;ancestral_shield&quot;, 30)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A shimmering spiritual shield hovers over you.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel somewhat safer from things that go bump in the night.</name>
                        <script>-- pfu
buff:set(whoami(), &quot;protection_from_undead&quot;, 360)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel somewhat safer from things that go bump in the night.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Undead love you once more.</name>
                        <script>-- pfu
buff:del(whoami(), &quot;protection_from_undead&quot;, &quot;x&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Undead love you once more.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A doppelganger of Bombum snaps into being at his side!</name>
                        <script>-- add buff
if groupList:ingroup(matches[2]) then
	buff:set(matches[2], &quot;doppleganger&quot;, 1000)
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A doppelganger of (.*) snaps into being at .*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Caceshen is now protected from undead!</name>
                        <script>--
-- Protection From Undead 6min
-- buff:set(whoami(), &quot;protection_from_undead&quot;, 360)

if matches[2] == &quot;You&quot; then
	--
else
	if groupList:ingroup(matches[2]) then
		buff:set(matches[2], &quot;protection_from_undead&quot;, 360)
	end
end
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(.*) is now protected from undead!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>PenaltyTriggers</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>penalty status</name>
                        <script>-- should set status, not just send status

-- Vitality                  (  7:18)   sleep                     ( 54:00)   

if matches[2] == &quot;your&quot; or matches[2] == &quot;Your&quot; then
	sendStatus()
else
	if groupList:ingroup(matches[2]) then
		sendStatus(matches[2])
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) body turns to stone as a petralisk gazer stares .*</string>
                            <string>([A-Za-z]+) ceases to move.. still and lifeless.</string>
                            <string>([A-Za-z]+) suddenly looks speechless!</string>
                            <string>([A-Za-z]+) seems to be blinded!</string>
                            <string>.* cleanse ([A-Za-z]+)'s body of impurities...</string>
                            <string>.* tries to dispel ([A-Za-z]+)'s magic!</string>
                            <string>Some of (your) magic has been dispelled!</string>
                            <string>([A-Za-z]+) body turns to stone as the dracolisk stares at .*</string>
                            <string>([A-Za-z]+) staggers about blindly!</string>
                            <string>([A-Za-z]+) goes to sleep.</string>
                            <string>([A-Za-z]+) is blinded by .*</string>
                            <string>([A-Za-z]+)  group-says '&lt;&lt; BLIND! &gt;&gt;'</string>
                            <string>(Your) body turns to stone as a petralisk gazer stares at you!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are suddenly silenced!</name>
                        <script>sendStatus()
spell:clear()

-- only dispel magic if caster or bard
if checkMask(&quot;caster&quot;) or checkMask(&quot;singer&quot;) then
	mud:send(&quot;quaff disp hole&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are suddenly silenced!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel your blood freezing in your veins!</name>
                        <script>mud:send(&quot;gsay &quot; .. whoami() .. &quot;  &lt;&lt; FREEZING &gt;&gt; &quot; .. prompt:get(&quot;hp&quot;) .. &quot;/&quot; .. prompt:get(&quot;maxhp&quot;) )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel your blood freezing in your veins!</string>
                            <string>The poison burns in your veins, and you feel weaker.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You have been blinded!</name>
                        <script>mud:send(&quot;gsay &lt;&lt; BLIND! &gt;&gt;&quot; )

buff:set(whoami(), &quot;blind&quot;, 600)

sendStatus()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^.*You have been blinded!$</string>
                            <string>^You are blinded!$</string>
                            <string>You are blinded by the burning sands!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Lobbole's vision is restored!</name>
                        <script>buff:del(matches[2], &quot;blind&quot;)
buff:del(matches[2], &quot;blindness&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+)'s vision is restored!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your vision returns!
</name>
                        <script>-- chkstat


-- clear blind
buff:del(whoami(), &quot;blind&quot;)
buff:del(whoami(), &quot;blindness&quot;)

sendGroup()

mud:send(&quot;chkstat&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your vision returns!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You can see normally again!</name>
                        <script>buff:del(whoami(), &quot;blind&quot;)
buff:del(whoami(), &quot;blindness&quot;)

sendGroup()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You can see normally again!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You feel able to speak again!</name>
                        <script>buff:del(whoami(), &quot;silence&quot;)
buff:del(whoami(), &quot;silence_person&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You feel able to speak again!</string>
                            <string>You feel able to speak again.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The world stops spinning.</name>
                        <script>-- no longer stunned
buff:del(whoami(), &quot;stun&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The world stops spinning.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Lilpekal looks MUCH healthier.</name>
                        <script>-- Lilpekal looks MUCH healthier.
-- Misi looks MUCH healthier.

-- cure poison/venom
buff:del(matches[2], &quot;poison&quot;)
buff:del(matches[2], &quot;venom&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) looks MUCH healthier.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A warm flush runs throughout your body as the toxins are neutralized.</name>
                        <script>buff:del(whoami(), &quot;poison&quot;)
buff:del(whoami(), &quot;venom&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A warm flush runs throughout your body as the toxins are neutralized.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your body becomes like stone as the paralyzation takes effect.</name>
                        <script>-- You can't!  You're paralyzed to the bone.

buff:set(whoami(), &quot;major_paralysis&quot;, 600)
spell:clear()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your body becomes like stone as the paralyzation takes effect.</string>
                            <string>A carnivorous vine reaches up and wraps itself about you, making it difficult to move, or even breathe!</string>
                            <string>You wait mindlessly for direction from your master.</string>
                            <string>Your body becomes rigid as the paralyzation takes effect.</string>
                            <string>You remain paralyzed and can't do a thing to defend yourself...</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are no longer attractive to pigeons.</name>
                        <script>-- remove para
sendStatus()</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are no longer attractive to pigeons.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your soul is transported to The Fugue Plane as your crumbling body succumbs</name>
                    <script>sound(&quot;165331__ani-music__tubular-bell-of-death.wav&quot;)

NyyLIB.active=nil

-- set room to fugue
map:setRoom(93848)
centerview( map:getRoom() )

-- Remove all buffs on death
buff:del(whoami())

NyyLIB.escapedir = nil
NyyLIB.roguereturn = nil

-- Reset size
charData:set(&quot;bodysize&quot;, whosize() )
setLabelImage(&quot;mysizeDisplay&quot;, &quot;size&quot; .. charData:get(&quot;bodysize&quot;) .. &quot;.png&quot;)

-- Clear train mem variable

NyyLIB.castertrain=nil

-- Clear memorized spells

resetSpellCount()

-- assign an arbitrary memcount

charData:set(&quot;memcount&quot;, 25)

-- Not casting

spell:clear()

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your soul is transported to The Fugue Plane as your crumbling body succumbs</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Capture powername</name>
                    <script>NyyLIB.powersname= matches[2]:trim()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Name             : ([A-Za-z ]+)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Change powers durations</name>
                    <script>--	 armor=1200, 
--	 haste=324, 
--	 dragonscales=360,
--	 blur=202,	
--	 globe_of_invulnerability=324,
--	 displace=1200,
--	 time_stop=175,
--	 stoneskin=240,
--	 elemental_ward=180


-- Target Effect    : Add globe of invulnerability for 4 minutes 


-- Target Effect    : Modify hitpoints by 254 for 8 minutes 40 seconds 2 pulses  
-- vit - will also show on other powers
--local num

--num = tonumber(matches[2])*60 + tonumber(matches[3])

local num=0

if tonumber(matches[2]) then
	num=tonumber(matches[2])*60
end

if tonumber(matches[3]) then
	num=num+ tonumber(matches[3])
end

if NyyLIB.powersname ~= nil then
	power:set( to_snake(NyyLIB.powersname), num )
else
	echo(&quot;Powersname is nil\n&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Target Effect    : Modify hitpoints by [0-9]+ for ([0-9]+) minutes ([0-9]+) seconds ([0-9]+) pulses</string>
                        <string>Target Effect    : Modify hitpoints by [0-9]+ for ([0-9]+) minutes ([0-9]+) seconds </string>
                        <string>Target Effect    : Add globe of invulnerability for ([0-9]+) minutes ?([0-9]+)? ?(seconds)?</string>
                        <string>Target Effect    : Add haste for ([0-9]+) minutes ([0-9]+) seconds</string>
                        <string>Self Effect      : Add time stop for ([0-9]+) minutes ([0-9]+) seconds</string>
                        <string>Target Effect    : Modify target hitroll by -33 for ([0-9]+) minutes ([0-9]+) seconds</string>
                        <string>Target Effect    : Add stoneskin for ([0-9]+) minutes ?([0-9]+)? ?(seconds)?</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>StatusGroup</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Status of Bonble</name>
                    <script>sendingStatus = false

if groupList:ingroup(matches[2]) then
	NyyLIB.statuschar = matches[2]

	local duration=buff:get(&quot;healing_aura&quot;, matches[2])

	-- include healing aura
	if duration then
		buff:del(matches[2])
		buff:set(matches[2], &quot;healing_aura&quot;, duration)
	else
		buff:del(matches[2])
	end
end

--echo(&quot;\n&quot;)
--display(&quot;Capturing status: &quot; .. matches[2])
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Status of ([A-Za-z]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="yes" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capturestatus</name>
                    <script>local min, sec, dur

--display(NyyLIB.statuschar)

if NyyLIB.statuschar ~= &quot;&quot; then
	min=tonumber(matches[3])
	sec=tonumber(matches[4])

	if sec == 0 then
		dur=min*60+NyyLIB.ticktimer
	else
		dur=min*60+sec
	end

	-- TODO
	-- Nyth Flare                (  0:24)
	--if to_snake(matches[2]) == &quot;nyth_flare&quot; then
		-- blind
	--end

	buff:set(NyyLIB.statuschar, to_snake(matches[2]), dur)

	if matches[5] ~= nil then
		min=tonumber(matches[7])
		sec=tonumber(matches[8])

		if sec == 0 then
			dur=min*60+NyyLIB.ticktimer
		else
			dur=min*60+sec
		end

		buff:set(NyyLIB.statuschar, to_snake(matches[6]), dur)

	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z ]+) +\([ ]*([0-9]+):([0-9]+)\)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>SplitClass</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>lootlist</name>
                    <script>-- add to list

table.insert(NyyLIB.groupitems, 1, matches[2])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>[ ]+(.+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>The following items exist in the group cache for</name>
                    <script>NyyLIB.groupitems = {}
enableTrigger(&quot;lootlist&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The following items exist in the group cache for</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>acceptbid</name>
                    <script>-- need to improve itename capture (bid on, please, no bid, etc)

local biditem=string.lower(string.trim(matches[3]))

-- confirm valid bidder
for nx=1, #NyyLIB.validbidders, 1 do
	if NyyLIB.validbidders[nx]:lower() ==
		 string.lower(matches[2]) then
		expandAlias(&quot;bid add &quot; .. matches[2] .. &quot; &quot; .. biditem, false)
		return
	end
end


</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) tells you 'bid (.*)'</string>
                        <string>([A-Za-z]+) tells you '(abstain)'</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="yes" isPerlSlashGOption="yes" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="yes" isColorTriggerFg="yes" isColorTriggerBg="yes">
                    <name>acceptdice</name>
                    <script>local dice, name

name = multimatches[1][2]
dice = multimatches[5][4]:trim()

if name == &quot;You&quot; then
	name = whoami()
end

if NyyLIB.trackbid ~= nil then
	if NyyLIB.trackbid[name] == 0 then
		expandAlias(&quot;adddice &quot; .. name .. &quot; &quot; .. dice, false)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile>C:/Users/Chris/.config/mudlet/profiles/toril 006/NyyLIB.006/beep.wav</mSoundFile>
                    <colorTriggerFgColor>#0000ff</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) group.* '</string>
                        <string>FG13BG2</string>
                        <string>I've rolled a 100 sided dice 1 times, the total result is:</string>
                        <string>FG9BG0</string>
                        <string>([ 0-9]+)'</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>6</integer>
                        <integer>0</integer>
                        <integer>6</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Mounted</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your mount rises up on its hind legs at lets forth a baleful howl!</name>
                    <script>timer:set(&quot;howlcd&quot;, 7)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your mount rises up on its hind legs at lets forth a baleful howl!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your wolf refuses to obey your command!</name>
                    <script>mud:send(&quot;howl&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your wolf refuses to obey your command!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>A massive snarling dire wolf answers your summons!</name>
                    <script>mount:set( &quot;mount&quot; )</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>A massive snarling dire (wolf) answers your summons!</string>
                        <string>A hell (hound) answers your summons!</string>
                        <string>A heavy (warhorse) answers your summons!</string>
                        <string>A zealous (griffon) answers your summons!</string>
                        <string>answers your summons!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your mount misses Elaith Waterstill with its charge!</name>
                    <script>setBashing(false)

</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your mount misses .* with its charge!</string>
                        <string>Your mount charges .* and .*</string>
                        <string>Your mount refuses to trample!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Remount in combat</name>
                    <script>--display(&quot;set dismounted&quot;)

dismounted = true

if mount:get() then
  mud:send(&quot;mount&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You lose your balance and are dismounted.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>summon return</name>
                    <script>mount:set(nil)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your mount gently nuzzles your hand before trotting away and disappearing.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>mount</name>
                    <script>-- You climb on and ride A heavy warhorse.
-- You climb on and ride a hell hound.
-- You skillfully climb on and ride A heavy warhorse in the midst of battle.
-- You climb on and ride a pack pony.

if not checkMask(&quot;mountedCombat&quot;) then
	return
end

local fname=&quot;MountDismount&quot;
local label=findlabel(fname)

if label ~= nil then
	setLabelImage(fname, &quot;dismount.png&quot;)
end

if mount:get() == nil then
	mount:set(&quot;unknown&quot;)
end

mount:setMounted(true)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You skillfully climb on and ride (.*) in the midst of battle.</string>
                        <string>You climb on and ride (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>dismount</name>
                    <script>-- You dismount A heavy warhorse.
-- You dismount a hell hound.
-- You stop riding a hell hound.

if not checkMask(&quot;mountedCombat&quot;) then
	return
end

local fname=&quot;MountDismount&quot;
local label=findlabel(fname)

if label ~= nil then
	setLabelImage(fname, &quot;mount.png&quot;)
end

-- was dismounted
if dismounted==true then
	return
end

mount:setMounted(false)
setBashing(false)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You dismount</string>
                        <string>You stop riding</string>
                        <string>You fall to the ground.  You stop riding.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You would bash your brains out on the roof, better dismount.</name>
                    <script>-- failed movement

--Nurpy flies south.
--You follow Nurpy south.
--
--You would bash your brains out on the roof, better dismount.

mud:send(&quot;dismount&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You would bash your brains out on the roof, better dismount.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You maneuver your wolf to outflank Shalyssa Lurialar!</name>
                    <script>timer:set(&quot;outflankcd&quot;, 6)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You maneuver your wolf to outflank</string>
                        <string>You fail to outflank</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>BOT</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>WaterXP</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A sea elf adventurer swims here.</name>
                        <script>echo(&quot;adventurer found\n&quot;)
NyyLIB.bots.advfound=1

display(&quot;Adventurer:&quot; )

NyyLIB.bots.advposition = map:getRoom()

display( map:getRoom() )

-- mud:send(&quot;give pearl adventurer&quot;)
-- expandAlias(&quot;#fwalk 86308&quot;)

--#COLOR red</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A sea elf adventurer swims here.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Exits: -N -E -S -W -U -D</name>
                        <script>-- room movement
NyyLIB.bots.position = NyyLIB.bots.position or 0


NyyLIB.bots.position = NyyLIB.bots.position+1</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Exits: -N -E -S -W -U -D</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You snap your fingers.</name>
                        <script>NyyLIB.bots.position=0

if NyyLIB.bots.advposition == 0 then
	NyyLIB.bots.xval=NyyLIB.bots.xval+1

	if NyyLIB.bots.xval ~= 6 then
		expandAlias(&quot;.e5n&quot;)
		send(&quot;snap&quot;)
	else
		NyyLIB.bots.xval=0
		NyyLIB.bots.yval=NyyLIB.bots.yval+1

		if NyyLIB.bots.yval ~= 3 then
			expandAlias(&quot;.d5n&quot;)
			send(&quot;snap&quot;)
		end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You snap your fingers.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You get a near-perfect pearl from corpse of a marid farmer.</name>
                        <script>expandAlias(&quot;#fwalk 86308&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You get a near-perfect pearl from corpse of a marid farmer.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>TM_Mochanokul</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Banzai! 
To the rescue...</name>
                        <script>if prompt:get(&quot;enemycondition&quot;) ~= &quot;awful&quot; then
	mud:send(&quot;tug suit&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Banzai! To the rescue...</string>
                            <string>Mochanokul fails miserably in his attempt to rescue you.</string>
                            <string>Mochanokul rises to his feet.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A fiery spark blazes about, forming a large pillar for flame.</name>
                        <script>-- restart, 3min wait

setBashing(false)
rescueSent=false
NyyLIB.damaged = false

function startspark()
	mud:send(&quot;kill spark&quot;)
	mud:send(&quot;tug suit&quot;)
	--mud:send(&quot;shieldpunch&quot;)
end

tempTimer(180, startspark)

</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A fiery spark blazes about, forming a large pillar for flame.</string>
                            <string>a fiery spark is dead!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>CMShadows</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You switch opponents!</name>
                        <script>send(&quot;kill 2.shadow&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You switch opponents!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are already fighting them!</name>
                        <script>send(&quot;kill 1.shadow&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are already fighting them!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You try to switch opponents, but you become confused!</name>
                        <script>send(&quot;kill 3.shadow&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You try to switch opponents, but you become confused!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You strike out wildly about the area in a mighty burst of power!
You critically wound a shadow with a powerful bludgeon!</name>
                        <script>function starthit()
	send(&quot;hitall&quot;)
end

send(&quot;kill 4.shadow&quot;)

tempTimer(20, starthit)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You strike out wildly about the area in a mighty burst of power!</string>
                            <string>You are too disoriented to hitall again!</string>
                            <string>You failed to strike any targets!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Zurg</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A wooden bucket rests here, filled with water.</name>
                        <script>for k,v in pairs(NyyLIB.buckets) do
	if v == map:getRoom() then
		return
	end
end

table.insert(NyyLIB.buckets, 1, map:getRoom() )

echo(&quot;\n[Found bucket in room: &quot; .. map:getRoom() .. &quot;]\n&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A wooden bucket rests here, filled with water.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>SMTrain</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>trainstation</name>
                        <script>local currentroom = map:getRoom()

if currentroom == NyyLIB.nextstop then
	disableTrigger(&quot;trainstation&quot;)

	if NyyLIB.smtrainposition == nil then
		if getPath(currentroom, 48603) then
			mud:send(&quot;gsay Stopping train and returning to inn (48603)&quot; .. &quot; &lt;.&quot; .. compressSpeedwalk() .. &quot;&gt;&quot; )

			expandAlias(&quot;#fwalk 48603&quot;, false)
		else
			mud:send(&quot;gsay Ending train&quot; )
		end

		disableTrigger(&quot;SMTrain&quot;)
	else
		local stopname=NyyLIB.smtrainstops[NyyLIB.smtrainposition][2]

		cecho(&quot;\n\n&lt;red&gt;[Reached train station: &lt;green&gt;(&quot; .. currentroom .. &quot;)&lt;red&gt; &quot; .. stopname .. &quot;]\n\n&quot;)

		if _G[stopname] ~= nil then
			cecho(&quot;&lt;red&gt;[Calling function: &quot; .. stopname .. &quot;]\n&quot;)
			_G[stopname]()
			tempTimer(2, [[NextTrainStop()]])
		else
			mud:send(&quot;glance &quot; .. string.split(stopname, &quot; &quot;)[1] )
			tempTimer(2, [[StartFight()]])
		end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^&lt; .* &gt;</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>checkhealth</name>
                        <script>if matches[2] == &quot;You don't see that here.&quot; then
--	cecho(&quot;\n&lt;red&gt;[Target is already dead.]\n&quot;)
else
	NyyLIB.traintarget=true
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) is in an excellent condition.</string>
                            <string>(You don't see that here.)</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>(.*) is dead! R.I.P. ^Your blood freezes as you hear the rattling death cry of (.*)[.]</name>
                        <script>if matches[2] == &quot;an onyx dagger with a pulsing ruby hilt&quot; then
	return
end

if matches[2] == &quot;an emerald and ruby encrusted dagger&quot; then
	return
end

if _G[&quot;NextTrainStop&quot;] == nil then
	expandAlias(&quot;resettrain&quot;, false)
	return
end

if NyyLIB.smtrainposition == nil then
	-- end train / return to bank
	NyyLIB.trainecho=0
	tempTimer(5, [[NextTrainStop()]])
else
	if map:getRoom() ~= NyyLIB.smtrainstops[NyyLIB.smtrainposition][1] then
		-- current room isn't expected room
		NyyLIB.traintarget=false

		cecho(&quot;&lt;red&gt;[Current room not expected]\n&quot;)
		display( map:getRoom() )
		display( NyyLIB.nextstop )

		expandAlias(&quot;#fwalk &quot; .. NyyLIB.nextstop)
	else
		NyyLIB.trainecho=0

		if callNextTrain == nil then
			callNextTrain=true
			cecho(&quot;&lt;red&gt;\n[Calling NextTrainStop]\n&quot;)
			tempTimer(6, [[NextTrainStop()]])
		end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^Your blood freezes as you hear the rattling death cry of (.*)[.]</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>EC: nasty wounds</name>
                        <script>local xname=string.lower(matches[2])

if NyyLIB.smtrainposition == nil then
	return
end

local xtarget=string.lower(NyyLIB.smtrainstops[NyyLIB.smtrainposition][2])

-- TODO need to capitalize all words in name, not just first

if NyyLIB.trainecho ~= 1 then
	if string.findPattern(xtarget, xname) then
--	if string.split(NyyLIB.smtrainstops[NyyLIB.smtrainposition][2], &quot; &quot;)[1] == string.title(matches[2]) then
		NyyLIB.trainecho=1
--		send(&quot;gcmd [&quot; .. string.title(xtarget) .. &quot; has nasty wounds!]&quot;)


		local str = NyyLIB.smtrainstops[NyyLIB.smtrainposition][2]
		local nextmob = string.gsub(&quot; &quot;..str, &quot;%W%l&quot;, string.upper):sub(2)

		mud:send(&quot;gcmd [&quot; .. nextmob .. &quot; has nasty wounds!]&quot;)
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>E: (.*) EC: nasty wounds</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Lavis Ryl clambers to his feet.</name>
                        <script>if NyyLIB.smtrainposition ~= nil then
	if matches[2] == NyyLIB.smtrainstops[NyyLIB.smtrainposition][2] then
		if inCombat() then
			if checkMask(&quot;rog&quot;) then
				sendTrip()
			else
				if charData:get(&quot;autobash&quot;) then
					sendBash()
				end
			end
		end
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(.*) clambers to (his|her) feet.</string>
                            <string>(.*) staggers about, but manages to get to (his|her) feet.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Purniel group-says 'stats reset'</name>
                        <script>NyyLIB.stats={}
send(&quot;gcmd [Resetting Stats]&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>.* group-(say|project)[s]? 'stats reset'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Purniel group-says 'stats display''</name>
                        <script>printStats(3)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>.* group-(say|project)[s]? 'stats display'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Ssassav gets a small pile of coins from corpse of Ersenas.</name>
                        <script>local charname=matches[2]

if groupList:ingroup(charname) then
	mud:send(&quot;gsay looting from &quot; .. whoami() .. &quot; bad! bad &quot; .. charname .. &quot;!&quot; )
	mud:send(&quot;followers pause &quot; .. charname)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) gets a small pile of coins from corpse of .*</string>
                            <string>([A-Za-z]+) gets something from corpse.</string>
                            <string>([A-Za-z]+) gets a few coins from corpse.*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>a human paladin is dead! R.I.P.</name>
                        <script>if getPath(map:getRoom(), NyyLIB.nextstop) then
	mud:send(&quot;gcmd Moving to: &quot; .. NyyLIB.smtrainstops[NyyLIB.smtrainposition][2] ..
							&quot; (&quot; .. NyyLIB.smtrainstops[NyyLIB.smtrainposition][1] .. &quot;) &quot; ..
 							&quot; &lt;.&quot; .. compressSpeedwalk() .. &quot;&gt;&quot;)
	
	NyyLIB.traintarget=false

	expandAlias(&quot;#fwalk &quot; .. NyyLIB.nextstop)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^a human paladin is dead! R.I.P.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A mage in the Spellguard clambers to her feet.</name>
                        <script>mud:send(&quot;bh spellguard&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A mage in the Spellguard clambers to her feet.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Aratha Sul is dead! R.I.P.</name>
                        <script>mud:send(&quot;get lucky corpse&quot;)
mud:send( p(&quot;lucky&quot;) )</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Aratha Sul is dead! R.I.P.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>dismount on xp</name>
                        <script>if mount:getMounted() then
	mud:send(&quot;dismount&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^You receive .* XP .* experience.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Your mount refuses to trample</name>
                        <script>display(&quot;X&quot;)

mount:charge( getEnemy() )
</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Your mount refuses to trample!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>PsiBomb</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A wispy smoke colored portal hovers just above the center of the room.</name>
                        <script>if NyyLIB.psibomb ~= true then
	NyyLIB.psibomb = true
	mud:send(&quot;enter portal&quot;)
	mud:send(&quot;enter hole&quot;)
	mud:send(&quot;.2s&quot;)
	mud:send(&quot;ultra&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A wispy smoke colored portal hovers just above the center of the room.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You are dead!</name>
                        <script>NyyLIB.psibomb=false</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You are dead!</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You do not have enough psp's to project that.</name>
                        <script>-- disable trigger set
disableTrigger(&quot;PsiBomb&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You do not have enough psp's to project that.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Bel</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>It seems to be locked.</name>
                        <script>belcount = belcount or 0

belcount = belcount + 1

send(&quot;open door&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>It seems to be locked.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>The door SLAMS shut and locks with a heavy thud.</name>
                        <script>belcount=0

send(&quot;gsay door is closed!&quot;)
send(&quot;st&quot;)
send(&quot;open door&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>The door SLAMS shut and locks with a heavy thud.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Ok.</name>
                        <script>belcount = belcount or 0

mud:send(&quot;gsay &lt;&lt;&lt; The door is open! After &quot; .. belcount .. &quot; attempts! &gt;&gt;&gt;&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Ok.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>SMTrainCaster</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Tuw group-says 'Attacking: Forell'</name>
                        <script>-- only do this if not already in combat
if not inCombat() and assistSent == nil then
	local nextroom = NyyLIB.nextroomstop or map:getRoom()

	-- move to correct room if lost

	if nextroom ~= map:getRoom() then
		expandAlias(&quot;#fwalk &quot; .. nextroom)	
	else
		fleeMem()
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) group-says 'Attacking: .*</string>
                            <string>([A-Za-z]+) group-says 'Killing .*</string>
                            <string>([A-Za-z]+) group-says '\[Attacking: .*</string>
                            <string>([A-Za-z]+) group-says 'Going on .*</string>
                            <string>(Entetee) is ENRAGED!</string>
                            <string>([A-Za-z]+) group-says 'Target .*</string>
                            <string>([A-Za-z]+) .* resulting in some strange noises and some blood.</string>
                            <string>([A-Za-z]+) group-says 'bash .*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You flee downward!</name>
                        <script>if NyyLIB.castertrain then
	NyyLIB.castertrain = matches[2]

	mud:send(&quot;pray&quot;, false)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You flee ([nsewud]).*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>finish mem/pray return to fight</name>
                        <script>fightreturn=true

--display(&quot;Z&quot;)

if NyyLIB.castertrain ~= nil then
	mud:send(&quot;st&quot;)

	if NyyLIB.reversedirs[NyyLIB.castertrain] == nil then
		display(&quot;error&quot;)
		display(NyyLIB.castertrain)
	end

	--display(NyyLIB.reversedirs[NyyLIB.castertrain])

	expandAlias(NyyLIB.reversedirs[NyyLIB.castertrain], false)
	--display(&quot;X&quot;)
	NyyLIB.castertrain=nil
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^Your prayers are complete.$</string>
                            <string>.* group-says '.* has nasty wounds.*</string>
                            <string>.* group-says '.* is -=Nasty Wounds=-'</string>
                            <string>.* group-says '.* is -=P-Hurt=-'</string>
                            <string>.* group-says 'ph'</string>
                            <string>.* group-says '.* is pretty hurt and will die soon.'</string>
                            <string>.* group-says '.* is not lookin good, Nasty!'</string>
                            <string>Who can concentrate with all that clanging and screaming?</string>
                            <string>.* group-says '.*  - pretty hurt -'</string>
                            <string>But you don't have any spells in your thoughts!</string>
                            <string>You can't concentrate with all the racket!</string>
                            <string>Your studies are complete.</string>
                            <string>.* group-says '.* has some nasty wounds!'</string>
                            <string>.* group-says '.* is doomed!! \(Nasty Wounds\)'</string>
                            <string>Our enemy will join Kelemvor soon.(pretty hurt)</string>
                            <string>Hoppil group-says '.. Pretty Hurt'</string>
                            <string>Your skin crawls as you hear a death cry nearby!</string>
                            <string>.* in the afterlife!! \(Pretty Hurt\)'</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>0</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>(.*) is dead! R.I.P.</name>
                        <script>spell:clear()

fightreturn=false
NyyLIB.castertrain=nil</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>(.*) is dead! R.I.P.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Harlindrel group-says 'Moving to: Lavis Ryl (48524)  &lt;.sen&gt;'</name>
                        <script>-- Harlindrel group-says 'Moving to: Ultrumm (49135)  &lt;.2e5s5w3nu&gt;'

NyyLIB.castertrain=nil

NyyLIB.nextroomstop = tonumber(matches[2])</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>.* group-says .*Moving to: .* \(([0-9]+)\).*&lt;.*&gt;.*</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>^Your blood freezes as you hear the rattling death cry of (.*)[.]</name>
                        <script>if mount:get() then
	mud:send(&quot;dismount&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>^Your blood freezes as you hear the rattling death cry of (.*)[.]</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>CPNoble</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>You get a signet ring from corpse of a Calimport noble.</name>
                        <script>send(&quot;put signet hole&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>You get a signet ring from corpse of a Calimport noble.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A Calimport noble stands here arrogantly.</name>
                        <script>mud:send(&quot;bh noble&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A Calimport noble stands here arrogantly.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>AutoPortal</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Sarrshis enters a blood-red portal and disappears among the mist.</name>
                        <script>-- Ezarak enters a rainbow colored portal and disappears among the mist.

-- todo
-- Atraz utters the words, 'uizuguburuhl'.
-- The ghost of a huge air elemental utters the words, 'invisibility'.
-- if previous line = invis

-- if more people have entered portal then warriors in group, enter portal

local charname = matches[2]
local portalname = matches[3]

enteredPortal = enteredPortal or {}


if groupList:ingroup(charname) and charData:get(&quot;autoportal&quot;, false) then
	enteredPortal[charname] = &quot;entered&quot;

	-- return if &lt; 6 people in group, or no warriors
	if groupList:size() &lt; 6 or #(groupList:pc(&quot;warrior&quot;)) == 0 then
		return
	end

	if table.size(enteredPortal) &gt; #(groupList:pc(&quot;warrior&quot;)) then
		enteredPortal={}

		spell:clear()

		mud:send(&quot;st&quot;)

		if portalname == &quot;fades&quot; then
		-- special exit or invis

			if map:getRoom() ~= nil then
				local specialexit = getSpecialExitsSwap( map:getRoom() )

				if table.size(specialexit) == 1 then
					for k,v in pairs(specialexit) do
						if mount:getMounted() then
							mud:send(&quot;dismount&quot;)
						end

						local exitcmd=string.split(k, &quot;|&quot;)[1]

						if pet:status() or mount:get() ~= nil then
							mud:send(&quot;O followers &quot; .. exitcmd)
						end

						mud:send (exitcmd)
					end
				end
			end
		else
			if mount:getMounted() then
				mud:send(&quot;dismount&quot;)
			end

			if pet:status() or mount:get() ~= nil then
				mud:send(&quot;O followers enter &quot; .. portalname)
			end

			mud:send(&quot;enter &quot; .. portalname)
		end

		sendLook()
	end
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) enters a blood-red (portal) and disappears among the mist.</string>
                            <string>([A-Za-z]+) enters a planar (rift) and disappears among the mist.</string>
                            <string>([A-Za-z]+) enters a (wormhole) and disappears among the darkness.</string>
                            <string>([A-Za-z]+) enters a rainbow colored (portal) and disappears among the mist.</string>
                            <string>([A-Za-z]+) slowly (fades) out of existence.</string>
                            <string>([A-Za-z]+) enters a (moonwell) and disappears among the mist.</string>
                            <string>([A-Za-z]+) enters the dimensional (fold) and reappears elsewhere...</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>AutoMem</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Ozzec opens an ancient tome and begins studying it intently.</name>
                        <script>-- mem started ingroup
automem = automem or 0

if groupList:ingroup(matches[2]) then
	automem = automem + 1

	if automem &gt;= 2 then
		spell:setMoving(false)
	end

	echoDebug(&quot;\n&lt;red&gt;[+1 automem &quot; .. automem .. &quot; memcount &quot; .. charData:get(&quot;memcount&quot;) .. &quot;\n&quot;)
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>([A-Za-z]+) opens an ancient tome and begins studying it intently.</string>
                            <string>([A-Za-z]+) takes out (his|her) holy symbol and begins praying intently.</string>
                            <string>([A-Za-z]+) takes out (his|her) holy symbol and begins praying intently</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                            <integer>1</integer>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Sorry, you aren't allowed to do that in combat.</name>
                        <script>automem=0</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Sorry, you aren't allowed to do that in combat.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Whark</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>Whiffle Whark leaves north.</name>
                        <script>-- reaches vipertongue (7019) at 23 minutes
-- reaches stream (6840) at 40 minutes 
-- reaches south side docks (3782) at 70-80 minutes

-- Keep Whark invis the entire time on north side of docks+

-- north side dock (3773) 81 minutes
-- leaves north side dock at 90 minutes
-- arrives calimshan spice emporium (3561) at 98 minutes
-- leaves spice at 121 minutes

-- invis all the guards at the Black Dragon Gate (3305)
-- invis the werewolf at the Circle of Contest (71711)

-- arrives kopha 137 minutes

-- if werewolf fights druid, invis werewolf again

-- departs kopha at 154 minutes

mud:send(matches[3])</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>Whiffle Whark (leaves|swims) ([A-Za-z]+).</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>1</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>AutoAssist</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Autoassist - barely wounds</name>
                    <script>-- The spectre of a human noble barely wounds a human noble with its average drain.
-- The spectre of a human noble misses a human noble with its drain.
-- The spectre of a human noble barely wounds a human noble with its average drain.

-- triggered by combat occuring in same room

if matches[2] == whoami() then
	return
end

if charData:get(&quot;autoassist&quot;) then
	if not inCombat() and groupList:getTanking(whoami()) == 0 then
		if groupList:ingroup(matches[2]) then
			if matches[2] ~= whoami() then
				sendAssist(matches[2])
			end
		end

		-- TODO: send assist if ungrouped pet following self

		if pet:member(matches[2]) then
			sendAssist( idMob(matches[2]) )
		end
	end
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(.+) barely wounds .* with .*</string>
                        <string>^(.+) attack only grazes .*</string>
                        <string>^(.+) slams .* shield into .*</string>
                        <string>.* attacks (.+), landing .*</string>
                        <string>^(.+) sends .* sprawling with a powerful bash.</string>
                        <string>^([A-Za-z]+) tried to backstab.*</string>
                        <string>^([A-Za-z]+) places .* in the back of.*</string>
                        <string>.* assists (.+) heroically.$</string>
                        <string>^(.+) sends a powerful force missile slamming into .*</string>
                        <string>^(.+) heroically rescues.*</string>
                        <string>^(.+) does an acrobatic maneuver in battle, and trips up .*</string>
                        <string>^(.+) dodges .*</string>
                        <string>^(.+) misses .* with .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>assist sent</name>
                    <script>-- failed assist attempts

assistSent=nil
sendLook()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are already fighting them!</string>
                        <string>Assist whom?</string>
                        <string>That person is not fighting anyone.</string>
                        <string>You can't see who is fighting</string>
                        <string>You stumble and miss your attack!</string>
                        <string>Maybe you should get on your feet first?</string>
                        <string>You can't get to</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Counters</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>successful rescues</name>
                    <script>-- You are rescued by Atorax, you are confused, but grateful!

if matches[2] == &quot;Banzai&quot; then
	addStat(whoami(), &quot;successrescue&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;successrescue&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(Banzai)! To the rescue...</string>
                        <string>([A-Za-z]+) heroically rescues .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>failed rescues</name>
                    <script>-- Atorax fails miserably in his attempt to rescue you.

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;failedrescue&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;failedrescue&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) fail the rescue.</string>
                        <string>([A-Za-z]+) futilely tries to rescue .*</string>
                        <string>([A-Za-z]+) fails miserably in .* attempt to rescue you.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defShieldGlance (all)</name>
                    <script>-- Ersenas's attack glances off your shield, but finds its mark!
-- Wobb partially blocks a githyanki patrol leader's attack with her shield!


-- there will still be a hit

if matches[2] == &quot;your&quot; then
	addStat(whoami(), &quot;defShieldGlance&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defShieldGlance&quot;)
	end
end

</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* glances off (your) shield, but finds its mark!</string>
                        <string>([A-Za-z]+)  partially blocks .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>STR: 100  AGI: 116  DEX:  83  CON: 106</name>
                    <script>NyyLIB.str=matches[2]
NyyLIB.agi=matches[3]
NyyLIB.dex=matches[4]
NyyLIB.con=matches[4]</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>STR: +([0-9]+) +AGI: +([0-9]+) +DEX: +([0-9]+) +CON: +([0-9]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Armor Class: -100  (100 to -100)  Agility Bonus: -10</name>
                    <script>NyyLIB.agibonus=matches[2]</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.*\(100 to -100\)  Agility Bonus: -([0-9]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Hitroll: 44   Damroll: 29</name>
                    <script>NyyLIB.hitroll=matches[2]
NyyLIB.damroll=matches[3]</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Hitroll: ([0-9]+) *Damroll: ([0-9]+)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offParryPartial (all)</name>
                    <script>-- A draconian warrior partially deflects Misi's lunge at it.

if matches[2] == &quot;your&quot; then
	addStat(whoami(), &quot;offParryPartial&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offParryPartial&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* partially deflects ([A-Za-z]+)'s lunge.*</string>
                        <string>.* partially deflects (your) lunge at .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offDeflect (all)</name>
                    <script>-- Tarthilmor Aerasume deflects your blow, and strikes back at YOU!
-- A githyanki captain deflects Lorle's blow, and strikes back at Lorle!

if matches[2] == &quot;your&quot; then
	addStat(whoami(), &quot;offDeflect&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offDeflect&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* deflects (your) blow, and strikes back at YOU!</string>
                        <string>.* deflects ([A-Za-z]+)'s blow, and strikes back at .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defWeaponDeflect (all)</name>
                    <script>-- You deflect Willa O'Greensleeves's blow, and strike back at Willa O'Greensleeves! (riposte)
-- Oggsk deflects an elite snow elf warrior's blow, and strikes back at an elite snow elf warrior!

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;defWeaponDeflect&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defWeaponDeflect&quot;)
	end
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^([A-Za-z]+) deflect.* </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defGraze (all)</name>
                    <script>if matches[2] == &quot;you&quot; then
	addStat(whoami(), &quot;defGraze&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defGraze&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* attack only grazes ([A-Za-z]+) as .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defDodge (all)</name>
                    <script>-- Uggub dodges a dapper noble's attack.

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;defDodge&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defDodge&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) dodge .*</string>
                        <string>([A-Za-z]+) dodges .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defHit - through my defenses</name>
                    <script>-- hit through my defense
if matches[2] == &quot;you&quot; then
	addStat(whoami(), &quot;defHit&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(whoami(), &quot;defHit&quot;)
		sendGroup()
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>barely wounds ([A-Za-z]+)</string>
                        <string>slightly wounds ([A-Za-z]+)</string>
                        <string>badly wounds ([A-Za-z]+)</string>
                        <string>You stagger from</string>
                        <string>wounds ([A-Za-z]+) harshly </string>
                        <string>severely wounds ([A-Za-z]+)</string>
                        <string>critically wounds ([A-Za-z]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offMissed - missed attack (all)</name>
                    <script>if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;offMiss&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offMiss&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) miss .* with .*</string>
                        <string>^([A-Za-z]+) misses .* with .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offHit - me</name>
                    <script>-- Your weak hit barely wounds a massive turnip.

-- hit
addStat(whoami(), &quot;offHit&quot;)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your awesome .*</string>
                        <string>Your strong .*.</string>
                        <string>Your mighty .*.</string>
                        <string>Your powerful .*.</string>
                        <string>Your massive .*.</string>
                        <string>Your average .*.</string>
                        <string>You enshroud .*</string>
                        <string> .* is nearly slain by the force of your .*</string>
                        <string>You critically wound .*</string>
                        <string>Your weak hit .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offHit - other</name>
                    <script>-- Yugguk barely wounds Forell Luckaun with his powerful slash.

if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;offHit&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^([A-Za-z]+) barely wounds .*</string>
                        <string>^([A-Za-z]+) critically wounds .*</string>
                        <string>^([A-Za-z]+) wounds .*</string>
                        <string>^([A-Za-z]+) enshrouds .*</string>
                        <string>^([A-Za-z]+) slightly wounds .*</string>
                        <string>^([A-Za-z]+) brutally wounds .*</string>
                        <string>^([A-Za-z]+) severely wounds .*</string>
                        <string>^.* staggers from ([A-Za-z]+)'s awesome .*</string>
                        <string>^.* is nearly slain by the force of ([A-Za-z]+)'s .*</string>
                        <string>^.* is slashed into two by a masterly stroke performed by ([A-Za-z]+).</string>
                        <string>^([A-Za-z]+) badly wounds .*</string>
                        <string>^.* staggers from ([A-Za-z]+)'s massive .*</string>
                        <string>^([A-Za-z]+) pierces.*, whose body falls lifeless to the ground.</string>
                        <string>^([A-Za-z]+) pierces the heart of .* who falls to the ground clutching at the wound.</string>
                        <string>^.* staggers from ([A-Za-z]+)'s strong .*</string>
                        <string>^([A-Za-z]+) neatly beheads .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offDodge (all)</name>
                    <script>-- miss - dodge

if matches[2] == &quot;you&quot; or matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;offDodge&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offDodge&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>dodges (you)r futile attack.</string>
                        <string>.* dodges ([A-Za-z]+)'s attack.</string>
                        <string>(You)r attack glances harmlessly off of .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defMiss - missed attack (all)</name>
                    <script>-- A challenge warrior's attack only grazes Graxod as he dodges aside!
-- Tarthilmor Aerasume deflects your blow, and strikes back at YOU!


-- attack doesn't get through my defense

if matches[2] == &quot;you&quot; then
	addStat(whoami(), &quot;defMiss&quot;)
end

if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;defMiss&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string> misses (you) </string>
                        <string>.* missed ([A-Za-z]+) with .*</string>
                        <string>.* misses ([A-Za-z]+) with .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>shield vamp</name>
                    <script>addStat(whoami(), &quot;shieldvamp&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your shield glows brightly as it steals some lifeforce</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defParry (all)</name>
                    <script>-- Grxx parries a mage in the Spellguard's lunge at him.

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;defParry&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defParry&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) parry .*</string>
                        <string>([A-Za-z]+) parries .* lunge at .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offParry (all)</name>
                    <script>-- An elite caravan guard parries your futile lunge at him.
-- A magical skeleton parries Nisaya's lunge at it.
-- Grxx parries a mage in the Spellguard's lunge at him.

if matches[2] == &quot;your&quot; then
	addStat(whoami(), &quot;offParry&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offParry&quot;)
	end
end
	</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* parries ([A-Za-z]+)'s lunge at .*</string>
                        <string>.* parries (your) futile lunge at .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defShieldBlock (all)</name>
                    <script>-- Graxod blocks a member of the High Guard's attack with his shield!
-- A large ogre blocks Sashishe's attack with his shield!
--Wobb blocks a githyanki Defender's attack with her shield!
-- .* blocks ([A-Za-z]+)'s attack with his shield!


if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;defShieldBlock&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defShieldBlock&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) block .*</string>
                        <string>([A-Za-z]+) blocks .* attack with .* shield!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offGraze - other</name>
                    <script>--Hoppel's attack only grazes a githyanki warrior as he dodges aside!
--Your attack only grazes a tl'a'ikith as he dodges aside!

if matches[2] == &quot;Your&quot; then
	addStat(whoami(), &quot;offGraze&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;offGraze&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+)'s attack only grazes .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>defParryPartial (all)</name>
                    <script>-- Lashimer partially deflects a shadowy spectre's lunge at him.

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;defParryPartial&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;defParryPartial&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(You) partially deflect</string>
                        <string>([A-Za-z]+) partially deflects .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>offShieldBlock (other)</name>
                    <script>-- A large ogre blocks Sashishe's attack with his shield!

if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;offShieldBlock&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* blocks ([A-Za-z]+)'s attack with .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Ganar summons a healing light that surround the entire group.</name>
                    <script>-- Bafog summons a healing light that surround the entire group.
-- Vare summons a holy light that surrounds the entire group.
-- Rokpat summons a holy light that surrounds the entire group.


if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;GroupHeal&quot;)
	return
end

addStat(matches[2], &quot;GroupHeal&quot;)

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) summons a healing light that surround the entire group.</string>
                        <string>(You) summon a healing light that surrounds the entire group.</string>
                        <string>([A-Za-z]+) summons a holy light that surrounds the entire group.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Nilebbeple starts casting a spell called 'Vitality'</name>
                    <script>
addStat(matches[2], &quot;Vitality&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) starts casting a spell called 'Vitality'</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>invoker spells</name>
                    <script>--</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) summons a fearsome meteor swarm!</string>
                        <string>Billowing clouds of incendiary gases pour from ([A-Za-z]+)'s fingertips!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Hosol summons a holy light to surround Hosol and close his wounds.
</name>
                    <script>-- full heal
-- Rynshana summons a holy light to surround Ravad and close his wounds.
-- Your feel a rush of warmth as your wounds are healed.
-- You summon a holy light to surround Lilabipple and close her wounds.
-- You summon a holy light to surround a gray slaad and close its wounds.[heal trigger]
-- Lilebeple summons a holy light to surround Tatris and close his wounds.


if matches[2] == &quot;Your&quot; then
	addStat(whoami(), &quot;gotFullHeal&quot;)
	return
end

if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;castFullHeal&quot;)

	if not groupList:ingroup(matches[3]) then
		return
	end

	addStat(matches[3], &quot;gotFullHeal&quot;)

	return
end

if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;castFullHeal&quot;)
end

if groupList:ingroup(matches[3]) then
	addStat(matches[3], &quot;gotFullHeal&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) summons a holy light to surround ([A-Za-z]+) and close .*</string>
                        <string>(Your) feel a rush of warmth as your wounds are healed.</string>
                        <string>(You) summon a holy light to surround ([A-Za-z ]+) and close .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Hosol surrounds Ashashas in a brilliant aura of 
holy power.</name>
                    <script>-- healingaura - add buff (20 sec timer)
-- Repeats 5 times every 4 seconds = 20 sec
-- triggers after 4, 4, 4, 4, 4 (heal at 4, 8, 12, 16, 20

--Mizes completes his spell...
--You are surrounded in a brilliant aura of holy power.

spell:whocast()

if groupList:ingroup(matches[2]) then
	-- ([A-Za-z]+) surrounds ([A-Za-z]+) in a brilliant aura of holy power.
	addStat(matches[2], &quot;castHealingAura&quot;)

	if groupList:ingroup(matches[3]) then
		buff:set(matches[3], &quot;healing_aura&quot;, 20)

		addStat(matches[3], &quot;gotHealingAura&quot;)
	end
end

if matches[2] == &quot;You&quot; then
	if matches[3] == nil then
		-- You are surrounded in a brilliant aura of holy power.
		buff:set(whoami(), &quot;healing_aura&quot;, 20)

		addStat(whoami(), &quot;gotHealingAura&quot;)

		if spell:whocast() == whoami() then
			addStat(whoami(), &quot;castHealingAura&quot;)
		end
	else
		-- You surround Harlindrel in a brilliant aura of holy power.
		addStat(whoami(), &quot;castHealingAura&quot;)

		if groupList:ingroup(matches[3]) then
			buff:set(matches[3], &quot;healing_aura&quot;, 20)

			addStat(matches[3], &quot;gotHealingAura&quot;)
		end
	end
end

</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) surrounds ([A-Za-z]+) in a brilliant aura of holy power.</string>
                        <string>(You) are surrounded in a brilliant aura of holy power.</string>
                        <string>(You) surround ([A-Za-z]+) in a brilliant aura of holy power.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Lilithelle has died!</name>
                    <script>-- death counter

if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;death&quot;)
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) has died!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your body warms as some of your wounds are healed.</name>
                    <script>-- heal cast on self
-- Your body warms as some of your wounds are healed. 

-- Your body warms as your wounds are healed. groupheal?

-- You summon a healing light that surrounds the entire group.

addStat(whoami(), &quot;castHeal&quot;)
addStat(whoami(), &quot;gotHeal&quot;)

for k,char in pairs(groupList:pc()) do
	buff:del(char, &quot;blind&quot;)
	buff:del(char, &quot;blindness&quot;)
end

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your body warms as some of your wounds are healed.</string>
                        <string>Your body warms as your wounds are healed.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Daggararoa is infused with vitality.</name>
                    <script>-- Daggararoa is infused with vitality. (cast by me)
--([A-Za-z]+) is infused with vitality. (someone else)
-- You feel vitalized. (by me or someone else)


local caster=spell:whocast()


if caster ~= nil then
	addStat(caster, &quot;Vitality&quot;)
end

if matches[2] == &quot;You&quot; then
	sendStatus()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) is infused with vitality.</string>
                        <string>(You) feel vitalized.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are rescued by Harlindrel!</name>
                    <script>if groupList:ingroup(matches[2]) then
	addStat(matches[2], &quot;successrescue&quot;)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are rescued by ([A-Za-z]+)!</string>
                        <string>You are rescued by ([A-Za-z]+), you are confused, but grateful!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Kazah starts casting an offensive spell called 'Spectral Hand'</name>
                    <script>-- track total spellcast
if matches[2] == &quot;You&quot; then
	addStat(whoami(), &quot;spellCast&quot;)
else
	if groupList:ingroup(matches[2]) then
		addStat(matches[2], &quot;spellCast&quot;)
	end
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) starts casting .*</string>
                        <string>(You) start chanting...</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You maneuver your mount to avoid A naked woman's attack!</name>
                    <script>-- mount block

addStat(whoami(), &quot;defMountBlock&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You maneuver your mount to avoid</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>planetar heal</name>
                    <script>-- planetar heal proc
addStat(whoami(), &quot;planetar&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Warm, radiating sunlight exudes from your blade, healing your wounds with its powerful energy.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>AutoRoller</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="yes" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>(Strength|Dexterity|Agility|Constitution|Power|Intelligence|Wisdom|Charisma): +(mighty|good|average|mundane)</name>
                    <script>if matches[3] == &quot;mighty&quot; then
	NyyLIB.roller = NyyLIB.roller +	 1
end

if matches[6] == &quot;mighty&quot; then
	NyyLIB.roller = NyyLIB.roller +	 1
end

if matches[3] == &quot;heroic&quot; then
	NyyLIB.roller = NyyLIB.roller +	 2
end

if matches[6] == &quot;heroic&quot; then
	NyyLIB.roller = NyyLIB.roller +	 2
end


if matches[3] == &quot;perfect&quot; then
	NyyLIB.roller = NyyLIB.roller +	 3
end

if matches[6] == &quot;perfect&quot; then
	NyyLIB.roller = NyyLIB.roller +	 3
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(Strength|Dexterity|Agility|Constitution|Power|Intelligence|Wisdom|Charisma): +(bad|fair|average|mundane|good|mighty|heroic|perfect)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Your basic stats:</name>
                    <script>NyyLIB.roller=0</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Your basic stats:</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>RollerTrigger</name>
                    <script>local rollerstats = rollerstats or {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}

if NyyLIB.roller ~= 0 then
	rollerstats[NyyLIB.roller] = rollerstats[NyyLIB.roller] + 1

	echo( &quot;\n[4: &quot; .. rollerstats[4] ..
	&quot; 5: &quot; .. rollerstats[5] ..
	&quot; 6: &quot; .. rollerstats[6] ..
	&quot; 7: &quot; .. rollerstats[7] ..
	&quot; 8: &quot; .. rollerstats[8] .. 
	&quot; 9: &quot; .. rollerstats[9] .. 
	&quot;10: &quot; .. rollerstats[10] .. 
	&quot;11: &quot; .. rollerstats[11] .. 

	&quot; Current: &quot; .. NyyLIB.roller .. &quot;]\n&quot;)
end

if NyyLIB.roller &lt; charData:get(&quot;autoroll&quot;, true) then
	send(&quot;y&quot;)
else
	-- sound
	sound(&quot;365641__furbyguy__8-bit-alarm.wav&quot;,nil,true)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Enter 'y' to reroll, 'n' to accept these stats, '?' to view help, or two attributes to swap: </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>DisplayPotions</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>When you look inside, you see:</name>
                    <script>-- A hole of spatial distortion (carried) : 

-- enable potion detect trigger
enableTrigger(&quot;InventoryPotions&quot;)
enableTrigger(&quot;EndTrigger&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>When you look inside, you see:</string>
                        <string>([A-Za-z ]+) \(carried\) : </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>InventoryPotions</name>
                    <script>-- echo info
--cecho(&quot; &lt;:medium_blue&gt;&lt;white&gt;&quot; .. &quot;(&quot; .. newvar .. &quot;)&quot;)

-- need to remove number, illuminating, magic etc - split

local itemname=matches[2]


itemname = string.gsub(itemname, &quot;%(magic%)&quot;, &quot;&quot;)
itemname = string.gsub(itemname, &quot;%(illuminated%)&quot;, &quot;&quot;)
itemname = itemname:trim()

if string.find(itemname, &quot;] &quot;) ~= nil then
	itemname = string.sub(itemname, string.find(itemname, &quot;] &quot;)+2)
end

itemname = NyyLIB.itemdb[itemname]

if itemname ~= nil then
	if itemname[1] == &quot;potion&quot; then
		itemname=itemname[2]
		cecho(&quot; &quot; .. charData:get(&quot;potionc&quot;, true) .. &quot;[&quot; .. itemname .. &quot;]&quot;)
	elseif itemname[1] == &quot;scroll&quot; then
		itemname=itemname[2]
		cecho(&quot; &lt;:medium_blue&gt;&lt;red&gt;&quot; .. &quot;[&quot; .. itemname .. &quot;]&quot;)
	else
		itemname=itemname[2]
		cecho(&quot; &lt;:medium_blue&gt;&lt;green&gt;&quot; .. &quot;[&quot; .. itemname .. &quot;]&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(.*)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>EndTrigger</name>
                    <script>-- need to fix for badge

disableTrigger(&quot;EndTrigger&quot;)
disableTrigger(&quot;InventoryPotions&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^&lt;.*&gt;</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Mapper.002</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>^Exits: (.*)</name>
                    <script>local xexits=matches[2]
local roomPortal = false

-- need to NOT do the below if moving through known map

NyyLIB.Mapper = NyyLIB.Mapper or {}
NyyLIB.Mapper.movement = NyyLIB.Mapper.movement or {}

--display(command)


-- last command entered was look - return
--if string.find(command, &quot;look &quot;) == 1 or string.find(command, &quot;L &quot;) == 1 then
--	return
--end


-- clair - 'cast your sights far out' in the last 6 lines

for nx=1,6,1 do
	if string.find( getLines(getLineNumber()-nx, getLineNumber())[1], &quot;cast your sights far out&quot;) then
		roomPortal=&quot;Clair&quot;
	end
end

-- looking in wormhole - 'You peer into'
-- You peer into a blood-red portal
-- You peer into a rainbow colored portal and see...
-- You peer into a moonwell and see...

for nx=1,6,1 do
	local portal=string.match( getLines(getLineNumber()-nx, getLineNumber())[1], &quot;You peer into a (.*) and see&quot; )

	if portal ~= nil then
		roomPortal=portal
	end
end

-- last command entered was scan
if command == &quot;SCAN&quot; then
	local lineindex=1

	while ( string.find( getLines(getLineNumber()-lineindex, getLineNumber())[1], &quot;^You scan ([A-Za-z]+)[.][.][.]&quot;) == nil) do
		lineindex=lineindex+1

		if lineindex &gt; 150 then
			cecho(&quot;&lt;red&gt;[Scan error]\n&quot;)
			return
		end
	end

	local scandir= string.match(getLines(getLineNumber()-lineindex, getLineNumber())[1], &quot;^You scan ([a-z]+).*&quot;)

	scanned[scandir]={}
	scanned[scandir][&quot;roomname&quot;]= getLines(getLineNumber()-lineindex+1, getLineNumber())[1]
	scanned[scandir][&quot;exits&quot;] = getExitTable(xexits)

	scanned[scandir][&quot;roomids&quot;] = findRoomIDTable( scanned[scandir][&quot;roomname&quot;], getExitTable(xexits), true)

	scanned[&quot;currentroomname&quot;] = NyyLIB.Mapper.roomname
	scanned[&quot;currentroomexits&quot;] = NyyLIB.Mapper.exits

	filterScan(scandir) -- reverse checks all rooms

	if map:getRoom() == nil then
		--display(&quot;map:getRoom() is nil&quot;)
		local solveroom = solveScan(true)

		if solveroom ~= nil then
			--display(solveroom)
			map:setRoom(solveroom)
			centerview( map:getRoom() )
		end
	end

	return
end

-- find last blank line received, name is first following line of format title, doesn't end in period

local lineindex=1

-- find last promptline received
while isStringPrompt( getLines(getLineNumber()-lineindex, getLineNumber())[1] ) == false do
	lineindex=lineindex+1

	if lineindex &gt; 150 then
		echoDebug(&quot;&lt;red&gt;[Unable to locate roomname]\n&quot;)
		return
	end
end

while isRoomName(lineindex) == false do
	lineindex=lineindex-1
end

-- if claired decrease index by 1
local checkline= getLines(getLineNumber()-lineindex, getLineNumber())[1]

if checkline ~= nil then
	if string.find( checkline, &quot;cast your sights far out&quot;) then
		lineindex=lineindex-1
	end

	if string.find( checkline, &quot;You peer into&quot;) then
		lineindex=lineindex-1
	end
end

NyyLIB.Mapper.roomname = getLines(getLineNumber()-lineindex, getLineNumber())[1] 

if NyyLIB.Mapper.roomname == nil then
	return
end

-- remove (Shadowed)
NyyLIB.Mapper.roomname = string.gsub(NyyLIB.Mapper.roomname, &quot; %(Shadowed%)&quot;, &quot;&quot;)

-- in case roomname was on same line as prompt (it happens!)
if string.find(NyyLIB.Mapper.roomname, &quot;&gt; &quot;) ~= nil then
	NyyLIB.Mapper.roomname = string.sub(NyyLIB.Mapper.roomname, string.find(NyyLIB.Mapper.roomname, &quot;&gt; &quot;)+2)
end

NyyLIB.Mapper.exits = getExitTable(xexits)

-- pop last movement (if there was one)

if #NyyLIB.Mapper.movement &gt; 0 then
	if NyyLIB.Mapper.movement[1] == &quot;enter&quot; then
		expandAlias(&quot;#find&quot;, false)
	else
		updateMap(NyyLIB.Mapper.movement[1])
	end	

	table.remove(NyyLIB.Mapper.movement, 1)
end

if not roomPortal then
	if map:getRoom() == nil then
		map:setRoom( findRoomID(NyyLIB.Mapper.roomname, NyyLIB.Mapper.exits, true) )
	
		updateMap( map:getRoom() )
	end
end

if xexits == nil then
	cecho(&quot;&lt;red&gt;[Error: nil match on exits]\n&quot;)
end

-- display vnum at the end of exits line
if charData:get(&quot;vnum&quot;, true) then
	if not roomPortal then
		if map:getRoom() ~= nil then
			cecho(&quot;&lt;forest_green&gt;&quot; .. string.format(&quot;%&quot; .. (15-string.len(xexits)) .. &quot;s [%s] &quot;, &quot; &quot;, map:getRoom() ))
			-- cecho(&quot;&lt;forest_green&gt;&quot; .. string.format(&quot; [%s] &quot;, map:getRoom() ))
		else
			cecho(&quot;&lt;red&gt;&quot; .. string.format(&quot;%&quot; .. (20-string.len(xexits)) .. &quot;s [%s] &quot;, &quot; &quot;, &quot;Unmapped&quot;))
		end
	else
		local clairedroomid = findRoomID(NyyLIB.Mapper.roomname, NyyLIB.Mapper.exits, true)
		local clairzone = findRoomArea(NyyLIB.Mapper.roomname, NyyLIB.Mapper.exits)

		if clairzone == nil then
			cecho(&quot;&lt;red&gt;&quot; .. string.format(&quot;%&quot; .. (15-string.len(xexits)) .. &quot;s [%s] &quot;, &quot; &quot;, roomPortal))
		else
			if clairedroomid == nil then
				cecho(&quot;&lt;red&gt;&quot; .. string.format(&quot;%&quot; .. (15-string.len(xexits)) .. &quot;s [%s: &lt;green&gt;%s&lt;red&gt;] &quot;, &quot; &quot;, roomPortal, clairzone))
			else
				cecho(&quot;&lt;red&gt;&quot; .. string.format(&quot;%&quot; .. (15-string.len(xexits)) .. &quot;s [%s: %d &lt;green&gt;%s&lt;red&gt;] &quot;, &quot; &quot;, roomPortal, clairedroomid, clairzone))
			end
		end
	end
end

if getHide() then
	cecho(&quot;&lt;blue&gt; [Hidden]&quot;)
end

if map:getRoom() ~= nil then
	doorName( map:getRoom() )
end

echo(&quot;\n&quot;)

if #NyyLIB.Mapper.movement == 0 then
	if NyyLIB.tosend ~= nil then
		send(NyyLIB.tosend)
	end

 	NyyLIB.tosend=nil 
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^Exits: (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>forcefind</name>
                    <script>-- As you step into the ruby, there is a blinding flash of light!

--Your vision descends into darkness as your feel your soul pulled back into
--your mortal form. As the transference completes. you feel your body wracked
--with terrible pain. You open your eyes and take a first, shuddering breath.

scanned={}

if timer:get(&quot;forcefind&quot;) then
	return
end

tempTimer(1.5, [[expandAlias(&quot;#find&quot;, false)]])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Suddenly the darkness falls revealing different surroundings.</string>
                        <string>You are instantaneously teleported nearby!</string>
                        <string>You enter something and reappear elsewhere...</string>
                        <string>You start to become less and less solid, until you reappear elsewhere!</string>
                        <string>You recite a scroll of cave escape which turns to dust in your hands.</string>
                        <string>You recite an ensorcelled scroll of the Mistwalker which turns to dust in your hands.</string>
                        <string>Your soul is instantly whisked away from the dreary Fugue Plane when you</string>
                        <string>Someone demands your presence NOW!</string>
                        <string>has summoned you!</string>
                        <string>You feel a Presence touch you, its divine hand cupping itself</string>
                        <string>Your vision descends into darkness as your feel your soul pulled back into</string>
                        <string>The world goes dark.  When you can see again, you are in your guild.</string>
                        <string>You board something.</string>
                        <string>You disembark this ship.</string>
                        <string>OH NO!  Something has gone wrong!  You feel lost!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You flee ([nsewud]).*</name>
                    <script>-- currently moving
spell:setMoving(true)

-- erase spellqueue if any spells present
spell:eraseQueue()

scanned={}

updateMap(matches[2])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You flee ([nsewud]).*</string>
                        <string>You follow .* ([nsewud]).*</string>
                        <string>You escape ([nsewud]).*</string>
                        <string>You stop fighting and attempt to retreat to the ([nwes]).*!</string>
                        <string>You find traces of tracks leading ([nsewud]).*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Failed movement</name>
                    <script>-- failed room movement


-- You're busy spellcasting! - follow has already processed
-- need to record last room/direction

--&lt; 104h/104H 118v/126V P: std &gt; 
--Bloogak lumbers down.
--You follow Bloogak down.

--A magic force blocks movement downwards.
--Irohple leaves down.

--&lt; 104h/104H 118v/126V P: std &gt; 



table.remove(NyyLIB.Mapper.movement, 1)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>That isn't the direction to your guild, type look room to view</string>
                        <string>Alas, you cannot go that way. . . .</string>
                        <string>Nah... You feel too relaxed to do that...</string>
                        <string>Perhaps you should get on your feet first?</string>
                        <string>Oof!  It seems that .* is in your way.</string>
                        <string>The .* seems to be closed.</string>
                        <string>Sorry, you aren't allowed to do that in combat.</string>
                        <string>There is no .* here.</string>
                        <string>You are too exhausted</string>
                        <string>You need a boat to go there.</string>
                        <string>.* is blocking your path!$</string>
                        <string>You would bash your brains out on the roof, better dismount.</string>
                        <string>Stepping off .* at this height might not be such a good idea.</string>
                        <string>humiliates you, and blocks your way.</string>
                        <string>The passage is too tight to fly.</string>
                        <string>You'd surely drown!</string>
                        <string>An impenetrable wall of ice blocks passage</string>
                        <string>preventing you from going</string>
                        <string>You need to board a ship to travel the oceans.</string>
                        <string>The entrance is locked and barred tight.</string>
                        <string>There is no .* here.</string>
                        <string>Try flapping your arms!  (Couldn't hurt)</string>
                        <string>You can't drag something when you're flying.</string>
                        <string>What do you want to drag?</string>
                        <string>You are much too big to fit through the holes in the floor.</string>
                        <string>You collapse under your carried load!</string>
                        <string>A magic force blocks movement downwards.</string>
                        <string>You are stuck in a huge spider web!</string>
                        <string>Animated plants secure your feet and prevent your exit!</string>
                        <string>Your mount is too exhausted for you to follow.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You sit down.</name>
                    <script>NyyLIB.Mapper.movement = {}

spell:setMoving(false)

setHide(false)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You sit down.</string>
                        <string>You drop to your belly.</string>
                        <string>You sit down and relax.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>failed doorbash</name>
                    <script>NyyLIB.doorbash = nil</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You feel stupid, about to bash open doorway down?</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>succeed doorbash</name>
                    <script>updateMap(NyyLIB.doorbash)
NyyLIB.doorbash=nil</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You did it! The door budges under your weight, and you charge into a new place!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>scanlandmarks</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A portal of swirling clouds hovers here.</name>
                        <script>if map:getRoom() ~= nil then
	return
end

if command == &quot;scan&quot; then
	-- You scan north...
	local lineindex=1

	while string.match(getLines(getLineNumber()-lineindex, getLineNumber())[1], &quot;^You scan ([a-z]+).*&quot;) == nil do
		lineindex=lineindex+1

		if lineindex &gt; 150 then
			echoDebug(&quot;&lt;red&gt;[Unable to locate scan message]\n&quot;)
			return
		end
	end

	local scandir = string.match(getLines(getLineNumber()-lineindex, getLineNumber())[1], &quot;^You scan ([a-z]+).*&quot;) 

	local setroom = getRoomExits(88233)[NyyLIB.reversedirs[scandir]]

	map:setRoom(setroom)
	centerview( map:getRoom() )

	-- display(&quot;Found on scan in dir &quot; .. scandir)
end

if string.match(command, &quot;^[nsewud]$&quot;) then
	map:setRoom(88233)
	centerview( map:getRoom() )
end</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A portal of swirling clouds hovers here.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>It is pitch black...</name>
                    <script>-- room entry into a pitch black room

NyyLIB.Mapper = NyyLIB.Mapper or {}
NyyLIB.Mapper.movement = NyyLIB.Mapper.movement or {}

-- last command entered was look or scan - return
if string.find(command, &quot;l &quot;) == 1 or string.find(command, &quot;look &quot;) == 1 or command == &quot;scan&quot; then
	return
end

-- pop last movement (if there was one)

if #NyyLIB.Mapper.movement &gt; 0 then
	if NyyLIB.Mapper.movement[1] == &quot;enter&quot; then
		expandAlias(&quot;#find&quot;, false)
	else
		updateMap(NyyLIB.Mapper.movement[1])
	end	

	table.remove(NyyLIB.Mapper.movement, 1)
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>It is pitch black...</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>GroupHP</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Group heal</name>
                    <script>-- group heal
-- Rokpat summons a holy light that surrounds the entire group.
-- Vooku summons a healing light that surround the entire group.

-- should increase hp accordingly



spell:clear(&quot;cb&quot;)

for k,char in pairs(groupList:pc()) do
	buff:del(char, &quot;blind&quot;)
	buff:del(char, &quot;blindness&quot;)
end

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) summons a healing light that surround the entire group.</string>
                        <string>(You) summon a healing light that surrounds the entire group.</string>
                        <string>([A-Za-z]+) summons a holy light that surrounds the entire group.</string>
                        <string>(Your) vision returns!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>to sendGroup</name>
                    <script>-- You summon a holy light to surround Hosol and close his wounds.
-- Lilebeple summons a holy light to surround Tatris and close his wounds.
-- Diac summons a holy light to surround Kitra and close her wounds.

if matches[2] ~= nil then
	sendStatus(matches[2])
end

sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>in a brilliant aura of holy power.</string>
                        <string>a holy light to surround</string>
                        <string>to heal a death kiss.</string>
                        <string>([A-Za-z]+) group-says 'I have</string>
                        <string>You don't see them here!</string>
                        <string>flips head over heels.</string>
                        <string>OUCH!  That really did HURT!</string>
                        <string>has created a devastating blast of sand!</string>
                        <string>says 'I have</string>
                        <string>A harmonious combination of notes from</string>
                        <string>You finish a verse of the song of healing.</string>
                        <string>hates your guts!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Condensed</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Duplicate line filter</name>
                    <script>-- this trigger will go off on every line recieved

if matches[2] == nil then
	return
end

if charData:get(&quot;condensed&quot;, true)[&quot;duplicate&quot;] then
	local linecheck = string.find(matches[2], &quot;^&lt; .* &gt; &quot;)

	-- line on same line as prompt
	if linecheck ~= nil then
		local endprompt = string.find(matches[2], &quot; &gt; &quot;)		

		if endprompt+2 == string.len(matches[2]) then
			condenseLine(matches[2])
		else
			linecheck = string.find(matches[2], &quot;&gt; &quot;)+1

			if moveCursor(string.find(matches[2], &quot;&gt;&quot;)+#(&quot;&gt;&quot;)-1, getLineNumber()) then
  				insertText(&quot;\n\n&quot;)
			

				-- feedTriggers
			end
		end
	else
		condenseLine(matches[2])
	end
else
	-- duplicate is turned off, but line on same line as prompt still needs to be corrected

	local linecheck = string.find(matches[2], &quot;^&lt; .* &gt; &quot;)

	-- line on same line as prompt
	if linecheck ~= nil then
		local endprompt = string.find(matches[2], &quot; &gt; &quot;)		

		if endprompt+2 ~= string.len(matches[2]) then
			linecheck = string.find(matches[2], &quot;&gt; &quot;)+1

			if moveCursor(string.find(matches[2], &quot;&gt;&quot;)+#(&quot;&gt;&quot;)-1, getLineNumber()) then
  				insertText(&quot;\n\n&quot;)
			
				-- feedTriggers
			end
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Assorted Gags</name>
                    <script>--As Peri's mount opens its mouth, flames lick out to sear a banedead's body!
--Peri's mount's baleful howl freezes a banedead is its tracks!

if charData:get(&quot;condensed&quot;, true)[&quot;misc&quot;] then
	eraseLine()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>shaft of light streaking towards</string>
                        <string>is bathed in scorching flames!</string>
                        <string>is stunned by the horrific visions!</string>
                        <string>A fire elemental revels in</string>
                        <string>A huge beam of white light shines down from the</string>
                        <string>moves about the room gathering</string>
                        <string>The flames engulfing</string>
                        <string>Your strike passes through</string>
                        <string>is partially absorbed!</string>
                        <string>The globe around your body flares as it bears the brunt</string>
                        <string>only grazes .* dodges aside!</string>
                        <string>is outside of the area of the blast!</string>
                        <string>mount opens its mouth, flames lick out to sear</string>
                        <string>baleful howl freezes</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Combat gags</name>
                    <script>if charData:get(&quot;condensed&quot;, true)[&quot;combat&quot;] then
	if groupList:ingroup(matches[2]) or matches[2] == &quot;you&quot; or matches[2] == &quot;You&quot; or matches[2] == &quot;&quot; or matches[2] == nil then
		eraseLine()
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^([A-Za-z]+) barely wounds .*</string>
                        <string>^([A-Za-z]+) misses .* with .*</string>
                        <string>.* misses (you) with .*</string>
                        <string>.* misses ([A-Za-z]+) with .*</string>
                        <string>(You) parry .* lunge at you.</string>
                        <string>(You) miss .* with .*</string>
                        <string>^([A-Za-z]+) assists .* heroically.</string>
                        <string>(You).* barely wounds .*</string>
                        <string>backwards several feet with a powerful kick.</string>
                        <string>^([A-Za-z]+) attempts to circle around .*</string>
                        <string>^([A-Za-z]+) circles around .*</string>
                        <string>^([A-Za-z]+) makes a nice ballet step .*</string>
                        <string>.* dodges ([A-Za-z]+)'s attack.</string>
                        <string>.* gasps in agony as ([A-Za-z]+) strikes at .*</string>
                        <string>^([A-Za-z]+) grits his teeth and viciously headbutts.*</string>
                        <string>.* partially deflects ([A-Za-z]+)'s lunge at .*</string>
                        <string>partially blocks .* attack with .*</string>
                        <string>attack with your shield!</string>
                        <string>attack glances off your shield, but finds its mark!</string>
                        <string>You dodge</string>
                        <string>dodges your futile attack.</string>
                        <string>You partially deflect</string>
                        <string>attack only grazes you as you dodge aside!</string>
                        <string>You score a CRITICAL HIT!</string>
                        <string>^You deflect .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>ItemProcGags</name>
                    <script>--Suddenly the room is filled with dark clouds, the very ground before Rahas 
--apparantly not quite as it had seemed just a moment ago. You picture Rahas
--dashing through some mystical land, on his way to a demon infested dungeon.
--Just before he arrives at it's entrance, a whisper is about the air. The 
--trickery of Brandobaris is suddenly apparent! You blink and it is all gone.
--Only Rahas seems to be grining.

--Dharn swings the warmaul of celestial glory in a mighty arc, crushing
--into Forell Luckaun's body with a mighty blow.  The weapon glows
--fiercely at the impact, and that glow seems to intensify the
--strike.  The celestial strike hammers into Forell Luckaun,
--who sways under the impact.

-- and torso, granting you a reptilian quickstrike ability! Your eyes gleam

if charData:get(&quot;condensed&quot;, true)[&quot;items&quot;] then
	eraseLine()

	if matches[2] == &quot;slithering&quot; then
		if matches[3] == &quot;your&quot; then
			cecho(&quot;\n&lt;blue&gt;[&quot; .. whoami() .. &quot; : the mystical circlet of the coiled serpent]\n&quot;)
		else
			local xname=string.sub(matches[3], 1, string.find(matches[3], &quot;'&quot;)-1)

			cecho(&quot;\n&lt;blue&gt;[&quot; .. xname .. &quot; : the mystical circlet of the coiled serpent]\n&quot;)
		end
	end

	if matches[2] == &quot;khanjari&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: an enchanted khanjari dagger]\n&quot;)
	end

	if matches[2] == &quot;screaming&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: a glittering dagger of the Nurturing Matriarch]\n&quot;)
	end

	if matches[2] == &quot;fanged&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: red dragon fanged]\n&quot;)
	end

	if matches[3] == &quot;warmaul&quot; then
		cecho(&quot;\n&lt;blue&gt;[&quot; .. matches[2] .. &quot; : warmaul of celestial glory]\n&quot;)
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>A momentary brilliant glow originating from</string>
                        <string>.* appearance. Countless serpents begin to uncoil,</string>
                        <string>(slithering) and sliding their way down and around (.*) arms, neck,</string>
                        <string>and torso, granting .* a reptilian quickstrike ability! .*</string>
                        <string>a vivid yellow the brief enchantment begins to fade. Quickly as</string>
                        <string>they descended, the serpents twist and twine their way back to the magic</string>
                        <string>within their circlet.</string>
                        <string>features twist in a grimace of absolute fury, as</string>
                        <string>a warped broadsword tightly.  With a howl of rage,</string>
                        <string>powerfully.  In a frenzy of howling fury</string>
                        <string> squeezes the ironwood haft</string>
                        <string>dwarven waraxe and wades fearlessly into battle.  Magic surges</string>
                        <string>through the glowing golden runes as</string>
                        <string>A sudden intense rush of physical fury spiderwebs its way up and down</string>
                        <string>Physical power emanating from the tip of .* enchanted (khanjari) dagger</string>
                        <string>races towards its wielder within a narrow strip of bright white light. A significant sounding</string>
                        <string>BOOM reverberates between your ears as the light settles</string>
                        <string>An eerie feeling creeps into your mind as a dark mystical power consumes</string>
                        <string>wisps of feathery darkened light ooze forth from the blade</string>
                        <string>enchanted (khanjari) dagger, surrounding</string>
                        <string>is taken by its ferocity and is plunged into a trance.</string>
                        <string>reappears, grinning as</string>
                        <string>A (screaming) can be heard for miles as</string>
                        <string>glittering dagger glows brightly, and then</string>
                        <string>is bathed in scorching flames!</string>
                        <string>jumps back and holds a red dragon fanged dagger out towards</string>
                        <string>The blade becomes a blur as it rapidly changes into the head of Ilxarzzinazzium</string>
                        <string>himself.  With a load roar the head lashes out towards</string>
                        <string>it's giant maw.  As suddenly as the head appeared it dissappears back into</string>
                        <string>a red dragon (fanged) dagger leaving no trace of itself.</string>
                        <string>A red dragon (fanged) dagger suddenly begins glowing brightly and vibrating.</string>
                        <string>The blade of the dagger slowly opens and begins to emerse the whole room in</string>
                        <string>bright yellow, red, and white flames that scorch everything in sight.</string>
                        <string>swings the warmaul of celestial glory in a mighty arc, colliding</string>
                        <string>The weapon glows fiercely at the</string>
                        <string>impact, and the radiance seems to reach out and</string>
                        <string>in a brilliant luminescence. the warmaul of celestial glory continues</string>
                        <string>body, crushing through unimpeded</string>
                        <string>from the might of its wielder's swing.  The aura around</string>
                        <string>intensifies, building to a painful glare as</string>
                        <string>the holy power unleashed by the celestial strike.</string>
                        <string>body sems to dissolve, slumping down into a lifeless corpse as</string>
                        <string>withdraws the (warmaul) of celestial glory</string>
                        <string>([A-Za-z]+) swings the (warmaul) of celestial glory in a mighty arc, crushing</string>
                        <string>body with a mighty blow.  The weapon glows</string>
                        <string>fiercely at the impact, and that glow seems to intensify the</string>
                        <string>strike.  The celestial strike hammers into</string>
                        <string>who sways under the impact.</string>
                        <string>a vivid yellow as the brief enchantment begins to fade. Quickly as</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>SpellGags</name>
                    <script>-- A doppelganger of 

if charData:get(&quot;condensed&quot;, true)[&quot;spells&quot;] then
	eraseLine()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>sends out an almost endless carpet of arachnoids and insects to kill</string>
                        <string>burst of lava coats</string>
                        <string>directs waves of freezing ice towards</string>
                        <string>storm of hail.</string>
                        <string>swarm of fiery meteors.</string>
                        <string>incendiary cloud torches</string>
                        <string>bursts into red hot flames from</string>
                        <string>reels from the sonic assault!</string>
                        <string>blasting winds and snow chill</string>
                        <string>sends a rainbow of prismatic spray from</string>
                        <string>shivers slightly.</string>
                        <string>staggers slightly, but manages to keep</string>
                        <string>staggers and almost falls!</string>
                        <string>looks a little less chilled.</string>
                        <string>calls forth a massive wave of ice!</string>
                        <string>electrical blast causes</string>
                        <string>The tendrils of electricity wrapped around</string>
                        <string>explodes in a shower of frost!</string>
                        <string>shaft of light streaking towards</string>
                        <string>sunray strikes</string>
                        <string>The lightning bolt slams into</string>
                        <string>looks really sick, and shivers uncomfortably.</string>
                        <string>whose swings contact only air!</string>
                        <string>body begins to rot and putrify under the assault of</string>
                        <string>ancestors rend</string>
                        <string>The flames engulfing .* subside.</string>
                        <string>spell is partially absorbed by</string>
                        <string>movements slow from the freezing cold!</string>
                        <string>A torrent of howling souls rips at</string>
                        <string>magic has been dispelled!</string>
                        <string>The area erupts in a massive INFERNO of heat and flames!</string>
                        <string>sends eight shimmering multicolored beams of light spraying</string>
                        <string>with a storm of ice.</string>
                        <string>.* shudders violently as .* is shattered!</string>
                        <string>A massive stone rises from below</string>
                        <string>Your ancestral spirits rend</string>
                        <string>A splash of water sprays</string>
                        <string>is coated in crimson ooze.</string>
                        <string>shudders in agony as .* thunderblast jolts .*</string>
                        <string>swarm of phantasmal blades slashes</string>
                        <string>shudders in pain from the searing winds of</string>
                        <string>waves of freezing ice towards</string>
                        <string>burst of negative energy!</string>
                        <string>You wave the gasses towards</string>
                        <string>directs waves of fire toward</string>
                        <string>The pummeling violence of hail echoes through the region!</string>
                        <string>Waves of heat seem to drink the water right out of your bones!</string>
                        <string>Then leaps and blasts into</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Dragon gags</name>
                    <script>if charData:get(&quot;condensed&quot;, true)[&quot;dragon&quot;] then
	eraseLine()
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>is shocked by the electrical charge!</string>
                        <string>chokes and gasps on the poison fumes!</string>
                        <string>is splattered by the sizzling acid!</string>
                        <string>is slammed by the powerful blast of air!</string>
                        <string>staggers in pain as the massive tail smashes into</string>
                        <string>is knocked down on</string>
                        <string>is chilled by the glacial frost!</string>
                        <string>is scorched by the intense flames!</string>
                        <string>screams in terror as</string>
                        <string>is gassed by</string>
                        <string>breathes cold.</string>
                        <string>is partly turned to ashes, as</string>
                        <string>is drained by the negative energy!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>archery gags</name>
                    <script>if charData:get(&quot;condensed&quot;, true)[&quot;arrows&quot;] then
	if groupList:ingroup(matches[2]) or matches[2] == &quot;&quot; or matches[2] == nil then
		eraseLine()
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) fires .*</string>
                        <string>([A-Za-z]+)'s arrows are turning into large shards of ice as they are fired!</string>
                        <string>ammunition, but doesn't seem to find any.</string>
                        <string>Crack! It impacts on</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>ItemProcGags (2)</name>
                    <script>--shudder pitifully as he fights to cling to conciousness. As the
--assault begins to fade, Lavis Ryl is unable to recover and falls
--to the ground. As you watch, the space all around their body
--shrinks and expands nearly constantly. Unable to withstand the
--massive forces directed at him, Lavis Ryl ceases the struggle
--at last and the magics release their hold.

--You scream in pain as your wrists are sliced open within your own gauntlets!
--Blood starts dripping down your arms as your vision blurs, causing you
--to fly into a maddening rage. Your entire world turns crimson as the intense
--fury of battle overwhelms you!

--As the nasty spikes on your gauntlets tear into the flesh of your opponent
--something inside your head triggers a seemingly infinite loop of carnage,
--repeating itself over and over. Your movement speed increases with every loop
--as you focus in on the bloodshed.

--Suddenly the room is filled with dark clouds, the very ground before Rahas 
--apparantly not quite as it had seemed just a moment ago. You picture Rahas
--dashing through some mystical land, on his way to a demon infested dungeon.
--Just before he arrives at it's entrance, a whisper is about the air. The 
--trickery of Brandobaris is suddenly apparent! You blink and it is all gone.
--Only Rahas seems to be grining.

--Enona's an enchanted khanjari dagger. As the finger-like tendrils writhe and wriggle
--their way up her arms, Enona is infused with a surprising finesse of movement.

--Nukakukac's eyes flash green, and he grins evilly.  Venomous toxins
--ooze from the dread gythka, and cause the blade to acquire an
--oily sheen.  The toxins are forced into Seipora Rein's bleeding wounds
--as Nukakukac slashes wildly.
--Nukakukac sends a small amount of caustic goo flying from his dread gythka,
--hitting Corland Deepforge squarely in the chest.

--An arched and jagged wave of negative energy lashes out in a great
--cone from the massive quadribladed axe wielded by Lilpekal. The
--space between Lilpekal and Corland Deepforge seems to spin wildly as the
--cone of energy penetrates its stunned victim. Corland Deepforge begins to
--shudder pitifully as he fights to cling to consciousness.

if charData:get(&quot;condensed&quot;, true)[&quot;items&quot;] then
	eraseLine()

	if matches[2] == &quot;bloodstone&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: a bloodstone studded shortsword]\n&quot;)
	end

	if matches[2] == &quot;crimson&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: a glowing crimson dagger]\n&quot;)
	end

	if matches[2] == &quot;gythka&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: the enchanted dread gythka of the thri-kreen]\n&quot;)
	end

	if matches[2] == &quot;quadribladed&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: a four-headed battleaxe of abyssal doom]\n&quot;)
	end

	if matches[2] == &quot;gauntlets&quot; then
		cecho(&quot;\n&lt;blue&gt;[&quot; .. whoami() .. &quot; : a pair of berserker battle gauntlets &lt;green&gt;(stat increase)&lt;blue&gt;]\n&quot;)
	end

	if matches[2] == &quot;spikes&quot; then
		cecho(&quot;\n&lt;blue&gt;[&quot; .. whoami() .. &quot; : a pair of berserker battle gauntlets (hitall)]\n&quot;)
	end

end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>rush suddenly, pivoting around on the ball</string>
                        <string>foot to reverse</string>
                        <string>With a sudden feint,</string>
                        <string>attack routine with a dizzying flourish.</string>
                        <string>slashes a (bloodstone) studded shortsword towards</string>
                        <string>flinches back reflexively.  Paired sets of runes along</string>
                        <string>spins about agilely, driving a powerful slash into</string>
                        <string>body with a bloodstone studded longsword.  As the blade is wrenched clear of</string>
                        <string>^the wound, .*</string>
                        <string>glowing (crimson) dagger bathes the room in eerie crimson light as a scathing beam</string>
                        <string>of pulsing pale energy fires from the blade at</string>
                        <string>of pulsing green energy fires from the blade at</string>
                        <string>nearly trips and falls.</string>
                        <string>glowing crimson dagger draws green energy into itself.</string>
                        <string>The dagger bursts into brilliant crimson fire which engulfs</string>
                        <string>of pulsing dark energy fires from the blade at</string>
                        <string>eyes flash green, and</string>
                        <string>ooze from the dread (gythka), and cause the blade to acquire an</string>
                        <string>oily sheen.  The toxins are forced into</string>
                        <string>slashes wildly.</string>
                        <string>sends a small amount of caustic goo flying from .* (gythka)</string>
                        <string>hitting .* squarely in the chest.</string>
                        <string>An arched and jagged wave of negative energy lashes out in a great</string>
                        <string>cone from the massive (quadribladed) axe wielded by</string>
                        <string>seems to spin wildly as the</string>
                        <string>cone of energy penetrates its stunned victim.</string>
                        <string>fights to cling to consciousness.</string>
                        <string>You scream in pain as your wrists are sliced open within your own (gauntlets)!</string>
                        <string>Blood starts dripping down your arms as your vision blurs, causing you</string>
                        <string>to fly into a maddening rage. Your entire world turns crimson as the intense</string>
                        <string>fury of battle overwhelms you!</string>
                        <string>As the nasty (spikes) on your gauntlets tear into the flesh of your opponent</string>
                        <string>something inside your head triggers a seemingly infinite loop of carnage,</string>
                        <string>repeating itself over and over. Your movement speed increases with every loop</string>
                        <string>as you focus in on the bloodshed.</string>
                        <string>shudder pitifully as he fights to cling to conciousness. As the</string>
                        <string>assault begins to fade, </string>
                        <string>to the ground. As you watch, the space all around their body</string>
                        <string>shrinks and expands nearly constantly. Unable to withstand the</string>
                        <string>massive forces directed at </string>
                        <string>at last and the magics release their hold.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>ItemProcGags (3)</name>
                    <script>--A moonblade with a golden hilt blurs into motion, striking
--flurry of attacks slices open cross-cuts across
--slides a moonblade with a golden hilt across the wound
--to inflict even greater damage.
--The runes along a moonblade with a golden hilt abruptly glow fiercely, emitting a
--warm glow that drifts across
--its body, and a loud sizzling sound can be heard as its body dissolves
--under the positive energy.
--seems to wilt under the positive energy discharge, cringing back away from the glare.



--Tafi kneels to the ground, wrapping her cloak around her body, chanting
--softly.  Smoke begins to issue from her cloak and begins to swirl around her 
--entire body, obscuring her in a swirling maelstrom of colors.  You see
--small disturbances in the column of smoke, tails flying out, wings breaking

--dragons are spinning around Tafi in the smoke, each representing a 
--different color.  The dragons suddenly break out of the column, and take spots 
--a few feet away from Tafi, their heads pointing down at her, their wings softly 
--beating. In unison, they all breathe their magic onto her, white, red, black
--blue and green breath slams into her resting body, disappating the smoke column
--and creating an aura around her, coating her with their basic elemental essence.
--The five dragons then begin to swirl around her, picking up speed, until they are 
--just a blur.  Then each swirling color breaks off from the group, flying into
--her cloak, reverting to the depiction of the dragon they represented.

--Xerena jumps back and holds both of her red dragon fanged daggers out
--in front of her. The blades of the daggers begin to glow and ignite in
--flames. A billowing vortex opens up and unleashes images of Ilxarzzinazzium,
--Fierrosa, Infernos, and Scorxariam into the room.  The dragons savagely tear at
--everything in sight with their giant talons. Fire blankets the battlefield
--searing everything.  Giant spiked tails flail about haphazardly crushing
--anything they hit!



--You take a few steps back as you notice Razz's greaves explode in a 
--shower of frost, only to reform about him as rotating blades of
--eternal ice. Even from a distance you can feel the deadly cold's touch
--sting your face as the jagged ice shards gyrate furiously. It would be
--foolish to move any closer to him.

if charData:get(&quot;condensed&quot;, true)[&quot;items&quot;] then
	eraseLine()

	if matches[2] == &quot;khanjari&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: an enchanted khanjari dagger]\n&quot;)
	end

	if matches[2] == &quot;greaves&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: a set of frozen ice shard greaves]\n&quot;)
	end

	if matches[2] == &quot;Vaprak&quot; then
		cecho(&quot;\n&lt;blue&gt;[proc: stupid legging proc]\n&quot;)
	end


end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>softly.  Smoke begins to issue from</string>
                        <string>in a swirling maelstrom of colors.  You see</string>
                        <string>small disturbances in the column of smoke, tails flying out, wings breaking</string>
                        <string>dragons are spinning around </string>
                        <string>different color.  The dragons suddenly break out of the column, and take spots</string>
                        <string>, their heads pointing down at</string>
                        <string>beating. In unison, they all breathe their magic onto</string>
                        <string>blue and green breath slams into </string>
                        <string>and creating an aura around</string>
                        <string>The five dragons then begin to swirl around</string>
                        <string>just a blur.  Then each swirling color breaks off from the group, flying into</string>
                        <string>cloak, reverting to the depiction of the dragon they represented.</string>
                        <string>(greaves) explode in a</string>
                        <string>shower of frost, only to reform about </string>
                        <string>eternal ice. Even from a distance you can feel the deadly cold's touch</string>
                        <string>sting your face as the jagged ice shards gyrate furiously. It would be</string>
                        <string>foolish to move any closer to</string>
                        <string>A ghostly portal suddenly opens, and a tall spectral troll steps out. He nods</string>
                        <string>and whistles. The ancient ghost of a venerable silver dragon appears</string>
                        <string>high above. It cries out, and a woosh of infernal energy radiates about the area</string>
                        <string>augmenting those whomm are acknowledged by (Vaprak).</string>
                        <string>Icis the Frigid snaps into visibility...and pats</string>
                        <string>A wild elf of Darktree appears from behind a tree.</string>
                        <string>An infernal giant strides in...and kicks</string>
                        <string>A goblin tinker sneaks up and stabs</string>
                        <string>who temporarily ducks out of sight.</string>
                        <string>gasps and turns pale as an iron golem passes by.</string>
                        <string>A group of elite soldiers march up and salute</string>
                        <string>A lightning elemental flies in...and embraces</string>
                        <string>kneels to the ground, wrapping</string>
                        <string>the edges of the column, quiet grumblings breaking the silence.  Five tiny</string>
                        <string>an enchanted (khanjari) dagger. As the finger-like tendrils writhe and wriggle</string>
                        <string>is infused with a surprising finesse of movement.</string>
                        <string>blinks as if</string>
                        <string>A moonblade with a golden hilt blurs into motion, striking</string>
                        <string>flurry of attacks slices open cross-cuts across</string>
                        <string>slides a moonblade with a golden hilt across the wound</string>
                        <string>to inflict even greater damage.</string>
                        <string>The runes along a moonblade with a golden hilt abruptly glow fiercely, emitting a</string>
                        <string>warm glow that drifts across</string>
                        <string>its body, and a loud sizzling sound can be heard as its body dissolves</string>
                        <string>under the positive energy.</string>
                        <string>seems to wilt under the positive energy discharge, cringing back away from the glare.</string>
                        <string>it's giant max.  The head of Ilxarzzinazzium chews through</string>
                        <string>spits the lifeless, partially eatten body on the ground.  As suddenly as the head appeared,</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>1</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Consent</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Bitel has revoked her consent.</name>
                    <script>consent:set( matches[2], nil)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) has revoked (his|her|its) consent.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>consent triggers</name>
                    <script>-- Thaemos is consenting you.

consent:set(matches[2], true)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z]+) is consenting you.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Corpse of Ilinal is lying here.</name>
                    <script>-- ressurect corpses if have consent, not fighting, autores enabled, and spellcast enabled
-- TODO - need to check if spell memd

local charname = matches[3]

if groupList:ingroup( charname ) then
	if consent:get(charname) then
		cecho(&quot; &lt;green&gt;(consented)&quot;)

		if not checkMask(&quot;cle&quot;) or not charData:get(&quot;autocast&quot;) then
			return
		end

		-- last command entered was look direction or scan - return
		if string.find(command, &quot;l &quot;) == 1 or string.find(command, &quot;look &quot;) == 1 or command == &quot;scan&quot; then
			return
		end

		if charData:get(&quot;autores&quot;) and not inCombat() then
			-- mark as to res

			if getSpellCount(&quot;resurrect&quot;) &gt; 0 then
				spell:setNext(&quot;resu &quot; .. matches[3])
			end
		end
	end
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(Corpse) of ([A-Za-z]+) is lying here.</string>
                        <string>(drags) corpse of ([A-Za-z]+) along behind .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Sounds</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>tells you</name>
                    <script>sound(&quot;320181__dland__hint.wav&quot;,nil,true)
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>tells you</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>ressurect sound</name>
                    <script>-- open and ([A-Za-z]+) takes a deep breath. The radiance dissipates, leaving
-- hand reaching down to touch ([A-Za-z]+) and .*
-- When it at last clears ([A-Za-z]+) stands before you, looking extremely tired!
-- ([A-Za-z]+) takes a first shuddering breath and rises from the dead. 

sound(&quot;139025__rj10328__131659-bertrof-game-sound-intro-to-game-80921-justinbw-buttonchime02up-4.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>open and ([A-Za-z]+) takes a deep breath. The radiance dissipates, leaving</string>
                        <string>hand reaching down to touch ([A-Za-z]+) and .*</string>
                        <string>([A-Za-z]+) takes a first shuddering breath and rises from the dead. </string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Lilithelle drags corpse of Venumma along behind her.</name>
                    <script>-- Yinelinol drags corpse of Kitra along behind him.

-- corpse drag sound
if charData:get(&quot;echodrag&quot;) then
	if whoclass(matches[2]) ~= &quot;Cle&quot; then
		--mud:send(&quot;gsay &quot; .. matches[3] .. &quot; dragged&quot;)
		mud:send(&quot;t &quot; .. matches[3] .. &quot; consent&quot;)
	end
end

sound(&quot;327909__ruonvniekerk__dragging-on-floor.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(.*) drags corpse of (.*) along behind .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>looting coins</name>
                    <script>-- looting coins
sound(&quot;343462__rocotilos__real-coin-drop.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* gets a small pile of coins from corpse of .*</string>
                        <string>.* gets a few coins from corpse.*</string>
                        <string>You get a few coins from corpse.*</string>
                        <string>You get a small pile of coins from corpse.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>inferno sound</name>
                    <script>sound(&quot;45809__themfish__gas-fire-catch.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>The area erupts in a massive INFERNO of heat and flames!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>dragon roar</name>
                    <script>-- A black dragon scout spreads his wings and ROARS, filling your heart with terror!
-- A young red dragon spreads his wings and ROARS, filling your heart with terror!

-- TODO - tiamat - https://www.freesound.org/people/tambascot/sounds/203105/


--display(&quot;dragon sound&quot;)

sound(&quot;85568__joelaudio__dragon-roar.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>.* wings and ROARS.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You are burned as you hit</name>
                    <script>sound(&quot;368014__trngle__burning-match-into-water.wav&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You are burned as you hit</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>MobAlerts</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>An ogre shaman from Faang watches you closely.</name>
                        <script>sound(&quot;72127__kizilsungur__sweetalertsound3.wav&quot;)</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>An ogre shaman from Faang watches you closely.</string>
                            <string>A servant of the Keep's lady is here tending official business.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Rares</name>
                    <script></script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList/>
                    <regexCodePropertyList/>
                    <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                        <name>A shimmering portal of emerald mist floats in the air here.</name>
                        <script>-- zoar portal</script>
                        <triggerType>0</triggerType>
                        <conditonLineDelta>0</conditonLineDelta>
                        <mStayOpen>0</mStayOpen>
                        <mCommand></mCommand>
                        <packageName></packageName>
                        <mFgColor>#ff0000</mFgColor>
                        <mBgColor>#ffff00</mBgColor>
                        <mSoundFile></mSoundFile>
                        <colorTriggerFgColor>#000000</colorTriggerFgColor>
                        <colorTriggerBgColor>#000000</colorTriggerBgColor>
                        <regexCodeList>
                            <string>A shimmering portal of emerald mist floats in the air here.</string>
                        </regexCodeList>
                        <regexCodePropertyList>
                            <integer>0</integer>
                        </regexCodePropertyList>
                    </Trigger>
                </TriggerGroup>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You find</name>
                    <script>-- You find a secret exit south!</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^You find .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>A deafening roar causes the walls around you to shake and tremble!</name>
                <script>cecho(&quot;&lt;red&gt;\n[Dragons summoned]\n&quot;)</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>A deafening roar causes the walls around you to shake and tremble!</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>0</integer>
                </regexCodePropertyList>
            </Trigger>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>an Ashstone noble is dead! R.I.P.</name>
                <script>setEnemy(&quot;&quot;)</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>is dead! R.I.P.</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>0</integer>
                </regexCodePropertyList>
            </Trigger>
            <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>An ice weird utters the words, 'iuophwabraz'.</name>
                <script>-- should be cleric only
spell:setNext(&quot;sp weird&quot;)</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>weird utters the words, 'iuophwabraz'.</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>0</integer>
                </regexCodePropertyList>
            </Trigger>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>MobCapture</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>Dragor Keenblade is a medium-sized level 56 shield dwarf. Are you mad!?</name>
                    <script>mobs = mobs or {}

conSent=nil

-- room number : map:getRoom()
-- mobname
-- keywords (list)

local roomid = map:getRoom()

local mobname = matches[2]:trim()
local mobsize = matches[3]
local moblvl = matches[4]
local mobrace = matches[5]


if roomid ~= nil then
	mobs[roomid] = {[mobname]={moblvl,mobsize,mobrace} }
end
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>([A-Za-z '-]+) is a ([A-Za-z]+)-sized level ([0-9]+) (.*)[.].*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>They're not here!</name>
                    <script>conSent=nil</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>They're not here!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>PracticeSkills</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capture skills</name>
                    <script>-- meditate                  (bad)           (21) 4 g, 1 s, and 1 c coins

-- mounted combat            (neophyte)      (8) 1 s coin

--display(&quot;Z&quot;)

toPractice = toPractice or {}

local skillname = matches[2]

if skillname ~= nil then
	skillname = skillname:trim()
	--display(skillname)
else
	display(&quot;error&quot;)
	display(matches)
	--display(matches)
	return
end

toPractice[skillname] = true
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^(.+) +\((bad|unlearned|neophyte|poor|very\sgood|below\saverage|average|above\saverage|good)\) +\([0-9]+\) .*coin.*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capture scribable spells</name>
                    <script>toScribe = toScribe or {}

local spellname = matches[2]:trim()

toScribe[spellname] = true</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(.*) +([0-9]+)(nd|rd|th) circle [0-9].*coin.*</string>
                        <string>^(.*) +1st circle $</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You practice 'specialize invocation' for a while...</name>
                    <script>mud:send(&quot;prac &quot; .. matches[2])</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You practice '(.*)' for a while...</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You don't feel comfortable enough to start to scribe.</name>
                    <script>mud:send(&quot;rest&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You don't feel comfortable enough to start to scribe.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>You finish scribing spell Shadow Burst to a large spellbook of flayed planetar skin.</name>
                    <script>-- scribe next
for k,v in pairs(toScribe) do
	mud:send(&quot;prac &quot; .. k)
	toScribe[k]=nil
	return
end</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>You finish scribing spell</string>
                        <string>You already have that power in your spellbook.</string>
                        <string>You already have that spell in your spellbook.</string>
                        <string>You can't learn that power.</string>
                        <string>You don't have that spell in any of your books or scrolls in learnable form!</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>FuriousAssault</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>recharge fa</name>
                    <script>--  - Furious Assault in 12 seconds 1 pulse 
--  - Furious Assault in 1 minute 23 seconds 
local timeleft

if matches[2] == &quot;recharging&quot; then
	timeleft=0
else
	if matches[3] == nil then
		timeleft = tonumber(matches[2])
	else
		timeleft = tonumber(matches[2])*60 + tonumber(matches[3])
	end
end

timer:set(&quot;furiousassault&quot;, timeleft)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Furious Assault in ([0-9]+) seconds .*</string>
                        <string> - Furious Assault in ([0-9]) minute ([0-9]+) seconds </string>
                        <string>You do not have any powers (recharging).</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                        <integer>1</integer>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Resting now will most likely lead to your final rest!</name>
                <script>-- in combat, though prompt might have yet to update</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>Resting now will most likely lead to your final rest!</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>0</integer>
                </regexCodePropertyList>
            </Trigger>
            <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>auction claim</name>
                <script>--    13)     127538                        the mask of the scorpion    100     10             Nirac  N/A   ENDED Nyyrazzilyss
--    25)     127686                      a deep-blue set of sleeves    200     10          Nicrekas  N/A  SELLER Nyyrazzilyss

-- 161)     127839                             a dark shadowy ring     10      1          You (25)  N/A   ENDED Peri

display(matches[3])

if matches[3] == whoami() then
	mud:send(&quot;auction claim &quot; .. matches[2] )
end</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string> +[0-9]+\) +([0-9]+) +.*[A-Za-z]+ +SELLER (.*)</string>
                    <string> +[0-9]+\) +([0-9]+) +.*You.*ENDED.*</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>1</integer>
                    <integer>0</integer>
                </regexCodePropertyList>
            </Trigger>
            <TriggerGroup isActive="no" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>CapturePowers</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>powers list</name>
                    <script>-- Sandblast                           Spell     Study      Level 46
powerslist = powerslist or {}

sortpowerslist={}

-- info needed: capture spellname, level



powerslist[#powerslist+1] = { matches[2]:trim(), matches[3]:trim()}

</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>(.*)Spell     Study      Level ([0-9]+)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capture name</name>
                    <script>-- Name             : Sandblast

powername = matches[2]:trim()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Name             : (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capture alias</name>
                    <script>-- Alias            : sb     

--

sortpowerslist = sortpowerslist or {}


-- info needed: powername, alias, chardata, function

local level=nil

if powerslist == nil then
	return
end


for nx=1, #powerslist, 1 do
	if powerslist[nx][1] == powername then
		level=powerslist[nx][2]
	end
end

if level == nil then
	display(&quot;Unable to find level&quot;)
	return
end

sortpowerslist[#sortpowerslist+1] = {to_snake(powername), matches[2]:trim(), level, &quot;&quot;, &quot;&quot;}
</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>Alias            : (.*)</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
            <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>force switch</name>
                <script>--

if prompt:get(&quot;enemy&quot;) ~= matches[2] then
	mud:send(&quot;kill &quot; .. matches[2] )
end</script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList>
                    <string>The (nightwing) .* fighting .*</string>
                    <string>An (ice) golem .*, fighting</string>
                </regexCodeList>
                <regexCodePropertyList>
                    <integer>1</integer>
                    <integer>1</integer>
                </regexCodePropertyList>
            </Trigger>
            <TriggerGroup isActive="yes" isFolder="yes" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                <name>Followers</name>
                <script></script>
                <triggerType>0</triggerType>
                <conditonLineDelta>0</conditonLineDelta>
                <mStayOpen>0</mStayOpen>
                <mCommand></mCommand>
                <packageName></packageName>
                <mFgColor>#ff0000</mFgColor>
                <mBgColor>#ffff00</mBgColor>
                <mSoundFile></mSoundFile>
                <colorTriggerFgColor>#000000</colorTriggerFgColor>
                <colorTriggerBgColor>#000000</colorTriggerBgColor>
                <regexCodeList/>
                <regexCodePropertyList/>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>NPC:</name>
                    <script>-- start of followers on screen

--Follower summary for Nyyrazzilyss:
--Number of Followers: 1

--NPC:
--   274/274   HP  137/137  MV      + an opulent merchant (merchant opulent)

pet:reset()

enableTrigger(&quot;endfollowers&quot;)
enableTrigger(&quot;capturefollower&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^NPC:$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>endfollowers</name>
                    <script>-- disable trigger on first prompt

disableTrigger(&quot;capturefollower&quot;)
disableTrigger(&quot;endfollowers&quot;)</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^&lt; .*</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="no" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>capturefollower</name>
                    <script>--   2505/2505  HP  152/152  MV      + a gray slaad (gray slaad anvil)
--   2471/2569  HP  192/192  MV      + a hell hound (hell hound direraidermount wolf)
--     72/72    HP  167/167  MV      + a pack pony (pony pack)&quot;a pack pony&quot;
--  2317/2401  HP  197/197  MV      + a zealous griffon (griffon zealous mount paladinmount)

-- matches[2] all keywords

--display(matches[2])
--display(matches[3])

local keywords= string.split(matches[5], &quot; &quot;)

local keyword=keywords[1]

local fullname=matches[4]:trim()

if table.contains( keywords, &quot;slaad&quot;) then
	keyword=&quot;slaad&quot;
end

pet:add(keyword, fullname, tonumber(matches[2]), tonumber(matches[3]) )</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>^ *([0-9]+)/([0-9]+) +HP +[0-9]+/[0-9]+ +MV *\+ (.*)\((.*)\)$</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>1</integer>
                    </regexCodePropertyList>
                </Trigger>
                <Trigger isActive="yes" isFolder="no" isTempTrigger="no" isMultiline="no" isPerlSlashGOption="no" isColorizerTrigger="no" isFilterTrigger="no" isSoundTrigger="no" isColorTrigger="no" isColorTriggerFg="no" isColorTriggerBg="no">
                    <name>starts/stops following you.</name>
                    <script>--You breathe life into corpse of a frost giant warrior with the awesome power of your art.
--The wight of a frost giant warrior starts following you.

mud:send(&quot;followers&quot;)
sendGroup()</script>
                    <triggerType>0</triggerType>
                    <conditonLineDelta>0</conditonLineDelta>
                    <mStayOpen>0</mStayOpen>
                    <mCommand></mCommand>
                    <packageName></packageName>
                    <mFgColor>#ff0000</mFgColor>
                    <mBgColor>#ffff00</mBgColor>
                    <mSoundFile></mSoundFile>
                    <colorTriggerFgColor>#000000</colorTriggerFgColor>
                    <colorTriggerBgColor>#000000</colorTriggerBgColor>
                    <regexCodeList>
                        <string>starts following you.</string>
                        <string>Smoke begins to pour out of your bracer, swirling around you in a dizzying</string>
                        <string>stops following you.</string>
                    </regexCodeList>
                    <regexCodePropertyList>
                        <integer>0</integer>
                        <integer>0</integer>
                        <integer>0</integer>
                    </regexCodePropertyList>
                </Trigger>
            </TriggerGroup>
        </TriggerGroup>
    </TriggerPackage>
    <TimerPackage/>
    <AliasPackage>
        <AliasGroup isActive="yes" isFolder="yes">
            <name>NyyLIB</name>
            <script></script>
            <command></command>
            <packageName></packageName>
            <regex></regex>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>ClassAliases</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Bard</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <AliasGroup isActive="yes" isFolder="yes">
                        <name>songs</name>
                        <script></script>
                        <command></command>
                        <packageName></packageName>
                        <regex></regex>
                        <Alias isActive="yes" isFolder="no">
                            <name>Offensive Harmony</name>
                            <script>music(charData:get(&quot;drum&quot;), &quot;song of offensive harmony&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^haste$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Healing</name>
                            <script>music(charData:get(&quot;lute&quot;), &quot;song of healing&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^heal$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Renewal</name>
                            <script>music(charData:get(&quot;piccolo&quot;), &quot;song of renewal&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^renew$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>The Elements</name>
                            <script>music(charData:get(&quot;drum&quot;), &quot;song of the elements&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^elements$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Harming</name>
                            <script>music(charData:get(&quot;mandolin&quot;), &quot;song of harming&quot;, &quot;room&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^harm$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Protection</name>
                            <script>music(charData:get(&quot;harp&quot;), &quot;song of protection&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^prot$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Recovery</name>
                            <script>music(charData:get(&quot;piccolo&quot;), &quot;song of recovery&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^recover$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Regeneration</name>
                            <script>music(charData:get(&quot;lute&quot;), &quot;song of regeneration&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^regen$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Offensive Disruption</name>
                            <script>music(charData:get(&quot;trumpet&quot;), &quot;song of offensive disruption&quot;, &quot;room&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^slow$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Sorcery</name>
                            <script>music(charData:get(&quot;piccolo&quot;), &quot;song of sorcery&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^sorc$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Travel</name>
                            <script>music(charData:get(&quot;lute&quot;), &quot;song of travel&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^travel$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Defensive Disruption</name>
                            <script>music(charData:get(&quot;trumpet&quot;), &quot;song of defensive disruption&quot;, &quot;room&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^weak$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>stopmusic</name>
                            <script>local label=findlabel(&quot;StopMusic&quot;)
label:echo([[&lt;p style=&quot;font-size:25px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;   &lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])

send(&quot;play&quot;)

charData:set(&quot;song&quot;, &quot;&quot;)
charData:set(&quot;_song&quot;, &quot;&quot;)
charData:set(&quot;effect&quot;, &quot;&quot;)
NyyLIB.songtimer = &quot;&quot;

resetSongs()
</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^stopmusic$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Miscast</name>
                            <script>music(charData:get(&quot;mandolin&quot;), &quot;song of miscast magic&quot;, &quot;room&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^miscast$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Defensive Harmony</name>
                            <script>music(charData:get(&quot;drum&quot;), &quot;song of defensive harmony&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^defend$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Song of Revelation</name>
                            <script>music(charData:get(&quot;harp&quot;), &quot;song of revelation&quot;, &quot;&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^reveal$</regex>
                        </Alias>
                    </AliasGroup>
                    <AliasGroup isActive="yes" isFolder="yes">
                        <name>spells</name>
                        <script></script>
                        <command></command>
                        <packageName></packageName>
                        <regex></regex>
                        <Alias isActive="yes" isFolder="no">
                            <name>Harmonious Blessing</name>
                            <script>send(&quot;c 'harmonious blessing' me&quot;)</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^bless$</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Phantom Armor</name>
                            <script>local cls = whoclass()

if cls == &quot;Ctr&quot; then
	spell:cast(&quot;c 'armor' &quot; .. matches[2])
elseif cls == &quot;Bar&quot; then
	spell:cast(&quot;c 'phantom armor' &quot; .. matches[2])
elseif cls == &quot;Enc&quot; then
	spell:cast(&quot;c 'energy shield' &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^armor (.*)</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Detect Invisibility</name>
                            <script>if checkMask(&quot;sing&quot;) then
	spell:cast(&quot;c 'detect invis' &quot; .. matches[2])
else
	spell:cast(&quot;DI &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^di (.*)</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Faerie Fire</name>
                            <script>if checkMask(&quot;singer&quot;) then
	spell:cast(&quot;c 'faerie fire' &quot; .. matches[2])
else
	spell:cast(&quot;FF &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^ff (.*)</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Ray of Enfeeblement</name>
                            <script>if checkMask(&quot;singer&quot;) then
	spell:cast(&quot;c 'ray of enfeeblement' &quot; .. matches[2])
else
	spell:cast(&quot;RAY &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^ray (.*)</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Displacement</name>
                            <script>-- displacement power is same as dragonscale

if checkMask(&quot;singer&quot;) then
	spell:cast(&quot;c 'displacement' &quot; .. matches[2])
else
	spell:cast(&quot;DS &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^disp (.*)</regex>
                        </Alias>
                        <Alias isActive="yes" isFolder="no">
                            <name>Feeblemind</name>
                            <script>if checkMask(&quot;singer&quot;) then
	spell:cast(&quot;c 'feeblemind' &quot; .. matches[2])
else
	spell:cast(&quot;FEEB &quot; .. matches[2])
end</script>
                            <command></command>
                            <packageName></packageName>
                            <regex>^feeb (.*)</regex>
                        </Alias>
                    </AliasGroup>
                    <Alias isActive="yes" isFolder="no">
                        <name>accompany</name>
                        <script>if NyyLIB.accompany == 0 then
	for k,char in pairs(groupList:pc(&quot;singer&quot;)) do
		if char ~= whoami() then
			mud:send(&quot;accompany &quot; .. char)
			NyyLIB.accompany = 1
			return
		end
	end
else
	mud:send(&quot;accompany stop&quot;)
	NyyLIB.accompany = 0
end
</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^accompany$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>escape dir return backstab</name>
                        <script>send(&quot;escape &quot; .. matches[2])

NyyLIB.escapedir = matches[2]
NyyLIB.roguereturn = matches[3]</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^es([nsewud])([cbp])?$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Psi</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>^sneak([neswud])$</name>
                        <script>if checkMask(&quot;psi&quot;) then
	expandAlias(matches[2], false)
	mud:send(&quot;darkness&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^sneak([neswud])$</regex>
                    </Alias>
                </AliasGroup>
                <Alias isActive="yes" isFolder="no">
                    <name>rift</name>
                    <script>if checkMask(&quot;psi&quot;) then
	send(&quot;rift &quot; .. matches[2], false)
else
	spell:cast(&quot;c 'gate' &quot; .. matches[2])
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^rift (.*)</regex>
                </Alias>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Ctr</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>stone</name>
                        <script>if whoclass() == &quot;Ctr&quot; then
	spell:cast(&quot;c 'stoneskin' &quot; .. matches[2])
else
	spell:cast(&quot;ss &quot; .. matches[2])
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^stone ([A-Za-z]+)</regex>
                    </Alias>
                </AliasGroup>
                <Alias isActive="yes" isFolder="no">
                    <name>shift</name>
                    <script>if checkMask(&quot;psi&quot;) then
	send(&quot;shift &quot; .. matches[2], false)
else
	spell:setMoving(false)
	spell:cast(&quot;relo &quot; .. matches[2])
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^shift ([A-Za-z]+)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>buff</name>
                    <script>if matches[2] ~= nil then
	if checkMask(&quot;enc&quot;) then
		spell:cast(&quot;ds &quot; .. matches[2])
		spell:cast(&quot;blur &quot; .. matches[2])
		spell:cast(&quot;gi &quot; .. matches[2])
		spell:cast(&quot;enl &quot; .. matches[2])
		spell:cast(&quot;di &quot; .. matches[2])
		spell:cast(&quot;fly &quot; .. matches[2])
	elseif checkMask(&quot;cle&quot;) then
		spell:cast(&quot;vt &quot; .. matches[2])
		spell:cast(&quot;ha &quot; .. matches[2])
	end
else
	--
end

-- Spells()</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^buff ?([A-Za-z]+)?$</regex>
                </Alias>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Lic</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>prot</name>
                        <script>send(&quot;rot&quot;)
NyyLIB.rotmovedir = matches[2]
enableTrigger(&quot;RotTrigger&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^prot ([nsewud])$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>soul bind</name>
                        <script>if matches[2] == nil then
	spell:setNext(&quot;SB&quot;)
else
	spell:setNext(&quot;SB &quot; .. matches[2])
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^sb ?([A-Za-z]+)?$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Enc</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>swapts</name>
                        <script>charData:init(&quot;swapts&quot;, &quot;ds&quot;)

if charData:get(&quot;swapts&quot;) == &quot;ds&quot; then
	send(&quot;forget ds&quot;)
	send(&quot;mem ts&quot;)
	send(&quot;prio ts&quot;)
	charData:set(&quot;swapts&quot;, &quot;ts&quot;)
else
	send(&quot;forget ts&quot;)
	send(&quot;mem ds&quot;)
	send(&quot;prio ds&quot;)
	charData:set(&quot;swapts&quot;, &quot;ds&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^swapts$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>ds</name>
                        <script>spell:setNext(&quot;DS &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^ds ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>blur</name>
                        <script>spell:setNext(&quot;bl &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^blur ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>hs</name>
                        <script>if checkMask(&quot;haster&quot;) then
	spell:setNext(&quot;hs &quot; .. matches[2])
else
	mud:send(&quot;HS &quot; .. matches[2])
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^hs ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>gi</name>
                        <script>spell:setNext(&quot;gi &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^gi ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>memd</name>
                        <script>mud:send(&quot;MEM&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^memd$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>cast</name>
                        <script>if not checkMask(&quot;casterSinger&quot;) then
	cecho(&quot;&lt;red&gt;[This class can't access casting scripts]\n&quot;)
	return
end

-- set to not moving, cast/mem ok

automem=3
memsent=false
spell:setMoving(false)
spell:setCurrent(nil)

mud:send(&quot;\n&quot;)

if checkMask(&quot;singer&quot;) then
	return
end

charData:set(&quot;autocast&quot;, true)
SpellsButton(&quot;init&quot;)


</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^cast$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Cle</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>ha</name>
                        <script>--send(&quot;ha &quot; .. matches[2], false)

if checkMask(&quot;cle&quot;) then
	spell:setNext(&quot;ha &quot; .. matches[2])
else
	mud:send(&quot;HA &quot; .. matches[2])
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^ha ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>rpoison</name>
                        <script>mud:send( g(&quot;removepoison&quot;) )
mud:send(&quot;rem warmaul&quot;)
mud:send(&quot;hold removepoison&quot;)
mud:send(&quot;use removepoison&quot;)
mud:send(&quot;rem removepoison&quot;)
mud:send(&quot;wield warmaul&quot;)
mud:send(&quot;drop removepoison&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^rpoison$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>fh (full heal)</name>
                        <script>spell:setNext(&quot;fh &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^fh ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>vit</name>
                        <script>spell:setNext(&quot;vt &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^vit ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>prayd</name>
                        <script>mud:send(&quot;PRAY&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^prayd$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>resu</name>
                        <script>if not consent:get(matches[2]) then
	send(&quot;t &quot; .. matches[2] .. &quot; consent&quot;)
end

spell:setNext(&quot;resu &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^resu ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>castha</name>
                        <script>spell:setMoving(false)

cecho(&quot;&lt;red&gt;[Queuing healing aura]\n&quot;)

--if NyyLIB.mtank ~= nil then
--	spell:setNext(&quot;ha &quot; .. NyyLIB.mtank)
--end

for k,char in pairs(groupList:pc(&quot;warrior&quot;)) do
	spell:attempt(char, &quot;healing_aura&quot;, &quot;ha&quot;)
end



</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^castha$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>sp (silence person)</name>
                        <script>spell:setNext(&quot;sp &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^sp ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>realm</name>
                        <script>spell:setNext(&quot;realm &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^realm (.*)</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Sha</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>summon totem</name>
                        <script>mud:send( g(&quot;totem&quot;) )
mud:send( &quot;rem warmaul&quot; )
mud:send( &quot;hold totem&quot; )
mud:send( &quot;use totem&quot; )
mud:send( &quot;rem totem&quot; )
mud:send( &quot;wield warmaul&quot; )
mud:send( p(&quot;totem&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^totem$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>hex</name>
                        <script>spell:setNext(&quot;hex &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^hex ([A-Za-z]+)$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Rog</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>cr</name>
                        <script>if checkMask(&quot;rogue&quot;) then
	mud:send(&quot;CR&quot;)
	sendLook()
	cecho(&quot;\n&lt;red&gt;[Attacking with circle]\n&quot;)
else
	spell:setNext(&quot;cr&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^cr$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>apb - apply poison blind</name>
                        <script>mud:send(&quot;apply blind primaryweapon&quot;)
mud:send(&quot;apply blind secondaryweapon&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^apb$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>gpb - get blind poison container</name>
                        <script>mud:send( &quot;GET blind &quot; .. charData:get(&quot;poisonbag&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^gpb$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>appb - get blind container and apply</name>
                        <script>expandAlias(&quot;gpb&quot;, false)
expandAlias(&quot;apb&quot;, false)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^appb$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>aps - apply poison slow</name>
                        <script>mud:send(&quot;apply slow primaryweapon&quot;)
mud:send(&quot;apply slow secondaryweapon&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^aps$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>gps - get poison slow from container</name>
                        <script>mud:send( &quot;GET slow &quot; .. charData:get(&quot;poisonbag&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^gps$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>apps - get, apply slow</name>
                        <script>expandAlias(&quot;gps&quot;, false)
expandAlias(&quot;aps&quot;, false)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^apps$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>app - blind primary, slow secondary</name>
                        <script>mud:send(&quot;apply blind primaryweapon&quot;)
mud:send(&quot;apply slow secondaryweapon&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^app$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>gpp - get blind/slow container</name>
                        <script>mud:send( g(&quot;blind&quot;) )
mud:send( g(&quot;slow&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^gpp$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>appp - get/apply blind, slow</name>
                        <script>expandAlias(&quot;gpp&quot;, false)
expandAlias(&quot;app&quot;, false)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^appp$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>pick - hold pick</name>
                        <script>mud:send(&quot;get string merchants&quot;)
mud:send(&quot;rem bane&quot;)
mud:send(&quot;hold string&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^pick$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>weapon</name>
                        <script>mud:send(&quot;rem string&quot;)
mud:send(&quot;put string merchants&quot;)
mud:send(&quot;wield bane&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^weapon$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>assassinate</name>
                        <script>local timeleft=timer:get(&quot;assassinatetimer&quot;)

if not timeleft then
	timer:set(&quot;assassinatetimer&quot;, 24*60)
	mud:send(&quot;ASSASSINATE &quot; .. matches[2])
else
	cecho(&quot;&lt;red&gt;[Assassinate in cooldown: &lt;green&gt;&quot; .. timedisplay(timeleft) .. &quot;&lt;red&gt;]\n&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^assa?s?s?i?n?a?t?e? (.*)</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>mpp - apply poison milky</name>
                        <script>mud:send(&quot;apply milky primaryweapon&quot;)
mud:send(&quot;apply milky secondaryweapon&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^mpp$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>gpm - get milky poison</name>
                        <script>mud:send( &quot;GET milky &quot; .. charData:get(&quot;poisonbag&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^gpm$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>mppp - get/apply milky</name>
                        <script>expandAlias(&quot;gpm&quot;, false)
expandAlias(&quot;mpp&quot;, false)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^mppp$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>A-P</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>dark wrath</name>
                        <script>if checkMask(&quot;anti&quot;) then
	spell:setNext(&quot;dw&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^dw$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>unholy aura</name>
                        <script>if checkMask(&quot;anti&quot;) then
	spell:setNext(&quot;ua&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^ua$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Nec</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>oc - order ghost cast</name>
                        <script>mud:send(&quot;ORDER ghost cast '&quot; .. matches[2] .. &quot;'&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^oc (.*)</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Ele</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>eee</name>
                        <script>spell:setNext(&quot;eee &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^eee ([A-Za-z]+)$</regex>
                    </Alias>
                </AliasGroup>
            </AliasGroup>
            <Alias isActive="yes" isFolder="no">
                <name>restart</name>
                <script>local ver=getMudletVersion()

if ver[&quot;major&quot;] == 3 then
	if ver[&quot;build&quot;] == &quot;&quot; or ver[&quot;build&quot;] == &quot;-dev&quot; then
		cecho(&quot;&lt;red&gt;[NyyLIB requires restart after installation.]\n&quot;)
		return
	end
end

cecho(&quot;&lt;red&gt;[NyyLIB requires minimum non-beta Mudlet version 3.x.x http://www.mudlet.org/download/ ]\n&quot;)</script>
                <command></command>
                <packageName></packageName>
                <regex>^.+$</regex>
            </Alias>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>EquipProcs</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>clair</name>
                    <script>mud:send( g(&quot;ball&quot;) )
mud:send(&quot;gaze ball &quot; .. matches[2])
mud:send( p(&quot;ball&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^clair (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>chpele</name>
                    <script>mud:send(&quot;say strength of stone&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^chpele</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>shabay</name>
                    <script>mud:send(&quot;emote starts casting a spell called 'Shabay'.&quot;)
mud:send(&quot;say my heavenly home&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^shabay</regex>
                </Alias>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>TiaSleeves</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>healme</name>
                        <script>send(&quot;quaff glowing &quot; .. charData:get(&quot;container&quot;) )</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^healme</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Baatorian</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>slaad</name>
                        <script>mud:send(&quot;say demonic conjuration&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^slaad</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>bash</name>
                        <script>if checkMask(&quot;fighter&quot;) then
	mud:send(&quot;BASH &quot; .. matches[2])
else
	mud:send(&quot;o followers bash &quot; .. matches[2])
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^bash ([A-Za-z]+)$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>oflee</name>
                        <script>mud:send(&quot;o followers flee&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^oflee$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>resc</name>
                        <script>mud:send(&quot;o &quot; .. charData:get(&quot;slaadname&quot;) .. &quot; rescue &quot; .. matches[2])</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^resc ([A-Za-z])$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>rme</name>
                        <script>mud:send(&quot;o followers rescue &quot; .. whoami())</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^rme$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>TiaStaff</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>protect</name>
                        <script>mud:send(&quot;say Protect me&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^protect$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>release</name>
                        <script>mud:send(&quot;say Release&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^release$</regex>
                    </Alias>
                </AliasGroup>
                <Alias isActive="yes" isFolder="no">
                    <name>pendant</name>
                    <script>send(&quot;say infernal protection&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^pendant$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>dcult</name>
                    <script>mud:send(&quot;rem swirling&quot;)
mud:send( g(&quot;ceremonial&quot;) )
mud:send(&quot;wear ceremonial&quot;)
mud:send(&quot;say draconian protection&quot;)
mud:send(&quot;rem ceremonial&quot;)
mud:send(&quot;wear swirling&quot;)
mud:send( p(&quot;ceremonial&quot;) )
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^dcult</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>bane</name>
                    <script>local bane=charData:get(&quot;bane&quot;)

if bane == &quot;blind&quot; then
	mud:send(&quot;say Dragonblind&quot;)
elseif bane == &quot;poison&quot; then
	mud:send(&quot;say Dragonpoison&quot;)
elseif bane == &quot;slow&quot; then
	mud:send(&quot;say Dragonslow&quot;)
elseif bane == &quot;strike&quot; then
	mud:send(&quot;say Dragonstrike&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^bane$</regex>
                </Alias>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>TiaWarmaul</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>aid</name>
                        <script>mud:send(&quot;say aid my companions&quot;)
sendGroup()</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^aid$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>restore</name>
                        <script>mud:send(&quot;say restore me&quot;)</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^restore$</regex>
                    </Alias>
                </AliasGroup>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>MiscAliases</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>follow</name>
                    <script>mud:send (&quot;FOL &quot; .. matches[2] )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^fol (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>powers</name>
                    <script>mud:send(&quot;POWERS &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^powers (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>help</name>
                    <script>mud:send(&quot;HELP &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^help (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>forget spellname</name>
                    <script>mud:send(&quot;FORGET &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^forget (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>masks</name>
                    <script>local printcount=0


for k,v in pairs(masks) do
	if table.size(v) == 1 then
		echo( string.format(&quot;%-6s &quot;, k) )
		--printcount=printcount+1

		--if printcount==5 then
		--	printcount=0
		--	echo(&quot;\n&quot;)
		--end
	end
end

echo(&quot;\n\n&quot;)

for k,v in pairs(masks) do
	if table.size(v) ~= 1 then
		echo( string.format(&quot;%-20s %s\n&quot;, k, table.concat(v, &quot;|&quot;) ) )
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^masks$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>eq</name>
                    <script>mud:send(&quot;EQ&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^eq$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>mem spellname</name>
                    <script>mud:send(&quot;MEM &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^mem (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>imix</name>
                    <script>mud:send(&quot;t imixilian worm &quot; .. whoami())</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^imix$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>tog</name>
                    <script>mud:send(&quot;TOG &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^tog (.+)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>scan</name>
                    <script>scanned={}
mud:send(&quot;SCAN&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^scan$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>l (look)</name>
                    <script>mud:send(&quot;L &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^l (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>sound</name>
                    <script>mud:send(&quot;gcc LF: suggested sound id#'s and events to play them - https://www.freesound.org/&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^sound$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>nhc</name>
                    <script>if charData:get(&quot;swedish&quot;, true) then
	mud:send (&quot;NHC &quot; .. swedish(matches[2]) )
else
	mud:send (&quot;NHC &quot; .. matches[2] )
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^nhc (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>tell</name>
                    <script>-- que tell

mud:send (&quot;T &quot; .. matches[2] )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^t (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>gcc (swedish)</name>
                    <script>if charData:get(&quot;swedish&quot;, true) then
	mud:send (&quot;GCC &quot; .. swedish(matches[2]) )
else
	mud:send (&quot;GCC &quot; .. matches[2] )
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^gcc (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>say swedish</name>
                    <script>-- swedish disabled because it doesn't proc properly

mud:send (&quot;SAY &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^say (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>ooc swedish</name>
                    <script>if charData:get(&quot;swedish&quot;, true) then
	mud:send (&quot;OOC &quot; .. swedish(matches[2]), false)
else
	mud:send (&quot;OOC &quot; .. matches[2], false)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^ooc (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>acc swedish</name>
                    <script>if charData:get(&quot;swedish&quot;, true) then
	mud:send (&quot;ACC &quot; .. swedish(matches[2]) )
else
	mud:send (&quot;ACC &quot; .. matches[2] )
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^acc (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#debug information</name>
                    <script>-- this alias displays numerous internal variable values

-- should add command #debug nhc to echo results to nhc


expandAlias(&quot;version&quot;, false)

local WindowWidth, WindowHeight = getMainWindowSize()
cecho(&quot;&lt;red&gt;Screen size: X: &lt;green&gt;&quot; .. WindowWidth .. &quot; &lt;red&gt;Y: &lt;green&gt;&quot; .. WindowHeight .. &quot;\n\n&quot;)

local hp=prompt:get(&quot;hp&quot;)
local maxhp=prompt:get(&quot;maxhp&quot;)
local psp=prompt:get(&quot;psp&quot;)
local maxpsp=prompt:get(&quot;maxpsp&quot;)
local mv=prompt:get(&quot;mv&quot;)
local maxmv=prompt:get(&quot;maxmv&quot;)
local tank=prompt:get(&quot;tank&quot;) or &quot;&quot;
local tankcon=prompt:get(&quot;tankcondition&quot;) or &quot;&quot;
local enemy=prompt:get(&quot;enemy&quot;) or &quot;&quot;
local enemycon=prompt:get(&quot;enemycondition&quot;) or &quot;&quot;
local enemypos=prompt:get(&quot;enemyposition&quot;) or &quot;&quot;
local pos=prompt:get(&quot;position&quot;) or &quot;&quot;

cecho(string.format(&quot;&lt;green&gt;hp: %d maxhp: %d\n&quot;, hp, maxhp) )
cecho(string.format(&quot;&lt;green&gt;mv: %d maxmv: %d\n&quot;, mv, maxmv) )

if psp ~= nil then
	cecho(string.format(&quot;&lt;green&gt;psp: %d maxpsp: %d\n&quot;, psp, maxpsp) )
end

echo (string.format(&quot;T: %s TC: %s E: %s EC: %s EP: %s P: %s\n&quot;, tank, tankcon, enemy, enemycon, enemypos, pos))

local current=spell:getCurrent() or &quot;nil&quot;

echo(&quot;\n&quot;)

cecho(&quot;&lt;red&gt;promt:get(tank) &quot; .. tank .. &quot;-\n&quot;)
echo(&quot;\n&quot;)

cecho(&quot;&lt;red&gt;spell:getCurrent(): &quot; .. current .. &quot;\n&quot;)
cecho(&quot;&lt;red&gt;spell:count(): &quot; .. spell:count() .. &quot;\n&quot;)

cecho(&quot;&lt;red&gt;To memorize (memcount): &quot; .. charData:get(&quot;memcount&quot;) .. &quot;\n&quot;)
cecho(&quot;&lt;red&gt;Seen mem'ing (automem): &quot; .. automem .. &quot;\n&quot;)

cecho(&quot;&lt;red&gt;spell:getMoving(): &quot; .. tostring(spell:getMoving()) .. &quot;\n&quot;)
cecho(&quot;&lt;red&gt;spell:getMem(): &quot; .. tostring(spell:getMem()) .. &quot;\n&quot;)

if memsent ~= nil then
	cecho(&quot;&lt;red&gt;memsent: &quot; .. tostring(memsent) .. &quot;\n&quot;)
end

cecho(&quot;&lt;red&gt;lastsent: &quot; .. lastsent .. &quot;\n&quot;)

if sendingStatus ~= nil then
	cecho(&quot;&lt;red&gt;sendingStatus: &quot; .. tostring(sendingStatus) .. &quot;\n&quot;)
end

if NyyLIB.escapedir ~= nil then
	cecho(&quot;&lt;red&gt;NyyLIB.escapedir: &quot; .. NyyLIB.escapedir .. &quot;\n&quot;)
end

echo(&quot;\n&quot;)

if spell:count() &gt; 0 then
	cecho(&quot;&lt;red&gt;Queued spells (spell.spellcastqueue)\n&quot;)
	display( spell.spellcastqueue )
end

if ( #mud.varsendqueue &gt; 0 ) then
	cecho(&quot;&lt;red&gt;Queued commands (mud.varsendqueue):\n&quot;)
	display( mud.varsendqueue )
end

if groupList:whoTanking() then
	cecho(&quot;&lt;red&gt;Who's tanking (groupList:whoTanking()):\n&quot;)
	display ( groupList:whoTanking() )
end

display( enteredPortal )

cecho(&quot;&lt;red&gt;[End debug]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#debug$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Set Variables</name>
                    <script>local nx

-- set by itself, no arguments
if matches[2] == &quot;set&quot; then
	cecho(&quot;&lt;red&gt;Usage: &lt;green&gt;set key value &lt;red&gt;Example: &lt;green&gt;set loot off &lt;red&gt;- turns off autoloot\n&quot;)
	echo(&quot;------------\n&quot;)

	for nx=1, #setvar, 1 do
		local key= setvar[nx][1]
		local value

		if key ~= &quot;-&quot; then
			if setvar[nx][2] == &quot;&quot; then
				value = charData:get(key, true)
			else 
				value = charData:get(key)
			end

			if type(value) == &quot;boolean&quot; then
				value=tostring(value)
			end

			if type(value) == &quot;table&quot; then
				value=&quot;&quot;
			end

			-- if no value set, assign default value

			if value == nil then
				cecho(&quot;&lt;red&gt;[ nil value &quot; .. key .. &quot;]\n&quot;)
			end

			--if value == nil then
			--	value=setvar[nx][4]
			--	if setvar[nx][2] == &quot;&quot; then
			--		charData:set(key, value, true)
			--	else
			--		charData:set(key, value)
			--	end
			--end

			if setvar[nx][2] == &quot;&quot; or setvar[nx][2] == &quot;*&quot; then
				if key == &quot;condensed&quot; then
					local count=0

					cecho ( string.format(&quot;&lt;green&gt;%14s&lt;white&gt;\n&quot;, 	&quot;[&quot; .. key .. &quot;]&quot;) )

					for k,v in pairs(charData:get(&quot;condensed&quot;, true)) do
						count = count + 1

						if count == 1 then
							echo(&quot;            &quot;)
						end

						cecho(string.format(&quot;&lt;green&gt; %-9s&lt;white&gt; %5s |&quot;, k, tostring(v) ))

						if count == 4 then
							count=0
							echo(&quot;\n&quot;)
						end
					end
				else
					cecho ( string.format(&quot;&lt;green&gt;%14s&lt;white&gt; %-15s %20s  %s\n&quot;, 
								&quot;[&quot; .. key .. &quot;]&quot;,
								value,
								table.concat(setvar[nx][3], &quot;|&quot;),
								setvar[nx][5] )
				 		)
				end
			else
				if setvar[nx][2] ~= &quot;equip&quot; then
					if checkMask(setvar[nx][2]) then
						cecho ( string.format(&quot;&lt;green&gt;%14s&lt;white&gt; %-15s %20s  %s\n&quot;, 
								&quot;[&quot; .. key .. &quot;]&quot;,
								value,
								table.concat(setvar[nx][3], &quot;|&quot;),
								setvar[nx][5] )
					 		)
					end
				end
			end
		else
			echo(&quot;--------------\n&quot;)
		end
	end

	return
end

-- at least one argument provided

for nx=1, #setvar, 1 do
	local key= setvar[nx][1]

	if matches[4] == key then
		local classes=setvar[nx][2]
		local pattern=setvar[nx][3]
		local value=matches[5]

		if matches[5] == &quot;true&quot; then
			value=true
		end

		if matches[5] == &quot;false&quot; then
			value=false
		end

		-- Is the key changeable by this class?

		if classes == &quot;&quot; or classes == &quot;*&quot; then
			-- ok to change
		else
			if classes ~= &quot;equip&quot; then
				if checkMask(classes) then
					-- ok to change
				else
					-- not ok to change
					cecho(&quot;&lt;red&gt;[Not a valid key for this character class]\n&quot;)
					return	
				end
			end
		end

		-- Does the new value match acceptable patterns?

		if matches[4] == &quot;border&quot; then
			if matches[5] == &quot;none&quot; then
				charData:set(&quot;border&quot;, &quot;none&quot;, true)
			end

			if matches[5] == &quot;file&quot; then	
				local tmp = invokeFileDialog(true, &quot;Select border image&quot;)

				if tmp ~= &quot;&quot; then
					charData:set(&quot;border&quot;, string.gsub(tmp, &quot;\\&quot;, &quot;/&quot;), true	)
				end
		
				echo(&quot;[Border imagefile: &quot; .. charData:get(&quot;border&quot;, true) .. &quot;]\n&quot;)
			end

			if matches[5] == &quot;default&quot; then
				charData:set(&quot;border&quot;, &quot;default&quot;, true)
			end

			cecho(&quot;&lt;red&gt;[Border set to &quot; .. charData:get(&quot;border&quot;, true) .. &quot;]\n&quot;)

			setBorder()
			return
		end


		if matches[4] == &quot;condensed&quot; then
			if table.index_of(pattern, matches[5]) then
				local condensed = charData:get(&quot;condensed&quot;, true)

				condensed[matches[5]] = togBoolean(condensed[matches[5]])
				charData:set(&quot;condensed&quot;, condensed, true)

				cecho(&quot;&lt;red&gt;[Setting condensed mode &quot; .. matches[5] .. &quot; to &quot; .. tostring(condensed[matches[5]]) .. &quot;]\n&quot;)
				return
			end
		end

		if matches[5] == &quot;&quot; and table.index_of(pattern, &quot;true&quot;) ~= nil then
			local nval

			if classes == &quot;&quot; then
				nval = togBoolean( charData:get(key, true) )
				charData:set(key, nval, true)
			else
				nval = togBoolean( charData:get(key) ) 
				charData:set(key, nval)
			end

			cecho(&quot;&lt;red&gt;[Setting &quot; .. key .. &quot; to &quot; .. tostring(nval) .. &quot;]\n&quot;)


			-- check if key is hideequip

			if key == &quot;hideequip&quot; then
				leftIcons()
			end

			-- check if key is hideicons

			if key == &quot;hideicons&quot; then
				showIconbar()
			end

			if key == &quot;style&quot; then
				if nval == true then				
					setStyle()
				else
					setAppStyleSheet(&quot;&quot;)
				end
			end

			buttons:sync()

			return
		end

		if matches[5] == &quot;&quot; or matches[5] == &quot;#&quot; or matches[5] == &quot;*&quot; then
			cecho(&quot;&lt;red&gt;[No value provided]\n&quot;)
			return
		end

		if (pattern[1] == &quot;*&quot; or table.index_of(pattern, matches[5]) ~= nil) or
			 (table.index_of(pattern, &quot;#&quot;) and tonumber(matches[5])) then
			cecho(&quot;&lt;red&gt;[Setting &quot; .. key .. &quot; to &quot; .. matches[5] .. &quot;]\n&quot;)

			if classes == &quot;&quot; then
				charData:set(key, value, true)
			else
				charData:set(key, value)
			end

			if key == &quot;chatfontsize&quot; then
				demonnic.chat:redo()
			end

			if key == &quot;hideequip&quot; then
				leftIcons()				
			end

			if key == &quot;hideicons&quot; then
				showIconbar()
			end

			if key == &quot;style&quot; then
				if value == true then				
					setStyle()					
				else
					setAppStyleSheet(&quot;&quot;)					
				end
			end

			buttons:sync()

			return
		end

		cecho(&quot;&lt;red&gt;[Not a valid value for &quot; .. key .. &quot; : &quot; .. table.concat(setvar[nx][3], &quot;|&quot;) .. &quot;]\n&quot;)

		return
	end
end

cecho(&quot;&lt;red&gt;[&quot; .. matches[4] .. &quot; is not a valid key]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>(^set$)|(^set ([A-Za-z]+) ?(.*)?$)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>guide - open todraels website</name>
                    <script>openUrl(&quot;http://www.grokh.com/todrael/guides/newbie.html&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^guide$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>quest - open Valkurian Blades website</name>
                    <script>openUrl(&quot;http://z15.invisionfree.com/Triterium_BBS&quot;)
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^quest$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>forum - open torilmud forums</name>
                    <script>openUrl(&quot;http://www.torilmud.com/phpBB3/&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^forum$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>gsay (gcmd)</name>
                    <script>charData:init(&quot;gcmd&quot;, false)

if charData:get(&quot;gcmd&quot;) then
	if charData:get(&quot;swedish&quot;, true) then
		mud:send(&quot;GCMD &quot; .. swedish(matches[2]) )
	else
		mud:send(&quot;GCMD &quot; .. matches[2])
	end
else
	if charData:get(&quot;swedish&quot;, true) then
		mud:send(&quot;GSAY &quot; .. swedish(matches[2]) )
	else
		mud:send(&quot;GSAY &quot; .. matches[2] )
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^gsay (.*)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>consent</name>
                    <script>consent.chars= {}
send(&quot;consent&quot;, false)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^consent$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#mtank</name>
                    <script>if matches[2] == nil then
	NyyLIB.mtank = nil

	cecho(&quot;&lt;green&gt;[Main tank cleared]\n&quot;)
else
	NyyLIB.mtank = string.title(matches[2])
	cecho(&quot;&lt;green&gt;[Main tank is now set to: &lt;red&gt;&quot; .. NyyLIB.mtank .. &quot;&lt;green&gt;]\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#mtank ?([0-9.a-zA-Z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#target</name>
                    <script>NyyLIB.target = matches[2]

if matches[2] == nil then
	cecho(&quot;&lt;red&gt;[Target cleared]\n&quot;)
else
	cecho(&quot;&lt;red&gt;[Target is now set to: &lt;green&gt;&quot; .. NyyLIB.target .. &quot;&lt;red&gt;]\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#target ?([0-9.a-zA-Z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>send</name>
                    <script>mud:send(matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^send (.*)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#save</name>
                    <script>-- save data files

saveNyyLIB()</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#save$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#backup</name>
                    <script>function backupDirectory(xname)
	lfs.mkdir(backupPath(xname))

	for file in lfs.dir(homepath(xname)) do
    	-- file is the current file or directory name
		if file ~= &quot;.&quot; and file ~= &quot;..&quot; then
	    	print( &quot;Copying: &quot; .. file )

			copyFile(homepath(xname) .. &quot;/&quot; .. file, backupPath(xname) .. &quot;/&quot; .. file)
		end
	end
end

function backupPath(xname)
	local path = charData:get(&quot;backupfolder&quot;, true) .. &quot;\\&quot; .. xname

	path=string.gsub(path, &quot;\\&quot;, &quot;/&quot;)	

	return(path)
end


function copyFile(ifile, ofile)
	local inp = assert(io.open(ifile, &quot;rb&quot;))
   local out = assert(io.open(ofile, &quot;wb&quot;))
    
   local data = inp:read(&quot;*all&quot;)
   out:write(data)
    
   assert(out:close())
	assert(inp:close())
end

function backupFile(filename)
	local is_file = io.open(homepath(filename))

	if is_file ~= nil then
		copyFile(homepath(filename), backupPath(filename))
		cecho(&quot;&lt;red&gt;[File: &quot; .. homepath(filename) .. &quot; copied to \n          &quot; .. backupPath(filename) .. &quot;]\n&quot;)
		io.close(is_file)
	else
		cecho(&quot;&lt;red&gt;[File: &quot; .. homepath(filename) .. &quot; does not exist]\n&quot;)
	end
end

function restoreFile(filename)
	local srcfile = backupPath(filename)

	local is_file = io.open(srcfile)

	if is_file ~= nil then
		copyFile(srcfile, homepath(filename))
		cecho(&quot;&lt;red&gt;[File: &quot; .. srcfile .. &quot; copied to \n          &quot; .. homepath(filename) .. &quot;]\n&quot;)
		io.close(is_file)
	else
		cecho(&quot;&lt;red&gt;[File: &quot; .. srcfile .. &quot; does not exist]\n&quot;)
	end
end

if matches[2] == &quot;logs&quot; then
	cecho(&quot;&lt;red&gt;[Backing up profile logs files]\n&quot;)
	backupDirectory(&quot;log&quot;)
	return
end

if matches[2] == &quot;set&quot; then
	charData:set(&quot;backupfolder&quot;, invokeFileDialog(false, &quot;Select destination folder for backups&quot;), true )

	charData:set(&quot;backupfolder&quot;, string.gsub(charData:get(&quot;backupfolder&quot;, true), &quot;/&quot;, &quot;\\&quot;), true )

	cecho(&quot;&lt;red&gt;[Backup folder: &quot; .. charData:get(&quot;backupfolder&quot;, true) .. &quot;]\n&quot;)

	return
end

if matches[2] == &quot;copy&quot; then
	if charData:get(&quot;backupfolder&quot;, true) ~= nil then
		saveNyyLIB()

		cecho(&quot;\n&lt;red&gt;[Backup folder: &quot; .. charData:get(&quot;backupfolder&quot;, true) .. &quot;]\n\n&quot;)

		backupFile(&quot;chardata.dat&quot;)
		backupFile(&quot;stats.dat&quot;)
		backupFile(&quot;wholist_v2&quot;)

		backupFile(&quot;toril.map&quot;)
	else
		cecho(&quot;&lt;red&gt;[No backup folder selected]\n&quot;)
	end

	return
end

if matches[2] == &quot;restore&quot; then
	if charData:get(&quot;backupfolder&quot;, true) ~= nil then
		cecho(&quot;\n&lt;red&gt;[Backup folder: &quot; .. charData:get(&quot;backupfolder&quot;, true) .. &quot;]\n\n&quot;)

		restoreFile(&quot;chardata.dat&quot;)
		restoreFile(&quot;stats.dat&quot;)
		restoreFile(&quot;wholist_v2&quot;)

		restoreFile(&quot;toril.map&quot;)

		loadwholist()
		
		local level=charData:get(&quot;level&quot;)

		charData:load()

		charData:init(&quot;level&quot;, level)

		initFullData()

		loadTorilMap(&quot;toril.map&quot;)

		buttons:sync()

		setBorder()
	else
		cecho(&quot;&lt;red&gt;[No backup folder selected]\n&quot;)
	end

	return
end

cecho(&quot;&lt;green&gt;[&lt;red&gt;WARNING:&lt;green&gt; This does not copy script changes]\n\n&quot;)
cecho(&quot;&lt;green&gt;[Usage: #backup set     - choose backup folder]\n&quot;)
cecho(&quot;&lt;green&gt;[       #backup copy    - copy data files to folder]\n&quot;)
cecho(&quot;&lt;green&gt;[       #backup restore - overwrite profile data files with backup folder]\n&quot;)
cecho(&quot;&lt;green&gt;[       #backup logs    - copy profile logfiles into backup folder\n&quot;)

if charData:get(&quot;backupfolder&quot;, true) ~= nil then
	cecho(&quot;\n&lt;red&gt;[Backup folder: &quot; .. charData:get(&quot;backupfolder&quot;, true) .. &quot;]\n&quot;)
else
	cecho(&quot;\n&lt;red&gt;[No backup folder selected]\n&quot;)
end
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#backup ?(set|copy|restore|logs)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#help</name>
                    <script>--function mainpath(xname)
--	This function returns the full pathname inside the profile of a specific file
--end

function showHelp(xindex)
	local index, name
	local found=false
	
	for line in io.lines(mainpath(&quot;helpfile.dat&quot;)) do
		if string.find(line, &quot;;;&quot;) ~= nil then
			if found == false then
				index,name = string.match(line, &quot;;;([0-9]+),([0-9a-zA-Z _]+)&quot;)
			else
				return
			end
		else
			if index == tostring(xindex) or name == xindex then
				found=true
				--display(line)
				cecho(line .. &quot;\n&quot;)
			end
		end
	end

	if found == false then
		cecho(&quot;&lt;red&gt;[No help information found for: &quot; .. xindex .. &quot;]\n&quot;)
	end
end

if matches[2] == &quot;&quot; then
	showHelp(&quot;index&quot;)
else
	showHelp(matches[2])
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#help ?(.*)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>tiap ?(gsay|acc)?</name>
                    <script>if matches[2] == &quot;gsay&quot; then
	--send(&quot;gsay * Tiamat Points - This does NOT include current run&quot;)
end

for k,char in pairs(groupList:pc()) do
	if inwho(char) then
		local temp=string.format(&quot;[%11s] (%13s) %6d\n&quot;, char,	&quot;@&quot; .. inwho(char),getPoints(inwho(char)) )

		if matches[2] == nil then
			echo(temp)
		end

		if matches[2] == &quot;gsay&quot; then
--			send(&quot;t @lilithelle * &quot; .. temp)
			send(&quot;gsay * &quot; .. temp)
		end

		if matches[2] == &quot;acc&quot; then
			send(&quot;acc * &quot; .. temp)
		end
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^tiap ?(gsay|acc)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>hasteme</name>
                    <script>mud:send(&quot;quaff haste &quot; .. charData:get(&quot;container&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^hasteme$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#at (attack dir)</name>
                    <script>if NyyLIB.target == nil then
	echo(&quot;[No target is currently set.]\n&quot;)
else
	mud:send(matches[2])
	mud:send(&quot;backstab &quot; .. NyyLIB.target)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#at([nsewud])$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#attack</name>
                    <script>NyyLIB.target = matches[2]

if matches[2] == nil then
	cecho(&quot;&lt;red&gt;[Target cleared]\n&quot;)
else
	cecho(&quot;&lt;red&gt;[Target is now set to: &lt;green&gt;&quot; .. NyyLIB.target .. &quot;&lt;red&gt;]\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#attack ?([0-9.a-zA-Z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#setroom</name>
                    <script>echo(&quot;\n[Searching for matching discovered rooms... ]\n&quot;)

if matches[2] == nil then
	local matchtable = {}

	if NyyLIB.Mapper.roomname ~= nil and NyyLIB.Mapper.exits ~= nil then
		matchtable = findRoomIDTable(NyyLIB.Mapper.roomname, NyyLIB.Mapper.exits)
	end

	display(matchtable)
else
	local matchvalue = tonumber(matches[2])

	if roomLocked(matchvalue) == false then
		echo(&quot;[Room set to &quot; .. matchvalue .. &quot;]\n&quot;)

		map:setRoom(matchvalue)
		centerview( map:getRoom() )
	else
		echo(&quot;[Room &quot; .. matchvalue .. &quot; doesn't exist.]\n&quot;)
	end
end

</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#setroom( [0-9]+)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#cd</name>
                    <script>function countdown()
	NyyLIB.countdown = NyyLIB.countdown - 1

	if NyyLIB.countdown &gt; 0 then
		mud:send(&quot;gsay &lt;&quot; .. NyyLIB.countdown .. &quot;&gt;&quot;)
		tempTimer(1, [[countdown()]])
	else
		expandAlias(NyyLIB.countdir, false)

		if NyyLIB.target ~= nil then
			mud:send(&quot;kill &quot; .. NyyLIB.target)
		else
			mud:send(&quot;hitall all&quot;)
		end
	end
end

if matches[2] == nil then
	if NyyLIB.target == nil then
		cecho(&quot;&lt;red&gt;[Countdown script: No target set]\n&quot;)
	else
		cecho(&quot;&lt;red&gt;[Countdown script: &quot; .. NyyLIB.target .. &quot;]\n&quot;)
	end
else
	-- disable rescue
	if checkMask(&quot;fighter&quot;) then
		if charData:get(&quot;rescuetype&quot;) ~= &quot;off&quot; then
			cecho(&quot;&lt;red&gt;[Disabling rescue]\n&quot;)
			charData:set(&quot;rescuetype&quot;, &quot;off&quot;)
			rescue(&quot;init&quot;, &quot;rescue&quot;)
		end
	end

	NyyLIB.countdown = 6

	NyyLIB.countdir = matches[2]

	countdown()
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#cd( [nsewud])?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#fwalk</name>
                    <script>-- map:getRoom() = nil (unknown) throws error

-- ^fwalk( [0-9A-Za-z]+)?( [A-Za-z]+)?


-- fwalk roomnum
-- fwalk add/del bookmarkname
-- fwalk bookmarkname

local var1
local var2

local addfwalk
local action=0

local tmpvar=charData:get(&quot;fwalk&quot;, true)

local tmplist={}

function fastwalk(xroomid)
	if roomLocked(xroomid) then
		cecho(&quot;&lt;red&gt;[Error: Destination room is locked]\n&quot;)
		return
	end

	if map:getRoom() == nil then
		cecho(&quot;&lt;red&gt;[Error: source room id is nil]\n&quot;)
		return
	end

	if getPath( map:getRoom(), xroomid) then
		doSpeedWalk()
	else
		cecho(&quot;&lt;red&gt;[Unable to find path to room#&quot; .. xroomid .. &quot;]\n&quot;)
	end
end

if tonumber(matches[2]) ~= nil then

	if inCombat() then
		cecho(&quot;&lt;red&gt;[Can't fwalk while in combat]\n&quot;)
		return(false)
	end

	fastwalk(tonumber(matches[2]))
else
	var1=string.trim(matches[2])
	var2=string.trim(matches[3])

	cecho(&quot;&lt;red&gt;Usage: #fwalk roomnumber - fastwalk to specified room number\n&quot;)
	cecho(&quot;&lt;red&gt;       #fwalk name       - fastwalk to room indicated by fwalk name\n&quot;)
	cecho(&quot;&lt;red&gt;       #fwalk add name   - adds a fastwalk to the currently occupied room using 'name' \n&quot;)
   cecho(&quot;&lt;red&gt;       #fwalk del name   - deletes fastwalk 'name'\n&quot;)
	cecho(&quot;&lt;red&gt;       #fwalk all        - list all fwalks regardless of location\n&quot;)

	echo(&quot;\n&quot;)

	if var1 == &quot;all&quot; then

		for k,v in pairs(charData:get(&quot;fwalk&quot;, true)) do

			if roomExists(v) then
				local zoneid=tonumber(getRoomUserData(v, &quot;zoneid&quot;) )
				local pathlength=0

				if roomLocked(v) == false then
					if getPath( map:getRoom(), v) then
						pathlength=#speedWalkPath
					end
				end

				if pathlength ~= 0 then
					tmplist[#tmplist+1] = string.format(&quot;[%-30s] [%6d %-15s] [%3d] %s\n&quot;, NyyLIB.areaTable[zoneid], v, k, pathlength, getRoomName(v))
				else
					tmplist[#tmplist+1] = string.format(&quot;[%-30s] [%6d %-15s] [%3d] %s\n&quot;, NyyLIB.areaTable[zoneid], v, k, pathlength, getRoomName(v))
				end
			else
				tmplist[#tmplist+1] = string.format(&quot;[%-30s] [%6d %-15s] [%3s] %s\n&quot;, &quot;&quot;, v, k, &quot;&quot;, &quot;&quot;)
			end
		end

		cecho(&quot;&lt;white&gt;             Area                  Room#      fwalk     Distance          Room Name\n&quot;)
		printSorted(tmplist)

		return
	end

	if map:getRoom() == nil then
		cecho(&quot;&lt;red&gt;[Current room is unknown]\n&quot;)
		return
	end

	-- check if var1 is existing marker - if so, fastwalk and exit

	for k,v in pairs(charData:get(&quot;fwalk&quot;, true)) do
		if k == var1 then
			cecho(&quot;&lt;green&gt;[Issue speedwalk to &quot; .. var1 .. &quot; at &quot; .. v .. &quot;]\n&quot;)
	
			fastwalk(v)
			return
		end
	end

	if var1 == &quot;add&quot; and var2 ~= nil then
		cecho(&quot;&lt;green&gt;[Adding fwalk for (&quot; .. var2 .. &quot;) to destination &quot; .. map:getRoom() .. &quot;]\n&quot;)

		tmpvar[var2] = map:getRoom()
		charData:set(&quot;fwalk&quot;, tmpvar, true)

		return
	end

	if var1 == &quot;del&quot; and tmpvar[var2] ~= nil then
		cecho(&quot;&lt;green&gt;[Deleting fwalk for (&quot; .. var2 .. &quot;) at destination &quot; .. tmpvar[var2] .. &quot;]\n&quot;)

		tmpvar[var2] = nil
		charData:set(&quot;fwalk&quot;, tmpvar, true)

		return
	end

	for k,v in pairs(tmpvar) do

		if roomExists(v) then
			local zoneid=tonumber(getRoomUserData(v, &quot;zoneid&quot;) )
			local pathlength=0

			if roomLocked(v) == false then
				if getPath( map:getRoom(), v) then
					pathlength=#speedWalkPath
				end
			end

			if pathlength ~= 0 or map:getRoom() == v then
				tmplist[#tmplist+1] = string.format(&quot;[%-30s] [%6d %-15s] [%3d] %s\n&quot;, NyyLIB.areaTable[zoneid], v, k, pathlength, getRoomName(v))
			end
		end
	end

	cecho(&quot;&lt;white&gt;             Area                  Room#      fwalk     Distance          Room Name\n&quot;)
	printSorted(tmplist)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#fwalk( [0-9a-zA-Z]+)?( [0-9a-zA-Z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>escape</name>
                    <script>if checkMask(&quot;rogue&quot;) then
	NyyLIB.escapedir = matches[2]
	mud:send(&quot;ESCAPE &quot; .. matches[2])
else
	NyyLIB.escapedir = matches[2]

	if checkMask(&quot;caster&quot;) then
		-- erase spellqueue if any spells present
		spell:eraseQueue()

		-- disable autocast
		charData:set(&quot;autocast&quot;, false)
		SpellsButton(&quot;init&quot;)

		spell:clear()
	end

	-- set as currently moving
	spell:setMoving(true)

	mud:send(&quot;flee&quot;, false)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^escape ([neswud])$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>advert</name>
                    <script>mud:send(&quot;nhc Toril Mud Client Script Updated: 5/19/17 011b http://www.torilmud.com/phpBB3/viewtopic.php?f=4&amp;t=25455&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^advert$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>version</name>
                    <script>NyyLIB.version = NyyLIB.version or &quot;NyyLIB011dev&quot;
NyyLIB.dbversion = NyyLIB.dbversion or &quot;10/10/2015&quot;

cecho (&quot;\n&lt;red&gt;Script version: 6/3/2017 &quot; .. NyyLIB.version .. &quot; https://github.com/Nyyrazzilyss/NyyLIB\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^version$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>p</name>
                    <script>mud:send(p(matches[2]))</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^p (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>g</name>
                    <script>mud:send(g(matches[2]))</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^g (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>scaleme</name>
                    <script>mud:send(&quot;quaff blood hole&quot;)
--mud:send(&quot;quaff blood &quot; .. charData:get(&quot;container&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^scaleme$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#gag</name>
                    <script>local tmpvar = charData:get(&quot;gags&quot;, true)

if matches[2] == &quot;reset&quot; then
	echo(&quot;Resetting all custom gags.\n&quot;)
	charData:set(&quot;gags&quot;, {}, true)
else
	if matches[2] == &quot;&quot; then
		echo(&quot;usage:\n #gag text to gag\n #gag reset\n&quot;)
		echo(&quot;Existing gags:\n&quot;)
		display(tmpvar)
	else
		table.insert(tmpvar, matches[2]:lower())
		echo(&quot;[New gag created for: &quot; .. matches[2]:title() .. &quot;]\n&quot;)
		charData:set(&quot;gags&quot;, tmpvar, true)
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#gag ?(.*)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#roll</name>
                    <script>if matches[2] == nil then
	echo(&quot;[Autoroller disabled.]\n&quot;)
	disableTrigger(&quot;RollerTrigger&quot;)
	return
end

local rollvalue = tonumber(matches[2])

charData:set(&quot;autoroll&quot;, rollvalue, true)

echo(&quot;[Autoroller enabled: Target= &quot; .. rollvalue .. &quot;]\n&quot;)

enableTrigger(&quot;RollerTrigger&quot;)
--mud:send(&quot;y&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#roll ?([0-9]+)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>zzz</name>
                    <script>mud:send(&quot;get mistwalker hole&quot;)
mud:send(&quot;rec mistwalker me&quot;)
mud:send(&quot;darkness&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^zzz$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>lf</name>
                    <script>mud:send(&quot;gcc LF: phantom quill, talisman of demonic rage&quot;)
-- mud:send(&quot;gcc FT: skull-cap of truespeed, ashen cage, loop of shale, smoke filled crystal ball, seaweed ring, pelt of demonhide, headbands a-&gt;j, more&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^lf$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#path</name>
                    <script>-- findpath either to room number or fwalk name

function tt(s)
   local t={}

   for p in s:gmatch(&quot;..?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?.?&quot;) do
       t[#t+1]=p
   end

   for i,v in ipairs(t) do
       print(&quot;.&quot; .. v)
   end

	echo(&quot;\n&quot;)
end


function showfastwalk(xroomid)
	if roomLocked(xroomid) then
		echo(&quot;[Error: Destination room is locked]\n&quot;)
		return
	end

	assert(map:getRoom(), &quot;[Error: source room id is nil]&quot;)

	if getPath(map:getRoom(), xroomid) then
		local path= compressSpeedwalk()

		if #speedWalkPath &gt; 100 then
			cecho(&quot;&lt;red&gt;Path length: &lt;green&gt;&quot; .. #speedWalkPath .. &quot; &lt;red&gt;rooms 100th room &lt;green&gt; &quot; .. speedWalkPath[100] .. &quot;\n\n&quot;)
		else
			cecho(&quot;&lt;red&gt;Path length: &lt;green&gt;&quot; .. #speedWalkPath .. &quot; &lt;red&gt;rooms\n\n&quot;)
		end

		cecho(&quot;&lt;red&gt;Path from current room (&quot; .. map:getRoom() .. &quot;) to &quot; .. xroomid .. &quot;\n&quot;)


		--echo(&quot;Rooms we'll pass through: &quot; .. table.concat(speedWalkPath, &quot;, &quot;) .. &quot;\n\n&quot;)

		cecho(&quot;&lt;green&gt;Speedwalk: .&quot; .. compressSpeedwalk() .. &quot;\n\n&quot;)

		if string.len(path) &gt; 100 then
			tt(path)
		end

		cecho(&quot;&lt;red&gt;Reverse path from &quot; .. xroomid .. &quot; to current room (&quot; .. map:getRoom() .. &quot;)\n&quot;)

		getPath(xroomid, map:getRoom())

		cecho(&quot;&lt;green&gt;Speedwalk: .&quot; .. compressSpeedwalk() .. &quot;\n\n&quot;)

	else
		echo(&quot;[Unable to find path to room#&quot; .. xroomid .. &quot;]\n&quot;)
	end
end

if tonumber(matches[2]) ~= nil then
	showfastwalk(tonumber(matches[2]))
else
	for k,v in pairs(charData:get(&quot;fwalk&quot;, true)) do
		if k == matches[2] then
			showfastwalk(v)
			return
		end
	end
end
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#path ?([0-9a-zA-Z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#room</name>
                    <script>if charData:get(&quot;roomwindow&quot;) then
	charData:set(&quot;roomwindow&quot;, false)
	cecho(&quot;&lt;red&gt;[Room capture display is OFF.]\n&quot;)
	hideWindow(&quot;gRoomWindow&quot;)
else
	charData:set(&quot;roomwindow&quot;, true)
	cecho(&quot;&lt;red&gt;[Room capture display is ON.]\n&quot;)
	showWindow(&quot;gRoomWindow&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#room$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>multidrag</name>
                    <script>display(&quot;drag &quot; .. matches[2] .. &quot; corpses &quot; .. matches[3])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^multidrag ([0-9]+) ([nsewud])$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>mcast</name>
                    <script>cecho(&quot;\n&lt;green&gt;[Mass Casting &quot; .. matches[2] .. &quot;]\n&quot;)

for k,char in pairs(groupList:pc()) do
	display(char)

	spell:cast(matches[2] .. &quot; &quot; .. char)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^mcast ([A-Za-z ]+)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>mem</name>
                    <script>-- Can't be moving if mem has been sent
spell:setMoving(false)
setQuake(false)

automem = 2

if memsent == true then
	cecho(&quot;&lt;red&gt;[Mem previously sent: type 'prepare' to force]\n&quot;)
	return
end

if spell:getMem() == true then
	cecho(&quot;&lt;red&gt;\n[Already meming - If not type 'prepare']\n&quot;)
	return
end


if charData:get(&quot;memcount&quot;) == nil or charData:get(&quot;memcount&quot;) == 0 and not checkMask(&quot;psi&quot;) then
	cecho(&quot;&lt;red&gt;\n[Mem has completed. Type 'memd' or 'prayd' to list spells]\n&quot;)
	return
end

if inCombat() then
	echoDebug(&quot;&lt;red&gt;[Fighting, can't memorize]\n&quot;)
	return
end

if checkMask(&quot;singer&quot;) == false then
	mud:send(&quot;rest&quot;)
else
	cecho(&quot;&lt;red&gt;[Singers can't memorize.]\n&quot;)
	return
end

local label=findlabel(&quot;MemButton&quot;)

if label ~= nil then
	label:setStyleSheet([[border-image: url(]] .. iconpath(&quot;psiStand.png&quot;) .. [[)]])
	echoDebug(&quot;&lt;red&gt;[Setting membutton to stand]&quot;)
end

if checkMask(&quot;psi&quot;) then
	if charData:get(&quot;psicrystal&quot;) ~= &quot;&quot; then
		mud:send(&quot;chargepsp &quot; .. charData:get(&quot;psicrystal&quot;) )
	end

	mud:send(&quot;MED&quot;)
else
	if checkMask(&quot;caster&quot;) then
		spell:clear()

		--if not checkMask(&quot;priest&quot;) then
		--setLabelImage(&quot;SpellsButton&quot;, &quot;encSpells-off.png&quot;)
		--end
	end

	-- prepare doesn't give spell count
	--send(&quot;prepare&quot;)

	memsent=true

	if checkMask(&quot;pray&quot;) then
		mud:send(&quot;PRAY&quot;)
	else
		mud:send(&quot;MEM&quot;)
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^(mem|pray)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>encoff</name>
                    <script>mud:send(&quot;rem hat&quot;)
mud:send(&quot;get circlet hole&quot;)
mud:send(&quot;wear circlet&quot;)
mud:send(&quot;put hat hole&quot;)
mud:send(&quot;rem power&quot;)
mud:send(&quot;rem power&quot;)
mud:send(&quot;put power hole&quot;)
mud:send(&quot;put power hole&quot;)
mud:send(&quot;get kinesis hole&quot;)
mud:send(&quot;wear kinesis&quot;)
mud:send(&quot;get kinesis hole&quot;)
mud:send(&quot;wear kinesis&quot;)
mud:send(&quot;rem dagger&quot;)
mud:send(&quot;put dagger hole&quot;)
mud:send(&quot;get staff hole&quot;)
mud:send(&quot;hold staff&quot;)
mud:send(&quot;rem gem&quot;)
mud:send(&quot;put gem hole&quot;)
mud:send(&quot;get mask hole&quot;)
mud:send(&quot;wear mask&quot;)
mud:send(&quot;powers info time&quot;)
mud:send(&quot;powers info gi&quot;)
mud:send(&quot;powers info blur&quot;)
mud:send(&quot;powers info hs&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^encoff$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>encon</name>
                    <script>mud:send(&quot;rem circlet&quot;)
mud:send(&quot;get hat hole&quot;)
mud:send(&quot;wear hat&quot;)
mud:send(&quot;put circlet hole&quot;)
mud:send(&quot;rem kinesis&quot;)
mud:send(&quot;rem kinesis&quot;)
mud:send(&quot;put kinesis hole&quot;)
mud:send(&quot;put kinesis hole&quot;)
mud:send(&quot;get power hole&quot;)
mud:send(&quot;wear power&quot;)
mud:send(&quot;get power hole&quot;)
mud:send(&quot;wear power&quot;)
mud:send(&quot;rem staff&quot;)
mud:send(&quot;put staff hole&quot;)
mud:send(&quot;get dagger hole&quot;)
mud:send(&quot;wield dagger&quot;)
mud:send(&quot;rem mask&quot;)
mud:send(&quot;get gem hole&quot;)
mud:send(&quot;wear gem&quot;)
mud:send(&quot;put mask hole&quot;)
mud:send(&quot;powers info time&quot;)
mud:send(&quot;powers info gi&quot;)
mud:send(&quot;powers info blur&quot;)
mud:send(&quot;powers info hs&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^encon$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>food</name>
                    <script>local container=charData:get(&quot;container&quot;)

if container == &quot;&quot; then
	cecho(&quot;&lt;red&gt;[container not set]\n&quot;)
	return
end

mud:send(&quot;eat &quot; .. charData:get(&quot;food&quot;) .. &quot; &quot; .. container)
mud:send( g(charData:get(&quot;canteen&quot;)) )
mud:send(&quot;drink &quot; .. charData:get(&quot;canteen&quot;) )
mud:send( p(charData:get(&quot;canteen&quot;)) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^food$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>walk</name>
                    <script>if charData:get(&quot;container&quot;) == nil then
	cecho(&quot;&lt;red&gt;[container not set]\n&quot;)
	return
end

mud:send(&quot;rem wings&quot;)
mud:send( p(&quot;wings&quot;) )
mud:send( g(&quot;swirling&quot;) )
mud:send(&quot;wear swirling&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^walk$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>fly</name>
                    <script>if charData:get(&quot;container&quot;) == nil then
	cecho(&quot;&lt;red&gt;[container not set]\n&quot;)
	return
end

mud:send(&quot;rem swirling&quot;)
mud:send( p(&quot;swirling&quot;) )
mud:send( g(&quot;wings&quot;) )
mud:send(&quot;wear wings&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^fly$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>loot</name>
                    <script>for nx=matches[2], 1, -1 do
	mud:send(&quot;get all.coins &quot; .. nx .. &quot;.corpse&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^loot ([0-9]+)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>seal</name>
                    <script>mud:send( g(&quot;seal&quot;) )
mud:send(&quot;rec seal me&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^seal$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>shiftsm</name>
                    <script>mud:send(&quot;shift ynndchiarhlizz&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^shiftsm$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>undresschar</name>
                    <script>function removeAll()
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all hole&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all hole&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all hole&quot;)
end

mud:send(&quot;storage access nyyrazzilyss&quot;)

mud:send(&quot;rem insignia&quot;)
mud:send(&quot;put insignia hole&quot;)

if whoami() == &quot;Innanin&quot; then
	mud:send(&quot;rem insignia&quot;)
	mud:send(&quot;rem circlet&quot;)
	mud:send(&quot;put all hole&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all merchants&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all merchants&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all merchants&quot;)
	mud:send(&quot;get portable merchants&quot;)
	mud:send(&quot;put merchants portable&quot;)
end
  
if whoami() == &quot;Rrissun&quot; or whoami() == &quot;Bombad&quot; then
	mud:send(&quot;rem warmaul&quot;)
	mud:send(&quot;storage store warmaul&quot;)
	removeAll()
end

if whoami() == &quot;Ajac&quot; or whoami() == &quot;Imseh&quot; or whoami() == &quot;Aynep&quot; or whoami() == &quot;Rrassulis&quot; or whoami() == &quot;Caged&quot; then
	removeAll()

	if whoami() == &quot;Imseh&quot; or whoami() == &quot;Aynep&quot; or whoami() == &quot;Rrassulis&quot; or whoami() == &quot;Caged&quot; then
		mud:send(&quot;get planetar hole&quot;)
	else
		mud:send(&quot;get midnight-blue hole&quot;)
	end

   	mud:send(&quot;get barrel hole&quot;)
end

if whoami() == &quot;Nyyrazzilyss&quot; then
	mud:send(&quot;rem barrier&quot;)
	mud:send(&quot;put barrier hole&quot;)
	mud:send(&quot;rem fires&quot;)
	mud:send(&quot;put fires hole&quot;)
	mud:send(&quot;rem ice&quot;)
	mud:send(&quot;put ice hole&quot;)
	mud:send(&quot;rem drow&quot;)
	mud:send(&quot;rem drow&quot;)
	mud:send(&quot;put all.drow hole&quot;)
	mud:send(&quot;rem force&quot;)
	mud:send(&quot;put force hole&quot;)
	mud:send(&quot;rem swirling&quot;)
	mud:send(&quot;put swirling hole&quot;)
	mud:send(&quot;rem belt&quot;)
	mud:send(&quot;put belt hole&quot;)
	mud:send(&quot;rem sleeves&quot;)
	mud:send(&quot;put sleeves hole&quot;)
	mud:send(&quot;rem bracer&quot;)
	mud:send(&quot;rem bracer&quot;)
	mud:send(&quot;put all.bracer hole&quot;)
	mud:send(&quot;rem ring&quot;)
	mud:send(&quot;rem ring&quot;)
	mud:send(&quot;put all.ring hole&quot;)
	mud:send(&quot;rem staff&quot;)
	mud:send(&quot;put staff hole&quot;)
	mud:send(&quot;rem breeches&quot;)
	mud:send(&quot;put breeches hole&quot;)
	mud:send(&quot;rem sandals&quot;)
	mud:send(&quot;put sandals hole&quot;)
end

if whoami() == &quot;Titter&quot; then
	mud:send(&quot;rem planetar&quot;)
	mud:send(&quot;storage store planetar&quot;)
end

if whoami() == &quot;Adud&quot; or whoami() == &quot;Wopur&quot; or whoami() == &quot;Titter&quot; or whoami() == &quot;Ihgod&quot; then
	mud:send(&quot;rem valhalla&quot;)
	mud:send(&quot;storage store valhalla&quot;)
	removeAll()
end

if whoami() == &quot;Bonble&quot; then
	mud:send(&quot;rem gossamer&quot;)
	mud:send(&quot;rem serpent&quot;)
	mud:send(&quot;rem swirling&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;rem kinesis&quot;)
	mud:send(&quot;rem rock&quot;)
	mud:send(&quot;rem sharp&quot;)
	mud:send(&quot;rem batskull&quot;)
	mud:send(&quot;put all hole&quot;)
	mud:send(&quot;rem sandals&quot;)
	mud:send(&quot;put sandals hole&quot;)
	mud:send(&quot;rem girdle&quot;)
	mud:send(&quot;put girdle hole&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all merchants&quot;)
	mud:send(&quot;rem all&quot;)
	mud:send(&quot;put all merchants&quot;)
	mud:send(&quot;get hole merchants&quot;)
	mud:send(&quot;put merchants hole&quot;)
end

if whoami() == &quot;Vottoc&quot; then
	mud:send(&quot;rem crown&quot;)
	mud:send(&quot;put crown merchants&quot;)
	mud:send(&quot;rem blood&quot;)
	mud:send(&quot;rem blood&quot;)
	mud:send(&quot;rem batskull&quot;)
	mud:send(&quot;put batskull merchants&quot;)
	mud:send(&quot;put all.blood merchants&quot;)
	mud:send(&quot;rem cringing&quot;)
	mud:send(&quot;put cringing merchants&quot;)
	mud:send(&quot;rem scalemail&quot;)
	mud:send(&quot;put scalemail merchants&quot;)
	mud:send(&quot;rem swirling&quot;)
	mud:send(&quot;put swirling hole&quot;)
	mud:send(&quot;rem sleeves&quot;)
	mud:send(&quot;put sleeves merchants&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;put all.baatorian hole&quot;)
	mud:send(&quot;rem rock&quot;)
	mud:send(&quot;put rock hole&quot;)
	mud:send(&quot;rem matriarch&quot;)
	mud:send(&quot;put matriarch merchants&quot;)
	mud:send(&quot;rem bane&quot;)
	mud:send(&quot;put bane merchants&quot;)
	mud:send(&quot;rem boots&quot;)
	mud:send(&quot;put boots merchants&quot;)
	mud:send(&quot;rem merchants&quot;)
	mud:send(&quot;rem studs&quot;)
	mud:send(&quot;put studs merchants&quot;)
	mud:send(&quot;rem gorget&quot;)
	mud:send(&quot;put gorget hole&quot;)
	mud:send(&quot;rem gorget&quot;)
	mud:send(&quot;put gorget hole&quot;)
	mud:send(&quot;put merchants hole&quot;)
end

mud:send(&quot;put sack hole&quot;)

mud:send(&quot;storage store hole&quot;)

mud:send(&quot;equip&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^undresschar$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>dresschar</name>
                    <script>mud:send(&quot;storage retrieve hole&quot;)

send(&quot;get insignia hole&quot;)
send(&quot;wear insignia&quot;)

if whoami() == &quot;Innanin&quot; then
  mud:send(&quot;get merchants hole&quot;)
  mud:send(&quot;wear merchants&quot;)
  mud:send(&quot;get matriarch merchants&quot;)
  mud:send(&quot;wield matriarch&quot;)
  mud:send(&quot;get bane merchants&quot;)
  mud:send(&quot;wield bane&quot;)
  mud:send(&quot;get serpent hole&quot;)
  mud:send(&quot;get cringing merchants&quot;)
  mud:send(&quot;get buckles merchants&quot;)
  mud:send(&quot;get silvered merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get crescent merchants&quot;)
  mud:send(&quot;get kossuth merchants&quot;)
  mud:send(&quot;get congealed merchants&quot;)
  mud:send(&quot;get congealed merchants&quot;)
  mud:send(&quot;get cincture merchants&quot;)
  mud:send(&quot;get demonleather merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get lustrous merchants&quot;)
  mud:send(&quot;get lustrous merchants&quot;)
  mud:send(&quot;get darkness merchants&quot;)
  mud:send(&quot;get marilith merchants&quot;)
  mud:send(&quot;get extremely merchants&quot;)
  mud:send(&quot;get protruding merchants&quot;)
  mud:send(&quot;get gauntlets merchants&quot;)
  mud:send(&quot;get rakshasa merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get seal hole&quot;)
end

if whoami() == &quot;Bombad&quot; then
	mud:send(&quot;storage retrieve glory&quot;)
	mud:send(&quot;wield glory&quot;)
	mud:send(&quot;get chimera hole&quot;)
	mud:send(&quot;wear chimera&quot;)
	mud:send(&quot;get ashstone hole&quot;)
	mud:send(&quot;wear ashstone&quot;)
	mud:send(&quot;get fires hole&quot;)
	mud:send(&quot;wear fires&quot;)
	mud:send(&quot;get stud hole&quot;)
	mud:send(&quot;wear stud&quot;)
	mud:send(&quot;get segmented hole&quot;)
	mud:send(&quot;wear segmented&quot;)
	mud:send(&quot;get segmented hole&quot;)
	mud:send(&quot;wear segmented&quot;)
	mud:send(&quot;get mask hole&quot;)
	mud:send(&quot;wear mask&quot;)
	mud:send(&quot;get selari hole&quot;)
	mud:send(&quot;wear selari&quot;)
	mud:send(&quot;get waistwrap hole&quot;)
	mud:send(&quot;wear waistwrap&quot;)
	mud:send(&quot;get warder hole&quot;)
	mud:send(&quot;wear warder&quot;)
	mud:send(&quot;get time hole&quot;)
	mud:send(&quot;wear time&quot;)
	mud:send(&quot;get manacle hole&quot;)
	mud:send(&quot;wear manacle&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;wear baatorian&quot;)
	mud:send(&quot;get planetar hole&quot;)
	mud:send(&quot;wear planetar&quot;)
	mud:send(&quot;get rock hole&quot;)
	mud:send(&quot;get rock hole&quot;)
	mud:send(&quot;wear rock&quot;)
	mud:send(&quot;wear rock&quot;)
	mud:send(&quot;get balor hole&quot;)
	mud:send(&quot;wear balor&quot;)
	mud:send(&quot;get flame hole&quot;)
	mud:send(&quot;wear flame&quot;)
	mud:send(&quot;get seal hole&quot;)
end

if whoami() == &quot;Rrissun&quot; then
	mud:send(&quot;storage retrieve glory&quot;)
	mud:send(&quot;wield glory&quot;)
	mud:send(&quot;get chimera hole&quot;)
	mud:send(&quot;wear chimera&quot;)
	mud:send(&quot;get mask hole&quot;)
	mud:send(&quot;wear mask&quot;)
	mud:send(&quot;get warder hole&quot;)
	mud:send(&quot;wear warder&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;wear baatorian&quot;)
	mud:send(&quot;get rock hole&quot;)
	mud:send(&quot;get rock hole&quot;)
	mud:send(&quot;wear rock&quot;)
	mud:send(&quot;wear rock&quot;)
	mud:send(&quot;get waistwrap hole&quot;)
	mud:send(&quot;get time hole&quot;)
	mud:send(&quot;get planetar hole&quot;)
	mud:send(&quot;get matter hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get manacle hole&quot;)
	mud:send(&quot;get selari hole&quot;)
	mud:send(&quot;get symbol hole&quot;)
	mud:send(&quot;get symbol hole&quot;)
	mud:send(&quot;get symbol hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get seal hole&quot;)
	mud:send(&quot;powers info vit&quot;)
end

if whoami() == &quot;Adud&quot; or whoami() == &quot;Wopur&quot; or whoami() == &quot;Titter&quot; or whoami() == &quot;Ihgod&quot; then
	mud:send(&quot;storage retrieve valhalla&quot;)
	mud:send(&quot;wield valhalla&quot;)
	mud:send(&quot;get shield hole&quot;)
	mud:send(&quot;wear shield&quot;)
	mud:send(&quot;get serpent hole&quot;)
	mud:send(&quot;get girdle hole&quot;)
	mud:send(&quot;get mask hole&quot;)
	mud:send(&quot;get stud hole&quot;)
	mud:send(&quot;get stud hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get quiver hole&quot;)
	mud:send(&quot;get isha hole&quot;)
	mud:send(&quot;get cenobite hole&quot;)
	mud:send(&quot;get mail hole&quot;)
	mud:send(&quot;get stability hole&quot;)
	mud:send(&quot;get sorcerous hole&quot;)
	mud:send(&quot;get sorcerous hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get volance hole&quot;)
	mud:send(&quot;get volance hole&quot;)
	mud:send(&quot;get berserker hole&quot;)
	mud:send(&quot;get djinn hole&quot;)
	mud:send(&quot;get plates hole&quot;)
	mud:send(&quot;get mesh hole&quot;)
	mud:send(&quot;get darkwood hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get graven hole&quot;)
	mud:send(&quot;get seal hole&quot;)
end

if whoami() == &quot;Titter&quot; then
	mud:send(&quot;storage retrieve planetar&quot;)
end

if whoami() == &quot;Nyyrazzilyss&quot; then
	mud:send(&quot;get barrier hole&quot;)
	mud:send(&quot;wear barrier&quot;)
	mud:send(&quot;get arch hole&quot;)
	mud:send(&quot;get fires hole&quot;)
	mud:send(&quot;get all.drow hole&quot;)
	mud:send(&quot;get force hole&quot;)
	mud:send(&quot;get swirling hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;put drow hole&quot;)
	mud:send(&quot;get gossamer hole&quot;)
	mud:send(&quot;get slaadi hole&quot;)
	mud:send(&quot;get breeches hole&quot;)
	mud:send(&quot;get kinesis hole&quot;)
	mud:send(&quot;get kinesis hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get sandals hole&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;wear all&quot;)
end

if whoami() == &quot;Bonble&quot; then
  mud:send(&quot;get merchants hole&quot;)
  mud:send(&quot;wear merchants&quot;)
  mud:send(&quot;get matriarch merchants&quot;)
  mud:send(&quot;wield matriarch&quot;)
  mud:send(&quot;get ravenous merchants&quot;)
  mud:send(&quot;wield ravenous&quot;)
  mud:send(&quot;get serpent hole&quot;)
  mud:send(&quot;get gossamer hole&quot;)
  mud:send(&quot;get cringing merchants&quot;)
  mud:send(&quot;get buckles merchants&quot;)
  mud:send(&quot;get silvered merchants&quot;)
  mud:send(&quot;get crescent merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get gorget hole&quot;)
  mud:send(&quot;get congealed merchants&quot;)
  mud:send(&quot;wear congealed&quot;)
  mud:send(&quot;get baatorian hole&quot;)
  mud:send(&quot;get baatorian hole&quot;)
  mud:send(&quot;get insignia hole&quot;)
  mud:send(&quot;get girdle hole&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get batskull hole&quot;)
  mud:send(&quot;get swirling hole&quot;)
  mud:send(&quot;get kinesis hole&quot;)
  mud:send(&quot;get rock hole&quot;)
  mud:send(&quot;get scalemail merchants&quot;)
  mud:send(&quot;get sharp hole&quot;)
  mud:send(&quot;get marilith merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get seal hole&quot;)
end

if whoami() == &quot;Vottoc&quot; then
  mud:send(&quot;get merchants hole&quot;)
  mud:send(&quot;wear merchants&quot;)
  mud:send(&quot;get fireballs merchants&quot;)
  mud:send(&quot;get cringing merchants&quot;)
  mud:send(&quot;get congealed merchants&quot;)
  mud:send(&quot;get congealed merchants&quot;)
  mud:send(&quot;get drogino merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get gorget hole&quot;)
  mud:send(&quot;get gorget hole&quot;)
  mud:send(&quot;get flesh merchants&quot;)
  mud:send(&quot;get baatorian hole&quot;)
  mud:send(&quot;get bracer hole&quot;)
  mud:send(&quot;get insignia hole&quot;)
  mud:send(&quot;get marilith merchants&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get batskull hole&quot;)
  mud:send(&quot;get rock hole&quot;)
  mud:send(&quot;get dwarfhide merchants&quot;)
  mud:send(&quot;get giant hole&quot;)
  mud:send(&quot;get studs merchants&quot;)
  mud:send(&quot;get scalemail merchants&quot;)
  mud:send(&quot;get swirling hole&quot;)
  mud:send(&quot;get girdle hole&quot;)
  mud:send(&quot;wear all&quot;)
  mud:send(&quot;get matriarch merchants&quot;)
  mud:send(&quot;wield matriarch&quot;)
  mud:send(&quot;get bane merchants&quot;)
  mud:send(&quot;wield bane&quot;)
  mud:send(&quot;get seal hole&quot;)
end

if whoami() == &quot;Ajac&quot; or whoami() == &quot;Imseh&quot; or whoami() == &quot;Aynep&quot; or whoami() == &quot;Caged&quot; then
	mud:send(&quot;get barrier hole&quot;)
	mud:send(&quot;wear barrier&quot;)
	mud:send(&quot;get arch hole&quot;)
	mud:send(&quot;hold arch&quot;)
	mud:send(&quot;get chimera hole&quot;)
	mud:send(&quot;get mauve hole&quot;)
	mud:send(&quot;get batskull hole&quot;)
	mud:send(&quot;get fires hole&quot;)
	mud:send(&quot;get all.drow hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get all.force hole&quot;)
	mud:send(&quot;get swirling hole&quot;)
	mud:send(&quot;get slaadi hole&quot;)
	mud:send(&quot;get gossamer hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get kinesis hole&quot;)
	mud:send(&quot;get kinesis hole&quot;)
	mud:send(&quot;get breeches hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get sharp hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get sandals hole&quot;)
	mud:send(&quot;wear sandals&quot;)
end

if whoami() == &quot;Rrassulis&quot; then
	mud:send(&quot;get barrier hole&quot;)
	mud:send(&quot;wear barrier&quot;)
	mud:send(&quot;get arch hole&quot;)
	mud:send(&quot;hold arch&quot;)
	mud:send(&quot;get chimera hole&quot;)
	mud:send(&quot;get mauve hole&quot;)
	mud:send(&quot;get amethyst hole&quot;)
	mud:send(&quot;get all.force hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get all.drow hole&quot;)
	mud:send(&quot;get swirling hole&quot;)
	mud:send(&quot;get slaadi hole&quot;)
	mud:send(&quot;get gossamer hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get kinesis hole&quot;)
	mud:send(&quot;get rock hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get sharp hole&quot;)
	mud:send(&quot;wear all&quot;)
	mud:send(&quot;get diamond hole&quot;)
	mud:send(&quot;wear diamond tail&quot;)
	mud:send(&quot;get seal hole&quot;)
end

mud:send(&quot;equip&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^dresschar$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>tintin # repeat</name>
                    <script>for nx=1, matches[2], 1 do
	send(matches[3])
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#([0-9]+) (.*+)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>checkbucket</name>
                    <script>function getbuckets()
	disableTrigger(&quot;Zurg&quot;)

	if #NyyLIB.buckets &gt; 0 then
		echo(&quot;[Buckets]\n&quot;)
		display( NyyLIB.buckets )

		mud:send(&quot;st&quot;)
		expandAlias(&quot;enter pathway&quot;, false)

		getPath(85075, NyyLIB.buckets[1])
	 	expandAlias(&quot;.&quot; .. compressSpeedwalk(), false)

		mud:send(&quot;darkness&quot;)
		mud:send(&quot;get all&quot;)
		mud:send(&quot;darkness&quot;)

		getPath(NyyLIB.buckets[1], 79574)
	 	expandAlias(&quot;.&quot; .. compressSpeedwalk(), false)

		table.remove(NyyLIB.buckets, 1)

		mud:send(&quot;put all.bucket hole&quot;)
		mud:send(&quot;drop all.squash&quot;)

		tempTimer(10, [[getbuckets()]])	
	else
		echo(&quot;[No buckets found.]\n&quot;)

		mud:send(&quot;rest&quot;)
		mud:send(&quot;darkness&quot;)
	end
end

expandAlias(&quot;#find&quot;, false)


local currentroom = map:getRoom()

if currentroom == 79573 or currentroom == 79574 then
	echo(&quot;[Running Zurg script]\n&quot;)

	NyyLIB.buckets={}
	enableTrigger(&quot;Zurg&quot;)

	tempTimer(3600, [[expandAlias(&quot;checkbucket&quot;)]])

	if currentroom == 79573 then
		expandAlias(&quot;.uw&quot;, false)
	end

	mud:send(&quot;st&quot;)
	mud:send(&quot;project schism&quot;)
	expandAlias(&quot;enter pathway&quot;)
	expandAlias(&quot;.2w2s2enwn2e&quot;, false)

	tempTimer(10, [[getbuckets()]])
else
	echo(&quot;[Not in Wagontrack Pass - Zurg script cancelled.]\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^checkbucket$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>armor</name>
                    <script>mud:send( g(&quot;ab&quot;) )
mud:send(&quot;rec ab me&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^armor$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>chkstat</name>
                    <script>cecho(&quot;&lt;red&gt;\n[Checking status on group]\n&quot;)

for k,char in pairs(groupList:pc()) do
	sendStatus(char)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^chkstat$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>blend</name>
                    <script>mud:send(&quot;rem swirling&quot;)
mud:send(&quot;get warder hole&quot;)
mud:send(&quot;wear warder&quot;)
mud:send(&quot;say blend&quot;)
mud:send(&quot;rem warder&quot;)
mud:send(&quot;wear swirling&quot;)
mud:send(&quot;put warder hole&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^blend$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>vitme</name>
                    <script>mud:send(&quot;quaff cactus &quot; .. charData:get(&quot;container&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^vitme$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#ungag</name>
                    <script>local tmpvar = charData:get(&quot;gags&quot;, true)

if matches[2] == &quot;&quot; then
	echo(&quot;usage: #ungag text to ungag\n&quot;)
	echo(&quot;Existing gags:\n&quot;)
	display(tmpvar)
else
	for key,val in pairs(tmpvar) do
		if string.findPattern(matches[2]:lower(), val) then
			tmpvar[key]=nil
			echo(matches[2]:lower() .. &quot; has been removed from gags.\n&quot;)
		end
	end

	charData:set(&quot;gags&quot;, tmpvar, true)

	display(tmpvar)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#ungag ?(.*)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>dep</name>
                    <script>enableTrigger(&quot;DepositTrigger&quot;)
mud:send( p(&quot;all.coin&quot;) )
mud:send( g(&quot;all.coin&quot;) )
mud:send( p(&quot;all.lucky&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^dep$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>^swap ?(girdle|loop|slaad)?$</name>
                    <script>local item=matches[2]

if item == nil then
	cecho(&quot;&lt;red&gt;[swap volance|onevolance|girdle|loop|slaad|slaads|time|oneslaad to change item]\n&quot;)
	return
end

if item == &quot;volance&quot; then
	mud:send(&quot;rem volance&quot;)
	mud:send(&quot;rem volance&quot;)
	mud:send(&quot;wear volance&quot;)
	mud:send(&quot;wear volance&quot;)
elseif item == &quot;warder&quot; then
	mud:send(&quot;get warder hole&quot;)
	mud:send(&quot;rem warder&quot;)
	mud:send(&quot;put warder hole&quot;)
	mud:send(&quot;wear warder&quot;)
elseif item == &quot;onevolance&quot; then
	mud:send(&quot;get volance hole&quot;)
	mud:send(&quot;rem volance&quot;)
	mud:send(&quot;put volance hole&quot;)
	mud:send(&quot;wear volance&quot;)
elseif item == &quot;sleeves&quot; then
	mud:send(&quot;get gossamer hole&quot;)
	mud:send(&quot;rem gossamer&quot;)
	mud:send(&quot;put gossamer hole&quot;)
	mud:send(&quot;wear gossamer&quot;)
elseif item == &quot;manacle&quot; then
	mud:send(&quot;get manacle hole&quot;)
	mud:send(&quot;rem manacle&quot;)
	mud:send(&quot;put manacle hole&quot;)
	mud:send(&quot;wear manacle&quot;)
	timer:set(&quot;TiaManacle&quot;, nil)
elseif item == &quot;manacles&quot; then
	mud:send(&quot;rem manacle&quot;)
	mud:send(&quot;rem manacle&quot;)
	mud:send(&quot;wear 2.manacle&quot;)
	mud:send(&quot;wear manacle&quot;)
	timer:set(&quot;TiaManacle&quot;, nil)
elseif item == &quot;time&quot; then
	mud:send(&quot;rem time&quot;)
	mud:send(&quot;get 3.time hole&quot;)
	mud:send(&quot;wear time&quot;)
	mud:send(&quot;put time hole&quot;)
elseif item == &quot;loop&quot; then
	mud:send(&quot;rem loop&quot;)
	mud:send(&quot;rem loop&quot;)
	mud:send(&quot;wear 2.loop&quot;)
	mud:send(&quot;wear loop&quot;)
	timer:set(&quot;TiaLoop&quot;, 1)
elseif item == &quot;slaad&quot; then
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;wear 2.baatorian&quot;)
	mud:send(&quot;wear baatorian&quot;)
	timer:set(&quot;baatorian&quot;, 1)
elseif item == &quot;slaads&quot; then
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;get baatorian hole&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;put baatorian hole&quot;)
	mud:send(&quot;put baatorian hole&quot;)
	mud:send(&quot;wear baatorian&quot;)
	mud:send(&quot;wear baatorian&quot;)
	timer:set(&quot;baatorian&quot;, 1)
elseif item == &quot;oneslaad&quot; then
	mud:send(&quot;get 4.baatorian portable&quot;)
	mud:send(&quot;rem baatorian&quot;)
	mud:send(&quot;put baatorian hole&quot;)
	mud:send(&quot;wear baatorian&quot;)
elseif item == &quot;girdle&quot; then
	mud:send( g(&quot;girdle&quot;) )
	mud:send(&quot;rem girdle&quot;)
	mud:send( p(&quot;girdle&quot;) )
	mud:send(&quot;wear girdle&quot;)
	timer:set(&quot;SuppleGirdle&quot;, 1)
end
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^swap ?(sleeves|girdle|loop|slaad|slaads|time|oneslaad|volance|onevolance|manacle|manacles|warder)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>slaad rescue</name>
                    <script>mud:send(&quot;o followers rescue &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^resc (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>ynnd</name>
                    <script>mud:send(&quot;t ynndchiarhlizz worm &quot; .. whoami())</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^ynnd$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>tintin . speedwalk</name>
                    <script>local dirString   =   matches[2]:lower()

for count, direction in string.gmatch(dirString, &quot;([0-9]*)([neswud])&quot;) do      
	count = (count == &quot;&quot; and 1 or count)
   for i=1, count do
   		expandAlias(direction)
   end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^[.]([0-9nsweudNSWEUD]+)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>who</name>
                    <script>mud:send(&quot;WHO &quot; .. matches[2])</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^who (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>stpm - stop moving</name>
                    <script>cecho(&quot;&lt;green&gt;[Not currently moving]\n&quot;)
spell:setMoving(false)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^stpm$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>Demonnic</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Shared</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="yes" isFolder="no">
                        <name>Reset chasing</name>
                        <script>demonnic.chaser:reset()</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^chaseres$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>Debug</name>
                        <script>-- commented out 10/11/16

--if matches[2] then
--  demonnic:listCategories()
--else
--  demonnic:toggleDebug()
--end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^debug(?: (list))?$</regex>
                    </Alias>
                    <Alias isActive="yes" isFolder="no">
                        <name>debug categories</name>
                        <script>if matches[2] then
  demonnic:watchCategory( matches[2] )
else
  demonnic:listCategories()
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^debugc(?: (.*))?$</regex>
                    </Alias>
                </AliasGroup>
                <AliasGroup isActive="yes" isFolder="yes">
                    <name>Tabbed Chat</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex></regex>
                    <Alias isActive="no" isFolder="no">
                        <name>Toggle blinking (temporary change)</name>
                        <script>if demonnic.chat.config.blink then
  demonnic.chat.config.blink = false
  demonnic.chat.tabsToBlink = {}
  demonnic:echo(&quot;Blinking temporarily turned &lt;red&gt;off&lt;grey&gt;. It will reset if you edit your tabbed chat configuration, or close and reopen mudlet. To make it permanent, change demonnic.chat.config.blink to false in \&quot;Demonnic-&gt;Tabbed Chat-&gt;Configuration options\&quot; under scripts\n&quot;)
else
  demonnic.chat.config.blink = true
  demonnic.chat:blink()
  demonnic:echo(&quot;Blinking temporarily turned &lt;red&gt;on&lt;grey&gt;. It will reset if you edit your tabbed chat configuration, or close and reopen mudlet. To make it permanent, change demonnic.chat.config.blink to true in \&quot;Demonnic-&gt;Tabbed Chat-&gt;Configuration options\&quot; under scripts\n&quot;)
end</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^dblink$</regex>
                    </Alias>
                    <Alias isActive="no" isFolder="no">
                        <name>fixChat</name>
                        <script>local currentsetting = demonnic.chat.config.location
local newsetting = &quot;&quot;
if currentsetting == &quot;topright&quot; then 
  newsetting = &quot;bottomleft&quot; 
elseif currentsetting == &quot;topleft&quot; then
  newsetting = &quot;bottomright&quot;
elseif currentsetting == &quot;bottomleft&quot; then
  newsetting = &quot;topright&quot;
elseif currentsetting == &quot;bottomright&quot; then
  newsetting = &quot;topleft&quot;
end

demonnic.chat.config.location = newsetting
demonnic.chat:create()
demonnic.chat.config.location = currentsetting
demonnic.chat:create()</script>
                        <command></command>
                        <packageName></packageName>
                        <regex>^fixchat$</regex>
                    </Alias>
                </AliasGroup>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>SplitClass</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>bid</name>
                    <script>local biditem= matches[4], bids, bidders
local xname=string.lower(matches[3]):title()

if matches[2] == &quot;help&quot; then
	echo(&quot;\nbid init\n&quot;)
	echo(&quot;bid addchar name, bid delchar name\n&quot;)
	echo(&quot;\nbid start\n&quot;)
	echo(&quot;bid open\n&quot;)
	echo(&quot;bid stop\n&quot;)
	echo(&quot;\nbid add charname itemname\n&quot;)
	echo(&quot;adddice charname roll\n&quot;)
	echo(&quot;\nbid status\n&quot;)
end

if matches[2] == &quot;status&quot; then	
	local allbidders

	allbidders=table.deepcopy(NyyLIB.validbidders)

	if NyyLIB.bids == nil then
		echo(&quot;Bidding is currently closed. Type 'bid help' for commands.\n&quot;)
		return
	end

	echo(&quot;Bids received:\n\n&quot;)

	display(NyyLIB.bids)

	for k,v in pairs(NyyLIB.bids) do
		table.remove(allbidders, table.index_of(allbidders, k))
		echo(k .. &quot; - &quot; .. v .. &quot;\n&quot;)
	end

	echo(&quot;\nMissing bids:\n&quot;)

	display(allbidders)

	--display(NyyLIB.validbidders)

	echo(&quot;\nDice:\n&quot;)

	display(NyyLIB.trackbid)

end


if matches[2] == &quot;init&quot; then
	mud:send(&quot;glist&quot;)
	NyyLIB.validbidders = groupList:pc(&quot;all&quot;)

	disableTrigger(&quot;acceptbid&quot;)
	disableTrigger(&quot;acceptdice&quot;)

	NyyLIB.trackbid = {}

	echo(&quot;\nSplit script enabled:\n&quot;)

	echo(&quot;Total number of bidders: &quot; .. #NyyLIB.validbidders .. &quot;\n&quot;)
	display(NyyLIB.validbidders)
	

end

if matches[2] == &quot;delchar&quot; then
	table.remove(NyyLIB.validbidders, table.index_of(NyyLIB.validbidders, xname))
	display(NyyLIB.validbidders)
end

if matches[2] == &quot;addchar&quot; then
	table.insert(NyyLIB.validbidders, 1, xname)
	display(NyyLIB.validbidders)
end

if matches[2] == &quot;start&quot; then
	mud:send(&quot;gsay [--------------------------]&quot;)
	mud:send(&quot;gsay 'tell &quot; .. whoami() .. &quot; bid itemname or bid abstain - Resend the tell if you wish to change.&quot;)
	mud:send(&quot;gsay You will receive a confirmation tell on a successful bid.&quot;)
	mud:send(&quot;gsay Bids can NOT be changed after all bids have been received.&quot;)
  
	NyyLIB.fullbidderlist=NyyLIB.validbidders

	expandAlias(&quot;bid open&quot;)

end

if matches[2] == &quot;open&quot; then
	NyyLIB.bidding=1
	NyyLIB.bids={}

	mud:send(&quot;gsay Bids will now be accepted from &quot; .. table.concat(NyyLIB.validbidders, &quot;|&quot;))
	enableTrigger(&quot;acceptbid&quot;)
end

if matches[2] == &quot;add&quot; then
	local abort=1
	local itemMatches=0

	if isActive(&quot;acceptbid&quot;, &quot;trigger&quot;) == 0 then
		echo(&quot;\nBidding is currently closed.\n&quot;)
		return
	end


	for nx=1, #NyyLIB.validbidders, 1 do
		if NyyLIB.validbidders[nx]:lower() == string.lower(matches[3]) then
			abort=0
		end
	end

	if abort == 1 then
		echo(&quot;[Not a valid bidder]\n&quot;)
		return
	end

	--display(matches)
	-- display(matches[2]) add
	-- display(matches[3]) charname
	--display(matches[4])  itemname
	-- biditem= matches[4]

	-- if table.contains(NyyLIB.groupitems, matches[3]) then  should be 4?

	if table.contains(NyyLIB.groupitems, matches[3]) then
		biditem= NyyLIB.groupitems[table.index_of(NyyLIB.groupitems, xname)]
	else
		local nx
		local founditem
		local testitem = string.gsub(biditem, &quot;-&quot;, &quot;[-]&quot;) -- testitem is regex

		for nx=1, #NyyLIB.groupitems, 1 do
			if string.findPattern(NyyLIB.groupitems[nx], testitem) then
				founditem = NyyLIB.groupitems[nx]
				itemMatches=itemMatches+1
			end
		end

		if itemMatches == 1 then
			biditem=founditem
		end
	end
	
	if biditem == &quot;abstain&quot; or table.contains(NyyLIB.groupitems, biditem) and itemMatches &lt; 2 then
		local dup=0

		mud:send(&quot;t &quot; .. matches[3] .. &quot; Bid received for &quot; .. biditem)

		NyyLIB.bids[xname] = biditem

		bids= table.size(NyyLIB.bids)
		bidders = table.size(NyyLIB.validbidders)

		mud:send(&quot;gsay &quot; .. bids .. &quot;/&quot; .. bidders .. &quot; bids received&quot;)

		RedrawGroupStatus()
 
   		if bids == bidders then
			NyyLIB.activebids = NyyLIB.bids
			disableTrigger(&quot;acceptbid&quot;)
      		expandAlias(&quot;sortbids&quot;, false)
		end
	else
		if itemMatches &gt; 1 then
			mud:send(&quot;t &quot; .. matches[3] .. &quot; Which &quot; .. biditem .. &quot;? There's more then one.&quot;)
		else
			mud:send(&quot;t &quot; .. matches[3] .. &quot; failed bid on &quot; .. biditem)
		end
	end
end

if matches[2] == &quot;stop&quot; then
	cecho(&quot;\n&lt;red&gt;[Disabled bid script.]\n&quot;)
	NyyLIB.bidding=0
  	NyyLIB.bids=nil
  	NyyLIB.activebids=nil
  	NyyLIB.groupitems=nil
  	NyyLIB.validbidders=nil
  	NyyLIB.trackbid=nil
  	NyyLIB.fullbidderlist=nil
  	NyyLIB.biditem=nil
  	NyyLIB.trackbid2=nil

	disableTrigger(&quot;acceptbid&quot;)

	RedrawGroupStatus()
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^bid ([A-Za-z]+)? ?([A-Za-z-']+)? ?(.*)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>sortbids</name>
                    <script>local abstain=0
local abstainwho=&quot;&quot;
local abort=0
local nx
local key, val

-- remove abstain
for key,val in pairs(NyyLIB.activebids) do
	if val == &quot;abstain&quot; then
		abstain=abstain+1
	
		abstainwho = abstainwho .. &quot; &quot; .. key

		table.remove(NyyLIB.validbidders, table.index_of(NyyLIB.validbidders, key))
		NyyLIB.activebids[key] = nil
		abort=1
	end
end

if abstainwho ~= &quot;&quot; then
	send(&quot;gsay &lt;&lt;&lt; &quot; .. abstain .. &quot; abstain by &quot; .. abstainwho .. &quot; &gt;&gt;&gt;&quot;)
end

for key,val in pairs(NyyLIB.activebids) do	
	local compete=0
	local who = key
	local item = val

	for k,v in pairs(NyyLIB.bids) do
		if item == v and who ~= k then
			compete=1
		end
	end

	if compete == 0 then
		send(&quot;gsay &lt;&lt;&lt; Sole Bidder: &quot; .. key .. &quot; - &quot; .. val .. &quot; &gt;&gt;&gt;&quot;)

		table.remove(NyyLIB.validbidders, table.index_of(NyyLIB.validbidders, key))
		NyyLIB.activebids[key] = nil

		abort=1
	end
end

if abort == 0 then
	--display(&quot;Calling nextbid&quot;)
	expandAlias(&quot;nextbid&quot;, false)
end
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^sortbids$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>nextbid</name>
                    <script>local abort = 0
local nx


if isActive(&quot;acceptbid&quot;, &quot;trigger&quot;) ~= 0 or isActive(&quot;acceptdice&quot;, &quot;trigger&quot;) ~= 0 then
	display(&quot;acceptbid &quot; .. isActive(&quot;acceptbid&quot;, &quot;trigger&quot;))
	display(&quot;acceptdice &quot; .. isActive(&quot;acceptdice&quot;, &quot;trigger&quot;))

	echo(&quot;\nBidding is currently ongoing.\n&quot;)
	return
end

NyyLIB.trackbid= {}

for key,val in pairs(NyyLIB.activebids) do
	if abort == 0 then
		local compete=&quot;&quot;
		local who = key
		NyyLIB.biditem= val

		compete = NyyLIB.biditem .. &quot;: &quot; .. who    

		NyyLIB.trackbid[who] = 0

		NyyLIB.activebids[who]=nil

		for k,v in pairs(NyyLIB.activebids) do
			if NyyLIB.biditem == v then
				compete= compete .. &quot;, &quot; .. k

				NyyLIB.trackbid[k] = 0
				NyyLIB.activebids[k]=nil
			end
		end

		enableTrigger(&quot;acceptdice&quot;)
		send(&quot;gsay &lt;&lt;&lt; Competition! &quot; .. compete .. &quot; &gt;&gt;&gt;&quot;)
		abort=1
	end
end

if abort == 0 then
	disableTrigger(&quot;acceptdice&quot;)
	send(&quot;gsay This round of bidding has now completed.&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^nextbid$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>adddice</name>
                    <script>local xname, xdice

NyyLIB.trackbid2={}

xname=string.lower(matches[2]):title()
xdice=tonumber(matches[3])

if NyyLIB.trackbid == nil then
	echo(&quot;[Bidding is not currently open. Type 'bid help' for commands.]\n&quot;)
	return
end


if NyyLIB.trackbid[xname] == nil then
	echo(&quot;[ &quot; .. xname .. &quot; doesn't exist in valid dice rollers]\n&quot;)
	return
end

cecho(&quot;\n&lt;red&gt;[Setting &quot; .. xname .. &quot; to dice roll of &quot; .. xdice .. &quot;.]\n&quot;)

NyyLIB.trackbid[xname] = xdice

if table.contains(NyyLIB.trackbid, 0) == false then
	local winval=0
	local winkey=&quot;&quot;
	local tie=0
	local temp= &quot;Dice: |&quot;
	
	for k,v in pairs(NyyLIB.trackbid) do
		temp = temp .. k .. &quot;-&quot; .. v .. &quot;|&quot;
		if v &gt; winval then
			winval = v
			winkey = k
		end
	end

	mud:send(&quot;gsay &quot; .. temp .. &quot; &gt;&gt;&quot;)

	temp = winkey
  
	-- display(NyyLIB.trackbid)

	for k,v in pairs(NyyLIB.trackbid) do
		if (v == winval) and k ~= winkey then
			tie = 1
			NyyLIB.trackbid2[k] = 0
			temp = temp .. &quot;, &quot; .. k
		end
	end

	if tie == 1 then
		mud:send(&quot;gsay &lt;&lt; Finish Him! &quot; .. winval .. &quot; by &quot; .. temp)

		NyyLIB.trackbid2[winkey] = 0
		NyyLIB.trackbid = NyyLIB.trackbid2
	else
		mud:send(&quot;gsay &lt;&lt; Winner: &quot; .. winkey .. &quot; (&quot; .. winval .. &quot;) &quot; .. NyyLIB.biditem .. &quot; &gt;&gt;&quot;)
		disableTrigger(&quot;acceptdice&quot;)
	
		table.remove(NyyLIB.validbidders, table.index_of(NyyLIB.validbidders, winkey))
		NyyLIB.activebids[winkey] = nil
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^adddice ([A-Za-z]+) ([0-9]+)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>createhistory</name>
                    <script>local mydb = db:create(&quot;bidhistory&quot;,
		{
		bids = {
			whatgroup = db:Timestamp(&quot;CURRENT_TIMESTAMP&quot;),
         itemname = &quot;&quot;,
         round = 0,
       	charname = &quot;&quot;,
	     	diceroll = 0,
         	_index = { {&quot;itemname&quot;} }
		}
	} )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^createhistory$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>Counters</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>#stats</name>
                    <script>-- c_block: Shield block
-- c_glances: Glances off shield - will also hit
-- c_svamp: Vamp from shield

-- c_deflect: Deflect from sword
-- c_pdeflect: Partially deflect from sword - will also hit				defpdeflect
-- c_parry: Parry attack (count as miss)

-- c_dodge: dodge attack (count as miss)
-- c_graze: partial dodge - will also hit

-- c_hit: hit
-- c_miss: miss

--NyyLIB.c_crit

-- 'all avoidance is checked before ac'


if matches[2] == &quot;heals&quot; then
	printHeals()
	return
end

if matches[2] == &quot;reset&quot; then
	resetStats()

	return
end

local cntRescueFail=getStat(whoami(), &quot;failedrescue&quot;)
local cntRescueSuccess=getStat(whoami(), &quot;successrescue&quot;)

local c_attackmiss=getStat(whoami(), &quot;offMiss&quot;)
local c_attackhit=getStat(whoami(), &quot;offHit&quot;)

local c_block=getStat(whoami(), &quot;defShieldBlock&quot;)
local c_dodge=getStat(whoami(), &quot;defDodge&quot;)
local c_graze=getStat(whoami(), &quot;defGraze&quot;)
local c_deflect=getStat(whoami(), &quot;defWeaponDeflect&quot;)
local c_glances=getStat(whoami(), &quot;defShieldGlance&quot;)
local c_svamp=getStat(whoami(), &quot;shieldvamp&quot;)
local c_parry=getStat(whoami(), &quot;defParry&quot;)
local c_pdeflect=getStat(whoami(), &quot;defpdeflect&quot;)
local c_crit=getStat(whoami(), &quot;crithit&quot;)

local c_hit=getStat(whoami(), &quot;defHit&quot;)
local c_miss=getStat(whoami(), &quot;defMiss&quot;)


local c_all=c_hit+c_miss + c_parry + c_deflect + c_dodge + c_block


local c_adjhit=c_all-c_miss

local output = {}

local skillblocked = c_block + c_parry + c_deflect + c_dodge
local partialblock=  c_pdeflect + c_graze + c_glances


local v2allhit = c_hit + skillblocked
local v2weapon = c_parry + c_deflect + c_pdeflect

-- csv line

output[#output+1] = string.format(&quot;//%s,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n&quot;, 
											charData:get(&quot;statname&quot;), whoami(), NyyLIB.str, NyyLIB.agibonus, NyyLIB.hitroll, NyyLIB.damroll,
												cntRescueFail, cntRescueSuccess, c_attackmiss, c_attackhit,
											c_block,c_dodge,c_graze,c_deflect,c_glances,c_svamp,c_parry,c_pdeflect, c_crit,c_hit,c_miss)

--output[#output+1] = string.format(&quot;[Based on AC alone, %2.1f%% (%d) hit, %2.1f%% (%d) missed]\n&quot;,
--							v2allhit*100/c_all, c_all,
--							c_miss*100/c_all, c_miss)
							
--output[#output+1] = string.format(&quot;[Of hits/potential hits (%d), %2.1f%% (%d) of them were dodged, %2.1f%% (%d) of them partially]\n&quot;,
--								v2allhit,
--								(c_dodge+c_graze)*100/v2allhit,
--								 c_dodge+c_graze,
--								c_graze*100/(c_dodge+c_graze),
--								c_graze )

--output[#output+1] = string.format(&quot;[Of available attacks (%d), %2.1f%% (%d) were shield blocked, %2.1f%% (%d) of them partially]\n&quot;,
--							 	v2allhit-c_dodge-c_graze,
--								(c_block+c_glances)*100/(v2allhit-c_dodge-c_graze), c_block+c_glances,
--								c_glances*100/(c_block+c_glances), c_glances)

--output[#output+1] = string.format(&quot;[Of the remaining %d attacks, %2.1f%% (%d) were riposted, %2.1f%% (%d) of them partially]\n&quot;,
--							 	v2allhit-c_dodge-c_graze-c_block-c_glances,
--								v2weapon*100/(v2allhit-c_dodge-c_graze-c_block-c_glances), v2weapon,
--								c_pdeflect*100/(v2weapon), c_pdeflect   )

--output[#output+1] = string.format(&quot;[%2.1f%% (%d) partially dodged, %2.1f%% (%d) glanced off shield, %2.1f%% (%d) partially deflected]\n&quot;,
--											c_graze*100/c_hit, c_graze,
--											c_glances*100/c_hit, c_glances,
--											c_pdeflect*100/c_hit, c_pdeflect)

--output[#output+1] = string.format(&quot;[%2.1f%% (%d) attacks went through all defenses]\n&quot;, 
--							(v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances)*100/c_hit, (v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances) )

--output[#output+1] = string.format(&quot;[The final hit rate is %2.1f%% (%d)]\n&quot;,
--											c_hit*100/c_all,	c_hit )

output[#output+1] = string.format(&quot;[Defense: Hit %2.1f%% (%d/%d) : %2.1f%% (%d) direct, %2.1f%% (%d) dodge, %2.1f%% (%d) shield, %2.1f%% (%d) weapon]\n&quot;,
												c_hit*100/c_all, c_hit, c_all,
												(v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances)*100/c_hit, (v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances),
												c_graze*100/c_hit, c_graze,
												c_glances*100/c_hit, c_glances,
												c_pdeflect*100/c_hit, c_pdeflect   )

output[#output+1] = string.format(&quot;[+HIT %d +DAM %d : Missed %2.1f%% (%d) Hit %2.1f%% (%d)]\n&quot;, 
								NyyLIB.hitroll, NyyLIB.damroll,
								c_attackmiss*100/(c_attackhit+c_attackmiss), c_attackmiss,
								c_attackhit*100/(c_attackhit+c_attackmiss), c_attackhit)


if cntRescueFail + cntRescueSuccess &gt; 0 then
	output[#output+1] = string.format(&quot;[%2.2f%% (%d) failed rescues, %2.2f%% (%d) success]\n&quot;, 
											cntRescueFail*100 / (cntRescueFail+cntRescueSuccess), cntRescueFail, 
											cntRescueSuccess*100 / (cntRescueFail+cntRescueSuccess), cntRescueSuccess)
end

local nx

if matches[2] == &quot;write&quot; then
	local file = io.open(homepath(&quot;stats.dat&quot;), &quot;a&quot;)

	io.output(file)

	io.write(&quot;\n&quot;)

	for nx=1, #output, 1 do
		io.write(output[nx])
	end

	io.close(file)

	return
end

if matches[2] == &quot;read&quot; then
	--local file = io.open(, &quot;r&quot;)

	for line in io.lines(homepath(&quot;stats.dat&quot;)) do
		echo(line .. &quot;\n&quot;)
	end


	--io.close(file)
	return
end

if matches[2] == &quot;gcc&quot; then
	for nx=1, #output, 1 do
		mud:send(&quot;gcc &quot; .. output[nx])	
	end
	return
end

if matches[2] == &quot;gsay&quot; then
	for nx=1, #output, 1 do
		mud:send(&quot;gsay &quot; .. output[nx])	
	end
	return
end

echo(&quot;\n&quot;)

printStats()

echo(&quot;\n&quot;)

for nx=2, #output, 1 do
	echo(output[nx])
end

</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#stats ?(write|read|reset|gcc|gsay|heals)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#gstats</name>
                    <script>printStats()</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#gstats$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>Mapper.002</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>#map</name>
                    <script>NyyLIB.Mapper.exitmap = { n = 1, north = 1, e = 4, east = 4, w = 5, west = 5, s = 6, south = 6,
		  u = 9, up = 9, d = 10, down = 10, [&quot;in&quot;] = 11, out = 12, [1] = &quot;north&quot;, [4] = &quot;east&quot;, [5] = &quot;west&quot;,
		  [6] = &quot;south&quot;,  [9] = &quot;up&quot;,  [10] = &quot;down&quot;,  [11] = &quot;in&quot;,  [12] = &quot;out&quot;}

NyyLIB.Mapper.doormap = { n = 1, north = 1, e = 4, east = 4, w = 5, west = 5, s = 6, south = 6,
		  u = 9, up = 9, d = 10, down = 10, [&quot;in&quot;] = 11, out = 12, [1] = &quot;n&quot;, [4] = &quot;e&quot;, [5] = &quot;w&quot;,
		  [6] = &quot;s&quot;,  [9] = &quot;u&quot;,  [10] = &quot;d&quot;,  [11] = &quot;in&quot;,  [12] = &quot;out&quot;}


if matches[2] == nil then
	local list = getAreaTable()
	local fullmap = getRooms()

	local totalmap=0
	local totalfound=0

	local totalarea=0
	local areasfound=0

	local maprooms = {}

	for roomid, roomname in pairs(fullmap) do
		local internalid = getRoomArea(roomid)

		local zone=getRoomUserData(roomid, &quot;zoneid&quot;)
		local zoneid=tonumber(zone)

		if zoneid ~= nil then
			-- first appearance of room in area
			if maprooms[NyyLIB.areaTable[zoneid]] == nil then
				maprooms[NyyLIB.areaTable[zoneid]] = {0,0}
			end

			if internalid == -1 then
				-- undiscovered room
				maprooms[NyyLIB.areaTable[zoneid]][2] = maprooms[NyyLIB.areaTable[zoneid]][2] + 1
			else
				-- discovered room
				maprooms[NyyLIB.areaTable[zoneid]][1] = maprooms[NyyLIB.areaTable[zoneid]][1] + 1
			end
		else
			-- echo(&quot;nil room &quot; .. roomid .. &quot;\n&quot;)
		end
	end

	for k,v in pairs(maprooms) do
		if v[1] ~= 0 then
			echo ( string.format(&quot;%45s %4d/%4d  rooms, ( %5.2f%% )\n&quot;, k, v[1], v[1]+v[2], v[1]*100/(v[1]+v[2])) )

			totalfound=totalfound+v[1]
			areasfound=areasfound+1
		end
		totalmap=totalmap+v[1]+v[2]
	end

	echo( string.format(&quot;\n             found %3d/%-3d included areas      %d/%d rooms  ( %5.2f%% )\n\n&quot;, 
		areasfound, table.size(maprooms), totalfound, totalmap, totalfound*100/totalmap) )

	echo(&quot;#map on           - turn on the mapper display\n&quot;)
	echo(&quot;#map off          - turn off the mapper display\n&quot;)
	echo(&quot;#map update       - update the map after a new NyyLIB is installed\n&quot;)
	echo(&quot;#map info         - list size/name of all areas in the map\n&quot;)
	echo(&quot;#find             - attempt to locate the currently occupied room on the map\n&quot;)
	echo(&quot;#find roomname    - list of previously located rooms\n&quot;)
	echo(&quot;#fwalk roomnum    - fastwalk from the current room to roomnum\n&quot;)
end


if matches[2] == &quot;info&quot; then
	local list = getAreaTable()
	local fullmap = getRooms()

	local totalmap=0
	local totalfound=0

	local totalarea=0
	local areasfound=0

	local maprooms = {}

	for roomid, roomname in pairs(fullmap) do
		local internalid = getRoomArea(roomid)
		local zone=getRoomUserData(roomid, &quot;zoneid&quot;)
		local zoneid=tonumber(zone)


		if zoneid ~= nil then
			-- first appearance of room in area
			if maprooms[NyyLIB.areaTable[zoneid]] == nil then
				maprooms[NyyLIB.areaTable[zoneid]] = {0,0}
			end

			if internalid == -1 then
				-- undiscovered room
				maprooms[NyyLIB.areaTable[zoneid]][2] = maprooms[NyyLIB.areaTable[zoneid]][2] + 1
			else
				-- discovered room
				maprooms[NyyLIB.areaTable[zoneid]][1] = maprooms[NyyLIB.areaTable[zoneid]][1] + 1
			end
		else
			-- echo(&quot;nil room &quot; .. roomid .. &quot;\n&quot;)
		end
	end

	for k,v in pairs(maprooms) do
		echo ( string.format(&quot;%45s %4d/%4d  rooms, ( %5.2f%% )\n&quot;, k, v[1], v[1]+v[2], v[1]*100/(v[1]+v[2])) )

		totalfound=totalfound+v[1]
		areasfound=areasfound+1

		totalmap=totalmap+v[1]+v[2]
	end

	echo( string.format(&quot;\n             found %3d/%-3d included areas      %d/%d rooms  ( %5.2f%% )\n\n&quot;, 
		areasfound, table.size(maprooms), totalfound, totalmap, totalfound*100/totalmap) )
end

if matches[2] == &quot;update&quot; then
	cecho(&quot;&lt;red&gt;[Support for combing split maps has been removed]\n&quot;)
	cecho(&quot;&lt;red&gt;[If you're still using them, install rc2 first]\n&quot;)
	cecho(&quot;&lt;green&gt;[Running the map update on image will take 5-10 minutes.]\n&quot;)
	cecho(&quot;&lt;green&gt;[Mudlet will appear to be frozen while running. Don't close it.]\n&quot;)
	cecho(&quot;\n&lt;red&gt;[Use the '&lt;green&gt;#backup&lt;red&gt;' command to make a backup of data files before updating!]\n\n&quot;)
	cecho(&quot;&lt;green&gt;[Type '&lt;red&gt;#map updateok&lt;green&gt;' to start update]\n&quot;)
end

if matches[2] == &quot;updateok&quot; then
	local fullmap = getRooms()
	local nx

	local mapdata={}

	-- check existing toril.map file
	for roomid, roomname in pairs(fullmap) do
		local internalid = getRoomArea(roomid)

		if internalid ~= -1 and internalid ~= nil then
			mapdata[#mapdata+1]=roomid
		end
	end

	loadMap(mainpath(&quot;toril.map&quot;))

	for nx=1,#mapdata,1 do
		if mapdata[nx] ~= 1 then
			unhideRoom(mapdata[nx])
		end
	end

	expandAlias(&quot;#map save&quot;, false)

	cecho(&quot;&lt;red&gt;[Done]\n&quot;)
end

if matches[2] == &quot;reset&quot; then
	loadMap(mainpath(&quot;toril.map&quot;))

	expandAlias(&quot;#find&quot;, false)

	cecho(&quot;&lt;red&gt;[Default map loaded]\n&quot;)
end

if matches[2] == &quot;on&quot; then
	charData:set(&quot;map&quot;, &quot;on&quot;)

	if map:getRoom() == nil then
		tempTimer(3, [[expandAlias(&quot;#find&quot;, false)]])
	end
	map:show()

	resizeGroupWindow(true)
elseif matches[2] == &quot;off&quot; then
	charData:set(&quot;map&quot;, &quot;off&quot;)

	map:hide()

	resizeGroupWindow(true)
elseif matches[2] == &quot;save&quot; then
	local mapname = homepath(&quot;toril.map&quot;)
	local savedok = saveMap(mapname)

	if not savedok then
  		cecho(&quot;\n&lt;red&gt;[Failed map save: &quot; .. mapname .. &quot;]\n&quot;)
	else
  		cecho(&quot;\n&lt;red&gt;[Saved map: &quot; .. mapname .. &quot;]\n&quot;)
	end

elseif matches[2] == &quot;init&quot; then
	-- mapfile is also loaded from mudlet saved data by the creation command

	cecho(&quot;&lt;red&gt;[Creating mapper window and loading mudlet saved data]\n&quot;)

	mudlet = mudlet or {}; mudlet.mapper_script = true

	NyyLIB.mapwindow = Geyser.Mapper:new({name=&quot;mapper&quot;,x=&quot;33%&quot;,y=0,width=&quot;33%&quot;,height=&quot;50%&quot;})
	NyyLIB.mapwindow:hide()

	if setDefaultAreaVisible ~= nil then
		setDefaultAreaVisible(false)
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#map ?(info|on|off|reset|update|updateok|save|init|empty)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#find</name>
                    <script>-- empty movement queue

NyyLIB.Mapper.movement = {}
NyyLIB.Mapper.queueroomID = nil

-- pattern provided, locate rooms in map
if matches[2] ~= nil and matches[2] ~= &quot;&quot; then
	local fullmap = getRooms()

	cecho(&quot;\n&lt;red&gt;[Matching rooms in discovered map]\n&quot;)

	for roomid, roomname in pairs(fullmap) do
		if matches[2] == &quot;*&quot; then
			if getRoomArea(roomid) ~= -1 and roomid ~= 1 then
				echo(string.format(&quot;%30s Room ID: %6d  %s\n&quot;, getRoomAreaName(getRoomArea(roomid)), roomid, roomname))
			end
		else
			if string.findPattern(roomname:lower(), matches[2]:lower()) then
				if getRoomArea(roomid) ~= -1 then
					local pathlength=0

					if roomLocked(roomid) == false then
						if map:getRoom() ~= nil then
							if getPath( map:getRoom(), roomid) then
								pathlength=#speedWalkPath
							end
						end
					end

					cecho(string.format(&quot;&lt;green&gt;%30s Room ID: %6d [%3d]  %s\n&quot;, getRoomAreaName(getRoomArea(roomid)), roomid, pathlength, roomname))
				end
			end
		end
	end

	return
end

-------

-- no pattern provided, locate current room
local current=map:getRoom()

cecho(&quot;\n&lt;red&gt;[Searching... &quot;)

-- use scanned info if present

if table.size(scanned) &gt; 0 then
	local scanroom = solveScan()
	
	if scanroom ~= nil then
		map:setRoom( scanroom )
	end
else
	if NyyLIB.Mapper.roomname ~= nil and NyyLIB.Mapper.exits ~= nil then
		map:setRoom( findRoomID(NyyLIB.Mapper.roomname, NyyLIB.Mapper.exits) )
	end
end

if map:getRoom() ~= nil then
	if 	charData:get(&quot;map&quot;) == &quot;off&quot; then
		cecho(&quot;&lt;red&gt;Mapper is currently off. Type '#map on' to enable it.\n&quot;)
	end

	unhideRoom( map:getRoom() )
	updateMap(nil)
else
	NyyLIB.lastRoomID = nil
	centerview(1) -- blank room number
end
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#find ?(.*)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#afind - find room in current area</name>
                    <script>local fullmap = getRooms()

cecho(&quot;\n&lt;red&gt;[Matching discovered rooms in current area]\n&quot;)

if matches[2] ~= nil and matches[2] ~= &quot;&quot; then
	local fullmap = getRooms()

	local zoneid
	local internalid

	if map:getRoom() ~= nil then
		zoneid=tonumber(getRoomUserData( map:getRoom(), &quot;zoneid&quot;) )
		internalid= findAreaID(NyyLIB.areaTable[zoneid])
	end

	if internalid == nil then
		return
	end

	for roomid, roomname in pairs(fullmap) do
		if getRoomArea(roomid) == internalid then
			if string.findPattern(roomname:lower(), matches[2]:lower()) then

				local pathlength=0

				if roomLocked(roomid) == false then
					if map:getRoom() ~= nil then
						if getPath( map:getRoom(), roomid) then
							pathlength=#speedWalkPath
						end
					end
				end

				cecho(string.format(&quot;&lt;green&gt;%30s Room ID: %6d [%3d]  %s\n&quot;, getRoomAreaName(getRoomArea(roomid)), roomid, pathlength, roomname))
			end
		end
	end

	return
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#afind ?(.*)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>addarea</name>
                    <script>if matches[2] == nil then
	local count=0
	local line=&quot;&quot;

	for areaid, areaname in pairs(NyyLIB.areaTable) do
		line = line .. string.format(&quot;%3d %-33s &quot;, areaid, areaname)
		count=count+1

		if count == 3 then
			echo(line .. &quot;\n&quot;)
			line=&quot;&quot; 
			count=0
		end
	end

	if line ~= &quot;&quot; then
		echo(line .. &quot;\n&quot;)
	end

	echo(&quot;\n&quot;)
end

if matches[2] ~= nil then
	local areaid = tonumber(matches[2])
	local internalid = findAreaID( NyyLIB.areaTable[areaid] )

	if internalid ~= nil then
		echo(&quot;Map for &quot; .. NyyLIB.areaTable[areaid] .. &quot; already exists.\n&quot;)
	else
		cecho(&quot;\n&lt;green&gt;[Added area: (&quot; .. areaid .. &quot;) &quot; .. NyyLIB.areaTable[areaid] .. &quot;]\n&quot;)

		addAreaName(NyyLIB.areaTable[areaid])
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^addarea( [0-9]+)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>setroom</name>
                    <script>if map:getRoom() ~= nil then
	if getRoomArea(map:getRoom()) ~= -1 then
		echo(&quot;[Room set]\n&quot;)
		map:setRoom(matches[2])
		centerview(map:getRoom())
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^setroom ([0-9]+)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>emptyroom</name>
                    <script>local fullmap = getRooms()

for roomid, roomname in pairs(fullmap) do
	if string.findPattern(roomname:lower(), &quot;unmapped&quot;) then
		echo(&quot;Empty room already exists: &quot; .. roomid .. &quot;\n&quot;)
		setRoomArea(1, findAreaID(&quot;The Great Unknown&quot;))
		return
	end
end

expandAlias(&quot;addarea 6&quot;)

local newroomid = createRoomID()
addRoom(newroomid)

echo(&quot;\nCreated room number: &quot; .. newroomid .. &quot;\n&quot;)

setRoomArea(newroomid, findAreaID(&quot;The Great Unknown&quot;))

setRoomName(newroomid, &quot;Unmapped&quot;)


echo(&quot;Centering map.\n&quot;)
centerview(newroomid)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^emptyroom$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#f</name>
                    <script>local fullmap = getRooms()

echo(&quot;\n[Matching rooms in full map]\n&quot;)

for roomid, roomname in pairs(fullmap) do
	if string.findPattern(roomname:lower(), matches[2]:lower()) then
			echo(string.format(&quot;%30s Room ID: %6d  %s\n&quot;, getRoomAreaName(getRoomArea(roomid)), roomid, roomname))
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#f (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>enter</name>
                    <script>mud:send(&quot;ENTER &quot; .. matches[3], false)

NyyLIB.Mapper.movement[#NyyLIB.Mapper.movement+1] = &quot;enter &quot; .. matches[3]
</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^(en|ent|ente|enter) (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>recall</name>
                    <script>tempTimer(1.5, [[expandAlias(&quot;#find&quot;, false)]])
send(&quot;recall&quot;, false)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^recall$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>fullname Movement</name>
                    <script>-- currently moving
spell:setMoving(true)

-- erase spellqueue if any spells present
spell:eraseQueue()


-- erase scanned table
scanned={}

local dir=matches[2]:sub(1,1):lower()

processMovement(dir)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^(n|N|no|nor|nort|north|s|S|so|sou|sout|south|e|E|ea|eas|east|w|W|we|wes|west|u|U|up|d|D|do|dow|down)$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>doorbash</name>
                    <script>local dir=matches[3]:sub(1,1):lower()

NyyLIB.doorbash = dir

mud:send(&quot;DOORBASH &quot; .. dir, false)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^(doo|door|doorb|doorba|doorbas|doorbash) ([nsewud])$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>erasemap</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^erasemap$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>drag</name>
                    <script>-- drag corpse in direction

if checkMask(&quot;caster&quot;) then
	-- erase spellqueue if any spells present
	spell:eraseQueue()

	-- disable autocast
	charData:set(&quot;autocast&quot;, false)
	SpellsButton(&quot;init&quot;)
end

-- set as currently moving
spell:setMoving(true)

local dir=matches[2]:sub(1,1):lower()

queueMovement(dir)
send(matches[1], false)

-- if illithid - break hide

if checkMask(&quot;psi&quot;) then
	setHide(false)
end

</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^drag .*([ewnsud])$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#zone</name>
                    <script>--This alias will list all zones matching a pattern

for id, name in pairs(NyyLIB.areaTable) do
	if string.findPattern(name:lower(), matches[2]:lower()) then
		cecho(&quot;&lt;red&gt;(&quot; .. id .. &quot;) &quot; .. name .. &quot;\n&quot;)
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#zone (.*)</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>cMud Map Importer</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>Create map from cmud</name>
                    <script>local ok, msg = cmi:importAll()
if ok then
  echo(&quot;&lt;green&gt;cMud map successfully imported.  Use 'centerview #' in a script to orient yourself, where # is a room id\n&quot;)
else
  echo(&quot;&lt;firebrick&gt;Didn't import; &quot;..msg..&quot;.\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud importmap$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>purgemap</name>
                    <script>--this method is meant for a clean import from cmud
local maxid = table.maxn(getRooms())
local i

for i = 1, maxid  do
	if roomExists(i) then
		deleteRoom(i)
	end
end

--delete labels for all areas
local areatable = getAreaTable()
for i,v in pairs(areatable) do
	local labels = getMapLabels(v)
	if type(labels) == 'table' then
		for j,k in pairs(labels) do
			deleteMapLabel(v,j)
		end
	end
	deleteArea(v)
end
cecho(&quot;&lt;red&gt;[Wiped all data from loaded map]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud purgemap$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Clear sqlite connection</name>
                    <script>cmi:getConnection()</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud resetConnection$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Import rooms</name>
                    <script>cmi:checkConnection()
cmi:addRooms(cmi.con)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud addRooms$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Color rooms</name>
                    <script>cmi:checkConnection()
cmi:colorRooms(cmi.con)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud colorRooms$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Import Favorites</name>
                    <script>cmi:checkConnection()
cmi:addFavorites(cmi.con)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud addFavs$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>Label Zones</name>
                    <script>cmi:checkConnection()
cmi:labelCmudZones(cmi.con)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud labelZones$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>List areas</name>
                    <script>cmi:listAreas()</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^cmud listareas$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>import</name>
                    <script>NyyLIB.passwords = {
[5678] = &quot;auril&quot;,
[16418] = &quot;netheril&quot;,
[71573] = &quot;silverwing&quot;,
[77932] = &quot;kostchtchie&quot;,
[79128] = &quot;glukknukkle&quot;,
[41212] = &quot;tug plank&quot;,
[47888] = &quot;laduguer&quot;,
[48565] = &quot;hanali&quot;,
[48806] = &quot;moradin&quot;,
[14237] = &quot;hi&quot;,
[11687] = &quot;paradox&quot;,
[17103] = &quot;wind&quot;,
[70373] = &quot;kossuth&quot;,
[74115] = &quot;annam&quot;,
[75603] = &quot;sunbat&quot;,
[78269] = &quot;jess&quot;,
[78562] = &quot;trahern&quot;,
[78577] = &quot;vrazgal&quot;,
[79003] = &quot;yylirmog&quot;,
[87034] = &quot;bloodstone&quot;,
[92882] = &quot;ancients&quot;,
[94218] = &quot;dugmaren&quot;,
[94219] = &quot;clangeddin&quot;,
[94220] = &quot;moradin&quot;,
[94221] = &quot;berronar&quot;,
[94222] = &quot;marthammor&quot;,
[95059] = &quot;kartagan&quot;
}

--GN hall- say 'uthgar'
--door to chief in SS- say 'ugracht'
--fire giant village- say 'annam'
--secret room in Ghore- say 'paradise'
-- citadel
--say 'shalafi'
--say 'black'
--say 'wind'
--Room on MS- say 'enigma'
--Yath Oloth- say 'athzaganaroul'
--bronze door in Demi- say 'nevarlith'
--Waterdeep graveyard- say 'Torm'
--Skerttd-Gul king- say 'Kartagan'
--Skerttd-Gul tower- say 'wine' 'sand' and 'wind' for the next room. 
--Leuthilspar gates- say 'peace'
--Kobold village- tug plank
--mines near GH- say 'glukknukkle'
--Swift Steel Merc company- say 'ssc'
--Demi tower- say 'nevarlith'
--MH mines to beholder area- say 'orlean' (sw from the dwarf corpse)
--Bloodtusk gates- say 'death', 'blood or 'war'
--CP, door to Sheik Akalon- say 'lore'
--Blood Bayou blood pool- says 'yylirmog'
--Kobold mines- say i&gt;|uub
--Longhollow- say 'selune'


echo(&quot;[Starting map import]\n&quot;)

loadMap(&quot;__&quot;)

-- read file, import from listed zones
local line

for line in io.lines(mainpath(&quot;importlist.txt&quot;)) do
--	&quot;{127,277}, --   The Nine Hells - Avernus - Bronze Citadel &quot;
-- {mud , cmud}

	local mudid= string.match(line, &quot;{([0-9]+),&quot;)
	local cmudid=string.match(line, &quot;[0-9]+,([0-9 ]+)}&quot;)
	local zonename=string.match(line, &quot;-- (.*)&quot;)

	if mudid ~= nil then
		if tonumber(cmudid) ~= nil then
			echo ( string.format(&quot;%3d %3d &gt;&gt; %s\n\n&quot;, tonumber(mudid), tonumber(cmudid), zonename ) )

			cmi:importArea(cmudid, mudid)
		end
	end
end

echo(&quot;[Adding exits]\n&quot;)
cmi:addExits(cmi.con)

echo(&quot;[Colouring rooms]\n&quot;)
cmi:colorAreas()

echo(&quot;[Labeling zone edges]\n&quot;)
cmi:labelCmudZones(cmi.con)

echo(&quot;[Adding room password information]\n&quot;)

for k,v in pairs(NyyLIB.passwords) do
	if roomExists(k) then
		echo(&quot;Room: &quot; .. k .. &quot; PW: &quot; .. v .. &quot;\n&quot;)
		setRoomUserData(k, &quot;password&quot;, v)
	else
		echo(&quot;Room: &quot; .. k .. &quot; does not exist in map\n&quot;)
	end
end

expandAlias(&quot;emptyroom&quot;)

echo(&quot;[End import]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^import$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>SQL Aliases</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>#clist</name>
                    <script>local nx
local matchchar = matches[2]:title()
local charlist

local tmpchar

if matchchar == nil then
	echo(&quot;[clist charname]\n&quot;)
	return
end

matchchar = string.lower(matches[2]):title()

cecho(&quot;&lt;red&gt;[Matching characters for &quot; .. matchchar .. &quot; as at katumi: &quot; .. NyyLIB.dbversion .. &quot;]\n\n&quot;)

if getProfile(matchchar) ~= nil then
	matchchar=getProfile(matchchar)
end

charlist = sqlclist(matchchar)

for k,v in pairs(charlist) do
	echo(string.format(&quot;[%2d %15s] %20s %-15s (@%s)\n&quot;, v[1], v[2], v[3], 
				string.format(&quot;(%s)&quot;, v[4]), v[5]))
end

cecho(&quot;&lt;red&gt;[Matching characters from local database]\n\n&quot;)

whoclist(matchchar)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#clist ?([A-Za-z]+)?</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#gall</name>
                    <script>-- create gags for all of a persons characters
local matchchar=matches[2]

if matchchar ~= nil then
	echo(&quot;[Gagging all characters for &quot; .. matchchar:title() .. &quot;]\n&quot;)

	matchchar = sqlclist(matchchar)

	for k,v in pairs(matchchar) do
		expandAlias(&quot;#gag &quot; .. v[3], false)
	end
else
	echo(&quot;usage: #gall charactername - creates a gag for all associated characters\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#gall ?([A-za-z]+)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#id </name>
                    <script>local data

cecho(&quot;&lt;red&gt;[Attempting to identify &quot; .. matches[2] .. &quot;]\n&quot;)

data = sqliditem(matches[2])

for k,v in pairs(data) do
	cecho(&quot;&lt;green&gt;&quot; .. v .. &quot;\n&quot;)
end

cecho (&quot;&lt;red&gt;[&quot; .. #data .. &quot; matches in database]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#id (.*)</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>#statitems ?(gsay)?$</name>
                    <script>local stats

local togsay = matches[2]

if NyyLIB.groupitems == nil then
	cecho(&quot;&lt;red&gt;[groupitems is nil]\n&quot;)
	return
end

for k,v in pairs(NyyLIB.groupitems) do
	stats = sqliditem(v)

	-- need to distinguish between multiple return values

	if #stats &gt; 1 then
		echo(&quot;[multiple return values]\n&quot;)
	end

	if togsay == &quot;gsay&quot; then
		if stats[1] ~= nil then
			mud:send(&quot;gsay * &quot; .. stats[1])
		else
			mud:send(&quot;gsay * &quot; .. v .. &quot; : not found in database.&quot;)
		end
	else
		if stats[1] ~= nil then
			echo(stats[1] .. &quot;\n&quot;)
		else
			echo(v .. &quot; : not found in database.\n&quot;)
		end
	end
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^#statitems ?(gsay)?$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>BOTS</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>stoptrain</name>
                    <script>if checkMask(&quot;warrior&quot;) then
	NyyLIB.smtrainposition=nil
	disableTrigger(&quot;trainstation&quot;)
	expandAlias(&quot;set statname unset&quot;, false)
else
	cecho(&quot;&lt;red&gt;[Stopping: Caster train trigger]\n&quot;)
	disableTrigger(&quot;SMTrainCaster&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^stoptrain$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>starttrain</name>
                    <script>local tankmode=matches[2]

configureTrain()

if tankmode == &quot;tank&quot; then
	trainEngine()

	echo(&quot;[Sending starting movement]\n&quot;)
	NextTrainStop()
else
	trainCar()
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^starttrain ?(tank)?$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>inittrain</name>
                    <script>if getZone() == &quot;Ashstone&quot; then
	cecho(&quot;&lt;red&gt;[Unlock path in Ashstone. This starts at Stephan]\n&quot;)
	expandAlias(&quot;#fwalk 87411&quot;, true)
	expandAlias(&quot;.w4ns4wseduwn3e2n5w2sw2sw2se4nene3se2wese2wese2wesew2s2en4e4ws2w9n4e5s2e&quot;, true)
else
	cecho(&quot;&lt;red&gt;[Unlock path in Silverymoon]\n&quot;)
	expandAlias(&quot;#fwalk 48603&quot;, true)
	expandAlias(&quot;.neswen12e2n2sw2new2nsen2snesn3w2new2s13w3s3w5neudw2s3wnew4s9e2s2w2e5sesn5esudn11w3nud3s5e7nws&quot;, true)
end

</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^inittrain$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>genseal</name>
                    <script>send(&quot;get dust &quot; .. charData:get(&quot;container&quot;) )
send(&quot;give dust lavis&quot;)
send(&quot;put scroll &quot; .. charData:get(&quot;container&quot;) )</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^genseal$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>resettrain</name>
                    <script>-- turn it off in full

NyyLIB.nextroomstop=nil
NyyLIB.castertrain=nil
NyyLIB.smtrainposition=nil

disableTrigger(&quot;trainstation&quot;)
expandAlias(&quot;set statname unset&quot;, false)

disableTrigger(&quot;SMTrainCaster&quot;)
disableTrigger(&quot;SMTrain&quot;)

if checkMask(&quot;fighter&quot;) then
	cecho(&quot;&lt;red&gt;[Setting rescue type to BASIC]\n&quot;)
	charData:set(&quot;rescuetype&quot;, &quot;basic&quot;)
	rescue(&quot;init&quot;, &quot;rescue&quot;)

	cecho(&quot;&lt;red&gt;[Disabling autobash]\n&quot;)
	charData:set(&quot;autobash&quot;, false)
	bashing(&quot;init&quot;)
end

cecho(&quot;&lt;red&gt;[All train triggers disabled]\n&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^resettrain$</regex>
                </Alias>
            </AliasGroup>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>ZoneImport</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>readobj</name>
                    <script></script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^readobj$</regex>
                </Alias>
            </AliasGroup>
            <Alias isActive="yes" isFolder="no">
                <name>test</name>
                <script>display( pet )


--display( string.match(&quot;test string&quot;, &quot;aa&quot;) )

--display( string.match( &quot;You peer into a wormhole and see&quot;, &quot;You peer into (.*) and see&quot; ) )

--	local dopplechar = string.match(spellname, &quot;^dopple (.*)&quot;)

--for k,v in pairs( groupList:pc(&quot;psi&quot;) ) do
--	display(v)
--end











-- get button number

--for i,v in pairs(NyyLIB.buttonarray) do
--	if v[1] == &quot;cure_light&quot; then
		-- button number
--		display(i)
--	end
--end




--display( string.find(&quot;aff test&quot;, &quot;^ff&quot;) )



--local mobnames=
--		{ &quot;zombie&quot;, &quot;ghoul&quot;, &quot;skeleton&quot;, &quot;wight&quot;, &quot;spectre&quot;, &quot;ghast&quot;, &quot;ghost&quot;}

--for k,v in pairs(mobnames) do
--	display(v)
--end



--if string.findPattern(&quot;2.merchant&quot;, &quot;(x[0-9]+)&quot; ) ~= nil then
--	cecho(&quot; &lt;red&gt;(x&quot; .. (tonumber(string.findPattern(string.findPattern(previousline, &quot;%(x([0-9]+)%)&quot; ), &quot;[0-9]+&quot; ))+1) .. &quot;)&quot;)
--end


--local tmp=to_snake(&quot;Globe of Invuln&quot;)

--display(tmp)

--display( to_english(tmp) )




--local scanresults = {}

--if #scanresults == 0 then
--	display(&quot;X&quot;)
--end



--	local WindowWidth, WindowHeight = getMainWindowSize()
--	local wwidth,wheight = calcFontSize(demonnic.chat.config.fontSize)

--	local tmp = (WindowWidth/3)/ wwidth
 

--display(tmp)


--	 demonnic.chat.windows[tab]:setWrap(demonnic.chat.config.width)
--   demonnic.chat.windows[tab]:setWrap(tmp) 



--labelID = createMapImageLabel(areaID, filePath, posx, posy, posz, width, height, zoom, showOnTop)

--Creates an image label on the map at the given coordinates, with the given dimensions and zoom. You might find the default room and image size correlation to be too big - try reducing the width and height of the image then, while also zooming in the same amount.
--The coordinates 0,0 are in the middle of the map, and are in sync with the room coordinates - so using the x,y values of getRoomCoordinates() will place the label near that room.
--See also: deleteMapLabel
--Example
-- 138 is our pretend area ID
-- next, inside [[]]'s, is the exact location of our image
-- 0,0,0 are the x,y,z coordinates - so this will place it in the middle of the map
-- 482 is the width of the image - we divide it by 100 to scale it down, and then we'll zoom it by 100 - making the image take up about 4 rooms in width then
-- 555 is the original width of the image
-- 100 is how much we zoom it by, 1 would be no zoom
-- and lastly, false to make it go below our rooms
--createMapImageLabel(138, [[/home/vadi/Pictures/You only see what shown.png]], 0,0,0, 482/100, 555/100, 100, false)


--display ( getAreaTable() )

--display( iconpath(&quot;back1.png&quot;) )

--local testpath=&quot;C:\\Users\\Chris\\.config\\mudlet\\profiles\\toril010rc2-2\\NyyLIB010rc2\\back1.png&quot;

--display ( createMapImageLabel(8, testpath, 46, 19, 0, 200, 200, 100, true) )



--for i,v in pairs(Geyser.Label) do

--	display(v.name)

	--display(v.name)

	--if v.name == othername then
	--	return v
	--end
--end

-- regex match
--display( string.match(&quot;You scan north...&quot;, &quot;You scan (%w)&quot;) )


--playSoundFile(&quot;\\tmp\\165331__ani-music__tubular-bell-of-death.wav&quot;)
--playSoundFile(&quot;\\tmp\\209740__yummie__minion-yahoo-2.wav&quot;)
--playSoundFile(&quot;\\tmp\\274736__sforsman__distort-ring-2.wav&quot;)
--playSoundFile(&quot;\\tmp\\85568__joelaudio__dragon-roar.wav&quot;)
--playSoundFile(&quot;\\tmp\\45809__themfish__gas-fire-catch.wav&quot;)
--sound(&quot;365641__furbyguy__8-bit-alarm.wav&quot;)
--sound(&quot;105308__kovrov__rumble.wav&quot;)
--sound(&quot;139025__rj10328__131659-bertrof-game-sound-intro-to-game-80921-justinbw-buttonchime02up-4.wav&quot;)


--local testpattern =string.gsub(&quot;test-st&quot;, &quot;-&quot;, &quot;[-]&quot;)

--if string.findPattern(&quot;thisisatest-string&quot;, testpattern) then
--	display(&quot;match&quot;)
--end



--	NyyLIB.RightLabel:move(nil, &quot;50%&quot;)

-- the entire window is 100%, just partially off screen

--	demonnic.chat.container:move(nil, 0)
--	demonnic.chat.container:resize(nil, &quot;40%&quot;)

-- iconbar = 20
-- bottomcount = 

--local bottomWindow=Geyser.Label:getWindow(&quot;gGroupStatusWindow&quot;)

--clearWindow(&quot;gGroupStatusWindow&quot;)
--bottomWindow:show()

--bottomWindow:echo( parseLine(&quot;&lt;red&gt;test1 \ntest2 \n&quot;) )
</script>
                <command></command>
                <packageName></packageName>
                <regex>^test$</regex>
            </Alias>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>Samples</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>sampleTimer</name>
                    <script>timer:set(&quot;sampleTimer&quot;, 10)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^sampleTimer$</regex>
                </Alias>
            </AliasGroup>
            <Alias isActive="yes" isFolder="no">
                <name>backstab</name>
                <script>mud:send(&quot;BS &quot; .. matches[2])
sendLook()</script>
                <command></command>
                <packageName></packageName>
                <regex>^bs (.*)</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>meph</name>
                <script>mud:send(&quot;rescue ekahk&quot;)
mud:send(&quot;rescue mephit&quot;)
mud:send(&quot;rescue 2.mephit&quot;)
mud:send(&quot;rescue 3.mephit&quot;)
mud:send(&quot;rescue 4.mephit&quot;)
mud:send(&quot;rescue 5.mephit&quot;)
mud:send(&quot;rescue slaad&quot;)</script>
                <command></command>
                <packageName></packageName>
                <regex>^meph$</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>solvescan</name>
                <script>local xid = solveScan()

if xid ~= nil then
	map:setRoom(xid)
	centerview( map:getRoom() )

	echo(&quot;Set room to: &quot; .. xid .. &quot;\n&quot;)
end</script>
                <command></command>
                <packageName></packageName>
                <regex>^solvescan$</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>pracall</name>
                <script>if table.size(toPractice) == 0 then
	cecho(&quot;&lt;red&gt;[No skills to practice]\n&quot;)
	return
end

for k,v in pairs(toPractice) do
	-- display(k)
	mud:send(&quot;prac &quot; .. k)
	toPractice[k]=nil
end</script>
                <command></command>
                <packageName></packageName>
                <regex>^pracall$</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>scribeall</name>
                <script>if table.size(toScribe) == 0 then
	cecho(&quot;&lt;red&gt;[No spells to scribe]\n&quot;)
	return
end

if matches[2] == &quot;start&quot; then
	for k,v in pairs(toScribe) do
		mud:send(&quot;prac &quot; .. k)
		toScribe[k]=nil
		return
	end

	return
end

cecho(&quot;\n&lt;red&gt;[Type: 'scribeall start' to begin scribing the following spells:]\n&quot;)

for k,v in pairs(toScribe) do
	cecho(&quot;&lt;green&gt;&quot; .. k .. &quot;\n&quot;)
end

echo(&quot;\n&quot;)
</script>
                <command></command>
                <packageName></packageName>
                <regex>^scribeall ?(start)?$</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>order</name>
                <script>mud:send(&quot;ORDER &quot; .. matches[2])</script>
                <command></command>
                <packageName></packageName>
                <regex>^o (.*)</regex>
            </Alias>
            <AliasGroup isActive="yes" isFolder="yes">
                <name>CapturePowers</name>
                <script></script>
                <command></command>
                <packageName></packageName>
                <regex></regex>
                <Alias isActive="yes" isFolder="no">
                    <name>genalias</name>
                    <script>sortpowerslist={}

for nx=#powerslist,1,-1 do
	mud:send(&quot;powers info &quot; .. powerslist[nx][1])
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^genalias$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>showalias</name>
                    <script>-- sortpowerslist[#sortpowerslist+1] = {to_snake(powername), matches[2]:trim(), level, &quot;&quot;, &quot;&quot;}


for nx=1,#sortpowerslist,1 do
	echo(&quot;{ &quot; .. [[&quot;]] .. sortpowerslist[nx][1] .. [[&quot;, &quot;]] .. sortpowerslist[nx][2] .. [[&quot;, ]] .. sortpowerslist[nx][3] .. [[, &quot;&quot;, &quot;&quot;},]] .. &quot;\n&quot;)
end</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^showalias$</regex>
                </Alias>
                <Alias isActive="yes" isFolder="no">
                    <name>classpowers</name>
                    <script>powerslist = {}

mud:send(&quot;powers list&quot;)

tempTimer(5, &quot;genalias&quot;)</script>
                    <command></command>
                    <packageName></packageName>
                    <regex>^classpowers$</regex>
                </Alias>
            </AliasGroup>
            <Alias isActive="yes" isFolder="no">
                <name>claimall</name>
                <script>mud:send(&quot;auction list &quot; .. whoami() )</script>
                <command></command>
                <packageName></packageName>
                <regex>^claimall$</regex>
            </Alias>
            <Alias isActive="yes" isFolder="no">
                <name>reset</name>
                <script>spell:setMoving(false)</script>
                <command></command>
                <packageName></packageName>
                <regex>^reset$</regex>
            </Alias>
        </AliasGroup>
    </AliasPackage>
    <ActionPackage/>
    <ScriptPackage>
        <ScriptGroup isActive="yes" isFolder="yes">
            <name>NyyLIB</name>
            <packageName></packageName>
            <script></script>
            <eventHandlerList/>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>ImportedCode</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>chef</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-- Copyright (C) 2009 Florian Zeitz
-- Copyright (C) 2009 Matthew Wild
--
-- This project is MIT/X11 licensed. Please see the
-- COPYING file in the source package for more information.
--

local chef = {
  { th = &quot;t&quot; },

  { ow = &quot;o&quot;},
  {[&quot;([^%w])o&quot;] = &quot;%1oo&quot;,
  O = &quot;Oo&quot;},

  {au = &quot;oo&quot;,
  u = &quot;oo&quot;, U = &quot;Oo&quot;},
  {[&quot;([^o])o([^o])&quot;] = &quot;%1u%2&quot;},
  {ir = &quot;ur&quot;,

  an = &quot;un&quot;, An = &quot;Un&quot;, Au = &quot;Oo&quot;},

  {e = &quot;i&quot;, E = &quot;I&quot;},

  { i = function () return select(math.random(2), &quot;i&quot;, &quot;ee&quot;); end },

  {a = &quot;e&quot;, A = &quot;E&quot;},

  {[&quot;e([^%w])&quot;] = &quot;e-a%1&quot;},
  {f = &quot;ff&quot;},

  {v = &quot;f&quot;, V = &quot;F&quot;},
  {w = &quot;v&quot;, W = &quot;V&quot;} };

function swedish(english)
	local eng, url = english:match(&quot;(.*)(http://.*)$&quot;);
	if eng then english = eng; end

	for _,v in ipairs(chef) do
		for k,v in pairs(v) do
			english = english:gsub(k,v);
		end
	end
	english = english:gsub(&quot;the&quot;, &quot;zee&quot;);
	english = english:gsub(&quot;The&quot;, &quot;Zee&quot;);
	english = english:gsub(&quot;tion&quot;, &quot;shun&quot;);
	--english = english:gsub(&quot;[.!?]$&quot;, &quot;%1\nBork Bork Bork!&quot;);
	return tostring(english..((url and url) or &quot;&quot;));
end

function check_message(data)
	local origin, stanza = data.origin, data.stanza;

	local body, bodyindex;
	for k,v in ipairs(stanza) do
		if v.name == &quot;body&quot; then
			body, bodyindex = v, k;
		end
	end

	if not body then return; end
	body = body:get_text();

	if body and (body:find(trigger_string, 1, true) == 1) then
		module:log(&quot;debug&quot;, body:find(trigger_string, 1, true));
		stanza[bodyindex][1] = swedish(body:gsub(&quot;^&quot; .. trigger_string, &quot;&quot;, 1));
	end
end


</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>LuaBit v0.4</name>
                    <packageName></packageName>
                    <script>------------------------------------------------
--LuaBit v0.4
-------------------
--a bitwise operation lib for lua.

--http://luaforge.net/projects/bit/

--How to use:
-------------------
-- bit.bnot(n) -- bitwise not (~n)
-- bit.band(m, n) -- bitwise and (m &amp; n)
-- bit.bor(m, n) -- bitwise or (m | n)
-- bit.bxor(m, n) -- bitwise xor (m ^ n)
-- bit.brshift(n, bits) -- right shift (n &gt;&gt; bits)
-- bit.blshift(n, bits) -- left shift (n &lt;&lt; bits)
-- bit.blogic_rshift(n, bits) -- logic right shift(zero fill &gt;&gt;&gt;)
 
--Please note that bit.brshift and bit.blshift only support number within
--32 bits.

--2 utility functions are provided too:
-- bit.tobits(n) -- convert n into a bit table(which is a 1/0 sequence)
               -- high bits first
-- bit.tonumb(bit_tbl) -- convert a bit table into a number 
-------------------

--Under the MIT license.

--copyright(c) 2006~2007 hanzhao (abrash_han@hotmail.com)
--]]---------------


------------------------
-- bit lib implementions

function check_int(n)
 -- checking not float
 if(n - math.floor(n) &gt; 0) then
  error(&quot;trying to use bitwise operation on non-integer!&quot;)
 end
end

local function to_bits(n)
 check_int(n)
 if(n &lt; 0) then
  -- negative
  return to_bits(bit.bnot(math.abs(n)) + 1)
 end
 -- to bits table
 local tbl = {}
 local cnt = 1
 while (n &gt; 0) do
  local last = math.mod(n,2)
  if(last == 1) then
   tbl[cnt] = 1
  else
   tbl[cnt] = 0
  end
  n = (n-last)/2
  cnt = cnt + 1
 end

 return tbl
end

function tbl_to_number(tbl)
 local n = table.getn(tbl)

 local rslt = 0
 local power = 1
 for i = 1, n do
  rslt = rslt + tbl[i]*power
  power = power*2
 end
 
 return rslt
end

function expand(tbl_m, tbl_n)
 local big = {}
 local small = {}
 if(table.getn(tbl_m) &gt; table.getn(tbl_n)) then
  big = tbl_m
  small = tbl_n
 else
  big = tbl_n
  small = tbl_m
 end
 -- expand small
 for i = table.getn(small) + 1, table.getn(big) do
  small[i] = 0
 end

end

function bit_or(m, n)
 local tbl_m = to_bits(m)
 local tbl_n = to_bits(n)
 expand(tbl_m, tbl_n)

 local tbl = {}
 local rslt = math.max(table.getn(tbl_m), table.getn(tbl_n))
 for i = 1, rslt do
  if(tbl_m[i]== 0 and tbl_n[i] == 0) then
   tbl[i] = 0
  else
   tbl[i] = 1
  end
 end
 
 return tbl_to_number(tbl)
end

function bit_and(m, n)
 local tbl_m = to_bits(m)
 local tbl_n = to_bits(n)
 expand(tbl_m, tbl_n) 

 local tbl = {}
 local rslt = math.max(table.getn(tbl_m), table.getn(tbl_n))
 for i = 1, rslt do
  if(tbl_m[i]== 0 or tbl_n[i] == 0) then
   tbl[i] = 0
  else
   tbl[i] = 1
  end
 end

 return tbl_to_number(tbl)
end

function bit_not(n)
 
 local tbl = to_bits(n)
 local size = math.max(table.getn(tbl), 32)
 for i = 1, size do
  if(tbl[i] == 1) then 
   tbl[i] = 0
  else
   tbl[i] = 1
  end
 end
 return tbl_to_number(tbl)
end

function bit_xor(m, n)
 local tbl_m = to_bits(m)
 local tbl_n = to_bits(n)
 expand(tbl_m, tbl_n) 

 local tbl = {}
 local rslt = math.max(table.getn(tbl_m), table.getn(tbl_n))
 for i = 1, rslt do
  if(tbl_m[i] ~= tbl_n[i]) then
   tbl[i] = 1
  else
   tbl[i] = 0
  end
 end
 
 --table.foreach(tbl, print)

 return tbl_to_number(tbl)
end

function bit_rshift(n, bits)
 check_int(n)
 
 local high_bit = 0
 if(n &lt; 0) then
  -- negative
  n = bit_not(math.abs(n)) + 1
  high_bit = 2147483648 -- 0x80000000
 end

 for i=1, bits do
  n = n/2
  n = bit_or(math.floor(n), high_bit)
 end
 return math.floor(n)
end

-- logic rightshift assures zero filling shift
function bit_logic_rshift(n, bits)
 check_int(n)
 if(n &lt; 0) then
  -- negative
  n = bit_not(math.abs(n)) + 1
 end
 for i=1, bits do
  n = n/2
 end
 return math.floor(n)
end

function bit_lshift(n, bits)
 check_int(n)
 
 if(n &lt; 0) then
  -- negative
  n = bit_not(math.abs(n)) + 1
 end

 for i=1, bits do
  n = n*2
 end
 return bit_and(n, 4294967295) -- 0xFFFFFFFF
end

function bit_xor2(m, n)
 local rhs = bit_or(bit_not(m), bit_not(n))
 local lhs = bit_or(m, n)
 local rslt = bit_and(lhs, rhs)
 return rslt
end

--------------------
-- bit lib interface

bit = {
 -- bit operations
 bnot = bit_not,
 band = bit_and,
 bor  = bit_or,
 bxor = bit_xor,
 brshift = bit_rshift,
 blshift = bit_lshift,
 bxor2 = bit_xor2,
 blogic_rshift = bit_logic_rshift,

 -- utility func
 tobits = to_bits,
 tonumb = tbl_to_number,
}
</script>
                    <eventHandlerList/>
                </Script>
                <ScriptGroup isActive="yes" isFolder="yes">
                    <name>Demonnic</name>
                    <packageName></packageName>
                    <script></script>
                    <eventHandlerList/>
                    <ScriptGroup isActive="yes" isFolder="yes">
                        <name>Tabbed Chat</name>
                        <packageName></packageName>
                        <script>--Do not remove the following lines. Or change them.
demonnic = demonnic or {}
demonnic.chat = demonnic.chat or {}
demonnic.chat.tabsToBlink = demonnic.chat.tabsToBlink or {}
demonnic.chat.config = demonnic.chat.config or {}
demonnic.chat.tabs = demonnic.chat.tabs or {}
demonnic.chat.windows = demonnic.chat.windows or {}
demonnic.chat.config.activeColors = demonnic.chat.config.activeColors or {}
demonnic.chat.config.inactiveColors = demonnic.chat.config.inactiveColors or {}</script>
                        <eventHandlerList/>
                        <Script isActive="yes" isFolder="no">
                            <name>Configuration Options</name>
                            <packageName></packageName>
                            <script>--[[
This is where all of the configuration options can be set. 
Anything I've put in this script object can be changed, but please do pay attention to what you're doing.
If you change one of the values to something it shouldn't be, you could break it. 
]]

--This is where you tell it to use tabbed chat.
demonnic.chat.use = true

--[[
The timestamp option is set here.
Set to false if you do not want any timestamps displayed for chat.
If you do want it displayed, set to the string for the format you wish. 
see http://wiki.mudlet.org/w/Manual:Lua_Functions#getTime for information
how to format the string
]]
demonnic.chat.config.timestamp = false

--[[ Should we use our own colors for the timestamp?
Set to true if you want to specify foreground and background colors
for the timestamp.
Set to false if you want the timestamps background and foreground
colors to match that of the mud output.
]]
demonnic.chat.config.timestampCustomColor = false
--[[
and what foreground color? You can either use one of the 'named' colors
(see http://wiki.mudlet.org/images/c/c3/ShowColors.png for available colors)
demonnic.chat.config.timestampFG = &quot;slate_grey&quot;

Or you can use a table of R,G,B values. 
demonnic.chat.config.timestampFG = {
  255,
    0,
    0,
}
then the foreground for the timestamp would be 255 read, 100 green, and 0 blue
]]
demonnic.chat.config.timestampFG = &quot;red&quot;

--and background? Same rules as for the foreground above
demonnic.chat.config.timestampBG = &quot;blue&quot;

--[[
This is where you say what corner of the screen you want the tabbed chat on
Valid settings are &quot;topright&quot;, &quot;topleft&quot;, &quot;bottomright&quot;, &quot;bottomleft&quot;
]]--
demonnic.chat.config.location = &quot;topright&quot;

--[[
This is a table of channels you would like.
AKA the place you tell the script what tabs you want.
Each entry must be a string. The defaults should be a pretty effective guide.
]]

demonnic.chat.config.channels = {
  &quot;ALL&quot;,
	&quot;SAYS&quot;,
	&quot;SKILL&quot;,
  &quot;TELLS&quot;,
  &quot;GSAY&quot;,
  &quot;NHC&quot;,
  &quot;GCC&quot;,
  &quot;OOC&quot;,
  &quot;ACC&quot;,
  &quot;AUC&quot;
}


--Set this to the name of the channel you want to have everything sent to. 
--Per the default, this would be the &quot;All&quot; channel. If you have a different name for it:
--
--demonnic.chat.config.Alltab = &quot;Bucket&quot;  
--
--And if you don't want it turned on at all:
--
--demonnic.chat.config.Alltab = false

demonnic.chat.config.Alltab = &quot;ALL&quot;



---------------------------------------------------------------------------------
--                                                                             --
--The infamous blinking stuff!!!                                               --
--                                                                             --
---------------------------------------------------------------------------------

--[[
Do you want tabs to blink when you get new messages, until you click on the tab?
True if yes, false if no.
]]
demonnic.chat.config.blink = true

--How long (in seconds) between blinks? For example, 1 would mean a 1 second pause in between blinks.
demonnic.chat.config.blinkTime = 3

--Blink if the bucket tab (&quot;All&quot; by default, but configured above) is in focus?
demonnic.chat.config.blinkFromAll = true




--Font size for the chat messages

demonnic.chat.config.fontSize = 12

--[[
Should we preserve the formatting of the text. 
Or should we set the background of it to match the window color?
Set this to false if you want the background for all chat to match the background of the window.
Useful if you change the background from black, and don't like the way the pasted chat makes blocks in it
]]

demonnic.chat.config.preserveBackground = false

--[[
Gag the chat lines in the main window?
defaults to false, set to true if you want to gag.
]]

demonnic.chat.config.gag = false

--[[
Number of lines of chat visible at once. 
Will determine how tall the window for the chats is.
]]

-- demonnic.chat.config.lines = 19

--[[
Number of characters to wrap the chatlines at.
This will also determine how wide the chat windows are.
]]

demonnic.chat.config.width = 90

--[[
Set the color for the active tab. R,G,B format.
The default here is a brightish green
]]

demonnic.chat.config.activeColors = {
  r = 0,
  g = 180,
  b = 0,
}

--[[
Set the color for the inactive tab. R,G,B format.
The default here is a drab grey
]]

demonnic.chat.config.inactiveColors = {
  r = 60,
  g = 60,
  b = 60,
}

--[[
Set the color for the chat window itself. R,G,B format.
Defaulted to the black of my twisted hardened soul. Or something.
]]

demonnic.chat.config.windowColors = {
  r = 0,
  g = 0,
  b = 0,
}

--[[
Set the color for the text on the active tab. Uses color names.
Set the default to purple. So the tab you're looking at, by default will be purple on bright green. 
Did I mention I'm a bit colorblind?
]]

demonnic.chat.config.activeTabText = &quot;purple&quot;

--[[
Set the color for the text on the inactive tabs. Uses color names.
Defaulted this to white. So the tabs you're not looking at will be white text on boring grey background.
]]

demonnic.chat.config.inactiveTabText = &quot;white&quot;

--[[
have to make sure a currentTab is set... 
so we'll use the one for the bucket, or the first one in the channels table
Or, you know... what it's currently set to, if it's already set.
]]
demonnic.chat.currentTab = demonnic.chat.currentTab or demonnic.chat.config.Alltab or demonnic.chat.config.channels[1]
</script>
                            <eventHandlerList/>
                        </Script>
                        <Script isActive="yes" isFolder="no">
                            <name>Code</name>
                            <packageName></packageName>
                            <script>--[[
If the label callbacks ever decide to start taking a function which is part of a table, 0then this will change.
Or if it's modified to take actual functions. Anonymouse function clickcallback would be awfully nice.
]]

function demonnicChatSwitch(chat)
  local r = demonnic.chat.config.inactiveColors.r
  local g = demonnic.chat.config.inactiveColors.g
  local b = demonnic.chat.config.inactiveColors.b
  local newr = demonnic.chat.config.activeColors.r
  local newg = demonnic.chat.config.activeColors.g
  local newb = demonnic.chat.config.activeColors.b
  local oldchat = demonnic.chat.currentTab
  if demonnic.chat.currentTab ~= chat then

	 demonnic.chat.tabs[oldchat]:setStyleSheet([[border-image: url(]] .. iconpath(&quot;gui&quot;.. oldchat  .. &quot;.png&quot;) .. [[)]])

    demonnic.chat.windows[oldchat]:show()
    demonnic.chat.windows[oldchat]:hide()
    demonnic.chat.tabs[oldchat]:setColor(r,g,b)
    -- demonnic.chat.tabs[oldchat]:echo(oldchat, demonnic.chat.config.inactiveTabText, &quot;c&quot;)
    if demonnic.chat.config.blink and demonnic.chat.tabsToBlink[chat] then
      demonnic.chat.tabsToBlink[chat] = nil
    end
    if demonnic.chat.config.blink and chat == demonnic.chat.config.Alltab then
      demonnic.chat.tabsToBlink = {}
    end
  end
  demonnic.chat.tabs[chat]:setColor(newr,newg,newb)
  -- demonnic.chat.tabs[chat]:echo(chat, demonnic.chat.config.activeTabText, &quot;c&quot;)
  demonnic.chat.windows[chat]:show()


  demonnic.chat.tabs[chat]:setStyleSheet([[border-image: url(]] .. iconpath(&quot;gui&quot;.. chat  .. &quot;-on.png&quot;) .. [[)]])



  demonnic.chat.currentTab = chat  
end

function demonnic.chat:resetUI()

	demonnic.chat.container = Geyser.Container:new( {
    fontSize = demonnic.chat.config.fontSize,
--  x=string.format(&quot;-%sc&quot;,demonnic.chat.config.width + 2),
	 x=0,
    y=0,
    width=&quot;100%&quot;,
--  width=&quot;-15px&quot;,
--    height=string.format(&quot;%ic&quot;, demonnic.chat.config.lines + 2),
	 height=&quot;40%&quot;
  }, Geyser.Label:getWindow(&quot;RightPanel&quot;) )

  demonnic.chat.tabBox = Geyser.HBox:new({
    x=0,
    y=0,
    width = &quot;100%&quot;,
    height = &quot;25px&quot;,
    name = &quot;DemonChatTabs&quot;,
  },demonnic.chat.container)

end

function demonnic.chat:create()
  --reset the UI
  demonnic.chat:resetUI()
  --Set some variables locally to increase readability
  local r = demonnic.chat.config.inactiveColors.r
  local g = demonnic.chat.config.inactiveColors.g
  local b = demonnic.chat.config.inactiveColors.b
  local winr = demonnic.chat.config.windowColors.r
  local wing = demonnic.chat.config.windowColors.g
  local winb = demonnic.chat.config.windowColors.b

  --iterate the table of channels and create some windows and tabs
  for i,tab in ipairs(demonnic.chat.config.channels) do
    demonnic.chat.tabs[tab] = Geyser.Label:new({
      name=string.format(&quot;tab%s&quot;, tab),
    }, demonnic.chat.tabBox)


	demonnic.chat.tabs[tab]:setStyleSheet([[border-image: url(]] .. iconpath(&quot;gui&quot;.. tab  .. &quot;.png&quot;) .. [[)]])






    -- demonnic.chat.tabs[tab]:echo(tab, demonnic.chat.config.inactiveTabText, &quot;c&quot;)
    demonnic.chat.tabs[tab]:setColor(r,g,b)
    demonnic.chat.tabs[tab]:setClickCallback(&quot;demonnicChatSwitch&quot;, tab)

    demonnic.chat.windows[tab] = Geyser.MiniConsole:new({
--      fontSize = demonnic.chat.config.fontSize,
      x = 0,
      y = 25,
      height = &quot;100%&quot;,
      width = &quot;100%&quot;,
      name = string.format(&quot;win%s&quot;, tab),
    }, demonnic.chat.container)
    demonnic.chat.windows[tab]:setFontSize(demonnic.chat.config.fontSize)
    demonnic.chat.windows[tab]:setColor(winr,wing,winb)
    

	local WindowWidth, WindowHeight = getMainWindowSize()
	local wwidth,wheight = calcFontSize(demonnic.chat.config.fontSize)

	local tmp = (WindowWidth/3)/ wwidth
 
--	 demonnic.chat.windows[tab]:setWrap(demonnic.chat.config.width)
   demonnic.chat.windows[tab]:setWrap(tmp) 
   demonnic.chat.windows[tab]:show()
   demonnic.chat.windows[tab]:hide()
  end
  local showme = demonnic.chat.config.Alltab or demonnic.chat.config.channels[1]
  demonnicChatSwitch(showme)
  --start the blink timers, if enabled
  if demonnic.chat.config.blink and not demonnic.chat.blinkTimerOn then
    demonnic.chat:blink()
  end
end


function demonnic.chat:redo()
	local WindowWidth, WindowHeight = getMainWindowSize()
	local wwidth,wheight = calcFontSize(demonnic.chat.config.fontSize)
	
	if charData:get(&quot;chatfontsize&quot;, true) == &quot;auto&quot; then
		demonnic.chat.config.fontSize= maxfont(60, (WindowWidth/3-15))
	
		if demonnic.chat.config.fontSize &gt; 12 then
			demonnic.chat.config.fontSize = 12
		end	
	else
		demonnic.chat.config.fontSize= tonumber(charData:get(&quot;chatfontsize&quot;, true))
	end

	wwidth,wheight = calcFontSize(demonnic.chat.config.fontSize)	

  --iterate the table of channels and redo wrap, fontsize
  for i,tab in ipairs(demonnic.chat.config.channels) do
    demonnic.chat.windows[tab]:setFontSize(demonnic.chat.config.fontSize)
 	 demonnic.chat.windows[tab]:setWrap( (WindowWidth/3)/wwidth ) 
  end
end

function demonnic.chat:append(chat)
  local r = demonnic.chat.config.windowColors.r
  local g = demonnic.chat.config.windowColors.g
  local b = demonnic.chat.config.windowColors.b


	local roomline = getLines(getLineCount(), getLineCount()-1)[1]

	-- check if broken packet/line on same line as prompt

	if roomline == nil then
		echo(&quot;[ERROR: nil roomline]\n&quot;)
	end

	local linecheck = string.find(roomline, &quot;^&lt; .* &gt; &quot;)

	if linecheck ~= nil then
		linecheck = string.find(roomline, &quot;&gt; &quot;)
	end

	if linecheck ~= nil then
		-- include part line without prompt
		selectSection(linecheck+1, string.len(roomline)-linecheck-1)
	else
	-- include full line in capture window
		selectCurrentLine()
	end

	-- don't echo [] gsay, or empty lines

	if getCurrentLine() == nil then
		return
	end

	if getCurrentLine() == &quot;&quot; then
		return
	end

	-- don't capture wormhole requests

--	linecheck = string.find(roomline, &quot;^.* 'worm|well|hole|wormhole .*&quot;)
	linecheck = string.find(roomline, &quot;.* tells you 'hole .*&quot;)

	if linecheck ~= nil then
		return
	end

	linecheck = string.find(roomline, &quot;.* tells you 'hol .*&quot;)

	if linecheck ~= nil then
		return
	end

	linecheck = string.find(roomline, &quot;.* tells you 'worm .*&quot;)

	if linecheck ~= nil then
		return
	end

	linecheck = string.find(roomline, &quot;.* tells you 'wormhole .*&quot;)

	if linecheck ~= nil then
		return
	end

	-- don't capture rift requests
	linecheck = string.find(roomline, &quot;.* tells you 'rift .*&quot;)

	if linecheck ~= nil then
		return
	end

	-- don't capture [] messages

	linecheck = string.find(roomline, &quot;'%[&quot;)

	if linecheck ~= nil then
		linecheck = string.find(roomline, &quot;%]'&quot;)

		if linecheck ~= nil then
			linecheck = string.find(roomline, &quot;%]%]'&quot;)

			if linecheck ~= nil then
				linecheck = nil
			else
				linecheck = 1
			end
		end

		if linecheck ~= nil then
			return
		end
	end

  --selectCurrentLine()

  local ofr,ofg,ofb = getFgColor()
  local obr,obg,obb = getBgColor()
  if demonnic.chat.config.preserveBackground then
    setBgColor(r,g,b)
  end
  copy()
  
  if chat ~= &quot;petition&quot; then
	  demonnic.chat.windows[chat]:append()
	end

  if demonnic.chat.config.gag then 
    eraseLine() 
    tempLineTrigger(1,1, [[if isPrompt() then deleteLine() end]])
  end
  if demonnic.chat.config.Alltab then appendBuffer(string.format(&quot;win%s&quot;, demonnic.chat.config.Alltab)) end
  if demonnic.chat.config.blink and chat ~= demonnic.chat.currentTab then 
    if (demonnic.chat.config.Alltab == demonnic.chat.currentTab) and not demonnic.chat.config.blinkOnAll then
      return
    else
		if chat ~= &quot;petition&quot; then
	      demonnic.chat.tabsToBlink[chat] = true
		end
    end
  end
end



function demonnic.chat:blink()
  if demonnic.chat.blinkID then killTimer(demonnic.chat.blinkID) end
  if not demonnic.chat.config.blink then 
    demonnic.chat.blinkTimerOn = false
    return 
  end
  for tab,_ in pairs(demonnic.chat.tabsToBlink) do
    demonnic.chat.tabs[tab]:flash()
  end
  demonnic.chat.blinkID = tempTimer(demonnic.chat.config.blinkTime, function () demonnic.chat:blink() end)
end
</script>
                            <eventHandlerList/>
                        </Script>
                        <Script isActive="yes" isFolder="no">
                            <name>demonnicOnStart</name>
                            <packageName></packageName>
                            <script>function demonnicOnStart()
	cecho(&quot;&lt;red&gt;[Initializing chat windows...]\n&quot;)

	local WindowWidth, WindowHeight = getMainWindowSize()

	NyyLIB = NyyLIB or {}

	setBorderRight(math.ceil(WindowWidth/3)+15)	

	createRightsideContainers()
	createLeftsideContainers()

	-- if demonnic.chat.use then
	demonnic.chat:create()
  	-- end

	cecho(&quot;&lt;red&gt;[Chat containers created]\n&quot;)
end</script>
                            <eventHandlerList/>
                        </Script>
                        <Script isActive="yes" isFolder="no">
                            <name>echo functions</name>
                            <packageName></packageName>
                            <script>
function demonnic.chat:cecho(chat, message)
  local alltab = demonnic.chat.config.Alltab
  local blink = demonnic.chat.config.blink
  cecho(string.format(&quot;win%s&quot;,chat), message)
  if alltab and chat ~= alltab then 
    cecho(string.format(&quot;win%s&quot;, alltab), message)
  end
  if blink and chat ~= demonnic.chat.currentTab then
    if (alltab == demonnic.chat.currentTab) and not demonnic.chat.config.blinkOnAll then
      return
    else
      demonnic.chat.tabsToBlink[chat] = true
    end
  end
end

function demonnic.chat:decho(chat, message)
  local alltab = demonnic.chat.config.Alltab
  local blink = demonnic.chat.config.blink
  decho(string.format(&quot;win%s&quot;,chat), message)
  if alltab and chat ~= alltab then 
    decho(string.format(&quot;win%s&quot;, alltab), message)
  end
  if blink and chat ~= demonnic.chat.currentTab then
    if (alltab == demonnic.chat.currentTab) and not demonnic.chat.config.blinkOnAll then
      return
    else
      demonnic.chat.tabsToBlink[chat] = true
    end
  end
end

function demonnic.chat:hecho(chat, message)
  local alltab = demonnic.chat.config.Alltab
  local blink = demonnic.chat.config.blink
  hecho(string.format(&quot;win%s&quot;,chat), message)
  if alltab and chat ~= alltab then 
    hecho(string.format(&quot;win%s&quot;, alltab), message)
  end
  if blink and chat ~= demonnic.chat.currentTab then
    if (alltab == demonnic.chat.currentTab) and not demonnic.chat.config.blinkOnAll then
      return
    else
      demonnic.chat.tabsToBlink[chat] = true
    end
  end
end

function demonnic.chat:echo(chat, message)
  local alltab = demonnic.chat.config.Alltab
  local blink = demonnic.chat.config.blink
  echo(string.format(&quot;win%s&quot;,chat), message)
  if alltab and chat ~= alltab then 
    echo(string.format(&quot;win%s&quot;, alltab), message)
  end
  if blink and chat ~= demonnic.chat.currentTab then
    if (alltab == demonnic.chat.currentTab) and not demonnic.chat.config.blinkOnAll then
      return
    else
      demonnic.chat.tabsToBlink[chat] = true
    end
  end
end</script>
                            <eventHandlerList/>
                        </Script>
                        <Script isActive="yes" isFolder="no">
                            <name>geyser additions</name>
                            <packageName></packageName>
                            <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function Geyser.MiniConsole:clear()
   clearWindow(self.name)
end

function Geyser.MiniConsole:append()
  appendBuffer(self.name)
end</script>
                            <eventHandlerList/>
                        </Script>
                    </ScriptGroup>
                </ScriptGroup>
            </ScriptGroup>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>ClassScripts</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>SingerScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initCtr()
	initBar()
end

function initBar()
	setSpellCount(&quot;harmonious_blessing&quot;, 3)

	charData:init(&quot;song&quot;, &quot;&quot;)
	charData:init(&quot;_song&quot;, &quot;&quot;)
	charData:init(&quot;effect&quot;, &quot;&quot;)
	charData:init(&quot;_wield&quot;, 0)

	charData:init(&quot;instrument&quot;, &quot;&quot;)

	NyyLIB.songtimer = &quot;&quot;
	NyyLIB.accompany = 0

	addbutton(&quot;barBless&quot;, 1, 41)
	addbutton(&quot;StopMusic&quot;, 2, 0)

	if charData:get(&quot;level&quot;) &gt;= 31 then
		addbutton(&quot;HealSong&quot;, 3, 31)
	else
		addbutton(&quot;RegenSong&quot;, 3, 1)
	end

	addbutton(&quot;HasteSong&quot;, 4, 11)
	addbutton(&quot;SlowSong&quot;, 5, 11)
	addbutton(&quot;HarmSong&quot;, 6, 41)
	addbutton(&quot;RenewSong&quot;,7, 11)
	addbutton(&quot;ProtectSong&quot;,8, 1)
	addbutton(&quot;TravelSong&quot;,9, 31)
	addbutton(&quot;Accompany&quot;,10, 20)
end

function resetSongs()

	if charData:get(&quot;level&quot;) &gt;= 31 then
		HealSong(&quot;init&quot;)
	else
		RegenSong(&quot;init&quot;)
	end

	HasteSong(&quot;init&quot;)
	SlowSong(&quot;init&quot;)
	HarmSong(&quot;init&quot;)
	RenewSong(&quot;init&quot;)
	ProtectSong(&quot;init&quot;)
	--TravelSong(&quot;init&quot;)
end

function barBless(xcommand)
	shiftSkillButton(&quot;barBless&quot;, &quot;autobless&quot;, xcommand)
end

function StopMusic(xcommand)
	local fname=&quot;StopMusic&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;stopmusic.png&quot;)
	else
		mud:send(&quot;stopmusic&quot;)
	end
end

function HealSong(xcommand)
	local fname=&quot;HealSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barHeal-off.png&quot;)
	else
		mud:send(&quot;heal&quot;)
	end
end

function RegenSong(xcommand)
	local fname=&quot;RegenSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barRegen-off.png&quot;)
	else
		mud:send(&quot;regen&quot;)
	end
end

function HasteSong(xcommand)
	local fname=&quot;HasteSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barHaste-off.png&quot;)
	else
		mud:send(&quot;haste&quot;)
	end
end

function RenewSong(xcommand)
	local fname=&quot;RenewSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barRenew-off.png&quot;)
	else
		mud:send(&quot;renew&quot;)
	end
end

function HarmSong(xcommand)
	local fname=&quot;HarmSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barHarm-off.png&quot;)
	else
		mud:send(&quot;harm&quot;)
	end
end

function SlowSong(xcommand)
	local fname=&quot;SlowSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barSlow-off.png&quot;)
	else
		mud:send(&quot;slow&quot;)
	end
end

function TravelSong(xcommand)
	local fname=&quot;TravelSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barTravel-off.png&quot;)
	else
		mud:send(&quot;travel&quot;)
	end
end

function ProtectSong(xcommand)
	local fname=&quot;ProtectSong&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barProtect-off.png&quot;)
	else
		mud:send(&quot;prot&quot;)
	end
end

function Accompany(xcommand)
	local fname=&quot;Accompany&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;barAccompany-off.png&quot;)
	else
		mud:send(&quot;accompany&quot;)
	end
end

function music(xinstrument, xsong, xtarget)
	if checkMask(&quot;singer&quot;) == false then
		return
	end

	charData:set(&quot;_switch&quot;, 1)
	charData:set(&quot;new_i&quot;, xinstrument)
	switch()
	charData:set(&quot;song&quot;, xsong)
	charData:set(&quot;effect&quot;, xtarget)
	playsong()
	charData:set(&quot;_switch&quot;, 0)
end

function playsong()
 local song=charData:get(&quot;song&quot;)
 local effect=charData:get(&quot;effect&quot;)

 if song ~= &quot;&quot; then
   if effect == &quot;&quot; then
     mud:send(&quot;sing '&quot; .. song .. &quot;'&quot;)
   else
     mud:send(&quot;sing '&quot; .. song .. &quot;' &quot; .. effect )
   end
 end
end

function switch()
 local gigbag=charData:get(&quot;gigbag&quot;)

 if charData:get(&quot;song&quot;) ~= &quot;&quot; then
	mud:send(&quot;play&quot;)
 end

 if charData:get(&quot;_wield&quot;) ~= 1 then
  if charData:get(&quot;instrument&quot;) ~= charData:get(&quot;new_i&quot;) then
	if charData:get(&quot;instrument&quot;) ~= '&quot;&quot;' then
	 mud:send(&quot;rem &quot; .. charData:get(&quot;instrument&quot;))

	 if gigbag ~= '&quot;&quot;' then
	 	mud:send(&quot;put &quot; .. charData:get(&quot;instrument&quot;) .. &quot; &quot; .. gigbag )
    end
	 charData:set(&quot;instrument&quot;, &quot;&quot;)
   end
 
	if charData:get(&quot;new_i&quot;) ~= '&quot;&quot;' then
		if gigbag ~= '&quot;&quot;' then
			mud:send(&quot;get &quot; .. charData:get(&quot;new_i&quot;) .. &quot; &quot; .. gigbag )
   		end
	end

	charData:set(&quot;instrument&quot;, charData:get(&quot;new_i&quot;) )

	if charData:get(&quot;new_i&quot;) ~= '&quot;&quot;' then
	   mud:send(&quot;hold &quot; .. charData:get(&quot;new_i&quot;) )
	end
  end
 end
end

function tr_renew()
	music(charData:get(&quot;piccolo&quot;), &quot;song of renewal&quot;, &quot;&quot;)
end

-- this function will be called on all mud prompts
function SingerScript(event)
	if checkMask(&quot;singer&quot;) then

		-- cast harmonious blessing if down and not moving
		if charData:get(&quot;autobless&quot;) then
			if not buff:get(&quot;harmonious_blessing&quot;) then
				if getSpellCount(&quot;harmonious_blessing&quot;) &gt; 0 then
					if not spell:getMoving() then
						spell:cast(&quot;hbl&quot;)
					end
				end
			end
		end

		if prompt:get(&quot;psp&quot;) == prompt:get(&quot;maxpsp&quot;) and charData:get(&quot;_switch&quot;) == 0 and not charData:get(&quot;forcerenew&quot;) then
			if charData:get(&quot;_song&quot;) ~= charData:get(&quot;song&quot;) then
				if charData:get(&quot;_song&quot;) ~= &quot;&quot;  and charData:get(&quot;song&quot;) ~= &quot;&quot; then
					cecho(&quot;&lt;red&gt;\n[Max mana : switching songs]\n&quot;)
					if charData:get(&quot;_song&quot;) == &quot;song of harming&quot; or charData:get(&quot;_song&quot;) == &quot;song of offensive disruption&quot; then
						music(charData:get(&quot;_instrument&quot;), charData:get(&quot;_song&quot;), charData:get(&quot;effect&quot;) )
					else
						music(charData:get(&quot;_instrument&quot;), charData:get(&quot;_song&quot;), &quot;&quot;)
					end
				elseif charData:get(&quot;_song&quot;) == &quot;&quot; and charData:get(&quot;song&quot;) == &quot;song of renewal&quot; then
					--	if max psp and singing renew switch to heal (or regen)

					if charData:get(&quot;level&quot;) &gt;= 31 then
						cecho(&quot;&lt;red&gt;\n[Max mana : switching songs to heal]\n&quot;)
						music(charData:get(&quot;lute&quot;), &quot;song of healing&quot;, &quot;&quot;)
					else
						cecho(&quot;&lt;red&gt;\n[Max mana : switching songs to regen]\n&quot;)
						music(charData:get(&quot;lute&quot;), &quot;song of regeneration&quot;, &quot;&quot;)
					end
				end
			end
		end
	end
end</script>
                    <eventHandlerList>
                        <string>promptEvent</string>
                    </eventHandlerList>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>PsiScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initPsi()
	charData:init(&quot;autohide&quot;, false)

	spell:setMem(false)

	addbutton(&quot;MemButton&quot;, 1, 0)

	if charData:get(&quot;ultraquested&quot;) ~= nil then
		addbutton(&quot;ultrablast&quot;, 2, 47)
	else
		addbutton(&quot;deathfield&quot;, 2, 20)
	end

	addbutton(&quot;psidarkness&quot;, 3, 35)
	addbutton(&quot;tower&quot;, 4, 37)
	addbutton(&quot;combatmind&quot;, 5, 0)
	addbutton(&quot;battletrance&quot;, 6, 45)
	addbutton(&quot;wormhole&quot;, 7, 46)
end

function wormhole(xcommand)
	shiftSkillButton(&quot;wormhole&quot;, &quot;wormhole&quot;, xcommand)
end

function psidarkness(xcommand)
	local fname=&quot;psidarkness&quot;

	if xcommand ~= &quot;init&quot; then
		if charData:get(&quot;autohide&quot;) then
			charData:set(&quot;autohide&quot;, false)
			echo(&quot;\nSome illithids choose not to hide.\n&quot;)
		else
			charData:set(&quot;autohide&quot;, true)
			echo(&quot;\nA cautious illithid brings up darkness to hide after fleeing.\n&quot;)
		end
	end

	if charData:get(&quot;autohide&quot;) then
		setLabelImage(fname, &quot;darkness-on.png&quot;)
	else
		setLabelImage(fname, &quot;darkness-off.png&quot;)
	end
end

function tower(xcommand)
	local fname=&quot;tower&quot;

	if xcommand ~= &quot;init&quot; then
		if charData:get(&quot;autotower&quot;) then
			charData:set(&quot;autotower&quot;, false)
		else
			charData:set(&quot;autotower&quot;, true)
			send(&quot;tower me&quot;)
			NyyLIB.psilag=&quot;tower&quot;
		end
	end

	if charData:get(&quot;autotower&quot;) then
		setLabelImage(fname, fname .. &quot;-on.png&quot;)
	else
		setLabelImage(fname, fname .. &quot;-off.png&quot;)
	end
end

function combatmind(xcommand)
	local fname=&quot;combatmind&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, fname .. &quot;-off.png&quot;)
	else
		local cmblist = {}

		for k,char in pairs(groupList:pc(&quot;hitterSinger&quot;)) do
			if not buff:get(&quot;combatmind&quot;, char) then
				send(&quot;combatm &quot; .. char)
				NyyLIB.psilag=&quot;combatmb&quot;
				break
			end
		end
	end
end

function dropcombatmind()
	setLabelImage(&quot;combatmind&quot;, &quot;combatmind-off.png&quot;)
end

function battletrance(xcommand)
	local fname=&quot;battletrance&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, fname .. &quot;-off.png&quot;)
	else
		send(&quot;battletr&quot;)
	end
end

function ultrablast(xcommand)
	local fname=&quot;ultrablast&quot;
	
	if xcommand == &quot;init&quot; then
		setLabelImage(fname, fname .. &quot;-off.png&quot;)
	else
		if NyyLIB.psilag == &quot;none&quot; then
			setLabelImage(fname, fname .. &quot;-on.png&quot;)
			send(&quot;ultra&quot;)
			NyyLIB.psilag=&quot;ultra&quot;
		end
	end
end

function deathfield(xcommand)
	local fname=&quot;deathfield&quot;
	
	if xcommand == &quot;init&quot; then
		setLabelImage(fname, fname .. &quot;-off.png&quot;)
	else
		if NyyLIB.psilag == &quot;none&quot; then
			setLabelImage(fname, fname .. &quot;-on.png&quot;)
			send(&quot;deathfield&quot;)
			NyyLIB.psilag=&quot;death&quot;
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>EncScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- note: globe blocks 1-6, needs to be 7+

function initEnc()
	addbutton(&quot;stoneskin&quot;, 7, 21)
	addbutton(&quot;dragonscales&quot;, 8, 46)
	addbutton(&quot;blur&quot;, 9, 26)
--	addbutton(&quot;haste&quot;,10, 16)
	addbutton(&quot;globe_of_invulnerability&quot;,10, 36)

	addbutton(&quot;time_stop&quot;, 11, 46)

--	addbutton(&quot;encBard&quot;,11, 0)

	addbutton(&quot;encSelf&quot;,12, 0)
	addbutton(&quot;encResize&quot;,13, 0)

	powerAliases:addButtons()
	
	mud:send(&quot;powers info time stop&quot;)
	mud:send(&quot;powers info blur&quot;)
	mud:send(&quot;powers info globe&quot;)
end

function SpellsEnc()

	-- if blind, no casting
	-- will need to be altered for area offensives
	if 	buff:get(&quot;blind&quot;) or buff:get(&quot;blindness&quot;) then
		return
	end

	-- bring up timestop if not fighting

	if charData:get(&quot;autots&quot;) then
		--if not inCombat() or type(groupList:whoTanking()) == &quot;table&quot; and NyyLIB.tolook == 0 then
		if not inCombat() and assistSent == nil then
			if not buff:get(&quot;time_stop&quot;) then
				if getSpellCount(&quot;time_stop&quot;) &gt; 0 then
					spell:cast(&quot;ts&quot;)
					return
				end
			end
		end
	end

	-- check tank for needed spells

	if scr_tank() then
		return
	end

	if 	scr_globe() then
		return
	end

	if 	scr_scale() then
		return
	end

	-- blur group members

	if 	scr_blur() then
		return
	end

	if 	scr_stoneskin() then
		return
	end

	-- stoneskin

	if 	scr_stoneskin() then
		return
	end

	-- enlarge or reduce group members

	if 	scr_resize() then
		return
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end

	-- if fighting and no other spells - fire bolt
	if charData:get(&quot;automissile&quot;) then
		if inCombat() and spell:count() == 0 then
			spell:cast(&quot;fb&quot;)
		end
	end
end	

function time_stop(xcommand)
	local fname=&quot;time_stop&quot;

	local current=buff:get(&quot;time_stop&quot;)

	if xcommand == &quot;update&quot; then
		if not current then
			updateButton(fname)
		end

		return
	end

	if xcommand ~= &quot;init&quot; then
		if charData:get(&quot;autots&quot;) then
			charData:set(&quot;autots&quot;, false)
			cecho(&quot;\n&lt;green&gt;[Time Stop will not be used.]\n&quot;)
		else
			charData:set(&quot;autots&quot;, true)
			mud:send(&quot;\n&quot;)
			cecho(&quot;\n&lt;green&gt;[Time Stop will be used.]\n&quot;)
		end
	end

	if charData:get(&quot;autots&quot;) then
		if current then
			setLabelImage(fname, &quot;time_stop-active.png&quot;)
		else
			setLabelImage(fname, &quot;time_stop-on.png&quot;)
		end
	else
		setLabelImage(fname, &quot;time_stop-off.png&quot;)
	end

	if current then
		PopulateTimestop()
	else
		time_stop(&quot;update&quot;)
	end
end

function PopulateTimestop()
	local var = buff:get(&quot;time_stop&quot;)
	local label=findlabel(&quot;time_stop&quot;)

	if var then
		label:echo([[&lt;p style=&quot;font-size:20px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;]] .. charData:get(&quot;numcolor&quot;, true) .. [[&quot;&gt;]] .. timedisplay(var) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])		
	else
		label:echo([[&lt;p style=&quot;font-size:14px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;   &lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
	end
end

function encBard(xcommand)
	shiftSkillButton(&quot;encBard&quot;, &quot;bard&quot;, xcommand)
end

function encSelf(xcommand)
	shiftSkillButton(&quot;encSelf&quot;, &quot;self&quot;, xcommand)
end

function encResize(xcommand)
	shiftSkillButton(&quot;encResize&quot;, &quot;resize&quot;, xcommand)
end

function scr_tank()
	local tank=prompt:get(&quot;tank&quot;)

	if tank == nil or tank == &quot;&quot; then
		return
	end

	if charData:get(&quot;level&quot;) &gt;= 26 then
		if spell:attempt(tank, &quot;blur&quot;, &quot;bl&quot;) then
			return(true)
		end
	end

	if charData:get(&quot;level&quot;) &gt;= 46 then
		if spell:attempt(tank, &quot;dragonscales&quot;, &quot;ds&quot;) then
			return(true)
		end
	end
end

function scr_resize()
	local tmpvar = charData:get(&quot;resize&quot;)

	if tmpvar == &quot;small&quot; or tmpvar == &quot;all&quot; then
		for k,char in pairs(groupList:pc(&quot;casterSinger&quot;)) do
			if table.contains( {&quot;Halfling&quot;, &quot;Gnome&quot;}, whorace(char) ) then
				if consent:get(char) then
					if spell:attempt(char, &quot;reduce&quot;, &quot;red&quot;) then
						return(true)
					end
				end
			end
		end
	end

	if tmpvar == &quot;large&quot; then
		for k,char in pairs(groupList:pc(&quot;casterSinger&quot;)) do
			if consent:get(char) then
				if spell:attempt(char, &quot;enlarge&quot;, &quot;enl&quot;) then
					return(true)
				end
			end
		end
	end
	
	if tmpvar == &quot;all&quot; then
		for k,char in pairs(groupList:pc(&quot;war&quot;)) do
			if whorace(char) == &quot;Ogre&quot; then
				if consent:get(char) then
					if spell:attempt(char, &quot;enlarge&quot;, &quot;enl&quot;) then
						return(true)
					end
				end
			end
		end
	end	
end

function scr_globe()
	if charData:get(&quot;autoglobe&quot;) == true then
		for k,char in pairs(groupList:pc()) do
			if checkMask(&quot;hitter&quot;, char ) then
				if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
					return(true)
				end
			end

			if charData:get(&quot;bard&quot;) and checkMask(&quot;singer&quot;, char ) then
				if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
					return(true)
				end
			end
		end

		for k,char in pairs(groupList:pc(&quot;war&quot;)) do
			if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
				return(true)
			end
		end
	elseif charData:get(&quot;autoglobe&quot;) == &quot;hitters&quot; then
		for k,char in pairs(groupList:pc()) do
			if checkMask(&quot;hitter&quot;, char ) then
				if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
					return(true)
				end
			end
		
			if whoclass(char) == &quot;War&quot; and whorace(char) == &quot;Ogre&quot; then
				if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
					return(true)
				end
			end

			if charData:get(&quot;bard&quot;) and checkMask(&quot;singer&quot;, char ) then
				if spell:attempt(char, &quot;globe_of_invulnerability&quot;, &quot;gi&quot;) then
					return(true)
				end
			end
		end
	end
end

function scr_blur()
	if charData:get(&quot;autoblur&quot;) then
		for k,char in pairs(groupList:pc(&quot;casterPsiSinger&quot;)) do
			if char ~= whoami() then
				if spell:attempt(char, &quot;blur&quot;, &quot;bl&quot;) then
					return(true)
				end
			end
		end
	end

	for k,char in pairs(groupList:pc(&quot;warrior&quot;)) do
		if spell:attempt(char, &quot;blur&quot;, &quot;bl&quot;) then
			return(true)
		end
	end

	if charData:get(&quot;self&quot;) then
		if spell:attempt(whoami(), &quot;blur&quot;, &quot;bl&quot;) then
			return(true)
		end
	end

	
	local wuss=charData:get(&quot;wuss&quot;)

	if groupList:ingroup( wuss ) then
		if spell:attempt(wuss, &quot;blur&quot;, &quot;bl&quot;) then
			return(true)
		end
	end
end

function scr_scale()
	local wuss=charData:get(&quot;wuss&quot;)

	if groupList:ingroup( wuss ) then
		if spell:attempt(wuss, &quot;dragonscales&quot;, &quot;ds&quot;) then
			return(true)
		end
	end

	if charData:get(&quot;self&quot;) then
		if spell:attempt(whoami(), &quot;dragonscales&quot;, &quot;ds&quot;) then
			return(true)
		end
	end

	for k,char in pairs(groupList:pc(&quot;warrior&quot;)) do
		if spell:attempt(char, &quot;dragonscales&quot;, &quot;ds&quot;) then
			return(true)
		end
	end

	if charData:get(&quot;autoscale&quot;) then
		for k,char in pairs(groupList:pc(&quot;casterPsiSinger&quot;)) do
			if char ~= whoami() then
				if spell:attempt(char, &quot;dragonscales&quot;, &quot;ds&quot;) then
					return(true)
				end
			end
		end
	end
end

function scr_haste()
	-- placeholder
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>WarScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initWar()
	addbutton(&quot;shieldpunch&quot;, 1, 5)
	addbutton(&quot;HeadbuttButton&quot;, 2, 40)
end

function DisarmButton(xcommand)
	local fname=&quot;DisarmButton&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;warDisarm.png&quot;)
	else
		send(&quot;disarm&quot;)
	end
end

function KickButton(xcommand)
	shiftSkillButton(&quot;KickButton&quot;, &quot;autokick&quot;, xcommand)
end

function HeadbuttButton(xcommand)
	local fname=&quot;HeadbuttButton&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;warHeadbutt-off.png&quot;)
	else
		send(&quot;headbutt&quot;)
	end
end

function shieldpunch(xcommand)
	shiftSkillButton(&quot;shieldpunch&quot;, &quot;autoshieldpunch&quot;, xcommand)
end

function bashing(xcommand)
	shiftSkillButton(&quot;bashing&quot;, &quot;autobash&quot;, xcommand)
end

function mounted_charge(xcommand)
	shiftSkillButton(&quot;mounted_charge&quot;, &quot;autobash&quot;, xcommand)
end

function setBashing(xval)
	vbashing = xval
end

function getBashing()
	if vbashing == nil then
		vbashing=false
	end

	return(vbashing)
end

function sendBash()
	-- can't bash if stunned

	if buff:get(&quot;stun&quot;) then
		return
	end

	if not getBashing() then

		-- mounted charge instead of bash when mounted
		if mount:getMounted() then
			if not mount:charge() then
				return
			end
		else
			if dismounted == true then
				return
			end

			if charData:get(&quot;powersbash&quot;) then
				send(&quot;bh&quot;)
			else
				send(&quot;bash&quot;)
			end
		end

		setBashing(true)
	end
end

function rescue(xcommand)
	shiftSkillButton(&quot;rescue&quot;, &quot;rescuetype&quot;, xcommand)
end

-- send rescue will send a single rescue command to the mud

rescueSent=false

function sendRescue(xchar)
	if rescueSent == false then

		-- stand first if sitting
		if spell:getMem() == true then
			mud:send(&quot;st&quot;)
		end


		cecho(&quot;\n&lt;red&gt;[Rescue: &quot; .. xchar .. &quot;]\n&quot;)
		send(&quot;rescue &quot; .. xchar)

		if xchar == &quot;ghost&quot; then
			send(&quot;rescue 2.ghost&quot;)
		end

		if xchar == &quot;guard&quot; then
			send(&quot;rescue 2.guard&quot;)
			send(&quot;rescue 3.guard&quot;)
			send(&quot;rescue 4.guard&quot;)
		end

		rescueSent = true
	end
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>ShaScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initSha()
	addbutton(&quot;group_heal&quot;, 4, 41)
	addbutton(&quot;ancestral_shield&quot;, 11, 46)
	addbutton(&quot;stoneskin&quot;, 10, 26)

	addbutton(&quot;encSelf&quot;,12, 0)

	powerAliases:addButtons()

	mud:send(&quot;powers info vit&quot;)
end

-- this function will be called when shaman should cast
function SpellsSha()
	-- i'm blind: gheal, or cast heal on me if none left
	if buff:get(&quot;blind&quot;) or buff:get(&quot;blindness&quot;) then
		--display(&quot;X&quot;)
		if getSpellCount(&quot;group_heal&quot;) &gt; 0 then
			spell:cast(&quot;gh&quot;)
		else
			if getSpellCount(&quot;heal&quot;) &gt; 0 then
				spell:cast(&quot;HEAL&quot;)
			end
		end

		return
	end

	-- check if anyone blind
	for k,char in pairs(groupList:pc()) do
		if buff:get(&quot;blind&quot;, char) or buff:get(&quot;blindness&quot;, char) then
			--display(&quot;Y&quot;)
			if charData:get(&quot;autogh&quot;) then
				if getSpellCount(&quot;group_heal&quot;) &gt; 0 then
					spell:cast(&quot;gh&quot;)
					return
				end
			end
		end
	end

	-- earthquakes
	if castQuake() then
		return
	end

	-- stone if not stoned/scaled
	if scr_stoneskin(true) then
		return
	end

	-- group heal if multiple characters damaged
	local damaged=0
	for k,char in pairs(groupList:pc()) do
		local hp=tonumber(groupList:getHP(char))
		local maxhp= tonumber(groupList:getMaxHP(char))
		local percent = hp/maxhp

		if hp &lt; .9 * maxhp then
			damaged = damaged + 1
		end
	end
	
	if damaged &gt;= 3 and getSpellCount(&quot;group_heal&quot;) &gt; 0 and charData:get(&quot;autogh&quot;) then
		spell:cast(&quot;gh&quot;)
		return
	end

	-- stone remaining characters
	if scr_stoneskin() then
		return
	end

	-- vit self if needed / autovit enabled

	if charData:get(&quot;autovit&quot;) and charData:get(&quot;level&quot;) &gt;= 21 then
		if spell:attempt(whoami(), &quot;vitality&quot;, &quot;vt&quot;) then
			return
		end
	end
	
	-- cast heal on self?

	local hp=prompt:get(&quot;hp&quot;)
	local maxhp=prompt:get(&quot;maxhp&quot;)
	local percent=hp/maxhp

	if percent &lt; .8 then
		if getSpellCount(&quot;group_heal&quot;) &gt; 0 and charData:get(&quot;autogh&quot;) then
			spell:cast(&quot;gh&quot;)
			return
		end

		if getSpellCount(&quot;heal&quot;) &gt; 0 then
			spell:cast(&quot;heal me&quot;)
			return
		end
	end

	-- ancestral shield
	if charData:get(&quot;autoashield&quot;) then
		if not buff:get(&quot;ancestral_shield&quot;) then
			if getSpellCount(&quot;ancestral_shield&quot;) &gt; 0 then
				spell:cast(&quot;ash&quot;)
				return
			end
		end
	end

	-- queue vitality
	if charData:get(&quot;autovit&quot;) and charData:get(&quot;level&quot;) &gt;= 21 then
		if scr_vitality() then
			return
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end

function hex(xcommand)
	local fname=&quot;hex&quot;

	if xcommand == &quot;update&quot; then
		updateButton(fname)
		return
	end

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;hex-off.png&quot;)
		hex(&quot;update&quot;)
	else
		spell:cast(&quot;hex&quot;)
	end
end

function silence_person(xcommand)
	local fname=&quot;silence_person&quot;

	if xcommand == &quot;update&quot; then
		updateButton(fname)
		return
	end

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;silence_person-off.png&quot;)
		silence_person(&quot;update&quot;)
	else
		spell:cast(&quot;sp&quot;)
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>CleScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initCle()

	addbutton(&quot;greater_realm_of_protection&quot;,3, 46)

	addbutton(&quot;nestDPRM&quot;, 6, 16)
--	addbutton(&quot;silence_person&quot;,9, 26)

	addbutton(&quot;resurrect&quot;,4, 46)

	powerAliases:addButtons()

--	if whoami() ~= nil then
--		if whorace(whoami()) ~= nil then
--			if whorace(whoami()) == &quot;Yuan-Ti&quot; then
--				addbutton(&quot;scale_skin&quot;, 13, 1)
--			end
--		end
--	end

	mud:send(&quot;powers info vit&quot;)
end

function SpellsCle()
	-- this script will only be called if autocast enabled

	if buff:get(&quot;blind&quot;) or buff:get(&quot;blindness&quot;) then
		if prompt:get(&quot;hp&quot;) &lt; .9 * prompt:get(&quot;maxhp&quot;) then
			if getSpellCount(&quot;full_heal&quot;) &gt; 0 then
				spell:cast(&quot;fh&quot;)
				return
			end
		end

		if getSpellCount(&quot;cure_blind&quot;) &gt; 0 then
			spell:cast(&quot;cb&quot;)
			return
		end

		if getSpellCount(&quot;healing_aura&quot;) &gt; 0 then
			spell:cast(&quot;ha&quot;)
			return
		end
	end

	-- queue purify/etc
	if procClericPurify() then
		return
	end

	-- earthquakes
	if castQuake() then
		return
	end

	-- healing aura main tank if injured
	if charData:get(&quot;autoheal&quot;) then
		if NyyLIB.mtank ~= nil then
			local char=NyyLIB.mtank
			local hp=tonumber(groupList:getHP(char))
			local maxhp= tonumber(groupList:getMaxHP(char))
			local percent = hp/maxhp

			if getSpellCount(&quot;healing_aura&quot;) &gt; 0 and percent &lt; .7 and not buff:get(&quot;healing_aura&quot;, char) then
				spell:cast(&quot;ha &quot; .. char)
				return
			end
		end
	end

	--display(&quot;X&quot;)

	-- queue vitality
	if charData:get(&quot;autovit&quot;) and charData:get(&quot;level&quot;) &gt;= 21 then
		if 	scr_vitality() then
			return
		end
	end

	-- queue any needed heals
	if charData:get(&quot;autoheal&quot;) then
		if procClericHeal() then
			return
		end
	end

	-- scaleskin
	procYuanInnates()

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end

	if procClericRealm() then
		return
	end

	-- process cast/send queue if not currently casting
	--if spell:getCurrent() == nil then
	--	spell:cast()
	--end
end

function procYuanInnates()
	if charData:get(&quot;yuan&quot;) then
		if not charData:get(&quot;scaleskin&quot;) then
			mud:send(&quot;innate scaleskin&quot;)
		end
	end
end

function procClericHeal()
	-- Cleric heal event

	-- healing aura needs to be manually added to buffs
	-- otherwise, ha already present on self and damaged cleric (self) will stop moving further on script

	local ha_count=getSpellCount(&quot;healing_aura&quot;)
	local fh_count=getSpellCount(&quot;full_heal&quot;)

	if prompt:get(&quot;hp&quot;) &lt; .8 * prompt:get(&quot;maxhp&quot;) then
		-- first choice = healing aura if &lt; .8 hp
		if ha_count &gt; 0 then
			if not buff:get(&quot;healing_aura&quot;) then
				echoDebug(&quot;\n&lt;red&gt;[que ha on self]\n&quot;)
				spell:cast(&quot;ha &quot; .. whoami())
				return(true)
			end
		end

		-- alternate choice = full heal if no aura and &lt; .65 hp
		if fh_count &gt; 0 and (prompt:get(&quot;hp&quot;) &lt; .65 * prompt:get(&quot;maxhp&quot;)) then
			echoDebug(&quot;\n&lt;red&gt;[que fh on self]\n&quot;)
			spell:cast(&quot;fh&quot;)
			return(true)
		end
	end

	for k,char in pairs(groupList:pc()) do
		local hp=tonumber(groupList:getHP(char))
		local maxhp= tonumber(groupList:getMaxHP(char))
		local percent = hp/maxhp

		if spell:getCurrent() ~= (&quot;fh &quot; .. char) then
			if getSpellCount(&quot;full_heal&quot;) &gt; 0 then
				if hp &lt; .75 * maxhp then
					echoDebug(&quot;\n&lt;red&gt;[&quot; .. hp .. &quot;/&quot; .. maxhp .. &quot; casting fh on &quot; .. char .. &quot;]&quot;)
					spell:cast(&quot;fh &quot; .. char)
					return(true)

				elseif percent &lt; .8 and whoclass(char) == &quot;War&quot; then
					echoDebug(&quot;\n&lt;red&gt;[&quot; .. hp .. &quot;/&quot; .. maxhp .. &quot; casting ha on &quot; .. char .. &quot;]&quot;)

					if getSpellCount(&quot;healing_aura&quot;) &gt; 0 then
						spell:cast(&quot;ha &quot; .. char)
						return(true)
					end
				end
			end
		end
	end

	-- healing aura tank at few wounds
	if prompt:get(&quot;tankcondition&quot;) == &quot;few wounds&quot; then
		if getSpellCount(&quot;healing_aura&quot;) &gt; 0 then
			spell:cast(&quot;ha &quot; .. prompt:get(&quot;tank&quot;))
			return(true)
		end
	end

	-- full heal anyone at &lt; .6 maxhp

	for k,char in pairs(groupList:pc()) do
		local hp=tonumber(groupList:getHP(char))
		local maxhp= tonumber(groupList:getMaxHP(char))

		if spell:getCurrent() ~= (&quot;fh &quot; .. char) then
			if getSpellCount(&quot;full_heal&quot;) &gt; 0 then
				if hp &lt; .6 * maxhp then
					echoDebug(&quot;&lt;red&gt;[&quot; .. hp .. &quot;/&quot; .. maxhp .. &quot; casting fh on &quot; .. char .. &quot;]&quot;)
					spell:cast(&quot;fh &quot; .. char)
					return(true)
				end
			end
		end
	end

	return(false)
end

function procClericRealm()
	-- Greater Realm Of Protecti ( 43:59)   

	if charData:get(&quot;autorealm&quot;) then
		for k,char in pairs(groupList:pc()) do
			if getSpellCount(&quot;greater_realm_of_protection&quot;) &gt; 0 then
				if not buff:get(&quot;greater_realm_of_protecti&quot;, char) and groupList:getHP(char) ~= 0 then
					spell:cast(&quot;realm &quot; .. char)
					return(true)
				end
			end
		end
	end

	return(false)
end

function procClericPurify()
	-- check for anyone paralyzed
	for k,char in pairs(groupList:pc()) do
		if buff:get(&quot;minor_paralysis&quot;, char) or buff:get(&quot;major_paralysis&quot;, char) then
			if charData:get(&quot;autopurify&quot;) then
				if getSpellCount(&quot;divine_purification&quot;) &gt; 0 then
					spell:cast(&quot;dpu &quot; .. char)
					return(true)
				end
			end
		end
	end

	-- check for anyone blinded
	for k,char in pairs(groupList:pc()) do
		local hp=tonumber(groupList:getHP(char))
		local maxhp= tonumber(groupList:getMaxHP(char))
		local percent = hp/maxhp

		if buff:get(&quot;blind&quot;, char) or buff:get(&quot;blindness&quot;, char) then
			if charData:get(&quot;autocb&quot;) then
				if char == whoami() then
					if percent &lt; .9 then
						if getSpellCount(&quot;heal&quot;) &gt; 0 then
							spell:cast(&quot;heal&quot;)
							return(true)
						end
					end

					spell:cast(&quot;cb&quot;)
					return(true)
				else

					if percent &lt; .9 then
						if getSpellCount(&quot;heal&quot;) &gt; 0 then
							spell:cast(&quot;heal &quot; .. char)
							return(true)
						end
					end

					spell:cast(&quot;cb &quot; .. char)
					return(true)
				end
				return(false)
			end
		end
	end
end

function scr_vitality()
	local var=buff:get(&quot;vitality&quot;) or 0

	if getSpellCount(&quot;vitality&quot;) == 0 then
		return
	end

	if var == 0 then
		spell:cast(&quot;vt &quot; .. whoami())
		return(true)
	end

	if charData:get(&quot;autovit&quot;) then
		local vit=charData:get(&quot;vit&quot;)

		--echoDebug(&quot;&lt;red&gt;[Queuing vitality for: &quot; .. vit .. &quot;]\n&quot;)

		for k,char in pairs(groupList:pc(vit)) do
			if groupList:getHP(char) ~= 0 then
				var=buff:get(&quot;vitality&quot;, char) or 0

				if var == 0 then
					spell:cast(&quot;vt &quot; .. char)
					return(true)
				end
			end
		end
	end
end

function scale_skin(xcommand)
	local fname=&quot;scale_skin&quot;

	-- innate vipermind, scaleskin

	if xcommand == &quot;update&quot; then
--		updateButton(fname)
		return
	end

	if xcommand ~= &quot;init&quot; then
		if charData:get(&quot;yuan&quot;) then
			charData:set(&quot;yuan&quot;, false)
		else
			charData:set(&quot;yuan&quot;, true)
		end
	end

	if charData:get(&quot;yuan&quot;) then
		setLabelImage(fname, &quot;scale_skin-on.png&quot;)
	else
		setLabelImage(fname, &quot;scale_skin-off.png&quot;)
	end
end

function nestDPRM(xcommand)
	local fname=&quot;nestDPRM&quot;
	local label=findlabel(fname)

	charData:init(&quot;dprm&quot;, &quot;dp&quot;)

	local dprm = charData:get(&quot;dprm&quot;)

	if xcommand == &quot;init&quot; then
		nest1 = label:addChild({name=&quot;nest1&quot;,height=20,width=200, layoutDir=&quot;TV&quot;, flyOut=true})
		nest1:setClickCallback(&quot;nestDPRM&quot;, &quot;nestclick&quot;)

		if dprm == &quot;dp&quot; then
			label:setStyleSheet([[border-image: url(]] .. iconpath(&quot;divine_power-off.png&quot;) .. [[)]])
			nest1:echo([[&lt;p style=&quot;font-size:16px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;Righteous Might&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
		else
			label:setStyleSheet([[border-image: url(]] .. iconpath(&quot;righteous_might-off.png&quot;) .. [[)]])
			nest1:echo([[&lt;p style=&quot;font-size:16px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;Divine Power&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
		end

		setLabelOnEnter(label.name, fname, &quot;enter&quot;)
	elseif xcommand == &quot;update&quot; then
		if dprm == &quot;dp&quot; then
			updateButton(&quot;divine_power&quot;, fname)
		else
			updateButton(&quot;righteous_might&quot;, fname)
		end
	elseif xcommand == &quot;enter&quot; then
		closeNests()
		Geyser.Label:displayNest(label.name)
	elseif xcommand == &quot;nestclick&quot; then
		if dprm == &quot;rm&quot; then
			charData:set(&quot;dprm&quot;, &quot;dp&quot;)
			setLabelImage(fname, &quot;divine_power-off.png&quot;)
			updateButton(&quot;divine_power&quot;, fname)
			nest1:echo([[&lt;p style=&quot;font-size:16px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;Righteous Might&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
			spell:cast(&quot;dp&quot;)
		elseif dprm == &quot;dp&quot; then
			charData:set(&quot;dprm&quot;, &quot;rm&quot;)
			setLabelImage(fname, &quot;righteous_might-off.png&quot;)
			updateButton(&quot;righteous_might&quot;, fname)
			nest1:echo([[&lt;p style=&quot;font-size:16px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;Divine Power&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
			spell:cast(&quot;rm&quot;)
		end
	else
		spell:setMoving(false)

		if dprm == &quot;rm&quot; then
			spell:cast(&quot;rm&quot;)
		else
			spell:cast(&quot;dp&quot;)
		end
	end
end

function divine_power(xcommand)
	nestDPRM(&quot;update&quot;)
end

function righteous_might(xcommand)
	nestDPRM(&quot;update&quot;)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>MiscButtons</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function baseButtons()
	addbutton(&quot;ticktimer&quot;, 0.2, 0, &quot;4c&quot;, &quot;2c&quot;)
	addbutton(&quot;mysizeDisplay&quot;, 0.6, 0, &quot;3c&quot;, &quot;2c&quot;)

	-- non-class specific buttons at far right

	addbutton(&quot;chkstat&quot;, 15, 0)
	addbutton(&quot;flee&quot;, 16, 0)
	addbutton(&quot;autoassist&quot;, 17, 0)
	addbutton(&quot;loot&quot;, 18, 1)	
	if checkMask(&quot;petrescue&quot;) then
		addbutton(&quot;pet_rescue&quot;, 19, 1)
	end

	-- buttons at the bottom

	if checkMask(&quot;fighter&quot;) then
		addbutton(&quot;rescue&quot;, 4, 1)
	end
 
	if checkMask(&quot;caster&quot;) or checkMask(&quot;nonPriestCaster&quot;) then 
		addbutton(&quot;SpellsButton&quot;, 1, 0)
		addbutton(&quot;MemButton&quot;, 2, 0)
	end

	if whoclass() == &quot;Rog&quot; then
		addbutton(&quot;DisarmButton&quot;, 11, 10)	
	end


	if checkMask(&quot;fighter&quot;) then
		addbutton(&quot;bashing&quot;, 3, 1)
		addbutton(&quot;DisarmButton&quot;, 11, 22)	

		if whoclass() ~= &quot;Pal&quot; then
			addbutton(&quot;KickButton&quot;, 12, 1)	
		end
	end

	if checkMask(&quot;summonmount&quot;) then
		addbutton(&quot;SummonMount&quot;, 10, 15)
	end


	-- faerie fire

	if checkMask(&quot;ffire&quot;) then
		addbutton(&quot;faerie_fire&quot;, 14, 6)
	end



	-- xp display window

	if NyyLIB.xpwindow == nil then
		NyyLIB.xpwindow = Geyser.Label:new({name=&quot;xpwin&quot;, x=0, y=0, width=&quot;160px&quot;, height=&quot;32px&quot;})
	end

	if charData:get(&quot;level&quot;) == 50 then
		NyyLIB.xpwindow:show()
		NyyLIB.xpwindow:hide()
	else
		NyyLIB.xpwindow:show()
	end

	-- vote button

	charData:init(&quot;vote&quot;, 0, true)
	charData:set(&quot;vote&quot;, charData:get(&quot;vote&quot;, true)+1, true)

	if charData:get(&quot;vote&quot;, true) &gt; 10 then
		NyyLIB.votewindow = Geyser.Label:new({name=&quot;vote&quot;, x=0, y=0, width=&quot;225px&quot;, height=&quot;125px&quot;})
		NyyLIB.votewindow:setClickCallback(&quot;mudvote&quot;)
		NyyLIB.votewindow:setStyleSheet([[border-image: url(]] .. iconpath(&quot;vote.png&quot;) .. [[)]])

		checkVoteButton()
	end
end

function pet_rescue(xcommand)
	shiftSkillButton(&quot;pet_rescue&quot;, &quot;petrescue&quot;, xcommand)
end

function ticktimer()
	return
end

function checkVoteButton()
	local val=getTime()

	if NyyLIB.votewindow ~= nil then
		if charData:get(&quot;lastvote&quot;, true) ~= nil	then
			if val.day == charData:get(&quot;lastvote&quot;, true) then
				NyyLIB.votewindow:show()
				NyyLIB.votewindow:hide()
			else
				NyyLIB.votewindow:show()
			end
		end
	end
end

function SummonMount(xcommand)
	local fname=&quot;SummonMount&quot;
	local label=findlabel(fname)

	if xcommand ~= &quot;init&quot; then
		send(&quot;summon mount&quot;)
	end

	setLabelImage(fname, &quot;summon_mount.png&quot;)
end

function MountDismount(xcommand)
	local fname=&quot;MountDismount&quot;
	local label=findlabel(fname)

	if xcommand ~= &quot;init&quot; then
		if mount:getMounted() then
			send(&quot;dismount&quot;)
		else
			send(&quot;mount&quot;)
		end
	end

	if mount:getMounted() then
		setLabelImage(fname, &quot;dismount.png&quot;)
	else
		setLabelImage(fname, &quot;mount.png&quot;)
	end
end

function MemButton(xcommand)
	-- xcommand will either be init or button name (click)
	local fname=&quot;MemButton&quot;
	local label=findlabel(fname)

	if xcommand == &quot;update&quot; then
		if label ~= nil then
			charData:init(&quot;memcount&quot;, 0)

			if spell:getMem() then
				if charData:get(&quot;memcount&quot;) ~= 0 then
					label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;]] .. charData:get(&quot;numcolor&quot;, true) .. [[&quot;&gt;]] .. charData:get(&quot;memcount&quot;) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
				else
					label:clear()
					spell:setMem(false)
				end
			else
				MemButton(&quot;init&quot;)
			end
		end
		return
	end

	if xcommand == &quot;init&quot; then
		echoDebug(&quot;&lt;red&gt;[Setting membutton to mem/med/pray]&quot;)

		if label ~= nil then
			label:clear()
		end

		if checkMask(&quot;psi&quot;) then
			setLabelImage(fname, &quot;psiMeditate.png&quot;)
		elseif checkMask(&quot;priest&quot;) or checkMask(&quot;pray&quot;) then
			setLabelImage(fname, &quot;pray.png&quot;)
		else
			setLabelImage(fname, &quot;encMem.png&quot;)
		end
	else
		if checkMask(&quot;psi&quot;) then
			if spell:getMem() then
				setLabelImage(fname, &quot;psiMeditate.png&quot;)
				send(&quot;st&quot;)			
			else
				setLabelImage(fname, &quot;psiStand.png&quot;)
				mud:send(&quot;mem&quot;)
			end
		else
			if not spell:getMem() then
				mud:send(&quot;mem&quot;)
			else
				spell:setMem(false)
				mud:send(&quot;st&quot;)
			end
		end
	end
end

function SpellsButton(xcommand)
	local fname=&quot;SpellsButton&quot;

	if xcommand ~= &quot;init&quot; then
		if charData:get(&quot;autocast&quot;) then
			charData:set(&quot;autocast&quot;, false)
			cecho(&quot;&lt;red&gt;[Autocasting and Automem are disabled.]\n&quot;)
			spell:clear()
		else
			charData:set(&quot;autocast&quot;, true)
			cecho(&quot;&lt;green&gt;[Autocasting and Automem are enabled.]\n&quot;)
			spell:setMoving(false)
			mud:send(&quot;\n&quot;)
		end
	end

	if charData:get(&quot;autocast&quot;) then
		setLabelImage(fname, &quot;encSpells-on.png&quot;)
	else
		setLabelImage(fname, &quot;encSpells-off.png&quot;)
	end
end

function mudvote()
	local val=getTime()

	openUrl(&quot;http://www.topmudsites.com/vote-shev.html&quot;)
	openUrl(&quot;http://www.mudconnect.com/cgi-bin/vote_rank.cgi?mud=TorilMud,+the+Sojourner%27s+Home&quot;)
	charData:set(&quot;lastvote&quot;, val.day, true)
	NyyLIB.votewindow:show()
	NyyLIB.votewindow:hide()
end

function mysizeDisplay(xcommand, xname)
	local fname=&quot;mysizeDisplay&quot;
	local mysize = whosize()

	if mysize ~= nil then
		charData:init(&quot;bodysize&quot;, mysize)
	else
		charData:init(&quot;bodysize&quot;, &quot;M&quot;)
	end

	local tmpvar=charData:get(&quot;bodysize&quot;)

	if tmpvar == &quot;T&quot; then
		setLabelImage(fname, &quot;sizet.png&quot;)
	elseif tmpvar == &quot;S&quot; then
		setLabelImage(fname, &quot;sizes.png&quot;)
	elseif tmpvar == &quot;M&quot; then
		setLabelImage(fname, &quot;sizem.png&quot;)
	elseif tmpvar == &quot;L&quot; then
		setLabelImage(fname, &quot;sizel.png&quot;)
	elseif tmpvar == &quot;H&quot; then
		setLabelImage(fname, &quot;sizeh.png&quot;)
	end
end

function autoassist(xcommand)
	shiftSkillButton(&quot;autoassist&quot;, &quot;autoassist&quot;, xcommand)
end

function flee(xcommand)
	shiftSkillButton(&quot;flee&quot;, &quot;flee&quot;, xcommand)
end

function chkstat(xcommand)
	local fname=&quot;chkstat&quot;

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;chkstat.png&quot;)
	else
		mud:send(&quot;chkstat&quot;)
	end
end

function loot(xcommand)
	shiftSkillButton(&quot;loot&quot;, &quot;autoloot&quot;, xcommand)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>RogScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initRog()
	addbutton(&quot;assassinate&quot;, 1, 40)
	addbutton(&quot;trip&quot;, 2, 25)
	addbutton(&quot;circle&quot;, 3, 5)
	addbutton(&quot;poisonRogue&quot;, 7, 20)

end

function setTripping(xval)
	tripping = xval
end

function getTripping()
	if tripping == nil then
		tripping=false
	end

	return(tripping)
end

function sendTrip()
	-- can only trip if standing

	if not prompt:get(&quot;position&quot;) == &quot;std&quot; then
		return
	end

	-- can't trip if stunned

	if buff:get(&quot;stun&quot;) then
		return
	end

	if not getTripping() then
		mud:send(&quot;trip&quot;)

		setTripping(true)
	end
end

function sendAssassinate()
	if charData:get(&quot;autoassassinate&quot;) then
		if timer:get(&quot;assassinatetimer&quot;) == nil and charData:get(&quot;level&quot;) &gt; 39 then
			timer:set(&quot;assassinatetimer&quot;, 25*60)
			mud:send(&quot;assassinate &quot; .. enemytarget)
			sendLook()
			return(true)
		end
	end

	return(false)
end

function sendPoison()
	if charData:get(&quot;autopoison&quot;) then
		local primaryp=charData:get(&quot;primaryp&quot;)
		local secondaryp=charData:get(&quot;secondaryp&quot;)
		local poisonbag = charData:get(&quot;poisonbag&quot;)

		if primaryp ~= &quot;&quot; then
			mud:send( &quot;GET &quot; .. primaryp .. &quot; &quot; .. poisonbag )
			mud:send(&quot;apply &quot; .. primaryp .. &quot; primaryweapon&quot;)
			mud:send( &quot;PUT &quot; .. primaryp .. &quot; &quot; .. poisonbag )
		end

		if secondaryp ~= &quot;&quot; then
			mud:send( &quot;GET &quot; .. secondaryp .. &quot; &quot; .. poisonbag )
			mud:send(&quot;apply &quot; .. secondaryp .. &quot; secondaryweapon&quot;)
			mud:send( &quot;PUT &quot; .. secondaryp .. &quot; &quot; .. poisonbag )
		end
	end
end

function assassinate(xcommand)
	shiftSkillButton(&quot;assassinate&quot;, &quot;autoassassinate&quot;, xcommand)
end

function trip(xcommand)
	shiftSkillButton(&quot;trip&quot;, &quot;autotrip&quot;, xcommand)
end

function circle(xcommand)
	shiftSkillButton(&quot;circle&quot;, &quot;autocircle&quot;, xcommand)
end

function poisonRogue(xcommand)
	shiftSkillButton(&quot;poisonRogue&quot;, &quot;autopoison&quot;, xcommand)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>EleScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initEle()
	addbutton(&quot;stoneskin&quot;, 7, 31)
	addbutton(&quot;elemental_ward&quot;, 8, 46)
	addbutton(&quot;glitterdust&quot;, 9, 21)

	powerAliases:addButtons()
end

function SpellsEle()
	if scr_stoneskin(true) then
		return
	end

	local wuss=charData:get(&quot;wuss&quot;)

	if groupList:ingroup( wuss ) then
		if spell:attempt(wuss, &quot;elemental_earth_embodiment&quot;, &quot;eee&quot;) then
			return(true)
		end
	end

	if scr_ward() then
		return
	end

	if charData:get(&quot;autoblind&quot;) then
		if inCombat() and spell:count() == 0 then
			if getSpellCount(&quot;glitterdust&quot;) &gt; 0 then
				spell:cast(&quot;gl&quot;)
				return
			end
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end

function scr_ward()
	if charData:get(&quot;autoward&quot;) == true then
		for k,char in pairs(groupList:pc()) do
			if checkMask(&quot;hitter&quot;, char ) then
				if spell:attempt(char, &quot;elemental_ward&quot;, &quot;ew&quot;) then
					return(true)
				end
			end
		
			if whoclass(char) == &quot;War&quot; then
				if spell:attempt(char, &quot;elemental_ward&quot;, &quot;ew&quot;) then
					return(true)
				end
			end

			if whoclass(char) == &quot;Bar&quot; then
				if spell:attempt(char, &quot;elemental_ward&quot;, &quot;ew&quot;) then
					return(true)
				end
			end
		end
	end
end


function scr_stoneskin(xfirsttime)

	if charData:get(&quot;self&quot;) then
		-- stone self if not stoned/scaled
		if not buff:get(&quot;stoneskin&quot;) and not buff:get(&quot;dragonscales&quot;) then
			if getSpellCount(&quot;stoneskin&quot;) &gt; 0 then
				spell:cast(&quot;ss&quot;)
				return
			end
		end
	end

	if charData:get(&quot;autostone&quot;) == &quot;off&quot; then
		return
	end

	--local wuss=charData:get(&quot;wuss&quot;)

	--if groupList:ingroup( wuss ) then
	--	if spell:attempt(wuss, &quot;stoneskin&quot;, &quot;ss&quot;) then
	--		return(true)
	--	end
	--end

	-- in combat, no other spells queued
	if charData:get(&quot;autostone&quot;) == &quot;tanks&quot; then
		if inCombat() and spell:count() == 0 then
			local tank=prompt:get(&quot;tank&quot;)

			if not (tank == nil or tank == &quot;&quot;) then
				if charData:get(&quot;level&quot;) &gt;= 31 then
					if spell:attempt(tank, &quot;stoneskin&quot;, &quot;ss&quot;) then
						return(true)
					end
				end
			end
		end
	end

	if charData:get(&quot;autostone&quot;) == &quot;rogues&quot; then
		for k,char in pairs(groupList:pc(&quot;hitterToRescue&quot;)) do
			if spell:attempt(char, &quot;stoneskin&quot;, &quot;ss&quot;) then
				return(true)
			end
		end
	end

	if charData:get(&quot;autostone&quot;) == &quot;all&quot; then
		for k,char in pairs(groupList:pc(&quot;all&quot;)) do
			if spell:attempt(char, &quot;stoneskin&quot;, &quot;ss&quot;) then
				return(true)
			end
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>NecScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initNec()
	powerAliases:addButtons()

	addbutton(&quot;globe_of_invulnerability&quot;,10, 41)
end

function SpellsNec()
	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>LicScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initLic()
	addbutton(&quot;protection_from_undead&quot;, 7, 6)
	addbutton(&quot;globe_of_invulnerability&quot;,10, 41)

	powerAliases:addButtons()
end

function SpellsLic()

	if charData:get(&quot;autopfu&quot;) then
		if scr_pfu() then
			return
		end
	end

	if 	scr_globe() then
		return
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end

function scr_pfu()
	for k,char in pairs(groupList:pc(&quot;all&quot;)) do
		if spell:attempt(char, &quot;protection_from_undead&quot;, &quot;pfu&quot;) then
			return(true)
		end
	end

	return(false)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>InvScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initInv()
	powerAliases:addButtons()
end

function SpellsInv()

	-- if fighting - sandstorm
	if charData:get(&quot;autostorm&quot;) and not timer:get(&quot;sandstorm&quot;) then
		if getSpellCount(&quot;sandstorm&quot;) &gt; 0 then
			if inCombat() and spell:count() == 0 then
				spell:cast(&quot;ss&quot;)
			end
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end

	-- if fighting and no other spells - ray of frost
	if charData:get(&quot;automissile&quot;) then
		if inCombat() and spell:count() == 0 then
			spell:cast(&quot;rf&quot;)
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>IllScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initIll()
	powerAliases:addButtons()

	addbutton(&quot;displacement&quot;, 7, 26)
	addbutton(&quot;doppleganger&quot;, 9, 31)
	addbutton(&quot;massmorph&quot;, 10, 41)
end

function massmorph(xcommand)
	local fname=&quot;massmorph&quot;

	if xcommand == &quot;update&quot; then
--		updateButton(fname)
		return
	end

	if xcommand ~= &quot;init&quot; then
		spell:cast(&quot;massmorph&quot;)
	end

	setLabelImage(fname, &quot;massmorph-on.png&quot;)

end

function SpellsIll()

	-- phantom heal main tank if injured
	if charData:get(&quot;autoheal&quot;) then

		if scr_phantomheal() then
			return
		end
	end

	-- cast mirror image on self if needed and possible
	if getSpellCount(&quot;mirror_image&quot;) &gt; 0 then
		if not buff:get(&quot;mirror_image&quot;) then
			spell:cast(&quot;mi&quot;)
			return
		end
	end

	if charData:get(&quot;autodisplace&quot;) then
		if scr_displace() then
			return
		end
	end

	if charData:get(&quot;autodoppel&quot;) then
		if scr_doppelganger() then
			return
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end

end

function scr_doppelganger()
	for k,char in pairs(groupList:pc(&quot;all&quot;)) do
		if spell:attempt(char, &quot;doppleganger&quot;, &quot;dopple&quot;) then
			return(true)
		end
	end

	return(false)
end

function scr_displace()
--	if inCombat() and spell:count() == 0 then
--		if spell:attempt(prompt:get(&quot;tank&quot;), &quot;displacement&quot;, &quot;ds&quot;) then
--			return(true)
--		end
--	end

	for k,char in pairs(groupList:pc(&quot;displace&quot;)) do
--	for k,char in pairs(groupList:pc(&quot;all&quot;)) do
		if spell:attempt(char, &quot;displacement&quot;, &quot;ds&quot;) then
			return(true)
		end
	end

	--local wuss=charData:get(&quot;wuss&quot;)

	--if groupList:ingroup( wuss ) then
	--	if spell:attempt(wuss, &quot;blur&quot;, &quot;blur&quot;) then
	--		return(true)
	--	end
	--end
end

function scr_phantomheal()
	-- phantom heal anyone at &lt; .5 maxhp

	for k,char in pairs(groupList:pc()) do
		local hp=tonumber(groupList:getHP(char))
		local maxhp= tonumber(groupList:getMaxHP(char))

		if spell:getCurrent() ~= (&quot;pheal &quot; .. char) then
			if getSpellCount(&quot;phantom_heal&quot;) &gt; 0 then
				if hp &lt; .5 * maxhp then
					echoDebug(&quot;&lt;red&gt;[&quot; .. hp .. &quot;/&quot; .. maxhp .. &quot; casting pheal on &quot; .. char .. &quot;]&quot;)
					spell:cast(&quot;pheal &quot; .. char)
					return(true)
				end
			end
		end
	end

	return(false)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>DruScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initDru()
	powerAliases:addButtons()

	mud:send(&quot;powers info vit&quot;)
end

function SpellsDru()
	-- earthquakes
	if castQuake() then
		return
	end

	-- cure critic main tank if injured
	if charData:get(&quot;autoheal&quot;) then
		local tank=prompt:get(&quot;tank&quot;)

		if tank ~= &quot;&quot; then
			local char=tank
			local hp=tonumber(groupList:getHP(char))
			local maxhp= tonumber(groupList:getMaxHP(char))
			local percent = hp/maxhp

			if getSpellCount(&quot;cure_critic&quot;) &gt; 0 and percent &lt; .85 then
				spell:cast(&quot;ccr &quot; .. char)
				return
			end
		end
	end

	-- queue vitality
	if charData:get(&quot;autovit&quot;) and charData:get(&quot;level&quot;) &gt;= 26 then
		if 	scr_vitality() then
			return
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end

	if charData:get(&quot;automissile&quot;) then
		if inCombat() and spell:count() == 0 then
			spell:cast(&quot;tw&quot;)
			return
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>RanScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initRan()
	powerAliases:addButtons()
end

function SpellsRan()
	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>PalScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initPal()
	powerAliases:addButtons()
end

function SpellsPal()
	-- cure blind self if needed
	if buff:get(&quot;blind&quot;) or buff:get(&quot;blindness&quot;) then
		if getSpellCount(&quot;cure_blind&quot;) &gt; 0 then
			spell:cast(&quot;cb&quot;)
			return
		end
	end

	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>A_PScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initA_P()
	addbutton(&quot;poisonRogue&quot;, 7, 30)

	powerAliases:addButtons()
end

function SpellsA_P()
	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>DirScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initDir()
	powerAliases:addButtons()

	addbutton(&quot;outflank&quot;, 13, 30)
	addbutton(&quot;howl&quot;, 14, 15)
end


-- this function will be called when dire could cast
function SpellsDir()
	-- if fighting and no other spells cast damage spells
	if powerAliases:castDamage() then
		return
	end
end

function howl(xcommand)
	shiftSkillButton(&quot;howl&quot;, &quot;autohowl&quot;, xcommand)
end

function outflank(xcommand)
	shiftSkillButton(&quot;outflank&quot;, &quot;outflank&quot;, xcommand)
end
</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>EquipProcs</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>Baatorian</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function baatorian(xcommand)
	-- xcommand will either be init or button name (click)
	local fname=&quot;baatorian&quot;
	local label=findlabel(fname)

	local var = timer:get(&quot;baatorian&quot;)

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;update&quot; then
		if pet:status() then
			if var == nil then
				cecho(&quot;&lt;red&gt;[no timer on baatorian]\n&quot;)
				timer:set(&quot;baatorian&quot;, 13*60)
				var = timer:get(&quot;baatorian&quot;)
			end

			var = var - (12*60)
		end

		if label ~= nil then
			if timer:get(&quot;baatorian&quot;) == nil then
				label:echo([[&lt;p style=&quot;font-size:12px&quot;&gt;&lt;b&gt;&lt;center&gt;     &lt;br&gt;     &lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
				setLabelImage(fname, &quot;baatorian.png&quot;)
			else
				label:echo([[&lt;p style=&quot;font-size:12px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;]] ..
													charData:get(&quot;petrescue&quot;):upper() .. &quot;&lt;br&gt;&quot; .. timedisplay(var) ..
													&quot;&lt;/center&gt;&lt;/font&gt;&lt;/b&gt;&lt;/p&gt;&quot;)
			end
		end

		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		if timer:get(&quot;baatorian&quot;) == nil then
			setLabelImage(fname, &quot;baatorian.png&quot;)
		else
			setLabelImage(fname, &quot;baatorian-timer.png&quot;)
		end

		label:echo([[&lt;p style=&quot;font-size:12px&quot;&gt;&lt;b&gt;&lt;center&gt;     &lt;br&gt;     &lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])

	else
		if pet:status() then
			shiftSetting(&quot;petrescue&quot;)

			baatorian(&quot;update&quot;)
		else
			mud:send(&quot;slaad&quot;)
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>FrenziedGrin</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function FrenziedGrin(xcommand)
	local fname=&quot;FrenziedGrin&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;equipGrin-on.png&quot;)
	else
		mud:send(&quot;grin&quot;)
	end
end

function DragonCult(xcommand)
	local fname=&quot;DragonCult&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;equipdcult-on.png&quot;)
	else
		mud:send(&quot;say draconian protection&quot;)
	end
end


function VermSleeves(xcommand)
	local fname=&quot;VermSleeves&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;equipVSleeves-on.png&quot;)
	else
		mud:send(&quot;say accelerate&quot;)
	end
end

function SuppleGirdle(xcommand)
	local fname=&quot;SuppleGirdle&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;girdle-off.png&quot;)
	else
		if timer:get(&quot;SuppleGirdle&quot;) == nil then
			timer:set(&quot;SuppleGirdle&quot;, 10)
			mud:send(&quot;say strength of stone&quot;)
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>Tiamat</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function TiaWarder(xcommand)
	local fname=&quot;TiaWarder&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		if timer:get(&quot;TiaWarder&quot;) == nil then
			setLabelImage(fname, &quot;TiaWarder-charged.png&quot;)
		else
			setLabelImage(fname, &quot;TiaWarder-off.png&quot;)
		end
	else
		if timer:get(&quot;TiaWarder&quot;) == nil then
			timer:set(&quot;TiaWarder&quot;, 10)
			setLabelImage(fname, &quot;TiaWarder-off.png&quot;)
			cecho(&quot;&lt;red&gt;[Autoproc: Warder cloak]\n&quot;)
			mud:send(&quot;say blend&quot;)
		end
	end
end

function TiaLoop(xcommand)
	local fname=&quot;TiaLoop&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;equipTiaLoop-on.png&quot;)
	else
		mud:send(&quot;say aid of mage&quot;)
	end
end

function TiaClaws(xcommand)
	local fname=&quot;TiaClaws&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaClaws-on.png&quot;)
	else
		mud:send(&quot;say freezing flesh&quot;)
	end
end


function TiaScale(xcommand)
	local fname=&quot;TiaScale&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaScale-on.png&quot;)
	else
		mud:send(&quot;say deeply defend&quot;)
	end
end

function TiaCincture(xcommand)
	local fname=&quot;TiaCincture&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaCincture-on.png&quot;)
	else
		mud:send(&quot;say fell stars&quot;)
	end
end

function TiaManacle(xcommand)
	local fname=&quot;TiaManacle&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		if timer:get(&quot;TiaManacle&quot;) == nil then
			setLabelImage(fname, &quot;TiaManacle-on.png&quot;)
		else
			setLabelImage(fname, &quot;TiaManacle-off.png&quot;)
		end
	else
		if timer:get(&quot;TiaManacle&quot;) == nil then
			timer:set(&quot;TiaManacle&quot;, 10)
			setLabelImage(fname, &quot;TiaManacle-off.png&quot;)
			cecho(&quot;&lt;red&gt;[Autoproc: Tiamat Manacle]\n&quot;)
			mud:send(&quot;say no focus&quot;)
		end
	end
end

function TiaStability(xcommand)
	local fname=&quot;TiaStability&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaStability-on.png&quot;)
	else
		mud:send(&quot;say whirlwind&quot;)
	end
end


function TiaSandals(xcommand)
	local fname=&quot;TiaSandals&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaSandals-on.png&quot;)
	else
		mud:send(&quot;emote starts casting a spell called 'Shabay'.&quot;)
		mud:send(&quot;say my heavenly home&quot;)
	end
end

function TiaSleeves(xcommand)
	local fname=&quot;TiaSleeves&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaSleeves-on.png&quot;)
	else
		if timer:get(&quot;TiaSleeves&quot;) == nil then
			timer:set(&quot;TiaSleeves&quot;, 10)
			cecho(&quot;&lt;red&gt;[Autoproc: Tiamat Sleeves]\n&quot;)
			mud:send(&quot;say flesh mends&quot;)
		end
	end
end

function TiaBracers(xcommand)
	local fname=&quot;TiaBracers&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;tiaBracers-on.png&quot;)
	else
		mud:send(&quot;say let minds quicken&quot;)
	end
end

function TiaOcular(xcommand)
	local fname=&quot;TiaOcular&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;tiaOcular-on.png&quot;)
	else
		mud:send(&quot;say mine eyes divine&quot;)
	end
end


function TiaValhalla(xcommand)
	local fname=&quot;TiaValhalla&quot;

	charData:init(&quot;valhalla&quot;, &quot;defend&quot;)

	if xcommand == &quot;timer&quot; then
		return
	end

	if xcommand == &quot;init&quot; then
		--
	else
		if charData:get(&quot;valhalla&quot;) == &quot;defend&quot; then
			charData:set(&quot;valhalla&quot;, &quot;berserk&quot;)
			mud:send(&quot;say berserker fury&quot;)
		else
			charData:set(&quot;valhalla&quot;, &quot;defend&quot;)
			mud:send(&quot;say defender of asgard&quot;)
		end
	end

	if charData:get(&quot;valhalla&quot;) == &quot;berserk&quot; then
		setLabelImage(fname, &quot;TiaValhalla-berserk.png&quot;)
	else
		setLabelImage(fname, &quot;TiaValhalla-defend.png&quot;)
	end
end

function TiaVolance(xcommand)
	local fname=&quot;TiaVolance&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		if timer:get(&quot;TiaVolance&quot;) == nil then
			setLabelImage(fname, &quot;TiaVolance-charged.png&quot;)
		else
			setLabelImage(fname, &quot;TiaVolance-off.png&quot;)
		end
	else
		if timer:get(&quot;TiaVolance&quot;) == nil then
			timer:set(&quot;TiaVolance&quot;, 10)
			mud:send(&quot;say mirrors&quot;)
		end
	end
end

function TiaMask(xcommand)
	local fname=&quot;TiaMask&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaMask-charged.png&quot;)
	else
		if timer:get(&quot;TiaMask&quot;) == nil then
			timer:set(&quot;TiaMask&quot;, 10)
			setLabelImage(&quot;TiaMask&quot;, &quot;TiaMask-off.png&quot;)
			mud:send(&quot;project schism&quot;)
		end
	end
end

function TiaStaff(xcommand)
	local fname=&quot;TiaStaff&quot;

	if xcommand == &quot;timer&quot; or xcommand == &quot;expire&quot; and not isIconActive(fname) then
		return
	end

	if xcommand == &quot;init&quot; or xcommand == &quot;expire&quot; then
		setLabelImage(fname, &quot;TiaStaff-off.png&quot;)
	else
		if charData:get(&quot;TiaStaff&quot;) == nil or charData:get(&quot;TiaStaff&quot;) == &quot;&quot; then
			mud:send(&quot;protect&quot;)
		else
			mud:send(&quot;release&quot;)
		end
	end
end

function TiaWarmaul(xcommand)
	local fname=&quot;TiaWarmaul&quot;
	local label=findlabel(fname)

	charData:init(&quot;warmaul&quot;, &quot;off&quot;)

	if xcommand == &quot;timer&quot; then
		return
	end

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;equipWarmaul.png&quot;)

		NyyLIB.warmaul = NyyLIB.warmaul or 0

		TiaWarmaul(&quot;update&quot;)
	elseif xcommand == &quot;update&quot; then
		label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;]] .. charData:get(&quot;numcolor&quot;, true) .. [[&quot;&gt;]] .. NyyLIB.warmaul .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
	else
		local tmpvar=charData:get(&quot;warmaul&quot;)

		cecho(&quot;&lt;red&gt;[Warmaul: &quot; .. tmpvar .. &quot; type 'set warmaul off|aid|restore', or type 'aid' or 'restore' to proc accordingly]\n&quot;)

		if tmpvar == &quot;aid&quot; then
			mud:send(&quot;aid&quot;)
		elseif tmpvar == &quot;restore&quot; then
			mud:send(&quot;restore&quot;)
		end
	end
end

function TiaBane(xcommand)
	local fname=&quot;TiaBane&quot;
	local label=findlabel(fname)

	if xcommand == &quot;init&quot; then
		setLabelImage(fname, &quot;TiaBane-off.png&quot;)

		charData:init(&quot;bane&quot;, &quot;blind&quot;)
		charData:init(&quot;banecharges&quot;, 0)

		label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;]] .. charData:get(&quot;banecharges&quot;) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
	elseif xcommand == &quot;update&quot; then
		--label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;]] .. charData:get(&quot;banecharges&quot;) .. [[z&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
		label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;]] .. charData:get(&quot;banecharges&quot;) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
	else
		local tmpvar=charData:get(&quot;bane&quot;)

		if tmpvar == &quot;blind&quot; then
			mud:send(&quot;say Dragonblind&quot;)
		elseif tmpvar == &quot;poison&quot; then
			mud:send(&quot;say Dragonpoison&quot;)
		elseif tmpvar == &quot;slow&quot; then
			mud:send(&quot;say Dragonslow&quot;)
		elseif tmpvar == &quot;strike&quot; then
			mud:send(&quot;say Dragonstrike&quot;)
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <Script isActive="yes" isFolder="no">
                <name>changelog</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------


-- dev

-- autoassist will work with ungrouped pet followers
-- added outflank
-- refactored train - use 'starttrain tank' to start as engine
-- alias: stpm - sets the character as not moving
-- Added say, auction to tabbed chat windows
-- Map updated: full size 316 areas 44632 rooms

-- 011b

-- the function 'initCustom' will be called on initialization if it exists
-- self in group display if more then 1 person uses cyan colour 
-- file structure and installation updated - mudlet 3.1+ recommended
-- grouped hell hounds are named 'wolf'
-- set poisonbag - name of container containing all poisons
-- buttons refactored
-- set hideequip true/false - left equip bar shows on mouseover
-- clairvoyance will now show the room number viewed and zone name (if available)
-- spell buttons / cast script refactored
-- map window resized
-- changes to casting code
-- xp train starts fights with bodyslam (if ogre)
-- added most spells for all classes
-- pets/undead/mounts added to grouplist / displayed on screen
-- Change from necro to lich in wholist if needed
-- bugfixes
-- Map updated: full size 316 areas 44618 rooms

-- 011a

-- set echodrag true - gsay if a corpse is dragged into your room
-- rot/rain of blood buttons added
-- added tms to vote link
-- cleric: autorealm - keep the entire group realm'd
-- more xp train updates
-- kick enabled kicks mobs after you bash them
-- heal/harm buttons have been redone
-- bash changes to mounted charge after mounting
-- summount mount changes to mount/dismount button after summoning
-- refactored gui buttons
-- type prac, then 'scribeall' to scribe all spells
-- type prac, then 'pracall' to practice all skills
-- scripted: magic missile, earth darts, totem darts, shadow bolt
-- can't cast when paralyzed
-- 'scan' will attempt to solve for unknown map locations
-- half orcs will now use furious assault
-- rogue: assassinate timer
-- illusionist, druid, elementalist, invoker, paladin, anti, ranger, rogue added
-- changed #cd to disable rescue
-- bugfix: casting after gsay of 'moving'
-- Map updated: full size 314 areas 44262 rooms

-- 010

-- refactored and fixed gui sizing
-- set sound on|off|limited - limited plays sounds from tell, petition only
-- #zone command added to list zones example: '#zone swamp'
-- earthquake changed to use non-powers
-- hs being properly distinguished for haste/hamstring
-- fixed mapper not updating properly on dragon autoreturn
-- mapper fixed for passing through magically darkened rooms
-- autotank will not fire if less then 75% hp
-- more sounds!
-- pet rescue button added
-- sounds added for group members getting killed/ressurected 
-- set autohuw - enable/disable casting of holy/unholy word
-- buff:get function changed
-- change bid script to distinguish/display/match capital letters, hyphens
-- icy bash now recognized for success/failure
-- bless button for bard changed to cast harmonious blessing whenever needed
-- set forcerenew - bard will sing renew even at full psp
-- send stand before assist if memorizing
-- stand trigger: In your haste to slam people around, you slip and fall!
-- Get off your knees! added to stand triggers
-- disruption burst added to clerics
-- consent will be provided to anyone that asks
-- Map updated: full size 313 areas 44229 rooms

-- 010rc2

-- another shaman casting groupheal clears blind properly
-- escape working properly for rogues
-- #backup restore updates highlighted buttons
-- Map updated: full size 311 areas 43864 rooms
-- No more split maps - only toril.map used now
-- update map for movement when dragging corpses
-- enchanter will cast prismatic spray
-- clerics will cast holy/unholy word
-- bottom left corner counter changed to show stun
-- set vit nopriest - exclude cleric, shaman, druid from vit
-- fixed inittrain in silverymoon
-- local spell count is updated when casting begins (powerAliases)
-- set wuss charname - this character will be rescued and enchanter spelled regardless of settings
-- groupheal scripted for shaman
-- casting is now autocast on/off
-- set grpfontsize to change font used if &gt; 2 in group
-- 'spells' button changed to cast various spells while enabled (on/off)
-- spellcast/command queue refactored
-- set autores true - res any grouped (consented) corpses present in room
-- cdaura now part of autoheal
-- autoflee is temporarily disabled after 3 failed attempts in the same room
-- set swedish true/false - translate ooc/acc/etc to swedish
-- bugfix: autoflee/mem with caster train
-- set autoquake true - quake certain mobs if seen standing
-- queue cure blind as needed, clear cb from queue on groupheal
-- set autocb true - auto cast cure blind
-- autoenter portal/rift/gate if more people have entered it then grouped warriors
-- special entrances/exits working on map
-- various refactors

-- 010rc1

-- Map updates: full size 289 areas 42082 rooms
-- xp train fixed for an emerald and ruby encrusted dagger
-- xp train fixed for an onyx dagger with a pulsing ruby hilt
-- added bot warning to xp train
-- added hell hound to mounts list
-- shift alias changed to use powers relocate
-- triggers changed from mem autostand
-- casting now echoes the name of the spell being cast
-- autovit - vit after every mem
-- improved #clist
-- display position is now forced true
-- brief mode no longer required to be used with the mapper
-- set style to change css style of buttons
-- fixed autopen door names with newer map format
-- #cd delay changed to 5 sec for casting purposes

-- 010e

-- The script is now running with Mudlet release 30 pr308 of mudlet (compiled)
-- windows: https://github.com/Nyyrazzilyss/NyyLIB/raw/master/mudlet_w32_pr308.zip
-- osx: https://github.com/Nyyrazzilyss/NyyLIB/raw/master/Mudlet.app.zip

-- It should still work with -delta, though attempting to use the full Toril map will be SLOW
-- Map updates are no longer occuring to the individual mapsfiles, only to the toril.map file

-- THE BELOW STEPS SHOULD NOT BE EVEN ATTEMPTED ON MUDLET 3.0-DELTA - ONLY PR308

-- map has been combined into a single mapfile - to switch to using it, type #map toril
-- type #map update after the first time switching to the toril map to update with previously saved map progress

-- Map updates: Full size 254 areas 37958 rooms

-- bugfix: mem'ing darkness won't give illithid messages
-- the script will force restarting now after installation
-- scaleskin button only shown for yuan-ti
-- heal button for clerics will que healing aura on warriors when casting
-- petitions are placed on the 'tells/all' communication tab
-- added labels on map to zone edges

-- 010d

-- Map: Clouds, Ethereal Plane
-- character change after camping fixed
-- Baldurs Gate map fixed (dire raider guildhall)
-- #path command will now provide reverse paths from current room
-- Map: Dragonspear Castle
-- updates to Skullport map
-- Map: Tower of the Elementalist, Keep of Finn McCumhail
-- bidscript won't allow bids with mutiple possible matches
-- set chatfontsize fixed
-- 'starttrain tank' to start as head, regardless of not being warrior class
-- mesh manacle will proc at 70% hp
-- volance will proc at 60% hp
-- warder cloak will proc at 30% hp
-- supple girdle, tiamat sleeves will proc at 25% hp
-- bard singing renew by choice will switch to heal at maxpsp
-- set hideicons true to turn off display of the icon bar
-- maps: Lizard Marsh, Fire Giants Lair
-- centralized debug messages - set condensed debug
-- groupList:whoTanking() - table with how many mobs are on each character
-- #clist list chars now from both katumi database and local cache
-- prompt variables are now located in a prompt:get function
-- fixed condensed duplicate with signs
-- dire raiders
-- starttrain now checks area, and runs different paths for ashstone/silverymoon
-- prime.map split into prime1, prime2. type '#map split'
-- alias: cast - start casting (same as spells button)
-- added maps: Icecrag 2, Hulburg, the Temple of Twisted Flesh, Skerttd-Gul, Mistywood                                      
-- alternate button for check status: group
-- some buttons converted to nesting labels
-- even more cleric stuff
-- more refactors
-- bugfixes

-- 010c

-- set numcolor color to change number colors from the default blue
-- set pokehaste true/false to cast haste when poked
-- set gcmd true/false to use gcmd for gsay
-- some more cleric stuff
-- more refactors
-- bugfixes

-- 010b

-- Map updates: Ashstone, Nightwood, Splitshield
-- aliases: guide, forum, quest open browsers to the newbie guide, torilmud forums, and vb quest website
-- tabs will now be drawn properly (primarily visible in trophy, attributes &lt; level 20)
-- directions bound to keypad: 7=u 8=n 9=d 4=w 5=s 6=e
-- problem with saving map files fixed
-- 'send command' will insert a command into spell queue for immediate execution

-- 010a

-- major refactoring
-- 'resettrain' will disable all train triggers if ended incorrectly
-- added 'starttrain' triggers for casters
-- some cleric icons
-- tweaked valhalla icon
-- #fwalk all - list all fwalks regardless of area
-- the set command rewritten
-- Map updates: Muspelhiem 
-- various changes to add ansi
-- group commands sent by the script itself will be gagged
-- clicking the memorize/pray button will stand if currently mem'ing
-- memorize/pray button now show countdown for remaining spells
-- Updated caster buttons - counters for memorized spells
-- New buttons: bracers of time, warmaul, ocular disc
-- updates to mudlet condensed mode
-- some shaman triggers

-- 009 (final)

-- bugfixes

-- 009rc2

-- misc bugfixes/code cleanup
-- set group true|false - use redesigned group display

-- 009rc1

-- stats tracking added to 'group' command
-- #help astral - zone directions
-- #backup logs - copies contents of profile log files into backup folder
-- map density increased to maximum
-- set border default|none|file - changes the background image used (.png file)
-- added condensed modes - set condensed {dragon|combat|spells|items|arrows|misc|duplicate}
-- various map fixes
-- various bugfixes
-- maps added: The Lurkwood

-- 009d

-- misc bugfixes
-- fwalk/doubleclicking on map room to speedwalk will no longer send a 'stand' command (it breaks hide)
-- path corrected for #backup on osx/linux
-- fwalk will no longer run if path is longer then 100 rooms
-- maps added: Basin Wastes
-- maps fixed: Magma


-- 009c

-- #backup command added: type #backup for more information
-- misc bug fixes
-- permenantly 'locked' rooms flagged in maps - speedwalks will never pass through these rooms
-- #path now provides room path split at 50 rooms
-- #path now works with #fwalk names
-- update map on doorbash
-- maps added: Dark Forest, Orcish Halls of Plunder
-- maps fixed: CPV, Twisted Rune, Roads of the Heartland 1/2, VB Guildhall, UM2


-- 009b

-- map will update properly when tracking
-- Abreviations when loading maps: ud=underdark, em=evermeet
-- enlarge option added to enchanter resize button
-- some (most) buttons recoloured
-- more map updates (Ice, Faerie Realms, Seelie Faerie Court)
-- character profilenames will be updated from more sources
-- #stats - warrior statistics
-- #save - save chardata, loaded map
-- es[dir][b/c/p] - p=powers backstab
-- added room name to #room window
-- prompt won't be echoed to chat/room window if the mud doesn't send newline

-- 009a

-- map density increased 16x
-- Type #room to show/hide room capture window
-- #cd [dir] - countdown script - attacks targetname from #attack command, if none does hitall
-- #fwalk now shows length in rooms to destination, only shows destinations reachable from current location
-- es[dir][b/c] - escape direction, return, and backstab/circle targetname from #attack (example: eswb, esnc) 
-- #at[dir] (example #atn, #ats, etc) - move direction and backstab target
-- #attack targetname - set targetname variable
-- gui has been changed around

-- 008 (final)

-- Faang, Darktree moved to Underdark map
-- Added maps: Various Moonshaes - Added to 'evermeet' map
-- Added maps: Conqured Village, Baphomet
-- Room colours added
-- #fwalk results sorted by area
-- #path command to display path/length to room number

-- 008rc3

-- Added maps: Drulak, Plane of Fire 1&amp;2, Water, Yggdrasil
-- #afind pattern - find discovered rooms matching pattern in current area
-- #map update - update loaded map without resetting unlocked rooms
-- #fwalk shows area rooms are located in

-- 008rc2

-- Katumi database updated 2015/10/10
-- To help with map related slowdowns, it has been split to multiple files: scardale, prime, underdark, evermeet, planes
-- example: type: '#map scardale' to switch to Scardale map (Scardale map also includes Waterdeep)
-- 'set autoopen false' to disable opening doors
-- Doors added to map, and moving/fwalk through them will attempt to open first
-- misc updates to mapper
-- Added Maps: Temple of Dumathoin, Lair of the Deep Dragon, Yath Olath, more!
-- Added maps: Evermeet Bay, Manscorpions, Seer Kings, Ixarkon Prison, Githyanki, Choking Palace, Twisted Rune

-- 008rc1

-- sm xp train - type 'inittrain' in Silverymoon to setup map.
--	  (note this will run several minutes, and look like it's frozen), starttrain, stoptrain
-- #help command

-- 008g

-- #fwalk information now profile specific, not stored by character.
-- set vnum true/false - display room vnum after exits
-- tank rescue will occur at ph/awful, if self &gt; .30 maxhp
-- bash corrected if not warrior
-- Added maps: Imphras Guildhall, Trollbark Forest, Spiderhaunt, Thunderhead Peak, Earth Plane

-- 008f

-- major improvements to keeping map in sync
-- alias: fwalk changed to #fwalk, new command structure
--		#fwalk  - instructions, list of existing fwalks
--	   #fwalk roomnumber - fastwalk to specific room number
--    #fwalk name - fastwalk to room indicated by previously added name
--    #fwalk add name - adds a fastwalk using 'name' to the currently occupied room
--    #fwalk del name - deletes fastwalk 'name'
-- profile names are displayed after character names on 'group'
-- Added maps: The Evermoors, Undermountain 1&amp;2, The Underdark Trade Route, The Underworld, Nizari, Labyrinth of No Return, The Spirit Raven (Pirate Ship), Calimsham Desert, 
-- misc bugfixes

-- 008e

-- 3 choices now on enchanter globe: off, hitters, or all (hitters+warriors)
-- alias: #find - findroom merged with this alias, type #find to locate current position/or #find roomname
--  #find * - list all discovered rooms
-- autoroller: 
--		mighty=1 heroic=2 perfect=3
--		mighty heroic heroic perfect = 1 + 2 + 2 + 3 = 8
--	set autoroll 8    - stop on rolls &gt;= 8
--	alias: #roll - start autoroller
-- alias: map - updated, type 'map' for more information
-- alias: castspells - same as clicking spells button
-- alias: #id itemname - identify matching items
-- alias: dep - deposit all coins held or inside main storage container to the bank
-- disarm button added
-- More maps: New Cavecity, Klauthen Vale, The Shadow Swamp, The Swamps of Meilech, Darklake, Tunnel of Dread
-- size, buffs removed on death
-- more fixes to mapper to locate rooms / keep in sync
-- warrior will auto rescue other warriors if awful/ph/nasty and &gt;400hp
-- alias: #clist charname - list all known characters for that char's profile
-- alias: #gall charname - gag all characters for that char's profile
-- when examining containers, potions, scrolls will be identified on screen
-- alias: #statitems gsay - echo glist stats to gsay
-- alias: #statitems - echo glist stats to screen
-- katumi database incorporated
-- bid script: type 'bid help' for commands
-- rm (rescue me) alias changed to 'rme' not to conflict with righteous might
-- update map on escape

-- 008d

-- #gag/#ungag commands
-- enchanter: swapts alias - switch ds and ts in memorized spells
-- size button for enchanter: reduce halfing/gnome casters, enlarge ogre warriors
-- players added to onscreen group if not present and they gsay
-- set autotank true/false
-- set powersbash true/false
-- set valhalla defend/berserk
-- no more rescuing paladins/antipaladins in basic rescue mode

-- 008c

-- added some more documentation
-- mapper updates
-- 16765 rooms / 91 areas now included

-- 008b

-- All rooms are now hidden on the map until you have discovered it
-- find now checks for matching room name + exits

-- 008a - The mapper!

-- addarea - by itself for available areas, with an area number to add a blank map for the area
-- fwalk roomid - Fastwalk to roomid
-- findroom name - Search entire map for matching rooms
-- find - set your location on the map (Only Silverymoon, Scardale, Vipertounge, Western Realms at this time)
-- map load/save - to save your own map
-- map on/off - turn map display on or off

-- 007

--	Final release of 007 series

--007rc4b, 007rc4c

-- bugfix

-- 007rc4

-- added 'escape direction' for all classes
-- show body size
-- kill people if they're charmed
-- gsay on size change, consent
-- added feeblemind to group display
-- updated fastwalks (mostly wd area)

-- 007rc3

-- fwalk now includes reversed fastwalks
-- skill improvement capture window
-- bugfixes, mostly for warrior - rescue seems to work now

-- 007rc2

-- auto assist and rescue improved
-- bugfixes

-- 007h

-- meditate/stand button for psi
-- generic spells button for all script-less casters
--		set masscast powersname to spell name for it to cast
-- equip procs: bane
-- set automem (start memorizing if the majority of the group does)
-- fly now an option on endspell
-- added para, blind, silent to group display
-- on screen xp counter (until level 50)
-- misc bugfixes

-- 007g

-- song of miscast magic added (commandline only)
-- misc bug fixes

-- 007f

-- shaman now has functioning generic spells button
--   set masscast powersname to spell name for it to cast
-- added 'pwt' to endspell options
-- internal buff lengths update based on powers info / sf enc
-- added 'version' command
-- regen song button in place of heal song for lower level bard
-- mem on bard/battlechanter now handled properly
-- add people to grouplist if they gsay
-- some work done with rescue
-- updated fastwalks
-- disabled spellguard kill trigger
-- bugfix on adding to who database

-- 007e

-- self will be autoadded to wholist on initial login
-- improved autoassist
-- deathfield button for unquested psi
-- updated fastwalks
-- added rescue/bash/kick (such that they are) from War to Pal, A-P, Ran, Dir
-- some basic instructions added (type 'client' to read them)

-- 007d

-- set endspell (vit, dsp) - change the final spell displayed in group window
-- marking dead is now done by the new death message
-- updated buttons (sleeves, sandals, loop, grin)
-- set assocchar (charname) - connect to association chat on login
-- spellout messages are now changeable
-- minimum level now on button creation
-- fwalk alias for fastwalks</script>
                <eventHandlerList/>
            </Script>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>BOTS</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <ScriptGroup isActive="yes" isFolder="yes">
                    <name>WaterXP</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                    <eventHandlerList/>
                    <Script isActive="yes" isFolder="no">
                        <name>waterscripts</name>
                        <packageName></packageName>
                        <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------


-- first level: .5ne5ne5ne5ne5ne
-- 2nd level: .5ne5ne5ne5ne5ne



function initwater()
	NyyLIB.bots= NyyLIB.bots or {}

	NyyLIB.bots.advfound=0
	
	NyyLIB.bots.advposition=0

	NyyLIB.bots.xval=0
	NyyLIB.bots.yval=0
	NyyLIB.bots.zval=0

	expandAlias(&quot;.6n&quot;)
	send(&quot;snap&quot;)

	-- dirs to start room .nwnwndn

	--chklevel

	--#IF (@NyyLIB/WaterPlane/advfound = 0) {
   --NyyLIB/Waterplane/zval = 2
   -- .2d
   -- chklevel
end

function checklevel()
--#LOOP 1,5 {
--  chkrow
--  #IF (@NyyLIB/WaterPlane/advfound=1) {
--    #ABORT 1
--  }
--  {
--    NyyLIB/WaterPlane/xval = @NyyLIB/WaterPlane/xval+1
--    #IF (@NyyLIB/WaterPlane/xval &gt; 4) {
--      NyyLIB/WaterPlane/xval=0
--    }
    
--    w
--  }
--}
end

function checkrow()
--#LOOP 1,5 {
--  #IF (@NyyLIB/WaterPlane/advfound != 1) {
--    #wait 500
--    scan
--    #WAIT 750
--  }
--  #IF (@NyyLIB/WaterPlane/advfound=1) {
--    #ABORT 1
--  }
--  {
--    n
--    NyyLib/WaterPlane/yval=@NyyLib/WaterPlane/yval+1
--    #IF (@NyyLib/WaterPlane/yval&gt;4) {
--      NyyLib/WaterPlane/yval=0
--    }
--  }
--}
end</script>
                        <eventHandlerList/>
                    </Script>
                </ScriptGroup>
                <Script isActive="yes" isFolder="no">
                    <name>TrainScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-- various functions used with the xp trains

function NextTrainStop()
	local currentroom = map:getRoom()

	callNextTrain=nil

	-- if currently tanking anything, don't move
	if inCombat() then
		cecho(&quot;&lt;red&gt;[Still in combat - not leaving room]\n&quot;)
		return
	end	

	-- look has been sent but not received - recall function after 1 second if grouped player fighting
	if type(groupList:whoTanking()) == &quot;table&quot; and NyyLIB.tolook == 0 then
		for k,v in pairs( groupList:whoTanking() ) do
			if groupList:ingroup(k) and v ~= 0 then
				display( groupList:whoTanking() )
				echoDebug(&quot;&lt;red&gt;[look sent and not received]\n&quot;)
				tempTimer(1, [[NextTrainStop()]])
				return
			end
		end
	end

	if NyyLIB.smtrainposition == nil then
		assert(currentroom, &quot;[Error: room id is nil]&quot;)

		if getZone() == &quot;Ashstone&quot; then
			getPath(currentroom, 87415)
			mud:send(&quot;gcmd [Stopping train and returning to bank (87415)&quot; .. &quot; &lt;.&quot; .. compressSpeedwalk() .. &quot;&gt;]&quot;)
			expandAlias(&quot;#fwalk 87415&quot;, false)
		else
			getPath(currentroom, 48603)
			mud:send(&quot;gcmd [Stopping train and returning to inn (48603)&quot; .. &quot; &lt;.&quot; .. compressSpeedwalk() .. &quot;&gt;]&quot;)
			expandAlias(&quot;#fwalk 48603&quot;, false)
		end

		expandAlias(&quot;resettrain&quot;, false)
	else
		NyyLIB.smtrainposition = NyyLIB.smtrainposition + 1

		if NyyLIB.smtrainposition &gt; #NyyLIB.smtrainstops then
			NyyLIB.smtrainposition = 1

			printStats(3)

			expandAlias(&quot;#stats write&quot;, false)

			mud:send(&quot;gcmd [Resetting Stats]&quot;)
			resetStats()
		end

		NyyLIB.nextstop = NyyLIB.smtrainstops[NyyLIB.smtrainposition][1]
		enableTrigger(&quot;trainstation&quot;)

		assert(currentroom, &quot;[Error: room id is nil]&quot;)
		if getPath(currentroom, NyyLIB.nextstop) then

			local str = NyyLIB.smtrainstops[NyyLIB.smtrainposition][2]
			local nextmob = string.gsub(&quot; &quot;..str, &quot;%W%l&quot;, string.upper):sub(2)

			mud:send(&quot;gcmd [Moving to: &quot; .. nextmob ..
							&quot; (&quot; .. NyyLIB.smtrainstops[NyyLIB.smtrainposition][1] .. &quot;) &quot; ..
 							&quot; &lt;.&quot; .. compressSpeedwalk() .. &quot;&gt;]&quot;)
		end
		NyyLIB.traintarget=false
	
		if currentroom ~= NyyLIB.nextstop then
			echoDebug(&quot;&lt;red&gt;[queueing fwalk in 3 seconds]\n&quot;)
			tempTimer(3, [[expandAlias(&quot;#fwalk &quot; .. NyyLIB.nextstop)]])
		end
	end
end

function StartFight()
	local mobtarget = string.split(NyyLIB.smtrainstops[NyyLIB.smtrainposition][2], &quot; &quot;)[1]

	if NyyLIB.traintarget then
		setEnemy(mobtarget)

		mud:send(&quot;gcmd [Attacking: &quot; ..  string.title(mobtarget) .. &quot;]&quot;)

		-- rogue, anti-paladin - apply poison
		if checkMask(&quot;venomer&quot;) then
			sendPoison()
		end	


		-- rogue: start with assassinate
		if checkMask(&quot;rog&quot;) then
			if not sendAssassinate() then
				mud:send(&quot;bs &quot; .. mobtarget)
			end

			return
		end


		-- warrior classed - start with bash, bodyslam, mounted charge
		if checkMask(&quot;traintanks&quot;) then
			if checkMask(&quot;fighter&quot;) then
				if mount:get() == nil then
					if whorace(whoami()) == &quot;Ogre&quot; then
						mud:send(&quot;bs &quot; .. mobtarget) -- bodyslam
					else
						mud:send(&quot;bash &quot; .. mobtarget)
					end
				else
					mud:send(&quot;mount&quot;)
					mount:charge(mobtarget)
				end
				return
			end
		end			

		-- shouldn't be reached
		send(&quot;kill &quot; .. mobtarget)
	else
		cecho(&quot;\n&lt;red&gt;[Target is damaged or already dead - Moving to next target]\n&quot;)
		NextTrainStop()
	end
end

function bankDeposit()
	expandAlias(&quot;dep&quot;, false)

	if groupList:size() &gt; 1 then
		botWarning()
	end
end

function botWarning()
	mud:send(&quot;gsay * [       Warning! Use at own risk!       ]&quot;)
	mud:send(&quot;gsay * Toril discourages use of robots. Use may be&quot;)
	mud:send(&quot;gsay * permitted if at or near keys, but not for&quot;)
	mud:send(&quot;gsay * long periods of time. This may result in&quot;)
	mud:send(&quot;gsay * arbitrary punishment, including aggressive&quot;)
	mud:send(&quot;gsay * mob loads, teleportation, caging, freezing&quot;)
	mud:send(&quot;gsay * and deletion.&quot;)
	mud:send(&quot;gsay * [       Warning! Use at own risk!       ]&quot;)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>setupTrain config</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-- TODO: update inittrain path in Silverymoon

	smtrain = {
		{84203, &quot;bankDeposit&quot;},
		{48882, &quot;Willa O'Greensleeves&quot;},
		{48873, &quot;Aratha Sul&quot;},
		{48524, &quot;Lavis Ryl&quot;},
		{48525, &quot;Elaith Waterstill&quot;},
		{48518, &quot;Shalyssa Lurialar&quot;},
		{48850, &quot;Forell Luckaun&quot;},
		{48721, &quot;Seipora Rein&quot;},
		{48681, &quot;Corland Deepforge&quot;},
		{48586, &quot;Ersenas&quot;},
		{49135, &quot;Ultrumm&quot;},
--		{49054, &quot;Tathshandra Tyrar&quot;},
--		{94648, &quot;Otasit&quot;},
		{49117, &quot;devout priest&quot;},
		{49036, &quot;Dragor Keenblade&quot;}
	}

	ashtrain = {
		{87415, &quot;bankDeposit&quot;},
--		{87411, &quot;Stephan&quot;},
--		{87402, &quot;lich&quot;},
		{87263, &quot;gambler&quot;},
		{87270, &quot;bouncer&quot;},
--		{87271, &quot;naked man&quot;},
		{87272, &quot;prostitute&quot;},
		{87275, &quot;aging prostitute&quot;},
		{87276, &quot;naked woman&quot;},
		{87254, &quot;Ashstone noble&quot;},
		{87251, &quot;Ashstone noble&quot;},
		{87249, &quot;Ashstone noble&quot;},
		{87314, &quot;kindly priest&quot;},
		{87253, &quot;Ashstone noble&quot;},
		{87258, &quot;Ashstone noble&quot;},
		{87257, &quot;Ashstone noble&quot;}
	}

	wdtrain = {
		{13402, &quot;elite&quot;},
		{13359, &quot;elite&quot;},
		{13343, &quot;elite&quot;},
		{13354, &quot;master&quot;},
		{13397, &quot;master&quot;}
--		{85354, &quot;elite guard&quot;},
--		{85358, &quot;elite guard&quot;},
--		{85356, &quot;elite guard&quot;},
--		{85410, &quot;elite guard&quot;},
--		{85421, &quot;elite guard&quot;},
--		{85349, &quot;elite guard&quot;}
	}


function configureTrain()
	-- disable any active triggers prior to enabling
	expandAlias(&quot;resettrain&quot;, false)

	cecho(&quot;&lt;green&gt;[Laying train tracks...]\n&quot;)

	if getZone() == &quot;Ashstone&quot; then
		NyyLIB.smtrainstops = ashtrain
	elseif getZone() == &quot;Silverymoon, Gem of the North&quot; then
		NyyLIB.smtrainstops = smtrain
	elseif getZone() == &quot;Northern Waterdeep Main City&quot; then
		NyyLIB.smtrainstops = wdtrain
	elseif getZone() == &quot;The Great Harbor of Waterdeep&quot; then
		NyyLIB.smtrainstops = wdtrain
	end
end

</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>setupTrain mode</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function trainEngine()
	charData:set(&quot;autoloot&quot;, &quot;coins&quot;)
	charData:set(&quot;flee&quot;, &quot;off&quot;)
	flee(&quot;init&quot;)
	mud:send(&quot;tog wimp 0&quot;)

	if checkMask(&quot;fighter&quot;) then
		cecho(&quot;&lt;red&gt;[Setting rescue type to ALL]\n&quot;)
		charData:set(&quot;rescuetype&quot;, &quot;all&quot;)
		rescue(&quot;init&quot;, &quot;rescue&quot;)

		cecho(&quot;&lt;red&gt;[Enabling autobash]\n&quot;)
		charData:set(&quot;autobash&quot;, true)
		bashing(&quot;init&quot;)

		cecho(&quot;&lt;red&gt;[Disabling powersbash]\n&quot;)
		charData:set(&quot;powersbash&quot;, false)

		if whoclass() ~= &quot;Pal&quot; then
			cecho(&quot;&lt;red&gt;[Enabling autokick]\n&quot;)
			charData:set(&quot;autokick&quot;, true)
			KickButton(&quot;init&quot;)
		end

		-- dismount if currently mounted
		if mount:getMounted() then
			mud:send(&quot;dismount&quot;)
		end
	end

	charData:set(&quot;statname&quot;, &quot;train&quot;)

	mud:send(&quot;gcmd [Resetting Stats]&quot;)
	resetStats()

	NyyLIB.smtrainposition=0
	enableTrigger(&quot;SMTrain&quot;)
end

function trainCar()
	cecho(&quot;&lt;green&gt;[Starting train car...]\n&quot;)

	-- disable loot / enable flee
	charData:set(&quot;autoloot&quot;, &quot;off&quot;)
	charData:set(&quot;flee&quot;, &quot;on&quot;)
	loot(&quot;init&quot;)
	flee(&quot;init&quot;)

	-- set wimpy to maximum
	mud:send(&quot;tog wimp &quot; .. prompt:get(&quot;maxhp&quot;) )

	-- enable autoassist
	charData:set(&quot;autoassist&quot;, true)
	autoassist(&quot;init&quot;)

	if checkMask(&quot;missile&quot;) then
		cecho(&quot;&lt;red&gt;[Starting: Caster train triggers]\n&quot;)
		enableTrigger(&quot;SMTrainCaster&quot;)

		-- enable casting of missile spells
		charData:set(&quot;automissile&quot;, true)

		-- don't enable casting for dire - removed
		--if not checkMask(&quot;dire&quot;) then
			charData:set(&quot;autocast&quot;, true)
			SpellsButton(&quot;init&quot;)
		--end
	end
end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>Mapper.002</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>MapperScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
	map = map or {}

function isRoomName(testindex)
	local teststring = getLines(getLineNumber()-testindex, getLineNumber())[1]

	if teststring == nil then
		return
	end

	-- if first character not a capital letter can't be room name	

	if not string.find(teststring, &quot;^[A-Z]&quot;) then
		return(false)
	end

	-- if final character is period can't be room name

	if string.find(teststring, &quot;[.]$&quot;) then
		return(false)
	end

	return(true)
end

function isStringPrompt(teststring)
	if string.find(teststring, &quot;^&lt; .* &gt;&quot;) then
		return(true)
	end

	return(false)
end

function map:getRoom()
	return ( self.roomid )
end

function map:setRoom(xid)
	if xid ~= nil then
		if getRoomArea(xid) == -1 then
			unhideRoom(xid)
		end
	end

	self.roomid = xid

	--display(&quot;map:setRoom() to:&quot;)
	--display(self.roomid)

	raiseEvent(&quot;newRoomEvent&quot;, map:getRoom() )
end

function map:getZone(roomid)
	local areaID
	local areaname

	if roomid == nil then
		return( &quot;&quot; )
	end

	areaID = getRoomArea( roomid )

	if areaID ~= nil then
		if areaID == -1 then
			local zone=getRoomUserData(roomid, &quot;zoneid&quot;)
			local zoneid=tonumber(zone)

			areaname = NyyLIB.areaTable[zoneid]
		else
			areaname=getRoomAreaName(areaID)
		end
	end

	return (areaname)
end

function map:hide()
	if NyyLIB.mapwindow ~= nil then
		NyyLIB.mapwindow:show()
		NyyLIB.mapwindow:hide()
	end
end

function map:show()
	if NyyLIB.mapwindow ~= nil then
		NyyLIB.mapwindow:hide()
		NyyLIB.mapwindow:show()
	end
end

function map:count()
	if self.roomcount == nil then
		self.roomcount=0

		for k,v in pairs(getRooms()) do
			self.roomcount=self.roomcount+1
		end
	end

	return(self.roomcount)
end


function loadTorilMap(xmapname)
	-- create mapper window if not yet present

	mudlet = mudlet or {}; mudlet.mapper_script = true

	if NyyLIB.mapwindow == nil then
		NyyLIB.mapwindow = Geyser.Mapper:new({name=&quot;mapper&quot;,x=&quot;66%&quot;,y=0,width=&quot;33%&quot;,height=&quot;50%&quot;})
	end

	-- if function setDefaultAreaVisible exists, set it to false

	if setDefaultAreaVisible ~= nil then
		setDefaultAreaVisible(false)
	end

	-- top level map will be loaded if exists, otherwise the default
	local is_file = io.open(homepath(xmapname))
	local loadok	

	if is_file ~= nil then
		loadok = loadMap(homepath(xmapname))

		if loadok then
			cecho(&quot;&lt;red&gt;[Loaded map: &quot; .. homepath(xmapname) .. &quot;]\n&quot;)
		end
	else
		loadok = loadMap(mainpath(xmapname))

		if not loadok then
  			cecho(&quot;&lt;red&gt;[Failed map load: &quot; .. mainpath(xmapname) .. &quot;]\n&quot;)
		else
  			cecho(&quot;&lt;red&gt;[Loaded map: &quot; .. mainpath(xmapname) .. &quot;]\n&quot;)

			-- initial map load - save file
			saveMap( &quot;&quot; )
		end
	end

	expandAlias(&quot;#find&quot;, false)
end

function getDoorName(xroomid, xdir)
	local dirname={  [&quot;n&quot;]=&quot;north&quot;,
						 [&quot;s&quot;]=&quot;south&quot;,
						 [&quot;u&quot;]=&quot;up&quot;,
						 [&quot;d&quot;]=&quot;down&quot;,
						 [&quot;e&quot;]=&quot;east&quot;,
						 [&quot;w&quot;]=&quot;west&quot; }
	local exitNames
	local checkdir=xdir

	exitNames = getDoors(xroomid)

	if exitNames[xdir] then
		exitNames = getRoomUserData(xroomid, &quot;exitNames&quot;)

		if exitNames ~= &quot;&quot; and exitNames ~= nil then
			exitNames = yajl.to_value(exitNames)
		else
			exitNames = {}
		end

		if dirname[xdir] ~= nil then
			checkdir=dirname[xdir]
		end

		if exitNames[checkdir] then
			return(exitNames[checkdir])
		end

		return(&quot;door&quot;)
	end

	return(nil)
end

function setDoorName(xroomid, xdir, xdoorname)

	if roomExists(xroomid) then
		local exitNames = getRoomUserData(xroomid, &quot;exitNames&quot;)

		--display(exitNames)

		if exitNames == &quot;&quot; or exitNames == nil then
			exitNames = {}
		else
			exitNames = yajl.to_value(exitNames)
		end
			
		--echo(&quot;Door name: &quot; .. xdoorname .. &quot; Room id: &quot; .. xroomid .. &quot;\n&quot;)

		exitNames[NyyLIB.Mapper.exitmap[xdir]] = xdoorname

		setRoomUserData(xroomid, &quot;exitNames&quot;, yajl.to_string(exitNames))
	else
		echo(&quot;[Error: Attempt to set door in non-existent room: &quot; .. xroomid .. &quot; : &quot; .. xdir .. &quot; : &quot; .. xdoorname .. &quot;]\n&quot;)
	end
end

function setDoNotEnter(xroomid)

	if roomExists(xroomid) then
		setRoomUserData(xroomid, &quot;DoNotEnter&quot;, &quot;X&quot;)
	else
		echo(&quot;[Error: Attempt to set DNE in non-existent room: &quot; .. xroomid .. &quot;]\n&quot;)
	end
end

function getDoNotEnter(xroomid)
	local str=getRoomUserData(xroomid, &quot;DoNotEnter&quot;)

	if str == &quot;X&quot; then
		return(true)
	end

	return(false)
end

function queueMovement(xmove)
	NyyLIB.Mapper.movement = NyyLIB.Mapper.movement or {}
	
	if NyyLIB.Mapper.queueroomID == nil or #NyyLIB.Mapper.movement == 0 then
		NyyLIB.Mapper.queueroomID = map:getRoom()
	end

	if NyyLIB.Mapper.queueroomID ~= nil then
		exits = getRoomExits(NyyLIB.Mapper.queueroomID)

		if exits == nil then
			cecho(&quot;&lt;red&gt;[nil exits from &quot; .. NyyLIB.Mapper.queueroomID .. &quot;]&quot;)
		end

		local doors = getDoors(NyyLIB.Mapper.queueroomID)

		-- if there's a door in the way, open it
		if charData:get(&quot;autoopen&quot;) then
			if xmove == &quot;n&quot; and doors[&quot;n&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;n&quot;) .. &quot; north&quot;)
			elseif xmove == &quot;s&quot; and doors[&quot;s&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;s&quot;) .. &quot; south&quot;)
			elseif xmove == &quot;e&quot; and doors[&quot;e&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;e&quot;) .. &quot; east&quot;)
			elseif xmove == &quot;w&quot; and doors[&quot;w&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;w&quot;) .. &quot; west&quot;)
			elseif xmove == &quot;u&quot; and doors[&quot;u&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;u&quot;) .. &quot; up&quot;)
			elseif xmove == &quot;d&quot; and doors[&quot;d&quot;] then
				send(&quot;open &quot; .. getDoorName(NyyLIB.Mapper.queueroomID, &quot;d&quot;) .. &quot; down&quot;)
			end
		end

		if xmove == &quot;n&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;north&quot;]
		elseif xmove == &quot;s&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;south&quot;]
		elseif xmove == &quot;e&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;east&quot;]
		elseif xmove == &quot;w&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;west&quot;]
		elseif xmove == &quot;u&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;up&quot;]
		elseif xmove == &quot;d&quot; then
			NyyLIB.Mapper.queueroomID = exits[&quot;down&quot;]
		end
	end
		-- local nextroom

		-- next room is exits(queueroomid) -&gt; destination after xmove
	NyyLIB.Mapper.movement[#NyyLIB.Mapper.movement+1] = xmove
end

function compressSpeedwalk()
	local t=speedWalkDir
	local ret = {}
	local nx
	
	-- TODO - fixed special entrance entry


	for k,v in pairs(t) do
		if v == &quot;down&quot; then
			t[k] = &quot;d&quot;
		end
		if v == &quot;up&quot; then
			t[k] = &quot;u&quot;
		end
	end

   for i, v in ipairs(t) do
		if #v &gt; 4 then
			ret[#ret+1] = &quot;;&quot; .. v .. &quot;;&quot;
		else
	   		if t[i-1] and v == t[i-1] then
  		   		ret[#ret - 1] = ret[#ret - 1] + 1
	    	else
	      		ret[#ret + 1] = 1
 	      		ret[#ret + 1] = v
 	    	end
		end
   end

	--display(ret)

	for nx=1, #ret, 1 do
		if ret[nx] == 1 then
			ret[nx] = &quot;&quot;
		end
	end

	--display(ret)

   return table.concat(ret)
end

function doSpeedWalk()
	if #speedWalkDir &gt; 0 then
		cecho(&quot;&lt;green&gt;[Path: .&quot; .. compressSpeedwalk() .. &quot;]\n&quot;)
		--cecho(&quot;&lt;green&gt;[Rooms: &quot; .. table.concat(speedWalkPath, &quot;, &quot;) .. &quot;]\n&quot;)

		if #speedWalkPath &gt; 100 then
			cecho(&quot;&lt;red&gt;[Path in excess of 100 rooms: &quot; .. #speedWalkPath .. &quot;]\n&quot;)
			cecho(&quot;&lt;red&gt;[100th room: &lt;green&gt;&quot; .. speedWalkPath[100] .. &quot;&lt;red&gt; ]\n&quot;)
			return
		end

		for k,v in pairs(speedWalkDir) do
			if v == &quot;down&quot; then
				speedWalkDir[k] = &quot;d&quot;
			end
			if v == &quot;up&quot; then
				speedWalkDir[k] = &quot;u&quot;
			end
		end

		for k,v in ipairs(speedWalkDir) do
			if not string.find(v, &quot;^[nwesud]$&quot;) then
				-- special entrance
				local specialexit = getSpecialExitsSwap( NyyLIB.Mapper.queueroomID )[v]

				NyyLIB.Mapper.queueroomID=specialexit
				NyyLIB.Mapper.movement[#NyyLIB.Mapper.movement+1]=v
			end

			expandAlias(v)
		end
	end
end

function doorName(xroomid)
	-- doornames = name, direction

	local dataDoorName = getRoomUserData(xroomid, &quot;doornames&quot;) 

	if dataDoorName ~= &quot;&quot; and dataDoorName ~= nil then
		display(dataDoorName)
	end
end

function getZone()
	local areaID
	local areaname

	if map:getRoom() ~= nil then
		areaID = getRoomArea( map:getRoom() )
	end

	if areaID ~= nil then
		areaname=getRoomAreaName(areaID)
	end

	return (areaname)
end

function unhideRoom(xroomid)
	local zone=getRoomUserData(xroomid, &quot;zoneid&quot;)
	local zoneid=tonumber(zone)

	local edgelabel=getRoomUserData(xroomid, &quot;edge&quot;)

	local 	internalid= findAreaID(NyyLIB.areaTable[zoneid])

	if xroomid == 1 then
		return
	end

	-- zone doesn't exist in arealist - add it
	if zoneid ~= nil and internalid == nil then
		expandAlias(&quot;addarea &quot; .. zoneid, false)

		internalid= findAreaID(NyyLIB.areaTable[zoneid])

		if internalid == nil then
			cecho(&quot;[internalid error in room: &quot; .. xroomid .. &quot;]\n&quot;)
			display(zoneid)
			display(&quot;X&quot;)
		end
	end

	-- echo(&quot;\n[Room: &quot; .. xroomid .. &quot; &quot; .. NyyLIB.areaTable[zoneid] .. &quot;]\n&quot;)

	if getDoNotEnter(xroomid) == false then
		lockRoom( xroomid, false) -- unlocks the room, adding it back to possible rooms that can be walked through.
	end

	if roomExists(xroomid) == false then
		cecho(&quot;&lt;red&gt;[&lt;green&gt;&quot; .. xroomid .. &quot; &lt;red&gt;does not exist]\n&quot;)
		return
	end

	if internalid == nil then
		-- will crash this run room has been removed
		display(&quot;Likely to crash&quot;)
		display(xroomid)
		display(zoneid)
		display(getRoomUserData(xroomid, &quot;zoneid&quot;))
		display(NyyLIB.areaTable[zoneid])
		display( findAreaID(NyyLIB.areaTable[zoneid]) )
	end

	setRoomArea( xroomid, internalid)

	-- add label indicating zone edges
	if edgelabel ~= &quot;&quot; and edgelabel ~= nil then
		cmi:roomLabel(edgelabel)
	end

	-- add label indicating password
	local pw=getRoomUserData(xroomid, &quot;password&quot;)

	if pw ~= &quot;&quot; and pw ~= nil then
		cmi:passwordLabel(xroomid, pw)
	end
end

function zoneEdge(var)
	echo(&quot;Function call: zoneEdge\n&quot;)
	display(var)
end

function lockMap()
local fullmap = getRooms()
local areatable = getAreaTable()

	-- unassign all rooms
	for roomid, roomname in pairs(fullmap) do
		if getRoomArea(roomid) ~= -1 then
			resetRoomArea(roomid)
			echo(&quot;Unassigning &quot; .. roomid .. &quot;\n&quot;)
		end
		
		if roomLocked(roomid) == false then
			lockRoom( roomid, true)
			echo(&quot;Locking &quot; .. roomid .. &quot;\n&quot;)
		end
	end

	-- delete all areas
	for i,v in pairs(areatable) do
		deleteArea(v)
	end

	-- create great unknown
	expandAlias(&quot;addarea 6&quot;, false)

	-- need to check if already exists
	expandAlias(&quot;emptyroom&quot;, false)

	echo(&quot;Map locked\n&quot;)
end


function updateMap(xdir)
	local roomid
	local exits

	if map:getRoom() ~= nil then
		NyyLIB.lastRoomID = map:getRoom()

		local specialexit = getSpecialExitsSwap( map:getRoom() )

		local exitlist={}

		-- build list of special exits
		for k,v in pairs(specialexit) do
			for k2,v2 in pairs(string.split(k, &quot;|&quot;)) do
				exitlist[v2]=v
			end
		end

		if exitlist[xdir] ~= nil then
			roomid = exitlist[xdir]
		else
			exits = getRoomExits( map:getRoom() )

			if exits == nil and xdir ~= nil then
				echo(&quot;\n[No recorded exits: Room &quot; .. map:getRoom() .. &quot;]\n&quot;)
				map:setRoom(nil)
				return
			end

			if xdir == &quot;n&quot; then
				roomid	= exits[&quot;north&quot;]
			elseif xdir == &quot;s&quot; then
				roomid	= exits[&quot;south&quot;]
			elseif xdir == &quot;e&quot; then
				roomid	= exits[&quot;east&quot;]
			elseif xdir == &quot;w&quot; then
				roomid	= exits[&quot;west&quot;]
			elseif xdir == &quot;u&quot; then
				roomid	= exits[&quot;up&quot;]
			elseif xdir == &quot;d&quot; then
				roomid	= exits[&quot;down&quot;]
			else
				roomid=map:getRoom()
			end
		end

		NyyLIB.Mapper.lastmove = xdir

		if roomid ~= nil then
			if getRoomArea(roomid) == -1 then
				unhideRoom(roomid)
			else
				-- already found
			end

			centerview(roomid)
		else
			centerview(1)
		end
		
		map:setRoom(roomid)
	else
		centerview(1) -- blank room number
	end
end

function findAreaID(areaname)
	local nx
	local list = getAreaTable()
 
  -- iterate over the list of areas, matching them with substring match. 
  -- if we get match a single area, then return it's ID, otherwise return
  -- 'false' and a message that there are more than one area matches
  local returnid, fullareaname

	if areaname == nil then
		cecho(&quot;&lt;red&gt;[Warning: findAreaId(areaname) - nil areaname]\n&quot;)
		return nil
	end

  for area, id in pairs(list) do
		if area == areaname then
      if returnid then 
			echo(&quot;[more then one area matches]\n&quot;)
			return nil
		end
      returnid = id; 
    end
  end

  return returnid
end

function findRoomArea(xname, xexits)
	local partmap = searchRoom(xname)
	local match = {}
	local filteredmatch = {}

	local matchedarea=nil

	for roomid, roomname in pairs(partmap) do
		if roomname == xname then
			table.insert(match, roomid)
		end
	end

	if #match == 0 then
		return(nil)
	end

	if #match == 1 then
		matchedarea= map:getZone( match[1] )
		return(matchedarea)
	end

	for k, v in pairs(match) do
		local roomexits = getRoomExits(v)
		local matchtable = {0,0,0,0,0,0}

		if roomexits[&quot;north&quot;] then
			matchtable[1] = 1
		end

		if roomexits[&quot;south&quot;] then
			matchtable[2] = 1
		end
	
		if roomexits[&quot;east&quot;] then
			matchtable[3] = 1
		end

		if roomexits[&quot;west&quot;] then
			matchtable[4] = 1
		end
	
		if roomexits[&quot;up&quot;] then
			matchtable[5] = 1
		end
	
		if roomexits[&quot;down&quot;] then
			matchtable[6] = 1
		end
	
		if table.concat(xexits) == table.concat(matchtable) then
			table.insert(filteredmatch, v)
		end
	end

	matchedarea= map:getZone( filteredmatch[1] )

	-- multiple rooms matches, but all in the same area

	for k,v in pairs(filteredmatch) do
		if map:getZone(v) ~= matchedarea then
			matchedarea=nil
		end
	end

	return(matchedarea)
end

function findRoomID(xname, xexits, xsuppress)
	local partmap = searchRoom(xname)
	local match = {}
	local filteredmatch = {}

	for roomid, roomname in pairs(partmap) do
		if roomname == xname then
			table.insert(match, roomid)
		end
	end

	if #match == 0 then
		map:setRoom(nil)
		
		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;No matches found: &lt;blue&gt;&quot; .. xname .. &quot;&lt;red&gt;]\n&quot;)
		end
		return(nil)
	end

	if #match == 1 then
		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;Match found: &lt;forest_green&gt;&quot; .. getRoomAreaName(getRoomArea(match[1])) .. &quot; : &quot;.. xname .. &quot; : &quot; .. match[1] .. &quot;&lt;red&gt;]\n&quot;)
		end

		return(match[1])
	end

	for k, v in pairs(match) do
		local roomexits = getRoomExits(v)
		local matchtable = {0,0,0,0,0,0}

		if roomexits[&quot;north&quot;] then
			matchtable[1] = 1
		end

		if roomexits[&quot;south&quot;] then
			matchtable[2] = 1
		end
	
		if roomexits[&quot;east&quot;] then
			matchtable[3] = 1
		end

		if roomexits[&quot;west&quot;] then
			matchtable[4] = 1
		end
	
		if roomexits[&quot;up&quot;] then
			matchtable[5] = 1
		end
	
		if roomexits[&quot;down&quot;] then
			matchtable[6] = 1
		end
	
		if table.concat(xexits) == table.concat(matchtable) then
			table.insert(filteredmatch, v)
		end
	end

	if #filteredmatch == 0 then
		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;No matching exits found]\n&quot;)
		end
		return(nil)
	end

	if #filteredmatch == 1 then
		if xsuppress == nil then
			cecho(&quot;&lt;green&gt;Exits matched room#: &quot; .. filteredmatch[1] .. &quot; : &quot; .. xname .. &quot;&lt;red&gt;]\n&quot;)
		end
		return(filteredmatch[1])
	end

	if xsuppress == nil then
		cecho(&quot;&lt;green&gt;Multiple (&lt;red&gt;&quot; .. #filteredmatch .. &quot;&lt;green&gt;) matches found: &lt;blue&gt;&quot; .. xname .. &quot;]\n&quot;)
	end

	return(nil)
end

function findRoomIDTable(xname, xexits, xsuppress)
	local partmap = searchRoom(xname)
	local match = {}
	local filteredmatch = {}

	for roomid, roomname in pairs(partmap) do
		if roomname == xname then
			table.insert(match, roomid)
		end
	end

	if #match == 0 then
		-- map:setRoom(nil) don't set room
		
		if xsuppress == nil then
			echo(&quot;No matches found: &quot; .. xname .. &quot;]\n&quot;)
		end
		return(nil)
	end

	if #match == 1 then
		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;Match found: &lt;blue&gt;&quot; .. xname .. &quot; : &quot; .. match[1] .. &quot;&lt;red&gt;]\n&quot;)
		end
		return(match)
	end

	for k, v in pairs(match) do
		local roomexits = getRoomExits(v)
		local matchtable = {0,0,0,0,0,0}

		if roomexits[&quot;north&quot;] then
			matchtable[1] = 1
		end

		if roomexits[&quot;south&quot;] then
			matchtable[2] = 1
		end
	
		if roomexits[&quot;east&quot;] then
			matchtable[3] = 1
		end

		if roomexits[&quot;west&quot;] then
			matchtable[4] = 1
		end
	
		if roomexits[&quot;up&quot;] then
			matchtable[5] = 1
		end
	
		if roomexits[&quot;down&quot;] then
			matchtable[6] = 1
		end
	
		if table.concat(xexits) == table.concat(matchtable) then
			table.insert(filteredmatch, v)
		end
	end

	if #filteredmatch == 0 then
		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;No matching exits found]\n&quot;)
		end
		return(nil)
	end

	return(filteredmatch)
end

-- return a table built from mud exit string

function getExitTable(xmudstr)
	local exitsarray = {0,0,0,0,0,0}
	
	if string.find(xmudstr, &quot;-N&quot;) ~= nil or string.find(xmudstr, &quot;- N&quot;) ~= nil then
		exitsarray[1] = 1
	end

	if string.find(xmudstr, &quot;-S&quot;) ~= nil or string.find(xmudstr, &quot;- S&quot;) ~= nil then
		exitsarray[2] = 1
	end

	if string.find(xmudstr, &quot;-E&quot;) ~= nil or string.find(xmudstr, &quot;- E&quot;) ~= nil then
		exitsarray[3] = 1
	end

	if string.find(xmudstr, &quot;-W&quot;) ~= nil or string.find(xmudstr, &quot;- W&quot;) ~= nil then
		exitsarray[4] = 1
	end

	if string.find(xmudstr, &quot;-U&quot;) ~= nil or string.find(xmudstr, &quot;- U&quot;) ~= nil then
		exitsarray[5] = 1
	end

	if string.find(xmudstr, &quot;-D&quot;) ~= nil or string.find(xmudstr, &quot;- D&quot;) ~= nil then
		exitsarray[6] = 1	
	end

	-- display( exitsarray )

	return( exitsarray )
end

function mapperExits(xroomid)
	local stubs = getExitStubs(xroomid)

	display(stubs)

	--for i = 0, stubs, 1 do
 	--	print(NyyLIB.mapper.exitmap[stubs[i]])
	--end
end

-- [Searching... Match found: Silverymoon, Gem of the North : At the End of Bowshot Ride : 48908]

function solveScan(xsuppress)
	scanned = scanned or {}

	if table.size(scanned) == 0 then
		--if xsuppress == nil then
		--	echo(&quot;&lt;red&gt;No scan results to attempt solving]\n&quot;)
		--end
		return(nil)
	end

	local scanresults = {}

	for k,v in pairs(scanned) do
		if type(v) == &quot;table&quot; and k ~= &quot;currentroomexits&quot; then
			if #scanresults == 0 then
				scanresults= v.filtered
			end

			scanresults = table.n_intersection(scanresults, v.filtered)


			-- no intersect
			if scanresults == false then
				scanresults = {}
			end
		end
	end

	--display(scanresults)


	if #scanresults == 1 then
		local match= scanresults[1]

		if xsuppress == nil then
			cecho(&quot;&lt;red&gt;Match found: &lt;blue&gt;&quot; .. getRoomAreaName(getRoomArea(match)) .. &quot; : &quot; .. getRoomName(match) .. &quot; : &quot; .. match .. &quot;&lt;red&gt;]\n&quot;)
		end

		return( match )
	end

	if xsuppress == nil then
		cecho(&quot;&lt;red&gt;Solve scan failed. &lt;green&gt;Multiple (&lt;red&gt;&quot; .. #scanresults .. &quot;&lt;green&gt;) matches found]\n&quot;)
	end

	map:setRoom(nil)
	centerview(1)

	return(nil)
end

function filterScan(xkey)
	-- remove roomids from table if reversematch to current location is false

	if scanned[xkey].roomids ~= nil then
		scanned[xkey].filtered = {}

		for k,v in pairs(scanned[xkey].roomids) do
			local match= getRoomExits(v)[NyyLIB.reversedirs[xkey]]

			if match ~= nil then
				-- need to verify match identical to current room

				table.insert(scanned[xkey].filtered, match)
			end
		end

		--display( scanned[xkey].filtered )
		scanned[xkey].roomids = nil

	end
end

Set = {}
    
function Set.new (t)
   local set = {}
   for _, l in ipairs(t) do set[l] = true end
   return set
end
    
function Set.union (a,b)
  local res = Set.new{}
  for k in pairs(a) do res[k] = true end
  for k in pairs(b) do res[k] = true end
  return res
end
    
function Set.intersection (a,b)
  local res = Set.new{}
  for k in pairs(a) do
   res[k] = b[k]
  end
  return res
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>newRoomEvent</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function newRoomEvent(event, xroom)
	-- this event is called from updateMap after every new room is entered

	--Example: snap after entering a particular room
	--if xroom == 79574 then
	--	send(&quot;snap&quot;)
	--end

	if xroom ~= nil then
		spell:setMoving(true)
		spell:setMem(false)
		memsent = false


		-- nomagic is a variable to stop casting (beholder, etc)
		nomagic=nil

	end

	spell:setCast() -- reset

end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>cMud Map Importer</name>
                <packageName></packageName>
                <script></script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>CreateMapFromCmud</name>
                    <packageName></packageName>
                    <script> -------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
require &quot;luasql.sqlite3&quot;
cmi = {}
--kept as reminders
--[[dirnums = {[1]=&quot;north&quot;, [2]=&quot;northeast&quot;, [3]=&quot;northwest&quot;,[4]=&quot;east&quot;,
[5]=&quot;west&quot;,[6]=&quot;south&quot;,[7]=&quot;southeast&quot;,[8]=&quot;southwest&quot;,[9]=&quot;up&quot;,[10]=&quot;down&quot;}
dir_list=[&quot;north&quot;,&quot;n&quot;,&quot;northeast&quot;,&quot;ne&quot;,&quot;east&quot;,&quot;e&quot;,&quot;se&quot;,&quot;southeast&quot;,
          &quot;south&quot;,&quot;s&quot;,&quot;sw&quot;,&quot;southwest&quot;,&quot;west&quot;,&quot;w&quot;,&quot;nw&quot;,&quot;northwest&quot;,
          &quot;up&quot;,&quot;u&quot;,&quot;down&quot;,&quot;d&quot;, &quot;special&quot;, &quot;special&quot;]
dirtype_list=[0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9, 10, 10]]

cmi.cmudToMudletExit = {[0]=1,[1]=2,[2]=4,[3]=7,[4]=6,[5]=8, [6]=5, [7]=3, [8]=9, [9]=10}


function cmi:passwordLabel(xroomid, xpw)
 -- &quot;10749 1 red black Northern Waterdeep Main City&quot;

	local tmp=xroomid .. &quot; 7 green black &quot; .. xpw

	cmi:roomLabel(tmp)
end


-- room label the room I'm in
-- room label 342 this is a label in room 342
-- room label green this is a green label where I'm at
-- room label green black this is a green to black label where I'm at
-- room label 34 green black this is a green to black label at room 34
-- how it works: split input string into tokens by space, then determine
-- what to do by checking first few tokens, and finally call the local
-- function with the proper arguments
--taken from Vadi
--input is room number, fgcolor, bgcolor, message

function cmi:roomLabel(input)
  local tk = input:split(&quot; &quot;)
  local room, direction, fg, bg, message

  -- input always have to be something, so tk[1] at least always exists
  if tonumber(tk[1]) then
    room = tonumber(table.remove(tk, 1)) -- remove the number, so we're left with the direction, colors or msg
  end

  if tonumber(tk[1]) then
    direction = tonumber(table.remove(tk, 1)) -- remove the number, so we're left with the colors or msg
  end

  -- next: is this a foreground color?
  if tk[1] and color_table[tk[1]] then
    fg = table.remove(tk, 1)
  end

  -- next: is this a backround color?
  if tk[1] and color_table[tk[1]] then
    bg = table.remove(tk, 1)
  end

  -- the rest would be our message
  if tk[1] then
    message = table.concat(tk, &quot; &quot;)
  end

  -- if we haven't provided a room ID and we don't know where we are yet, we can't make a label
  if not room then
    echo(&quot;We don't know where we are to make a label here.&quot;) return
  end

  local x,y,z = getRoomCoordinates(room)
  local f1,f2,f3 = unpack(color_table[fg])
  local b1,b2,b3 = unpack(color_table[bg])

--  [1] = &quot;north&quot;,
--  [2] = &quot;northeast&quot;,
--  [3] = &quot;northwest&quot;,
--  [4] = &quot;east&quot;,
--  [5] = &quot;west&quot;,
--  [6] = &quot;south&quot;,
--  [7] = &quot;southeast&quot;,
--  [8] = &quot;southwest&quot;,
--  [9] = &quot;up&quot;,
--  [10] = &quot;down&quot;,
--  [11] = &quot;in&quot;,
--  [12] = &quot;out&quot;,

	local length = string.len(message)

	if direction == 1 then -- north
		y=y+1.5+1
		x=x-length/3.5
	end

	if direction == 4 then -- east
		y=y+.5
		x=x+.5+1
	end

	if direction == 5 then -- west
		y=y+.5
		x=x-(length/1.5)-.5-1
	end

	if direction == 6 then -- south
		y=y-.5-1
		x=x-length/3.5
	end

	if direction == 7 then -- se password
		x=x+.25
		y=y+.25
	end

  -- finally: do it :)
  if (z) then
  -- labelID = createMapLabel(areaID, text, posx, posy, posz, fgRed, fgGreen, fgBlue, bgRed, bgGreen, bgBlue, zoom, fontSize, showOnTop, noScaling)
  	local lid = createMapLabel(getRoomArea(room), message, x, y, z, f1,f2,f3, b1,b2,b3, 15, 15, false, false)
  --echo(string.format(&quot;Created new label #%d '%s' in %s.&quot;, lid, message, getRoomAreaName(getRoomArea(room))))
	end
end

function cmi:decimalToRGB(num)

		-- download luabit from http://files.luaforge.net/releases/bit/bit/luabitv0.4
		-- copy bit.lua to mudlet install directory

        -- require(&quot;bit&quot;)
        local r,g,b
        r = bit.band(num,0x0000ff)
        g = bit.band(num, 0x00ff00)
        g = bit.brshift(g,8)
        b = bit.band(num, 0xff0000)
        b = bit.brshift(b,16)
        return {['r']=r,['g']=g,['b']=b}
end



function cmi:colorRooms(con)
        local recs, row, roomID, colors, r,g, b, cTable
        local envsUsed = {}
        local envIndex = 500

		  echo(&quot;[Setting room colours]\n&quot;)

        recs = assert(con:execute([[SELECT ObjId, Color FROM ObjectTbl]]))
        row = recs:fetch({})
        while row do
                roomID = tonumber(row[1])
                colors = cmi:decimalToRGB(tonumber(row[2]))
                r = colors['r']
                b = colors['b']
                g = colors['g']
                if envsUsed[row[10]] then
                        cTable = envsUsed[row[2]]
                else
                        envsUsed[row[2]] = envIndex
                        cTable = envIndex
                        setCustomEnvColor(cTable, r,g,b,255)
                        envIndex=envIndex+1
                end
					
					if roomExists(roomID) then
	            		setRoomEnv(roomID, cTable)
						--echo(&quot;Setting room color for &quot; .. roomID .. &quot;\n&quot;)
					end
                row = recs:fetch({})
        end
        recs:close()

		echo(&quot;[Room colouring completed]\n&quot;)
end

function cmi:addRooms(con, xcmudid, xtorilid)
        local recs, row, roomID, roomname, roomdesc, x, y, z, cost, zone, script


		if xcmudid ~= nil then
      		recs = assert(con:execute([[SELECT ObjId, Name, Desc, X,Y,Z, Cost, ZoneID, Script FROM ObjectTbl where ZoneID=]] .. xcmudid))
		else
      		recs = assert(con:execute([[SELECT ObjId, Name, Desc, X,Y,Z, Cost, ZoneID, Script FROM ObjectTbl]]))
		end

		  -- recs = assert(con:execute([[SELECT ObjId, Name, Desc, X,Y,Z, Cost, ZoneID, Script FROM ObjectTbl]]))
        row = recs:fetch({})
        while row do
                roomID = tonumber(row[1])
                roomname = row[2]
                roomdesc = row[3]
                x = tonumber(row[4])
                y = tonumber(row[5])*-1 --need to reflect on y axis
                z = tonumber(row[6])

                x = math.floor(x/240) -- was 120
                y = math.floor(y/240) -- was 120

                cost = tonumber(row[7])
                zone = tonumber(row[8])
					--  zone=5
                script = row[9]
                if script then
                        script = string.gsub(script, &quot;All[=]?&quot;, &quot;&quot;, 1)
                end
                addRoom( roomID )
                if roomname then
                        setRoomName( roomID, roomname )
                else
                        echo(&quot;null roomname:&quot;..roomID .. &quot;\n&quot;)
                end
                if roomdesc then
                        setRoomUserData(roomID, &quot;description&quot;, roomdesc)
                else
                        echo(&quot;null roomdesc:&quot;..roomID .. &quot;\n&quot;)
                end
                if script and script ~= &quot;&quot; then
                        setRoomUserData(roomID, &quot;script&quot;, script)
                end
                setRoomCoordinates(roomID, x,y,z)
                setRoomWeight(roomID, cost)

					if cost == 2147483647 then
						-- do not enter room
						echo(&quot;[Set room &quot; .. roomID .. &quot; do not enter]\n&quot;)
						setDoNotEnter(roomID)
					end

                if zone == -1 or not zone then
                        zone = 0
                end

					if xtorilid ~= nil then
						setRoomUserData(roomID, &quot;zoneid&quot;, xtorilid)
						resetRoomArea(roomID)	 -- set room area to -1
						lockRoom(roomID, true) -- lock room
                else
						setRoomUserData(roomID, &quot;zoneid&quot;, zone)
						setRoomArea( roomID, zone )
					end

                row = recs:fetch({})
        end
		 -- centerview(roomID)
        recs:close()
end

function cmi:addAreas(con)
	local recs, row, zoneId, Name, row
	recs = assert(con:execute([[SELECT ZoneId, Name FROM ZoneTbl]]))
	row = recs:fetch({})
	while row do
		ZoneId = tonumber(row[1])
		Name = row[2]
			setAreaName(ZoneId, Name)
		row = recs:fetch({})
	end
	recs:close()
end

function cmi:listAreas()
	local recs, row, zoneId, Name, row

	cmi:checkConnection()
	echo(&quot;Selected map: &quot; .. cmi.file .. &quot;\n&quot;)

	recs = assert(cmi.con:execute([[SELECT ZoneId, Name FROM ZoneTbl]]))
	row = recs:fetch({})
	while row do
		ZoneId = tonumber(row[1])
		Name = row[2]

		echo(&quot;ID: &quot; .. ZoneId .. &quot; &quot; .. Name .. &quot;\n&quot;)

		row = recs:fetch({})
	end
	recs:close()
end


function cmi:addExits(con)
	local recs, row, FromID, ToID, dirtype, param, ExitKindID, name
	recs = assert(con:execute([[SELECT FromID, ToID, DirType, Param, ExitKindID, Name FROM ExitTbl]]))

-- NOTE - this adds all exits from mapfile, whether room has been added or not


--setDoor(roomID, exitCommand, doorStatus)
--Creates or deletes a door in a room. Doors are purely visual - they don't affect pathfinding. You can use the information to change to adjust your speedwalking path based on the door information in a room, though.

--roomID:
--Room ID to to create the door in.
--exitCommand:
--The cardinal direction for the door is in - it can be one of the following: e,s,w,n,ne,se,sw,ne. {Plans are afoot to add support for doors on the other normal exits: up,down,in,out and also on special exits though more work will be needed for them to be shown in the mapper.}
--doorStatus:
--The door status as a number - 0 means remove door, 1 means open door (will draw a green square on exit), 2 means closed door (yellow square) and 3 means locked door (red square).
--See also: getDoors()

-- make a door on the east exit of room 4234 that is currently open
--setDoor(4234, 'e', 1)
 
-- remove a door from room 923 that points north
--setDoor(923, 'n', 0)

	-- ExitKindID 0-normal exit 1-door 2-locked door


-- addSpecialExit(roomIDFrom, roomIDTo, command)
-- Creates a one-way from one room to another, that will use the given command for going through them.




	row = recs:fetch({})
	while row do
		FromID = tonumber(row[1])
		ToID = tonumber(row[2])
		dirtype = cmi.cmudToMudletExit[tonumber(row[3])]
		param = row[4]
		ExitKindID = row[5]
		name = row[6]

		-- if name has value then non-standard exit

		if roomExists(FromID) then
			if dirtype and dirtype ~= -1 then
				setExit(FromID, ToID, dirtype)
			else
				echo(&quot;dirtype failed room id &quot; .. FromID .. &quot;\n&quot;)
			end

			if name ~= &quot;&quot; and name ~= nil then
				addSpecialExit(FromID, ToID, name)
			end

			if param ~= &quot;&quot; and param ~= nil then
				setDoorName(FromID, dirtype, param)
			end

			if NyyLIB.Mapper.exitmap[dirtype] ~= nil then
				if ExitKindID == 1 then -- door
					--echo(&quot;Door in &quot; .. FromID .. &quot; facing &quot; .. NyyLIB.Mapper.exitmap[dirtype] .. &quot;\n&quot;)
					setDoor(FromID, NyyLIB.Mapper.doormap[dirtype], 2)
				elseif ExitKindID == 2 then -- locked door
					--echo(&quot;Locked door in &quot; .. FromID .. &quot; facing &quot; .. NyyLIB.Mapper.exitmap[dirtype] .. &quot;\n&quot;)
					setDoor(FromID, NyyLIB.Mapper.doormap[dirtype], 3)
				end
			else
				echo(&quot;nil exit match\n&quot;)
				display(FromID)
			end

		end

		row = recs:fetch({})
	end
	recs:close()
end

function cmi:labelCmudZones(con)
	local recs, row, exitrecs, toID, DirType, zonerecs, toZone, fromZone, fromID, zonerec, zoneFetch, zoneName, input
	recs = assert(con:execute([[SELECT ObjId, X,Y,Z, ZoneID, Script FROM ObjectTbl]]))
	row = recs:fetch({})
	while row do
		fromID = tonumber(row[1])
		fromZone = tonumber(row[5])
		exitrecs = assert(con:execute([[SELECT ToID, DirType FROM ExitTbl WHERE FromID = ]]..fromID))
		toID = exitrecs:fetch({})
	
		while toID do
			zonerecs = assert(con:execute([[SELECT ZoneID FROM ObjectTbl WHERE ObjId = ]]..tonumber(toID[1])))
			toZone = tonumber(zonerecs:fetch({})[1])
			if toZone ~= fromZone then
				zonerec = assert(con:execute([[SELECT ZoneId, Name FROM ZoneTbl WHERE ZoneId = ]]..toZone))
				zoneFetch = zonerec:fetch({})
				zoneName = zoneFetch[2]

				DirType = cmi.cmudToMudletExit[toID[2]]

				if DirType == nil then
					DirType=4
				end

	 			input = fromID..&quot; &quot; .. DirType .. &quot; red black &quot;..zoneName -- numeric direction to place label
				--display(input)
				setRoomUserData(fromID, &quot;edge&quot;, input)
				-- cmi:roomLabel(input)
			end
			toID = exitrecs:fetch({})
		end
		row = recs:fetch({})
	end
    if zonerec then
        zonerec:close()
    end
	zonerecs:close()
	exitrecs:close()
	recs:close()
end

function cmi:addFavorites(con)
	local recs, row, objId, Name
	recs = assert(con:execute([[SELECT Name, ObjID FROM FavTbl]]))
	row = recs:fetch({})
	while row do
		Name = row[1]
		objId = tonumber(row[2])
		setRoomUserData(objId, &quot;favorite&quot;, Name)
		row = recs:fetch({})
	end
	recs:close()
end

function cmi:getConnection()
	if cmi.con then
		cmi.con:close()
	end
	if cmi.env then
		cmi.env:close()
	end
	cmi.env = assert (luasql.sqlite3())
	
	-- connect to data source
	--cmi.file = invokeFileDialog(true, &quot;Select your cMud Map&quot;)

	--cmi.file = &quot;/tmp/TorilMud.dbm&quot;
	cmi.file = &quot;/users/Chris/Google Drive/Toril/TorilMud.dbm&quot;

	cmi.con = assert (cmi.env:connect(cmi.file))
end

function cmi:checkConnection()
	if not cmi.env or not cmi.file or not cmi.con then
		cmi:getConnection()
	end
end

function cmi:onlyExits()
	cmi:checkConnection()
	-- create environment object
	echo(&quot;Selected map: &quot; .. cmi.file .. &quot;\n&quot;)

	echo(&quot;[Adding exits]\n&quot;)
	cmi:addExits(cmi.con)
end

function cmi:importArea(xcmudid, xtorilid)
	cmi:checkConnection()
	-- create environment object
	echo(&quot;Selected map: &quot; .. cmi.file .. &quot;\n&quot;)
	
	echo(&quot;[Adding rooms]\n&quot;)
	cmi:addRooms(cmi.con, xcmudid, xtorilid)

	--cmi:colorRooms(cmi.con)
--	echo(&quot;[Adding exits]\n&quot;)
--	cmi:addExits(cmi.con)
	--set area names
	--cmi:addAreas(cmi.con)

   --cmi:addFavorites(cmi.con)
	--cmi:labelCmudZones(cmi.con)
end

function cmi:colorAreas()
	cmi:checkConnection()
	-- create environment object
	echo(&quot;Selected map: &quot; .. cmi.file .. &quot;\n&quot;)
	
	cmi:colorRooms(cmi.con)
end

function cmi:importAll()
	cmi:checkConnection()
	-- create environment object
	echo(&quot;Selected map: &quot; .. cmi.file .. &quot;\n&quot;)
	
	-- x cmi:addRooms(cmi.con)
	cmi:colorRooms(cmi.con)
	-- x cmi:addExits(cmi.con)


	--set area names
	--cmi:addAreas(cmi.con)

   --cmi:addFavorites(cmi.con)
	--cmi:labelCmudZones(cmi.con)
end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <Script isActive="yes" isFolder="no">
                <name>processMovement</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-- before sending/queuing, need to check for doors in need of being opened

-- start from current room, and iterate queue with expectation of success

function processMovement(xdir)
	queueMovement(xdir)
	send(xdir, false)

	-- illithid - break hide

	if checkMask(&quot;psi&quot;) then
		setHide(false)
	end
end</script>
                <eventHandlerList/>
            </Script>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>SpellTracker</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>SpellTrackerScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- incSpellCount(xname)
-- decSpellCount(xname)
-- setSpellCount(xname, xvalue)
-- getSpellCount(xname)
-- resetSpellCount()

function resetSpellCount()
	cecho(&quot;&lt;red&gt;[Clearing memorized spells]\n&quot;)
	charData:set(&quot;spells&quot;, {})
end

function incSpellCount(xname)
	local count=charData:get(&quot;spells&quot;) or {}

	count[xname] = count[xname] or 0
	count[xname] = count[xname] + 1

	echoDebug(&quot;\n&lt;red&gt;[ Incrementing spell count for: &quot; .. xname .. &quot; value: &quot; .. getSpellCount(xname) .. &quot; ]&quot; )

	charData:set(&quot;spells&quot;, count)

	-- call script associated with memorized spell to update spellcount in gui

	updateSpellCount(xname)

	return
end

function decSpellCount(xname)
	local count=charData:get(&quot;spells&quot;) or {}

	count[xname] = count[xname] or 1
	count[xname] = count[xname] - 1

	echoDebug(&quot;\n&lt;red&gt;[ Decrementing spell count for: &quot; .. xname .. &quot; value: &quot; .. getSpellCount(xname) .. &quot; ]&quot; )

	charData:set(&quot;spells&quot;, count)

	-- call script associated with memorized spell to update spellcount in gui

	updateSpellCount(xname)

	return
end

function getSpellCount(xname)
	local count=charData:get(&quot;spells&quot;) or {}

	count[xname] = count[xname] or 0

	return( count[xname] )
end

function setSpellCount(xname, xvalue)
	local count=charData:get(&quot;spells&quot;) or {}

	count[xname] = xvalue

	charData:set(&quot;spells&quot;, count)

	-- call script associated with memorized spell to update spellcount in gui

	updateSpellCount(xname)

	return
end

function iCast()
	if string.find(getLines(getLineNumber()-1, getLineNumber())[1], &quot;You complete your spell...&quot;) ~= nil then
		return true
	end

	return false
end

function initButton(xname)
	if _G[xname] == nil then
		if powerAliases:getChardata(xname) == &quot;&quot; then
			cecho(&quot;&lt;red&gt;[initButton: &quot; .. xname .. &quot; not set in powerAliases]\n&quot;)
			return
		end

		shiftButton(xname, powerAliases:getChardata(xname), &quot;init&quot;)
		return
	end

	_G[xname](&quot;init&quot;)
end

function updateSpellCount(xname, xcommand)
	local chardata= powerAliases:getChardata(xname)

	if chardata == &quot;&quot; then
		if _G[xname] == nil then
			echoDebug(&quot;&lt;red&gt;[updateSpellCount: xname &quot; .. xname .. &quot; has a nil function]\n&quot;)
		end

		if _G[xname] ~= nil then
			_G[xname](&quot;update&quot;)
		end

		return
	else
		if xcommand ~= nil then
			shiftButton(xname, chardata, xname)
		else
			shiftButton(xname, chardata, &quot;update&quot;)
		end
	end

	powerAliases:updateButton(chardata)
end
</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>Scripts</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>geyser replacements</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

--- Returns the Geyser object associated with the label name
-- @param label The name of the label to use

function Geyser.Label:getWindow(label)
   for i,v in pairs(Geyser.windowList) do
        if v.name == label then
            return v
        end
		
		-- added to search down 1 additional level

		for key,val in pairs(v.windowList) do
			if val.name == label then
				return val
			end
		end
	end
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>checkMask</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- The checkMask function returns true/false if a character is a member of a set of classes.

-- checkMask(xmask, xname)
-- 	xmask - name of the mask to use
-- xname - name to check, or nil (whoami)
-- Returns true if xname's class is a member of the set

-- Example: Adud is a warrior

-- if checkMask(&quot;rogue&quot;, &quot;Adud&quot;) then
--		display(&quot;This won't happen because Adud isn't a rogue&quot;)
-- end

-- Not including a character name means the character logged in will be used

-- Example: Nyyrazzilyss (an illithid) is currently logged in

-- if checkMask(&quot;psi&quot;) then
--		display(&quot;Nyyrazzilyss is a psi&quot;)
-- end

	masks = {
		classes = { &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;UNK&quot;, &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		noPsi = { &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		nopriest = { &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		nocleric = { &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		psi = { &quot;Psi&quot; },
		enc = { &quot;Enc&quot; },
		war = { &quot;War&quot; },
		cle = { &quot;Cle&quot; },
		sha = { &quot;Sha&quot; },
		rog = { &quot;Rog&quot; },
		ill = { &quot;Ill&quot; },
		inv = { &quot;Inv&quot; },
		dru = { &quot;Dru&quot; },
		bar = { &quot;Bar&quot; },
		ctr = { &quot;Ctr&quot; },
		ran = { &quot;Ran&quot; },
		ele = { &quot;Ele&quot; },
		pal = { &quot;Pal&quot; },
		anti = { &quot;A-P&quot; },
		lic = { &quot;Lic&quot; },
		nec = { &quot;Nec&quot; },
		dire = { &quot;Dir&quot; },
		all = { &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		self = { &quot;Enc&quot;, &quot;Sha&quot; },
		petrescue = { &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot; },
		traintanks = {&quot;War&quot;, &quot;Pal&quot;, &quot;A-P&quot;, &quot;Ran&quot;, &quot;Dir&quot;, &quot;Bar&quot;, &quot;Ctr&quot;},
		warrior = {&quot;War&quot;, &quot;Pal&quot;, &quot;A-P&quot;},
		fighter = {&quot;War&quot;, &quot;Pal&quot;, &quot;A-P&quot;, &quot;Ran&quot;, &quot;Dir&quot; },
		hitter = { &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot;, &quot;A-P&quot;, &quot;Pal&quot; },
		hitterToRescue = { &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		singer = {&quot;Bar&quot;, &quot;Ctr&quot;},
		hitterSinger = { &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Bar&quot;, &quot;Ctr&quot;},
		displace = { &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		rightWindow = {&quot;UNK&quot;, &quot;War&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Bar&quot;, &quot;Ctr&quot;, &quot;Dir&quot;, &quot;Ran&quot;, &quot;Rog&quot;},
		caster = {&quot;Dru&quot;, &quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Nec&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Cle&quot;, &quot;Sha&quot; },
		mage = {&quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Nec&quot;, &quot;Ill&quot;, &quot;Ele&quot; },
		casterGlobe= {&quot;Enc&quot;, &quot;Nec&quot;, &quot;Lic&quot;},
		casterSinger = {&quot;Dru&quot;, &quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Nec&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Cle&quot;, &quot;Sha&quot;, &quot;Bar&quot;, &quot;Ctr&quot; },
		casterPsi = {&quot;Psi&quot;, &quot;Dru&quot;, &quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Nec&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Cle&quot;, &quot;Sha&quot; },
		casterPsiSinger = {&quot;Psi&quot;, &quot;Dru&quot;, &quot;Enc&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Nec&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Cle&quot;, &quot;Sha&quot;, &quot;Bar&quot;, &quot;Ctr&quot; },
		statHitter = {&quot;War&quot;, &quot;Pal&quot;, &quot;A-P&quot;, &quot;Ran&quot;, &quot;Dir&quot;, &quot;Bar&quot;, &quot;Ctr&quot;, &quot;Rog&quot; },
		priest = {&quot;Sha&quot;, &quot;Dru&quot;, &quot;Ctr&quot;, &quot;Cle&quot; },
		pray = {&quot;Sha&quot;, &quot;Dru&quot;, &quot;Cle&quot;, &quot;Pal&quot;, &quot;A-P&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		nonPriestCaster = { &quot;Pal&quot;, &quot;A-P&quot;, &quot;Dir&quot;, &quot;Ran&quot; },
		rogue = {&quot;Rog&quot;, &quot;Bar&quot;, &quot;Ctr&quot;},
		petRescue = { &quot;Psi&quot;, &quot;Cle&quot;, &quot;Enc&quot;, &quot;Dru&quot;, &quot;Lic&quot;, &quot;Sha&quot;, &quot;Inv&quot;, &quot;Ill&quot;, &quot;Ele&quot;,	 &quot;Nec&quot;, &quot;Bar&quot;, &quot;Ctr&quot;, &quot;Rog&quot;, &quot;Ran&quot; },
		haster = { &quot;Enc&quot;, &quot;Nec&quot;, &quot;Ele&quot; },
		summonmount = { &quot;A-P&quot;, &quot;Pal&quot;, &quot;Dir&quot;},
		mountedCombat = { &quot;A-P&quot;, &quot;Pal&quot;, &quot;Dir&quot;, &quot;Ran&quot;},
		tiavit = { &quot;Sha&quot;, &quot;Enc&quot;, &quot;Ill&quot;, &quot;Bar&quot;, &quot;Ele&quot;, &quot;Rog&quot;, &quot;Nec&quot;, &quot;Psi&quot;},
		missile = { &quot;Sha&quot;, &quot;Ele&quot;, &quot;Dir&quot;, &quot;Enc&quot;, &quot;Nec&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Dru&quot;, &quot;Ran&quot; },
		hlarea = { &quot;Cle&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Sha&quot;, &quot;Ele&quot;, &quot;Dir&quot;, &quot;Enc&quot;, &quot;Nec&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Dru&quot;, &quot;Ran&quot; },
		ffire = { &quot;Enc&quot;, &quot;Ill&quot;, &quot;Inv&quot;, &quot;Dru&quot;, &quot;Ran&quot;, &quot;Sha&quot;},
		stoner = { &quot;Sha&quot;, &quot;Ele&quot;, &quot;Enc&quot; },
		venomer = { &quot;Rog&quot;, &quot;A-P&quot; },
		dmgundead = { &quot;Cle&quot;, &quot;Nec&quot;, &quot;Lic&quot;, &quot;Pal&quot;},
		necros = { &quot;Lic&quot;, &quot;Nec&quot; }
			}

function checkMask(xmask, xname)
	local classname

	if xname == nil then
		xname = whoami()
	end

	classname = whoclass(xname) or &quot;UNK&quot; -- TODO or &quot;UNK&quot;

	if masks[xmask] == nil then
		echoDebug(&quot;&lt;red&gt;[Error: mask &quot; .. xmask .. &quot; does not exist]\n&quot;)
		return
	end

	if table.contains( masks[xmask], classname ) then
		return(true)
	end

	return(false)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>charData script</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
charData = charData or {}

-- charData:init(xkey, xval, xtop)
-- xkey - the variable to initialize
-- xval - value of the variable
-- xtop - true - This variable is for all profiles, not a single character


	setvar = {
-- { &quot;name&quot;, &quot;class&quot;, {&quot;val1&quot;, &quot;val2&quot;, &quot;val3&quot;}, &quot;default&quot;, &quot;instructions&quot; },
	{ &quot;sound&quot;, &quot;&quot;, {&quot;off&quot;, &quot;limited&quot;, &quot;on&quot;}, &quot;on&quot;, &quot;play sounds&quot;},
	{ &quot;map&quot;, &quot;&quot;, {&quot;on&quot;, &quot;off&quot;}, &quot;on&quot;, &quot;display map&quot;},
	{ &quot;swedish&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;translate acc/etc to swedish&quot;},
	{ &quot;style&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;true&quot;, &quot;use Qt icon stylesheet&quot;},
	{ &quot;hideicons&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;hide lower icon bar&quot;},
	{ &quot;hideequip&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;true&quot;, &quot;hide left equip icon bar&quot;},
	{ &quot;border&quot;, &quot;&quot;, {&quot;default&quot;, &quot;file&quot;, &quot;none&quot;}, &quot;default&quot;, &quot;&quot;},
	{ &quot;numcolor&quot;, &quot;&quot;, {&quot;*&quot;}, &quot;blue&quot;, &quot;color of numbers on buttons&quot;},
	{ &quot;statname&quot;, &quot;*&quot;, {&quot;*&quot;}, &quot;unset&quot;, &quot;&quot;},
	{ &quot;autoopen&quot;, &quot;*&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;auto-open doors&quot; },
	{ &quot;echodrag&quot;, &quot;*&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;echo when a corpse is dragged&quot; },
	{ &quot;autoportal&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;auto enter rifts/portals/etc&quot; },
	{ &quot;condensed&quot;, &quot;&quot;, {&quot;dragon&quot;, &quot;combat&quot;, &quot;spells&quot;, &quot;items&quot;, &quot;arrows&quot;, &quot;misc&quot;, &quot;duplicate&quot;, &quot;debug&quot;}, &quot;&quot;, &quot;&quot; },
	{ &quot;vnum&quot;, &quot;&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;true&quot;, &quot;display room vnum&quot; },
	{ &quot;chatfontsize&quot;, &quot;&quot;, {&quot;auto&quot;, &quot;#&quot;}, &quot;12&quot;, &quot;fontsize to use for the chat window&quot; },
	{ &quot;grpfontsize&quot;, &quot;&quot;, {&quot;auto&quot;, &quot;#&quot;}, &quot;14&quot;, &quot;fontsize to use for the group window&quot; },
	{ &quot;reconnect&quot;, &quot;*&quot;, {&quot;false&quot;, &quot;#&quot;}, &quot;false&quot;, &quot;auto login this char number&quot; },
	{ &quot;endspell&quot;, &quot;*&quot;, {&quot;vit&quot;, &quot;dsp&quot;, &quot;pwt&quot;, &quot;fly&quot;, &quot;grp&quot;, &quot;pfu&quot;, &quot;hst&quot;, &quot;dop&quot;}, &quot;vit&quot;, &quot;&quot; },
	{ &quot;gcmd&quot;, &quot;*&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;use gcmd instead of gsay&quot;},
	{ &quot;group&quot;, &quot;&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;true&quot;, &quot;updated group display&quot; },
	{ &quot;assocchar&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;false&quot;, &quot;connect to association chat, storage&quot; },
	{ &quot;blurout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ BLUR OUT ]]&quot;, &quot;&quot; },
	{ &quot;displaceout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ DISPLACE OUT ]]&quot;, &quot;&quot; },
	{ &quot;globeout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ GLOBE OUT ]]&quot;, &quot;&quot; },
	{ &quot;hasteout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ HASTE OUT ]]&quot;, &quot;&quot; },
	{ &quot;scaleout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ SCALE OUT ]]&quot;, &quot;&quot; },
	{ &quot;stoneout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ STONE OUT ]]&quot;, &quot;&quot; },
	{ &quot;vitout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ VIT OUT ]]&quot;, &quot;&quot; },
	{ &quot;barkout&quot;, &quot;&quot;, { &quot;*&quot; }, &quot;[[ BARK OUT ]]&quot;, &quot;&quot;},
	{ &quot;-&quot;, &quot;-&quot; },
	{ &quot;container&quot;, &quot;*&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;set the name of your main container&quot;},
	{ &quot;food&quot;, &quot;noPsi&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;food name to eat&quot;},
	{ &quot;canteen&quot;, &quot;noPsi&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;name of water container&quot;},
	{ &quot;autoloot&quot;, &quot;*&quot;, {&quot;off&quot;, &quot;coins&quot;, &quot;all&quot;}, &quot;off&quot;, &quot;&quot;},
	{ &quot;flee&quot;, &quot;*&quot;, {&quot;on&quot;, &quot;off&quot;, &quot;dragon&quot;, &quot;lich&quot;}, &quot;on&quot;, &quot;&quot;,
				&quot;\n&lt;red&gt;[If you panic but can't get out, you'll flee again.]\n&quot;,
				&quot;\n&lt;red&gt;[All flee triggers are turned off.]\n&quot;,
				&quot;\n&lt;red&gt;[If a room is fled (for any reason), it will be returned to.]\n&quot;,
				&quot;\n&lt;red&gt;[Staying in a room with a lich that touched you isn't going to happen.]\n&quot;
		 },
	{ &quot;autoassist&quot;, &quot;*&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;true&quot;, &quot;assist people in combat&quot;,
				&quot;\n&lt;green&gt;[Any group member is combat will be assisted.]\n&quot;,
				&quot;\n&lt;red&gt;[Assist commands will not be sent.]\n&quot;,
		},
	{ &quot;petrescue&quot;, &quot;*&quot;, {&quot;NONE&quot;, &quot;ALL&quot;, &quot;ME&quot;}, &quot;ME&quot;, &quot;&quot;,
				&quot;\n&lt;red&gt;[Commands will not be generated to rescue anyone]\n&quot;,
				&quot;\n&lt;green&gt;[Order pets to rescue all non-warriors]\n&quot;,
				&quot;\n&lt;green&gt;[Only rescue me]\n&quot;
		 },
	{ &quot;-&quot;, &quot;-&quot; },
	{ &quot;autocast&quot;, &quot;caster&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast/mem spells automatically&quot;, &quot;SpellsButton&quot;},
	{ &quot;pokehaste&quot;, &quot;haster&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast haste when poked&quot; },
	{ &quot;autots&quot;, &quot;enc&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast time stop&quot; },
	{ &quot;self&quot;, &quot;self&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;spellup includes self&quot;,
				&quot;\n&lt;green&gt;[The caster will be blurred, scaled or stoned on spellup.]\n&quot;,
				&quot;\n&lt;red&gt;[Spellups are not including me.]\n&quot;
		},
	{ &quot;bard&quot;, &quot;enc&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;rogue spellups includes bards&quot;,
				&quot;\n&lt;green&gt;[Bards will be treated as hitters.]\n&quot;,
				&quot;\n&lt;red&gt;[Bards don't need spells.]\n&quot;
		},
	{ &quot;autoscale&quot;, &quot;enc&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;dragonscale targets&quot;,
				&quot;\n&lt;green&gt;[Casters will now be scaled.]\n&quot;,
				&quot;\n&lt;red&gt;[Warriors only will be scaled.]\n&quot;
		},
	{ &quot;autoblur&quot;, &quot;enc&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;blur targets&quot;,
				&quot;\n&lt;green&gt;[Casters will now be blurred.]\n&quot;,
				&quot;\n&lt;red&gt;[Warriors only will be blurred.]\n&quot;
		},
	{ &quot;autohaste&quot;, &quot;enc&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;incomplete&quot;,
				&quot;\n&lt;red&gt;[Incomplete: Hitters will be hasted.]\n&quot;,
				&quot;\n&lt;red&gt;[Incomplete: Hitters don't need haste.]\n&quot;
		},
	{ &quot;autoglobe&quot;, &quot;casterGlobe&quot;, {&quot;true&quot;, &quot;false&quot;, &quot;hitters&quot;}, &quot;false&quot;, &quot;who to globe&quot;,
				&quot;\n&lt;green&gt;[Hitters (including ogre warriors) will be globed.]\n&quot;,
				&quot;\n&lt;red&gt;[Players don't need globe.]\n&quot;,
				&quot;\n&lt;green&gt;[All hitters and warriors will be globed.]\n&quot;
		},
	{ &quot;resize&quot;, &quot;enc&quot;, {&quot;off&quot;, &quot;small&quot;, &quot;large&quot;, &quot;all&quot;}, &quot;all&quot;, &quot;resize setting&quot;,
			&quot;\n&lt;red&gt;[Resizing will no longer occur.]\n&quot;,
			&quot;\n&lt;red&gt;[Resizing will now occur for small players only.]\n&quot;,
			&quot;\n&lt;red&gt;[All medium sized casters will be enlarged.]\n&quot;,
			&quot;\n&lt;red&gt;[Ogre warriors will now be enlarged, and small casters reduced.]\n&quot;
		},
	{ &quot;vit&quot;, &quot;priest&quot;, { &quot;all&quot;, &quot;hitter&quot;, &quot;priest&quot;, &quot;warrior&quot;, &quot;nopriest&quot;, &quot;nocleric&quot;, &quot;tiavit&quot;, &quot;mage&quot; }, &quot;all&quot;, &quot;mask when casting vit&quot; },
	{ &quot;autovit&quot;, &quot;priest&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast vit automatically&quot;,
			&quot;\n&lt;green&gt;[Auto-vitality turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto vitality turned off.]\n&quot;
		},
	{ &quot;autogh&quot;, &quot;sha&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast group heal automatically&quot;,
			&quot;\n&lt;green&gt;[Auto group-heal turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto group-heal turned off.]\n&quot;
		},
	{ &quot;autofury&quot;, &quot;sha&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast ancestral fury automatically&quot;, 
			&quot;\n&lt;green&gt;[Ancestral Fury turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Ancestral Fury turned off.]\n&quot;
		},
	{ &quot;autoashield&quot;, &quot;sha&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast ancestral shield automatically&quot;, 
			&quot;\n&lt;green&gt;[Ancestral Shield turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Ancestral Shield turned off.]\n&quot;
		},
	{ &quot;autoheal&quot;, &quot;cle&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast fh/ha automatically&quot;},
	{ &quot;turnundead&quot;, &quot;dmgundead&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;damage undead automatically&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;autopurify&quot;, &quot;cle&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;true&quot;, &quot;cast divine purification automatically&quot;},
	{ &quot;autocb&quot;, &quot;cle&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;true&quot;, &quot;cast cure blind automatically&quot;},
	{ &quot;autoquake&quot;, &quot;priest&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast quake as needed&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;autores&quot;, &quot;cle&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;res all consented pcorpses in room&quot;,
			&quot;\n&lt;green&gt;[@ will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;autorealm&quot;, &quot;cle&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;keep everyone realmd&quot;,
			&quot;\n&lt;green&gt;[@ will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;warmaul&quot;, &quot;equip&quot;, { &quot;aid&quot;, &quot;restore&quot;, &quot;off&quot;}, &quot;off&quot;, &quot;&quot;},
	{ &quot;gigbag&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;name of container holding instruments&quot; },
	{ &quot;forcerenew&quot;, &quot;singer&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;force renew despite full psp&quot;},
	{ &quot;lute&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;piccolo&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;trumpet&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;drum&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;harp&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;mandolin&quot;, &quot;singer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot; },
	{ &quot;autobless&quot;, &quot;singer&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast harmonious blessing&quot;},
	{ &quot;bane&quot;, &quot;equip&quot;, { &quot;blind&quot;, &quot;poison&quot;, &quot;slow&quot;, &quot;strike&quot;}, &quot;blind&quot;, &quot;&quot;},
	{ &quot;valhalla&quot;, &quot;equip&quot;, { &quot;defend&quot;, &quot;berserk&quot; }, &quot;defend&quot;, &quot;&quot;},
	{ &quot;psicrystal&quot;, &quot;psi&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;&quot;},
	{ &quot;wormhole&quot;, &quot;psi&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Wormhole and Rift triggers turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Wormhole and Rift triggers turned off.]\n&quot;
		 },
	{ &quot;disableworm&quot;, &quot;psi&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot; },
	{ &quot;autotower&quot;, &quot;psi&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot; },
	{ &quot;autosustain&quot;, &quot;psi&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot; },
	{ &quot;autobash&quot;, &quot;fighter&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
				&quot;\n&lt;red&gt;[Auto-bash is turned on.]\n&quot;,
				&quot;\n&lt;red&gt;[Auto-bash is turned off.]\n&quot;
		 },
	{ &quot;autokick&quot;, &quot;fighter&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
				&quot;\n&lt;green&gt;[Auto-kick is turned on.]\n&quot;,
				&quot;\n&lt;red&gt;[Auto-kick is turned off.]\n&quot;
		 },
	{ &quot;autoshieldpunch&quot;, &quot;fighter&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
				&quot;\n&lt;red&gt;[incomplete: Auto-shieldpunch is turned on.]\n&quot;,
				&quot;\n&lt;red&gt;[incomplete: Auto-shieldpunch is turned off.]\n&quot;
		 },
	{ &quot;powersbash&quot;, &quot;fighter&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;use powers bash&quot; },
	{ &quot;wuss&quot;, &quot;*&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;always rescue and spell wuss&quot;},
	{ &quot;rescuetype&quot;, &quot;fighter&quot;, { &quot;off&quot;, &quot;basic&quot;, &quot;all&quot; }, &quot;basic&quot;, &quot;&quot;,
			&quot;\n&lt;red&gt;[Rescue is now turned off]\n&quot;,
			&quot;\n&lt;green&gt;[All grouped non-warrior players will be rescued]\n&quot;,
			&quot;\n&lt;green&gt;[All grouped players will be rescued]\n&quot;
		},
	{ &quot;autotank&quot;, &quot;fighter&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot; },
	{ &quot;autocircle&quot;, &quot;rog&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Auto-circle is turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto-circle is turned off.]\n&quot;
		},
	{ &quot;autotrip&quot;, &quot;rog&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Auto-trip is turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto-trip is turned off.]\n&quot;
		 },
	{ &quot;autoassassinate&quot;, &quot;rog&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Auto-assassinate is turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto-assassinate is turned off.]\n&quot;
		 },
	{ &quot;autopoison&quot;, &quot;venomer&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Auto-poison is turned on.]\n&quot;,
			&quot;\n&lt;red&gt;[Auto-poison is turned off.]\n&quot;
		},
	{ &quot;autoarea&quot;, &quot;missile&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast 1-6th circle area combat spells&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;automissile&quot;, &quot;missile&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast 1-6th circle combat spells&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autohlmissile&quot;, &quot;missile&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast 7th+ circle combat spells&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autohlarea&quot;, &quot;hlarea&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast 7th circle+ area combat spells&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autofm&quot;, &quot;inv&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;use force missiles in combat&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autostorm&quot;, &quot;inv&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;use sandstorm in combat&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autoharm&quot;, &quot;priest&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast harm spells&quot;},
	{ &quot;autoffire&quot;, &quot;ffire&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[@ will be cast during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		 },
	{ &quot;autodisplace&quot;, &quot;ill&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Displacement will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[Displacement will not be used.]\n&quot;
	},
	{ &quot;autodoppel&quot;, &quot;ill&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[Doppelganger will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[Doppelganger will not be used.]\n&quot;
	},
	{ &quot;displacemask&quot;, &quot;mask&quot;, { }, &quot;&quot;, &quot;&quot;,	},
	{ &quot;autoblind&quot;, &quot;ele&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[@ will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
	},
	{ &quot;autoward&quot;, &quot;ele&quot;, { &quot;true&quot;, &quot;false&quot; }, &quot;false&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[@ will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
	},
	{ &quot;autostone&quot;, &quot;stoner&quot;, { &quot;off&quot;, &quot;rogues&quot;, &quot;tanks&quot;, &quot;all&quot; }, &quot;off&quot;, &quot;&quot;,
			&quot;\n&lt;green&gt;[@ will be used on self.]\n&quot;,
			&quot;\n&lt;green&gt;[@ will be used on self and rogues.]\n&quot;,
			&quot;\n&lt;green&gt;[@ will be used on self and tanks.]\n&quot;,
			&quot;\n&lt;green&gt;[@ will be used on all group members.]\n&quot;
	},
	{ &quot;poisonbag&quot;, &quot;venomer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;name of container holding poisons&quot; },
	{ &quot;primaryp&quot;, &quot;venomer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;poison for primary weapon&quot;},
	{ &quot;secondaryp&quot;, &quot;venomer&quot;, { &quot;*&quot; }, &quot;&quot;, &quot;poison for secondary weapon&quot;},
	{ &quot;autopfu&quot;, &quot;necros&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;cast protection from undead&quot;,
			&quot;\n&lt;green&gt;[@ will be used.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;outflank&quot;, &quot;dire&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;outflank during combat&quot;,
			&quot;\n&lt;green&gt;[@ will be used during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		},
	{ &quot;autohowl&quot;, &quot;dire&quot;, {&quot;true&quot;, &quot;false&quot;}, &quot;false&quot;, &quot;howl during combat&quot;,
			&quot;\n&lt;green&gt;[@ will be used during combat.]\n&quot;,
			&quot;\n&lt;red&gt;[@ will not be used.]\n&quot;
		}

 }

function charData:init(xkey, xval, xtop)
	if xtop ~= nil then
		if self[xkey] == nil then
			self[xkey]=xval
		end
	else
		if whoami() == nil then
			cecho(&quot;&lt;red&gt;[Error: whoami not set]\n&quot;)
			return
		end
	
		self[whoami()] = self[whoami()] or {}

		if self[whoami()][xkey] == nil then
			self[whoami()][xkey]=xval
		end
	end
end

-- TODO: change charData:set to update matching button

function charData:set(xkey, xval, xtop)
	if xtop ~= nil then
		self[xkey] = xval
	else
		if self[whoami()] == nil then
			cecho(&quot;\n&lt;red&gt;[Creating self.&quot; .. whoami() .. &quot;]\n&quot;)
			self[whoami()] = {}
		end

		self[whoami()][xkey] = xval
	end
end

-- should return initial value if key doesn't exist

function charData:get(xkey, xtop)
	if xtop ~= nil then
		-- key is top level

		if self[xkey] ~= nil then
			return(self[xkey])
		end
	else
		-- key is indexed on charname

		if whoami() == nil then
			return(nil)
		end

		if self[whoami()][xkey] ~= nil then
			return(self[whoami()][xkey])
		end
	end

	-- doesn't exit, should return initial value from setvar table
	-- tables (i.e. condensed) always exist

	local nx

	for nx=1, #setvar, 1 do
		local key= setvar[nx][1]
		local value

		if key == xkey then
			value=setvar[nx][4]

			if value == &quot;true&quot; then
				value=true
			elseif value ==&quot;false&quot; then
				value=false
			end

			return(value)
		end
	end
	
	if xkey == nil then
		echoDebug(&quot;\n&lt;red&gt;[nil xkey value]\n&quot;)
	else
		echoDebug(&quot;\n&lt;red&gt;[Warning: key &quot; .. xkey .. &quot; does not exist]\n&quot;)
	end

	return(nil)
end

function charData:save()
	table.save(homepath(&quot;chardata.dat&quot;), self )
	cecho(&quot;\n&lt;red&gt;[Saved CharData table]\n&quot;)
end

function charData:load()
	local is_file = io.open(homepath(&quot;chardata.dat&quot;))

	cecho(&quot;&lt;red&gt;[Loaded charData]\n&quot;)

	
	if is_file ~= nil then
		table.load(homepath(&quot;chardata.dat&quot;), self)

		-- if old version, replace true/false with boolean
		for k1,v1 in pairs(self) do
			if v1 == &quot;true&quot; then
				charData:set(k1, true, true)
			end

			if v1 == &quot;false&quot; then
				charData:set(k1, false, true)
			end

			if type(self[k1]) == &quot;table&quot; then
				for k2,v2 in pairs(self[k1]) do
					if v2 == &quot;true&quot; then
						self[k1][k2] = true
					end

					if v2 == &quot;false&quot; then
						self[k1][k2] = false
					end
				end
			end
		end

		if self.spellouts ~= nil then
			self.blurout = self.spellouts[1][2]
			self.globeout = self.spellouts[2][2]
			self.hasteout = self.spellouts[3][2]
			self.scaleout = self.spellouts[4][2]
			self.vitout = self.spellouts[5][2]
			self.barkout = &quot;[[ BARK OUT ]]&quot;

			self.spellouts = nil
		end
	end

	self.border = self.border or &quot;default&quot;

	self.condensed= self.condensed or {}

	self.condensed[&quot;dragon&quot;] = self.condensed[&quot;dragon&quot;] or false
	self.condensed[&quot;combat&quot;] = self.condensed[&quot;combat&quot;] or false
	self.condensed[&quot;spells&quot;] = self.condensed[&quot;spells&quot;] or false
	self.condensed[&quot;items&quot;] = self.condensed[&quot;items&quot;] or false
	self.condensed[&quot;arrows&quot;] = self.condensed[&quot;arrows&quot;] or false
	self.condensed[&quot;misc&quot;] = self.condensed[&quot;misc&quot;] or false
	self.condensed[&quot;duplicate&quot;] = self.condensed[&quot;duplicate&quot;] or false
	self.condensed[&quot;debug&quot;] = self.condensed[&quot;debug&quot;] or false

	self.gags = self.gags or {}

	self.fwalk = self.fwalk or {}

	self.group = self.group or false

	self.potionc = self.potionc or &quot;&lt;:medium_blue&gt;&lt;white&gt;&quot;

	self.chatfontsize = self.chatfontsize or &quot;auto&quot;
	self.grpfontsize = self.grpfontsize or 14
	self.assocchar = self.assocchar or &quot;&quot;

	self.vnum = self.vnum or false

	self.numcolor = self.numcolor or &quot;blue&quot;

	return
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>Spell Powers Header</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
powerAliases= powerAliases or {}

-- automissile: circle 1-6 single target
-- autoarea: circle 1-6 area
-- autohlmissle: circle7+ single target
-- autohlarea: circle 7+ area


powerAliases[&quot;Bar&quot;] =
						{
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;phantom_armor&quot;, &quot;pa&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 16, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;harmonious_blessing&quot;, &quot;hbl&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;feeblemind&quot;, &quot;feeb&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;sonic_wave&quot;, &quot;sw&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;displacement&quot;, &quot;ds&quot;, 46, &quot;&quot;, &quot;&quot;},
						}


powerAliases[&quot;A_P&quot;] = 
						{
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cause_light&quot;, &quot;caul&quot;, 1, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;armor&quot;, &quot;am&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;create_food&quot;, &quot;cfood&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_good&quot;, &quot;pfd&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;curse_item&quot;, &quot;curi&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;curse&quot;, &quot;cr&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;poison&quot;, &quot;pn&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;heal_mount&quot;, &quot;hm&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_good&quot;, &quot;dispg&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;fear&quot;, &quot;fe&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;blindness&quot;, &quot;bl&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;wither&quot;, &quot;wt&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;tazriks_frenzied_hound&quot;, &quot;tz&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;harm&quot;, &quot;hm&quot;, 41, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;dark_wrath&quot;, &quot;dw&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;unholy_word&quot;, &quot;uw&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;unholy_aura&quot;, &quot;ua&quot;, 46, &quot;&quot;, &quot;&quot;}
						}

powerAliases[&quot;Pal&quot;] =
						{
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;armor&quot;, &quot;am&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 11, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;create_food&quot;, &quot;cfood&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;remove_curse&quot;, &quot;remc&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_evil&quot;, &quot;pfe&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;remove_poison&quot;, &quot;rp&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;heal_mount&quot;, &quot;hm&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_evil&quot;, &quot;dev&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 21, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;ward_undead&quot;, &quot;wu&quot;, 26, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;cure_blind&quot;, &quot;cb&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;destroy_undead&quot;, &quot;dun&quot;, 36, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;continual_light&quot;, &quot;cnl&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;holy_shroud&quot;, &quot;hs&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;heal&quot;, &quot;hl&quot;, 41, &quot;&quot;, &quot;autoheal&quot;},
{ &quot;holy_word&quot;, &quot;hw&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;}
						} 

powerAliases[&quot;Dir&quot;] =
						{
{ &quot;vigorize_light&quot;, &quot;vl&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;sense_life&quot;, &quot;sen&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;create_food&quot;, &quot;cfood&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_serious&quot;, &quot;vs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;poison&quot;, &quot;pn&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;jar_the_soul&quot;, &quot;js&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 16, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;vigorize_critic&quot;, &quot;vc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_animals&quot;, &quot;pfan&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;heal_mount&quot;, &quot;hm&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;fear&quot;, &quot;fe&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;blindness&quot;, &quot;bl&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;totem_darts&quot;, &quot;td&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;strength&quot;, &quot;str&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;barkskin&quot;, &quot;bark&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;minor_paralysis&quot;, &quot;minp&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 36, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;hex&quot;, &quot;hx&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;farsee&quot;, &quot;fs&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;poltergeist&quot;, &quot;pg&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;pass_without_trace&quot;, &quot;pwt&quot;, 46, &quot;&quot;, &quot;&quot;}
						}
powerAliases[&quot;Ran&quot;] = 
						{	
{ &quot;vigorize_light&quot;, &quot;vl&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;shillelagh&quot;, &quot;shl&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;sense_life&quot;, &quot;sen&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;goodberry&quot;, &quot;gdb&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 6, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;vigorize_serious&quot;, &quot;vs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 11, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;summon_insects&quot;, &quot;si&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fog&quot;, &quot;ffog&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_critic&quot;, &quot;vc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_animals&quot;, &quot;pfan&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;create_spring&quot;, &quot;cspring&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;sleep&quot;, &quot;slp&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;dust_devil&quot;, &quot;dd&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;barkskin&quot;, &quot;bark&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;sticks_to_snakes&quot;, &quot;sts&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;strength&quot;, &quot;str&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;natures_blessing&quot;, &quot;nb&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;minor_paralysis&quot;, &quot;minp&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 36, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;transport_via_plants&quot;, &quot;tvp&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;call_lightning&quot;, &quot;call&quot;, 41, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;pass_without_trace&quot;, &quot;pwt&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;control_weather&quot;, &quot;conweather&quot;, 46, &quot;&quot;, &quot;&quot;},
						}

powerAliases[&quot;Dru&quot;] = 
						{ 	
{ &quot;shillelagh&quot;, &quot;shl&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;goodberry&quot;, &quot;gdb&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cause_light&quot;, &quot;caul&quot;, 1, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;word_of_recall&quot;, &quot;word&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_light&quot;, &quot;vl&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_animals&quot;, &quot;pfan&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;preserve&quot;, &quot;prs&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 6, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 6, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cause_serious&quot;, &quot;causs&quot;, 6, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_serious&quot;, &quot;vs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;summon_insects&quot;, &quot;si&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;remove_poison&quot;, &quot;rp&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_lightning&quot;, &quot;pfl&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_gas&quot;, &quot;pfg&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_fire&quot;, &quot;pff&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_cold&quot;, &quot;pfc&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_acid&quot;, &quot;pfa&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fog&quot;, &quot;ffog&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;barkskin&quot;, &quot;bark&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;transport_via_plants&quot;, &quot;tvp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;summon&quot;, &quot;sum&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;sense_life&quot;, &quot;sen&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;earthquake&quot;, &quot;eaq&quot;, 16, &quot;autoquake&quot;, &quot;&quot;},
{ &quot;dust_devil&quot;, &quot;dd&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 16, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;create_spring&quot;, &quot;cspring&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;cause_critical&quot;, &quot;cauc&quot;, 16, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;vigorize_critic&quot;, &quot;vc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;sunray&quot;, &quot;sr&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;raise_dead&quot;, &quot;rd&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;harm&quot;, &quot;hm&quot;, 21, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;control_weather&quot;, &quot;conweather&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;call_lightning&quot;, &quot;call&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;vitality&quot;, &quot;vt&quot;, 26, &quot;autovit&quot;, &quot;&quot;},
{ &quot;suffocate&quot;, &quot;sf&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;insect_plague&quot;, &quot;ip&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;heal&quot;, &quot;hl&quot;, 26, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;firestorm&quot;, &quot;fst&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;fear&quot;, &quot;fe&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;continual_light&quot;, &quot;cnl&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;changestaff&quot;, &quot;cstf&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;sticks_to_snakes&quot;, &quot;sts&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;pass_without_trace&quot;, &quot;pwt&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;group_vigorize&quot;, &quot;gvig&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;flame_blade&quot;, &quot;fb&quot;, 31, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;cyclone&quot;, &quot;cy&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;water_breathing&quot;, &quot;wb&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;spiked_stones&quot;, &quot;ss&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;rock_to_mud&quot;, &quot;rocktm&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;mud_to_rock&quot;, &quot;mudtr&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;fire_seeds&quot;, &quot;fs&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;hailstorm&quot;, &quot;hs&quot;, 41, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;entangle&quot;, &quot;eng&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;dessicate&quot;, &quot;des&quot;, 41, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;plane_shift&quot;, &quot;pshift&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;group_barkskin&quot;, &quot;gbark&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;creeping_doom&quot;, &quot;cd&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;moonwell&quot;, &quot;mw&quot;, 46, &quot;&quot;, &quot;&quot;},
						}

powerAliases[&quot;Cle&quot;] =
						{ 	
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;create_food&quot;, &quot;cfood&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cause_light&quot;, &quot;caul&quot;, 1, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;armor&quot;, &quot;am&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;word_of_recall&quot;, &quot;word&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_light&quot;, &quot;vl&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;slow_poison&quot;, &quot;slp&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;preserve&quot;, &quot;prs&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 6, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cause_serious&quot;, &quot;causs&quot;, 6, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_serious&quot;, &quot;vs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;sense_life&quot;, &quot;sen&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;earthquake&quot;, &quot;eaq&quot;, 11, &quot;autoquake&quot;, &quot;&quot;},
{ &quot;dispel_good&quot;, &quot;dispg&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_evil&quot;, &quot;dev&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 11, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cure_blind&quot;, &quot;cb&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;cause_critical&quot;, &quot;cauc&quot;, 11, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;ward_undead&quot;, &quot;wu&quot;, 16, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;transport_via_plants&quot;, &quot;tvp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;summon&quot;, &quot;sum&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;remove_poison&quot;, &quot;rp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;remove_curse&quot;, &quot;remc&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_lightning&quot;, &quot;pfl&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_good&quot;, &quot;pfd&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_gas&quot;, &quot;pfg&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_fire&quot;, &quot;pff&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_evil&quot;, &quot;pfe&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_cold&quot;, &quot;pfc&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_acid&quot;, &quot;pfa&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;flame_strike&quot;, &quot;fs&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;blindness&quot;, &quot;bl&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;vitality&quot;, &quot;vt&quot;, 21, &quot;autovit&quot;, &quot;&quot;},
{ &quot;vigorize_critic&quot;, &quot;vc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;raise_dead&quot;, &quot;rd&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;heal&quot;, &quot;hl&quot;, 21, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;silence_person&quot;, &quot;sp&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;harm&quot;, &quot;hm&quot;, 26, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;fear&quot;, &quot;fe&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;destroy_undead&quot;, &quot;dun&quot;, 26, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;darkness&quot;, &quot;dkn&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;curse_item&quot;, &quot;curi&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;curse&quot;, &quot;cr&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;continual_light&quot;, &quot;cnl&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;water_breathing&quot;, &quot;wb&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;group_vigorize&quot;, &quot;gvig&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;full_heal&quot;, &quot;fh&quot;, 31, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;full_harm&quot;, &quot;fhm&quot;, 36, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;eradicate_undead&quot;, &quot;eu&quot;, 36, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;divine_purification&quot;, &quot;dpu&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;divine_blessing&quot;, &quot;dvb&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;greater_realm_of_protection&quot;, &quot;realm&quot;, 46, &quot;autorealm&quot;, &quot;&quot;},
{ &quot;divine_power&quot;, &quot;dp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;healing_aura&quot;, &quot;ha&quot;, 36, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;righteous_might&quot;, &quot;rm&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;plane_shift&quot;, &quot;pshift&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;resurrect&quot;, &quot;resu&quot;, 46, &quot;autores&quot;, &quot;&quot;},
{ &quot;unholy_word&quot;, &quot;uw&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;holy_word&quot;, &quot;hw&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;disruption_burst&quot;, &quot;db&quot;, 46, &quot;turnundead&quot;, &quot;&quot;},
						}

powerAliases[&quot;Sha&quot;] =
						{ 	
{ &quot;cure_light&quot;, &quot;curel&quot;, 1, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;create_water&quot;, &quot;cwater&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;create_food&quot;, &quot;cfood&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;cause_light&quot;, &quot;caul&quot;, 1, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;armor&quot;, &quot;am&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_light&quot;, &quot;vl&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;spiritknife&quot;, &quot;sk&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_good&quot;, &quot;dg&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;detect_evil&quot;, &quot;de&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;cure_serious&quot;, &quot;cs&quot;, 6, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cause_serious&quot;, &quot;causs&quot;, 6, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;bless&quot;, &quot;bls&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;word_of_recall&quot;, &quot;word&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_serious&quot;, &quot;vs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;sense_life&quot;, &quot;sen&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;remove_poison&quot;, &quot;rp&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;preserve&quot;, &quot;prs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;jar_the_soul&quot;, &quot;js&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;blindness&quot;, &quot;bl&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;vigorize_critic&quot;, &quot;vc&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;unleash_fetish&quot;, &quot;uf&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;minor_paralysis&quot;, &quot;minp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 16, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;earthquake&quot;, &quot;eaq&quot;, 16, &quot;autoquake&quot;, &quot;&quot;},
{ &quot;cure_critic&quot;, &quot;ccr&quot;, 16, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;cure_blind&quot;, &quot;cb&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;cause_critical&quot;, &quot;cauc&quot;, 16, &quot;autoharm&quot;, &quot;&quot;},
{ &quot;summon&quot;, &quot;sum&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;slowness&quot;, &quot;slow&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;remove_curse&quot;, &quot;remc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;raise_dead&quot;, &quot;rd&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;puppet&quot;, &quot;pp&quot;, 21, &quot;automissile&quot;, &quot;&quot;},
{ &quot;protection_from_lightning&quot;, &quot;pfl&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_good&quot;, &quot;pfd&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_gas&quot;, &quot;pfg&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_fire&quot;, &quot;pff&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_evil&quot;, &quot;pfe&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_cold&quot;, &quot;pfc&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_acid&quot;, &quot;pfa&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fog&quot;, &quot;ffog&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;stoneskin&quot;, &quot;ss&quot;, 26, &quot;autostone&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;hex&quot;, &quot;hx&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;heal&quot;, &quot;hl&quot;, 26, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;fear&quot;, &quot;fe&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;farsee&quot;, &quot;fs&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;continual_light&quot;, &quot;cnl&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;totem_darts&quot;, &quot;td&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;vitality&quot;, &quot;vt&quot;, 31, &quot;autovit&quot;, &quot;&quot;},
{ &quot;soul_tempest&quot;, &quot;stp&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;silence_person&quot;, &quot;sp&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;minor_globe_of_invulnerability&quot;, &quot;mgi&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;group_vigorize&quot;, &quot;gvig&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;darkness&quot;, &quot;dkn&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;water_breathing&quot;, &quot;wb&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;spirit_wrack&quot;, &quot;sw&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;missile_shield&quot;, &quot;ms&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;scry_remains&quot;, &quot;screm&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;control_weather&quot;, &quot;conweather&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;spirit_walk&quot;, &quot;swalk&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;plane_shift&quot;, &quot;pshift&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;ancestral_fury&quot;, &quot;afu&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;group_heal&quot;, &quot;gh&quot;, 41, &quot;autogh&quot;, &quot;&quot;},
{ &quot;ancestral_shield&quot;, &quot;ash&quot;, 46, &quot;autoashield&quot;, &quot;&quot;}
						}

powerAliases[&quot;Ill&quot;] =
					   { 
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 6, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;dispel_invisible&quot;, &quot;disi&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;blackthorns&quot;, &quot;bt&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;phantom_armor&quot;, &quot;pa&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;mass_invisibility&quot;, &quot;massi&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;locate_object&quot;, &quot;loco&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;change_self&quot;, &quot;chs&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;spook&quot;, &quot;sp&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;scarlet_outline&quot;, &quot;sct&quot;, 16, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;phantom_steed&quot;, &quot;psteed&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;farsee&quot;, &quot;fs&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;beautify&quot;, &quot;btf&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;true_sight&quot;, &quot;ts&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;shadow_magic&quot;, &quot;shm&quot;, 21, &quot;automissile&quot;, &quot;&quot;},
{ &quot;shadow_burst&quot;, &quot;sb&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;doppleganger&quot;, &quot;dopple&quot;, 21, &quot;autodoppel&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;tranquility&quot;, &quot;tq&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;summon_shade&quot;, &quot;shade&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;nondetection&quot;, &quot;non&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;displacement&quot;, &quot;ds&quot;, 26, &quot;autodisplace&quot;, &quot;&quot;},
{ &quot;clairvoyance&quot;, &quot;clv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;shadow_bolt&quot;, &quot;bolt&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;shadow_flux&quot;, &quot;sf&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;shadechill&quot;, &quot;sh&quot;, 31, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;sequester&quot;, &quot;sq&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;phantasmal_blades&quot;, &quot;pb&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;corpse_glamor&quot;, &quot;cglam&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;camouflage&quot;, &quot;camo&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;sun_shadow&quot;, &quot;sunshad&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;rainbow_pattern&quot;, &quot;rp&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;phantom_heal&quot;, &quot;pheal&quot;, 36, &quot;autoheal&quot;, &quot;&quot;},
{ &quot;mislead&quot;, &quot;ml&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;mirror_image&quot;, &quot;mi&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;feign_death&quot;, &quot;fnd&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;dimensional_fold&quot;, &quot;fold&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;phantasmal_killer&quot;, &quot;pk&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;massmorph&quot;, &quot;massm&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;gate&quot;, &quot;gate&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;shadow_walk&quot;, &quot;swalk&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;nightmare&quot;, &quot;nm&quot;, 46, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;phantasmal_tendrils&quot;, &quot;pt&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
						}

powerAliases[&quot;Inv&quot;] = {
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;chill_touch&quot;, &quot;ct&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;burning_hands&quot;, &quot;bh&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;shocking_grasp&quot;, &quot;sg&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
--{ &quot;faerie_fire&quot;, &quot;ff&quot;, 6, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;acid_blast&quot;, &quot;acb&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;locate_object&quot;, &quot;loco&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;lightning_bolt&quot;, &quot;lb&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;mordenkainens_sword&quot;, &quot;msw&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;minor_paralysis&quot;, &quot;minp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;fireball&quot;, &quot;fbl&quot;, 16, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;farsee&quot;, &quot;fs&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;slowness&quot;, &quot;slow&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;infravision&quot;, &quot;iv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;fireshield&quot;, &quot;fshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;cone_of_cold&quot;, &quot;cone&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;ice_storm&quot;, &quot;is&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;coldshield&quot;, &quot;cshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;melfs_acid_arrow&quot;, &quot;ma&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;clairvoyance&quot;, &quot;clv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;chain_lightning&quot;, &quot;chain&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;magic_missile&quot;, &quot;mg&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;power_word_stun&quot;, &quot;pws&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;bigbys_clenched_fist&quot;, &quot;bcf&quot;, 31, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;minute_meteors&quot;, &quot;mm&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;thunderblast&quot;, &quot;tb&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;major_paralysis&quot;, &quot;mp&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;force_missiles&quot;, &quot;fm&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;blazing_beam&quot;, &quot;bb&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;incendiary_cloud&quot;, &quot;ic&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;fell_frost&quot;, &quot;ff&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;meteor_swarm&quot;, &quot;ms&quot;, 41, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;relocate&quot;, &quot;relo&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;gate&quot;, &quot;gate&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;sandblast&quot;, &quot;sb&quot;, 46, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;ball_lightning&quot;, &quot;bl&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;inferno&quot;, &quot;inf&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;sandstorm&quot;, &quot;ss&quot;, 46, &quot;autostorm&quot;, &quot;&quot;},
}

powerAliases[&quot;Enc&quot;] = 
						{
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;faerie_fire&quot;, &quot;ff&quot;, 6, &quot;autoffire&quot;, &quot;&quot;},
{ &quot;energy_shield&quot;, &quot;es&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;chill_touch&quot;, &quot;ct&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;burning_hands&quot;, &quot;bh&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;strength&quot;, &quot;str&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;missile_shield&quot;, &quot;ms&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;locate_object&quot;, &quot;loco&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_invisible&quot;, &quot;disi&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;dexterity&quot;, &quot;dex&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;chromatic_orb&quot;, &quot;co&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;blink&quot;, &quot;bk&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;wizard_eye&quot;, &quot;weye&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;sleep&quot;, &quot;slp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;minor_paralysis&quot;, &quot;minp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;mass_invisibility&quot;, &quot;massi&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;lightning_bolt&quot;, &quot;lb&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;haste&quot;, &quot;hs&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;fumble&quot;, &quot;fmb&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;farsee&quot;, &quot;fs&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;stumble&quot;, &quot;stm&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;stoneskin&quot;, &quot;ss&quot;, 21, &quot;autostone&quot;, &quot;&quot;},
{ &quot;slowness&quot;, &quot;slow&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;minor_globe_of_invulnerability&quot;, &quot;mgi&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;infravision&quot;, &quot;iv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;fireshield&quot;, &quot;fshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;coldshield&quot;, &quot;cshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;charm_person&quot;, &quot;chp&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;needle_swarm&quot;, &quot;ns&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;identify&quot;, &quot;id&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;fireball&quot;, &quot;fbl&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;feeblemind&quot;, &quot;feeb&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;enervate&quot;, &quot;env&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;enchant_weapon&quot;, &quot;enchw&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;cone_of_cold&quot;, &quot;cone&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;clairvoyance&quot;, &quot;clv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;blur&quot;, &quot;bl&quot;, 26, &quot;autoblur&quot;, &quot;&quot;},
{ &quot;magic_missile&quot;, &quot;mg&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;solid_fog&quot;, &quot;sfog&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;repulsion&quot;, &quot;rps&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;reduce&quot;, &quot;red&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;power_word_blind&quot;, &quot;pwb&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;fly&quot;, &quot;fly&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;enlarge&quot;, &quot;enl&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;constriction&quot;, &quot;cn&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;prismatic_spray&quot;, &quot;ps&quot;, 31, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;major_paralysis&quot;, &quot;mp&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;globe_of_invulnerability&quot;, &quot;gi&quot;, 36, &quot;autoglobe&quot;, &quot;&quot;},
{ &quot;blacklight_burst&quot;, &quot;bb&quot;, 36, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;airy_water&quot;, &quot;airy&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;breach&quot;, &quot;brc&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;aura_of_the_griffon&quot;, &quot;griffon&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;relocate&quot;, &quot;relo&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;mind_blank&quot;, &quot;mb&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;gate&quot;, &quot;gate&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;time_stop&quot;, &quot;ts&quot;, 46, &quot;autots&quot;, &quot;&quot;},
{ &quot;dragonscales&quot;, &quot;ds&quot;, 46, &quot;autoscale&quot;, &quot;&quot;}
						}

powerAliases[&quot;Ele&quot;] =
						{ 	
{ &quot;minor_creation&quot;, &quot;minor&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;ice_spear&quot;, &quot;is&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;summon_elemental_kin&quot;, &quot;ekin&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;locate_object&quot;, &quot;loco&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;air_blast&quot;, &quot;ab&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;sleep&quot;, &quot;slp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;fireball&quot;, &quot;fbl&quot;, 16, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;faerie_fog&quot;, &quot;ffog&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;thunder_lance&quot;, &quot;tl&quot;, 21, &quot;automissile&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;infravision&quot;, &quot;iv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;glitterdust&quot;, &quot;gl&quot;, 21, &quot;autoblind&quot;, &quot;&quot;},
{ &quot;fireshield&quot;, &quot;fshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;conjure_elemental&quot;, &quot;ele&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;coldshield&quot;, &quot;cshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;stoneskin&quot;, &quot;ss&quot;, 26, &quot;autostone&quot;, &quot;&quot;},
{ &quot;feeblemind&quot;, &quot;feeb&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;earth_stones&quot;, &quot;es&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;cone_of_cold&quot;, &quot;cone&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;clairvoyance&quot;, &quot;clv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;blizzard_sphere&quot;, &quot;bs&quot;, 26, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;earth_darts&quot;, &quot;ed&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;ice_tongue&quot;, &quot;it&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;ice_layer&quot;, &quot;il&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;haste&quot;, &quot;hs&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;elemental_water_embodiment&quot;, &quot;ewe&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;whirlwind&quot;, &quot;ww&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;power_word_stun&quot;, &quot;pws&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;power_word_blind&quot;, &quot;pwb&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;icewave&quot;, &quot;iw&quot;, 36, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;firewave&quot;, &quot;fw&quot;, 36, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;fire_fog&quot;, &quot;ffog&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;elemental_air_embodiment&quot;, &quot;eae&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;earth_fog&quot;, &quot;efog&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;earthblood&quot;, &quot;eb&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;relocate&quot;, &quot;relo&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;gate&quot;, &quot;gate&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;lava_burst&quot;, &quot;lb&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;elemental_ward&quot;, &quot;ew&quot;, 46, &quot;autoward&quot;, &quot;&quot;},
{ &quot;gate&quot;, &quot;gate&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;elemental_earth_embodiment&quot;, &quot;eee&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;elemental_fire_embodiment&quot;, &quot;efe&quot;, 46, &quot;&quot;, &quot;&quot;},
					   }

powerAliases[&quot;Nec&quot;] =
						{
{ &quot;preserve&quot;, &quot;prs&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;animate_skeleton&quot;, &quot;skel&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_undead&quot;, &quot;pfu&quot;, 6, &quot;autopfu&quot;, &quot;&quot;},
{ &quot;protection_from_cold&quot;, &quot;pfc&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;chill_touch&quot;, &quot;ct&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;animate_zombie&quot;, &quot;zomb&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;soul_bind&quot;, &quot;sb&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;rejuvenate_minor&quot;, &quot;rejuvm&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;pain_touch&quot;, &quot;pt&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;animate_ghoul&quot;, &quot;ghoul&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;wither&quot;, &quot;wt&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;strength&quot;, &quot;str&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;spectral_hand&quot;, &quot;sh&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;sleep&quot;, &quot;slp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;command_horde&quot;, &quot;comh&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;animate_shadow&quot;, &quot;shadow&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;snapping_teeth&quot;, &quot;snp&quot;, 21, &quot;automissile&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;infravision&quot;, &quot;iv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;ice_storm&quot;, &quot;is&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;heal_undead&quot;, &quot;hu&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;feeblemind&quot;, &quot;feeb&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;energy_drain&quot;, &quot;ed&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;cone_of_cold&quot;, &quot;cone&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;coldshield&quot;, &quot;cshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;animate_wight&quot;, &quot;wight&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;ward_undead&quot;, &quot;wu&quot;, 26, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;vampiric_touch&quot;, &quot;vt&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;rejuvenate_major&quot;, &quot;rejuv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;nerve_dance&quot;, &quot;nd&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;minor_globe_of_invulnerability&quot;, &quot;mgi&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;animate_ghast&quot;, &quot;ghast&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;age&quot;, &quot;age&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;magic_missile&quot;, &quot;mg&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;protect_undead&quot;, &quot;pu&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;haste&quot;, &quot;hs&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;corpse_glamor&quot;, &quot;cglam&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;beltyns_burning_blood&quot;, &quot;bbb&quot;, 31, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;animate_wraith&quot;, &quot;wraith&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;soul_shackles&quot;, &quot;ssh&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;destroy_undead&quot;, &quot;dun&quot;, 36, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;contagion&quot;, &quot;ctg&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;blackmantle&quot;, &quot;bm&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;animate_spectre&quot;, &quot;spect&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;globe_of_invulnerability&quot;, &quot;gi&quot;, 41, &quot;autoglobe&quot;, &quot;&quot;},
{ &quot;eradicate_undead&quot;, &quot;eu&quot;, 41, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;animate_ghost&quot;, &quot;ghost&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;vampiric_curse&quot;, &quot;vc&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;life_walk&quot;, &quot;lwalk&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;soul_walk&quot;, &quot;soul&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;abi_dalzims_horrid_wilting&quot;, &quot;abi&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;rain_of_blood&quot;, &quot;rb&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;boneshatter&quot;, &quot;bs&quot;, 46, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;banshee_wail&quot;, &quot;bw&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;annihilate_undead&quot;, &quot;au&quot;, 46, &quot;turnundead&quot;, &quot;&quot;}
					   }	

powerAliases[&quot;Lic&quot;] =
						{ 	
{ &quot;preserve&quot;, &quot;prs&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;mage_flame&quot;, &quot;mf&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;erase&quot;, &quot;erase&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_magic&quot;, &quot;dm&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;detect_invisibility&quot;, &quot;di&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;animate_skeleton&quot;, &quot;skel&quot;, 1, &quot;&quot;, &quot;&quot;},
{ &quot;protection_from_undead&quot;, &quot;pfu&quot;, 6, &quot;autopfu&quot;, &quot;&quot;},
{ &quot;protection_from_cold&quot;, &quot;pfc&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;minor_creation&quot;, &quot;minor&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;invisibility&quot;, &quot;invis&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;command_undead&quot;, &quot;comu&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;chill_touch&quot;, &quot;ct&quot;, 6, &quot;automissile&quot;, &quot;&quot;},
{ &quot;animate_zombie&quot;, &quot;zomb&quot;, 6, &quot;&quot;, &quot;&quot;},
{ &quot;soul_bind&quot;, &quot;sb&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;rejuvenate_minor&quot;, &quot;rejuvm&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;pain_touch&quot;, &quot;pt&quot;, 11, &quot;automissile&quot;, &quot;&quot;},
{ &quot;animate_ghoul&quot;, &quot;ghoul&quot;, 11, &quot;&quot;, &quot;&quot;},
{ &quot;wither&quot;, &quot;wt&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;strength&quot;, &quot;str&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;spectral_hand&quot;, &quot;sh&quot;, 16, &quot;automissile&quot;, &quot;&quot;},
{ &quot;sleep&quot;, &quot;slp&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;embalm&quot;, &quot;emm&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;dispel_magic&quot;, &quot;dism&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;command_horde&quot;, &quot;comh&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;animate_shadow&quot;, &quot;shadow&quot;, 16, &quot;&quot;, &quot;&quot;},
{ &quot;teleport&quot;, &quot;tele&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;snapping_teeth&quot;, &quot;snp&quot;, 21, &quot;automissile&quot;, &quot;&quot;},
{ &quot;ray_of_enfeeblement&quot;, &quot;ray&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;levitate&quot;, &quot;lv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;infravision&quot;, &quot;iv&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;ice_storm&quot;, &quot;is&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;heal_undead&quot;, &quot;hu&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;feeblemind&quot;, &quot;feeb&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;energy_drain&quot;, &quot;ed&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;cone_of_cold&quot;, &quot;cone&quot;, 21, &quot;autoarea&quot;, &quot;&quot;},
{ &quot;coldshield&quot;, &quot;cshield&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;animate_wight&quot;, &quot;wight&quot;, 21, &quot;&quot;, &quot;&quot;},
{ &quot;ward_undead&quot;, &quot;wu&quot;, 26, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;vampiric_touch&quot;, &quot;vt&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;rejuvenate_major&quot;, &quot;rejuv&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;nerve_dance&quot;, &quot;nd&quot;, 26, &quot;automissile&quot;, &quot;&quot;},
{ &quot;minor_globe_of_invulnerability&quot;, &quot;mgi&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;animate_ghast&quot;, &quot;ghast&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;age&quot;, &quot;age&quot;, 26, &quot;&quot;, &quot;&quot;},
{ &quot;magic_missile&quot;, &quot;mg&quot;, 1, &quot;automissile&quot;, &quot;&quot;},
{ &quot;protect_undead&quot;, &quot;pu&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;locate_remains&quot;, &quot;locr&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;haste&quot;, &quot;hs&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;dimension_door&quot;, &quot;dim&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;corpse_glamor&quot;, &quot;cglam&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;beltyns_burning_blood&quot;, &quot;bbb&quot;, 31, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;animate_wraith&quot;, &quot;wraith&quot;, 31, &quot;&quot;, &quot;&quot;},
{ &quot;soul_shackles&quot;, &quot;ssh&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;life_drain&quot;, &quot;ld&quot;, 36, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;destroy_undead&quot;, &quot;dun&quot;, 36, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;contagion&quot;, &quot;ctg&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;blackmantle&quot;, &quot;bm&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;animate_spectre&quot;, &quot;spect&quot;, 36, &quot;&quot;, &quot;&quot;},
{ &quot;lich_touch&quot;, &quot;lt&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;globe_of_invulnerability&quot;, &quot;gi&quot;, 41, &quot;autoglobe&quot;, &quot;&quot;},
{ &quot;eradicate_undead&quot;, &quot;eu&quot;, 41, &quot;turnundead&quot;, &quot;&quot;},
{ &quot;animate_ghost&quot;, &quot;ghost&quot;, 41, &quot;&quot;, &quot;&quot;},
{ &quot;abi_dalzims_horrid_wilting&quot;, &quot;abi&quot;, 41, &quot;autohlmissile&quot;, &quot;&quot;},
{ &quot;rain_of_blood&quot;, &quot;rb&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;rot&quot;, &quot;rot&quot;, 46, &quot;autohlarea&quot;, &quot;&quot;},
{ &quot;ice_tomb&quot;, &quot;it&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;death_pact&quot;, &quot;dp&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;banshee_wail&quot;, &quot;bw&quot;, 46, &quot;&quot;, &quot;&quot;},
{ &quot;siphon_undead&quot;, &quot;su&quot;, 46, &quot;turnundead&quot;, &quot;&quot;}
					   }</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>sqlfunctions</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function sqlinwho(xname)
	local recs, row
	local profilename

	recs = assert(NyyLIB.conn:execute([[SELECT class_name, char_race, account_name FROM chars WHERE char_name = ']] .. xname .. [[']]))

	row = recs:fetch({})

	recs:close()
	
	if row == nil then
		--echo(&quot; [Not found in database]\n&quot;)
		return(false)
	else
		-- display(row)
		for k, v in pairs(NyyLIB.fullclasslist) do
			if v[1] == row[1]:trim()	 then
				whoadd(xname, v[2], row[2], row[3])
				profilename = row[3]
				--echo(&quot;\n[Adding - &quot; .. xname .. &quot; &quot; .. v[2] .. &quot; &quot; .. row[2] .. &quot;]\n&quot;)
			end
		end

		return(profilename)
	end
end

function sqlprofilename(xname)
	local recs, row

	recs = assert(NyyLIB.conn:execute([[SELECT class_name, char_race, account_name FROM chars WHERE char_name = ']] .. xname .. [[']]))

	row = recs:fetch({})

	recs:close()
	
	if row == nil then
		--echo(&quot; [Not found in database]\n&quot;)
		return(false)
	else
		return(row[3])
	end
end

function sqlclist(xname)
	local recs, row

	local retval = {}

	recs = assert(NyyLIB.conn:execute([[
				SELECT char_name, class_name, char_race, char_level, account_name FROM 
				chars WHERE vis = 't' AND (account_name = (SELECT account_name 
				FROM chars WHERE LOWER(char_name) = LOWER(']] .. xname .. [[') AND vis = 't') OR 
				LOWER(account_name) = LOWER(']] .. xname .. [[')) ORDER BY char_level DESC, 
				char_name ASC]]))

	row = recs:fetch({})

	while row do
		retval[#retval+1] = {row[4], row[2], row[1], row[3], row[5]}
		row= recs:fetch({})
	end

	recs:close()

	return(retval)
end

function sqliditem(xitemname)
	local recs, row

	local retval = {}

	xitemname=string.gsub(xitemname, &quot;'&quot;, &quot;''&quot;)

	recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_name LIKE '%]] .. xitemname .. [[%']]))

	row = recs:fetch({})

	while row do
		retval[#retval+1] = row[2]
		row = recs:fetch({})
	end

	recs:close()
	
	return(retval)
end

function sqlindexitem(xitemname)
	local recs, row

	local retval = {}

	xitemname=string.gsub(xitemname, &quot;'&quot;, &quot;''&quot;)

	recs = assert(NyyLIB.conn:execute([[SELECT rowid, item_name FROM items WHERE item_name LIKE '%]] .. xitemname .. [[%']]))

	row = recs:fetch({})

	while row do
		display(row[1])
		display(row[2])
		retval[#retval+1] = row[2]
		row = recs:fetch({})
	end

	recs:close()
	
	return(retval)
end

function createconsumabledb()
	local recs, row

	NyyLIB.itemdb = NyyLIB.itemdb or {}

	recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_type = 'potion']]))

	row = recs:fetch({})

	while row do
		if string.find(row[2], &quot;%(Potion%) &quot;) ~= nil then
			local st, en, retval

			st, en, retval = string.find (row[2], &quot;%(Potion%)([A-Za-z0-9: -]+)%*&quot;)

			NyyLIB.itemdb[row[1]]={&quot;potion&quot;, retval:trim()}
		end

		row= recs:fetch({})
	end

	recs:close()

	recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_type = 'scroll']]))

	row = recs:fetch({})

	while row do
		if string.find(row[2], &quot;%(Scroll%) &quot;) ~= nil then
			local st, en, retval

			st, en, retval = string.find (row[2], &quot;%(Scroll%)([A-Za-z0-9: -]+)%*&quot;)

			NyyLIB.itemdb[row[1]]={&quot;scroll&quot;, retval:trim()}
		end

		row= recs:fetch({})
	end

	recs:close()

	--recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_type = 'wand']]))

	--row = recs:fetch({})

	--while row do
	--	if string.find(row[2], &quot;%(Wand%) &quot;) ~= nil then
	--		local st, en, retval

	--		st, en, retval = string.find (row[2], &quot;%(Wand%)([A-Za-z0-9: -]+)%*&quot;)

	--		NyyLIB.itemdb[row[1]]={&quot;wand&quot;, retval:trim()}
	--	end

	--	row= recs:fetch({})
	--end

	--recs:close()

	--recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_type = 'staff']]))

	--row = recs:fetch({})

	--while row do
	--	if string.find(row[2], &quot;%(Staff%) &quot;) ~= nil then
	--		local st, en, retval

	--		st, en, retval = string.find (row[2], &quot;%(Staff%)([A-Za-z0-9: -]+)%*&quot;)

	--		NyyLIB.itemdb[row[1]]={&quot;staff&quot;, retval:trim()}
	--	end

	--	row= recs:fetch({})
	--end

	--recs:close()


	--recs = assert(NyyLIB.conn:execute([[SELECT item_name, short_stats FROM items WHERE item_type = 'poison']]))

	--row = recs:fetch({})

	--while row do
	--	if string.find(row[2], &quot;%(Poison%) &quot;) ~= nil then
	--		local st, en, retval

	--		st, en, retval = string.find (row[2], &quot;%(Poison%)([A-Za-z0-9: -]+)%*&quot;)

	--		NyyLIB.itemdb[row[1]]={&quot;poison&quot;, retval:trim()}
	--	end

	--	row= recs:fetch({})
	--end

	--recs:close()


	cecho(&quot;&lt;red&gt;[Consumable database cached: Potions, Scrolls]\n&quot;)
end


function sqlwhoclass(xname)
	display(NyyLIB.conn)

	recs = assert(NyyLIB.conn:execute([[SELECT class_name FROM chars WHERE char_name LIKE ']] .. xname .. [[']]))

	row = recs:fetch({})

	while row do
	
		echo ( row[1] .. &quot;\n&quot;)
		row = recs:fetch({})
	end

	recs:close()

end





function opendb()
	NyyLIB.env = assert (luasql.sqlite3())
	
	NyyLIB.conn = assert (NyyLIB.env:connect(mainpath(&quot;toril.db.2015_10_10&quot;)))

	display(NyyLIB.conn)
end

function closedb()
	cecho(&quot;&lt;red&gt;[Closing database]\n&quot;)
	NyyLIB.conn:close()
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>tiapoints</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------


-- @([A-Za-z]+) - ([0-9]+)
-- \1=\2,

TiamatPoints={
Adriorn=0,
Aetius=200,
Alak=0,
Alane=0,
Alimam=0,
Anashoa=100,
Andreww=150,
Annam=0,
Arrithes=275,
Ashades=0,
Azralek=0,
Babo=0,
Banducci=100,
Beern=100,
Berrin=80,
Cobu=200,
Con=150,
Damet=0,
Delkor=400,
Delmair=100,
Deshana=435,
Diel=200,
Diggz=300,
Dixa=0,
Donny=200,
Drabyl=400,
Drahken=200,
Drakkochian=100,
Drake=465,
Druzix=0,
Duard=200,
Elscint=0,
Enth=100,
Etrangere=100,
Ezwar=300,
Fibble=100,
Fkteval=0,
Flib=75,
Flyngspaghetti=175,
Frensolith=500,
Gene=0,
George=75,
Gerin=100,
Gindipple=0,
Gormal=100,
Graum=100,
Gruuggh=0,
Grundar=75,
Gubody=0,
Gyrx=300,
Hamwich=100,
Hefa=275,
Hibbidy=0,
Hue=200,
Hyla=0,
Iamtux=100,
Ice=100,
Ikhar=300,
Iledor=50,
Inames=100,
Isisa=0,
Jacob=150,
Jaul=100,
Jhira=265,
Jkersey=0,
Jlewis=100,
John=100,
Justmefjs=50,
Kaern=0,
Kajj=235,
Kalantha=100,
Kanenan=0,
Kathal=100,
Kayos=100,
Kelemon=0,
Kidus=0,
Kimi=200,
Klandan=35,
Klosh=100,
Koric=200,
Koxa=0,
Kramel=100,
Krimic=0,
Kugol=300,
Kuno=180,
Kwirl=100,
Lenen=0,
Lilithelle=0,
Lilmeshay=0,
Lopi=100,
Lusas=0,
Maxler=200,
Mayoung=100,
Mij=0,
Mikempty=200,
Misi=0,
Mrorange=625,
Mrizzalazzrazzi=100,
Mung=200,
Myrranth=100,
Naled=0,
Nerox=50,
Netonosel=250,
Nolumakil=0,
Ntwolfgang=0,
Nurpy=300,
Nyyrazzilyss=200,
Oggsk=50,
Onut=100,
Osheara=0,
Ozzec=100,
Parsnip=400,
Pibbinivil=0,
Popinoples=50,
Quinn=0,
Raronsil=0,
Redgoat=100,
Rhazien=200,
Rirus=0,
Riwer=300,
Rorg=50,
Rouse=0,
Ruagh=500,
Saerian=100,
Samiam=0,
Sasin=150,
Saitcho=100,
Sekfarok=0,
Selshanar=500,
Shoshana=0,
Silena=100,
Silvenleif=0,
Sipes=100,
Solah=100,
Ssezef=0,
Stephanie=500,
Stoutwoodarcanos=0,
Sulaco=100,
Susab=150,
Syrac=0,
Tafi=150,
Talomis=0,
Tanji=0,
Teresias=65,
Thegnome=100,
Tibek=100,
Tilsen=250,
Timok=0,
Todd=0,
Toraza=100,
Torlin=100,
Torsoul=300,
Travok=0,
Turg=100,
Turxx=0,
Typographer=0,
Utheba=100,
Venlarin=175,
Verarb=0,
Vooku=100,
Wired=100,
Wobb=0,
Xboomx=300,
Xilissisix=100,
Xuter=100,
Yadir=0,
Ykor=200,
Yog=100,
Yxageirr=175,
Zarel=100,
Zellas=300,
Zepharian=0,
Zerogod=100,
Zipalodok=0,
Zoe=400,
Zusuk=100
}


function getPoints(xprofile)
	if TiamatPoints[xprofile] ~= nil then
		return(TiamatPoints[xprofile])
	end

	return(0)
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>StatsScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function groupStatsDisplay(xcharname)
	local profilename=inwho(xcharname)
	local temp = whoclass(xcharname)

	
	if not charData:get(&quot;group&quot;, true) then
		return
	end

	if temp ~= nil then
		if temp ~= &quot;UNK&quot; then
			local hits = getHits(xcharname)
			local attacks = getAttacks(xcharname)

			local cntRescueFail=getStat(xcharname, &quot;failedrescue&quot;)
			local cntRescueSuccess=getStat(xcharname, &quot;successrescue&quot;)


-- 			cecho(string.format(&quot;%&quot; .. (16-string.len(xcharname)) .. &quot;s&quot;, &quot; &quot;))

  			cecho(string.format(&quot;&lt;cyan&gt;%5.1f%% (%4d)&quot;, 
						(hits*100)/attacks,
						attacks))

			
			if cntRescueFail+cntRescueSuccess ~= 0 then
				cecho(string.format(&quot;&lt;cyan&gt;%5.1f%% (%4d)   &quot;, 
							cntRescueSuccess*100/(cntRescueFail+cntRescueSuccess),
							cntRescueFail+cntRescueSuccess))
			end

			echo(&quot;\n&quot;)
		end
	else
		echo(&quot; [ Unknown ]\n&quot;)
	end
end

function resetStats()
	cecho(&quot;\n&lt;red&gt;[Resetting stats counters.]\n&quot;)

	NyyLIB.stats = {}
end

function addStat(xcharname, xstatname)
	NyyLIB.stats = NyyLIB.stats or {}

	if xcharname == &quot;Someone&quot; or xcharname == nil then
		return
	end

	echoDebug(&quot; &lt;cyan&gt;[STAT: &quot; .. xcharname .. &quot; : &quot; .. xstatname .. &quot;]\n&quot;)

	if NyyLIB.stats[xcharname] == nil then
		NyyLIB.stats[xcharname] = {}
	end

	if NyyLIB.stats[xcharname][xstatname] == nil then
		NyyLIB.stats[xcharname][xstatname] = 0
	end

	NyyLIB.stats[xcharname][xstatname] = NyyLIB.stats[xcharname][xstatname] + 1
end

function getStat(xcharname, xstatname)
	if NyyLIB.stats[xcharname] == nil then
		-- echo(&quot;\n[&quot; .. xstatname .. &quot; on &quot; .. xcharname .. &quot; is nil stat]\n&quot;)
		NyyLIB.stats[xcharname]={}
	end

	if NyyLIB.stats[xcharname][xstatname] == nil then
		-- echo(&quot;\n[&quot; .. xstatname .. &quot; on &quot; .. xcharname .. &quot; is nil stat]\n&quot;)
		
		NyyLIB.stats[xcharname][xstatname]=0
	end

	return ( NyyLIB.stats[xcharname][xstatname] )
end

function getHits(xcharname)

	local c_offHit = getStat(xcharname, &quot;offHit&quot;)
	local c_offParry = getStat(xcharname, &quot;offParry&quot;)
	local c_offDodge = getStat(xcharname, &quot;offDodge&quot;)
	local c_offdeflect = getStat(xcharname, &quot;offDeflect&quot;)

	local c_offShieldBlock = getStat(xcharname, &quot;offShieldBlock&quot;)	

	local c_offMiss = getStat(xcharname, &quot;offMiss&quot;)

	local c_all=c_offHit+ c_offMiss + c_offParry + c_offdeflect + c_offDodge + c_offShieldBlock

	local c_adjhit=c_all-c_offMiss

	return(c_adjhit)
end

function getAttacks(xcharname)

	local c_offHit = getStat(xcharname, &quot;offHit&quot;)
	local c_offParry = getStat(xcharname, &quot;offParry&quot;)
	local c_offDodge = getStat(xcharname, &quot;offDodge&quot;)
	local c_offdeflect = getStat(xcharname, &quot;offDeflect&quot;)

	local c_offShieldBlock = getStat(xcharname, &quot;offShieldBlock&quot;)	

	local c_offMiss = getStat(xcharname, &quot;offMiss&quot;)

	local c_all=c_offHit+ c_offMiss + c_offParry + c_offdeflect + c_offDodge + c_offShieldBlock


	return(c_all)
end


function printDeaths()
	local deathcount={}
	local nx=0


	for k,v in pairs(NyyLIB.stats) do
		deathcount[k]= getStat(k, &quot;death&quot;)

		--echo( string.format(&quot;%15s %d\n&quot;, k, getStat(k, &quot;death&quot;) ) )
	end

	echo (&quot;gcc * ... DEATH Top 20 ...\n&quot;)

	for k,v in spairs(deathcount, function(t, a, b) return (t[a]&gt;t[b]) end) do
		nx=nx+1

		if nx &lt; 21 then
			echo( string.format(&quot;gcc * %-12s %d\n&quot;, k, getStat(k, &quot;death&quot;) ) )
		end
	end

end

function printHeals(xmode)
	local gheals={}
	local gotfullheal={}
	local gothealingaura={}

	for k,v in pairs(NyyLIB.stats) do
		if getStat(k, &quot;GroupHeal&quot;) ~= 0 then
			gheals[k] = {getStat(k, &quot;GroupHeal&quot;), getStat(k, &quot;Vitality&quot;) }
			-- echo(k .. &quot; Group Heal: &quot; .. getStat(k, &quot;GroupHeal&quot;) .. &quot; Vitality: &quot; .. getStat(k, &quot;Vitality&quot;) .. &quot;\n&quot;)
		end

		if getStat(k, &quot;gotHealingAura&quot;) ~= 0 or getStat(k, &quot;gotFullHeal&quot;) ~= 0  then
			gothealingaura[k] = getStat(k, &quot;gotHealingAura&quot;)
			gotfullheal[k] = getStat(k, &quot;gotFullHeal&quot;)
		end

		--if getStat(k, &quot;Vitality&quot;) ~= 0 then
		--	echo(k .. &quot; Vitality: &quot; .. getStat(k, &quot;Vitality&quot;) .. &quot;\n&quot;)
		--end
	end

	echo(&quot;gsay * ............... Heal F-Heal G-Heal Aura Vit\n&quot;)

	if xmode == &quot;3&quot; then
		echo( &quot;gsay * ............... Heal F-Heal G-Heal Aura Vit&quot;)
	end

	if gheals ~= {} then
		for k,v in spairs(gheals, function(t, a, b) return (t[a][1]&gt;t[b][1]) end) do
			echo ( string.format(&quot;gsay * %-15s              %3d        %2d\n&quot;, k, v[1], v[2]) )

			if xmode == &quot;3&quot; then
				echo( string.format(&quot;gsay * %-15s  %3d        %3d\n&quot;, k, v[1], v[2]) )
			end	
		end
	end

	for k,v in pairs(NyyLIB.stats) do
		if whoclass(k) == &quot;Cle&quot; then
			echo( string.format(&quot;gsay * %-15s        %2d           %2d  %2d\n&quot;, k, getStat(k, &quot;castFullHeal&quot;), getStat(k, &quot;castHealingAura&quot;), getStat(k, &quot;Vitality&quot;) ) )
		end
	end

	echo(&quot;gsay * ...............\n&quot;)

	if xmode == &quot;3&quot; then
		echo( &quot;gsay * ...............&quot;)
	end

	for k,v in spairs(gotfullheal, function(t, a, b) return (t[a]&gt;t[b]) end) do
		if checkMask(&quot;warrior&quot;, k) then
			echo( string.format(&quot;gsay * %-15s        %2d           %2d \n&quot;, k, v, getStat(k, &quot;gotHealingAura&quot;) ) )
		end
	end

	echo(&quot;\n&quot;)

end

function printStats(xmode)
	local hitters=false

	local c_attackmiss=getStat(whoami(), &quot;offMiss&quot;)
	local c_attackhit=getStat(whoami(), &quot;offHit&quot;)

	local c_block=getStat(whoami(), &quot;defShieldBlock&quot;)
	local c_dodge=getStat(whoami(), &quot;defDodge&quot;)
	local c_graze=getStat(whoami(), &quot;defGraze&quot;)
	local c_deflect=getStat(whoami(), &quot;defWeaponDeflect&quot;)
	local c_glances=getStat(whoami(), &quot;defShieldGlance&quot;)
	local c_svamp=getStat(whoami(), &quot;shieldvamp&quot;)
	local c_parry=getStat(whoami(), &quot;defParry&quot;)
	local c_pdeflect=getStat(whoami(), &quot;defpdeflect&quot;)
	local c_crit=getStat(whoami(), &quot;crithit&quot;)

	local c_hit=getStat(whoami(), &quot;defHit&quot;)
	local c_miss=getStat(whoami(), &quot;defMiss&quot;)

	local c_offdodge=getStat(whoami(), &quot;offDodge&quot;) -- attacked mob, but dodged - count as hit

	local c_all=c_hit+ c_miss + c_parry + c_deflect + c_dodge + c_block
	local skillblocked = c_block + c_parry + c_deflect + c_dodge
	local partialblock=  c_pdeflect + c_graze + c_glances
	local v2allhit = c_hit + skillblocked
	local v2weapon = c_parry + c_deflect + c_pdeflect

	local c_adjhit=c_all-c_miss

	local ptar = getStat(whoami(), &quot;planetar&quot;)

	local defstring = string.format(&quot;[Defense: Hit %2.1f%% (%d/%d), %2.1f%% (%d) direct, %2.1f%% (%d) dodge, %2.1f%% (%d) shield, %2.1f%% (%d) weapon]\n&quot;,
												c_hit*100/c_all, c_hit, c_all,
												(v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances)*100/c_hit, (v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances),
												c_graze*100/c_hit, c_graze,
												c_glances*100/c_hit, c_glances,
												c_pdeflect*100/c_hit, c_pdeflect   ) 

	for k,v in pairs(NyyLIB.stats) do
		if k ~= whoami() then
			if checkMask(&quot;statHitter&quot;, k) then
				hitters=true
			end
		else
			if xmode == nil or xmode == 2 then
				hitters=true
			end
		end
	end 

	--display(NyyLIB.stats)

	echo(&quot;\npeople groupList:ingroup only - () echo (1) gsay hitters (2) gsay hitters+me (3) gsay all\n&quot;)


	if hitters then
		if xmode == nil then
			echo(&quot;* ................... Hit (Total)   Rescues\n&quot;)
		else
			if xmode == 3 then
				send(&quot;gsay * [gsay stats reset] [gsay stats display]&quot;)
			end
			--send(&quot;gsay * ......................   Hit (Total) Spells&quot;)
			send(&quot;gsay * ......................   Hit (Total)&quot;)
		end
	end

	--for k,v in pairs(NyyLIB.stats) do
	--	if getStat(k, &quot;offHit&quot;) == 0 then
	--		addStat(k, &quot;offHit&quot;)
	--	end

	--	if getStat(k, &quot;offMiss&quot;) == 0 then
	--		addStat(k, &quot;offMiss&quot;)
	--	end
	--end
	
	for k,v in spairs(NyyLIB.stats, function(t,a,b) return (getHits(b)*100/(getHits(b)+t[b][&quot;offMiss&quot;])) &lt;
																	  (getHits(a)*100/(getHits(a)+t[a][&quot;offMiss&quot;])) end) do


		local varstring

		if whoclass(k) ~= nil then 

			varstring =  string.format(&quot;[%3s] %-16s:%5.1f%% (%4d)&quot;,
							whoclass(k), k, 
							getHits(k)*100/(getHits(k)+getStat(k, &quot;offMiss&quot;)), 
							getHits(k) + getStat(k, &quot;offMiss&quot;) )


			--local cntSpellCast = getStat(k, &quot;spellCast&quot;)

			--if cntSpellCast ~= 0 then
			--	varstring = varstring .. string.format(&quot; %4d&quot;, cntSpellCast)
			--end

			local cntRescueFail=getStat(k, &quot;failedrescue&quot;)
			local cntRescueSuccess=getStat(k, &quot;successrescue&quot;)


			if xmode ~= 3 then
				if cntRescueFail + cntRescueSuccess ~= 0 then
					varstring = varstring ..	string.format(&quot; %5.1f%% (%4d)&quot;, 
									cntRescueSuccess*100/(cntRescueFail+cntRescueSuccess),	cntRescueFail+cntRescueSuccess)
				end
			end

			varstring = &quot;* &quot; .. varstring .. &quot;\n&quot;

			if checkMask(&quot;statHitter&quot;, k) then
				if k ~= whoami() then
					if xmode == 1 or xmode == 2 or xmode == 3 then
						if groupList:ingroup(k) then
							send(&quot;gsay &quot; .. varstring)
						end
					end
				else
					if xmode == 2 or xmode == 3 then
						if groupList:ingroup(k) then
							send(&quot;gsay &quot; .. varstring)
						end
					end
				end
			else
				if xmode == 3 then
					if groupList:ingroup(k) then
						send(&quot;gsay &quot; .. varstring)
					end
				end
			end

			if xmode == nil then
				echo(varstring)
	--			send(&quot;acc &quot; .. varstring)
			end
		end
	end

--	if xmode == nil then
--		echo(defstring)
--		send(&quot;acc &quot; .. defstring)
--	else
--		send(&quot;gsay &quot; .. defstring)
--	end

	--mud:send(&quot;gsay Planetar heal procs: &quot; .. ptar)

	echo(&quot;\n&quot;)

	printHeals()
end

function spairs(t, order)
    -- collect the keys
    local keys = {}
    for k in pairs(t) do keys[#keys+1] = k end

    -- if order function given, sort by it by passing the table and keys a, b,
    -- otherwise just sort the keys 
    if order then
        table.sort(keys, function(a,b) return order(t, a, b) end)
    else
        table.sort(keys)
    end

    -- return the iterator function
    local i = 0
    return function()
        i = i + 1
        if keys[i] then
            return keys[i], t[keys[i]]
        end
    end
end

function v2print(xname)

local cntRescueFail=getStat(xname, &quot;failedrescue&quot;)
local cntRescueSuccess=getStat(xname, &quot;successrescue&quot;)

local c_attackmiss=getStat(xname, &quot;offMiss&quot;)
local c_attackhit=getStat(xname, &quot;offHit&quot;)

local c_block=getStat(xname, &quot;defShieldBlock&quot;)
local c_dodge=getStat(xname, &quot;defDodge&quot;)
local c_graze=getStat(xname, &quot;defGraze&quot;)
local c_deflect=getStat(xname, &quot;defWeaponDeflect&quot;)
local c_glances=getStat(xname, &quot;defShieldGlance&quot;)
local c_svamp=getStat(xname, &quot;shieldvamp&quot;)
local c_parry=getStat(xname, &quot;defParry&quot;)
local c_pdeflect=getStat(xname, &quot;defpdeflect&quot;)
local c_crit=getStat(xname, &quot;crithit&quot;)

local c_hit=getStat(xname, &quot;defHit&quot;)
local c_miss=getStat(xname, &quot;defMiss&quot;)


local c_all=c_hit+c_miss + c_parry + c_deflect + c_dodge + c_block

local output = {}

local skillblocked = c_block + c_parry + c_deflect + c_dodge
local partialblock=  c_pdeflect + c_graze + c_glances


local v2allhit = c_hit + skillblocked
local v2weapon = c_parry + c_deflect + c_pdeflect

-- csv line

output[#output+1] = string.format(&quot;//%s,%s,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n&quot;, 
											charData:get(&quot;statname&quot;), whoami(), NyyLIB.str, NyyLIB.agibonus, NyyLIB.hitroll, NyyLIB.damroll,
												cntRescueFail, cntRescueSuccess, c_attackmiss, c_attackhit,
											c_block,c_dodge,c_graze,c_deflect,c_glances,c_svamp,c_parry,c_pdeflect, c_crit,c_hit,c_miss)

output[#output+1] = string.format(&quot;[Based on AC alone, %2.1f%% (%d) hit, %2.1f%% (%d) missed]\n&quot;,
							v2allhit*100/c_all, c_all,
							c_miss*100/c_all, c_miss)
							
output[#output+1] = string.format(&quot;[Of hits/potential hits (%d), %2.1f%% (%d) of them were dodged, %2.1f%% (%d) of them partially]\n&quot;,
								v2allhit,
								(c_dodge+c_graze)*100/v2allhit,
								 c_dodge+c_graze,
								c_graze*100/(c_dodge+c_graze),
								c_graze )

output[#output+1] = string.format(&quot;[Of available attacks (%d), %2.1f%% (%d) were shield blocked, %2.1f%% (%d) of them partially]\n&quot;,
							 	v2allhit-c_dodge-c_graze,
								(c_block+c_glances)*100/(v2allhit-c_dodge-c_graze), c_block+c_glances,
								c_glances*100/(c_block+c_glances), c_glances)

output[#output+1] = string.format(&quot;[Of the remaining %d attacks, %2.1f%% (%d) were riposted, %2.1f%% (%d) of them partially]\n&quot;,
							 	v2allhit-c_dodge-c_graze-c_block-c_glances,
								v2weapon*100/(v2allhit-c_dodge-c_graze-c_block-c_glances), v2weapon,
								c_pdeflect*100/(v2weapon), c_pdeflect   )

output[#output+1] = string.format(&quot;[%2.1f%% (%d) partially dodged, %2.1f%% (%d) glanced off shield, %2.1f%% (%d) partially deflected]\n&quot;,
											c_graze*100/c_hit, c_graze,
											c_glances*100/c_hit, c_glances,
											c_pdeflect*100/c_hit, c_pdeflect)

output[#output+1] = string.format(&quot;[%2.1f%% (%d) attacks went through all defenses]\n&quot;, 
							(v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances)*100/c_hit, (v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances) )

output[#output+1] = string.format(&quot;[The final hit rate is %2.1f%% (%d)]\n&quot;,
											c_hit*100/c_all,	c_hit )

output[#output+1] = string.format(&quot;[Defense: Hit %2.1f%% (%d/%d) : %2.1f%% (%d) direct, %2.1f%% (%d) dodge, %2.1f%% (%d) shield, %2.1f%% (%d) weapon]\n&quot;,
												c_hit*100/c_all, c_hit, c_all,
												(v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances)*100/c_hit, (v2allhit-c_dodge-c_graze-v2weapon-c_block-c_glances),
												c_graze*100/c_hit, c_graze,
												c_glances*100/c_hit, c_glances,
												c_pdeflect*100/c_hit, c_pdeflect   )

output[#output+1] = string.format(&quot;[+HIT %d +DAM %d : Missed %2.1f%% (%d) Hit %2.1f%% (%d)]\n&quot;, 
								NyyLIB.hitroll, NyyLIB.damroll,
								c_attackmiss*100/(c_attackhit+c_attackmiss), c_attackmiss,
								c_attackhit*100/(c_attackhit+c_attackmiss), c_attackhit)


if cntRescueFail + cntRescueSuccess &gt; 0 then
	output[#output+1] = string.format(&quot;[%2.2f%% (%d) failed rescues, %2.2f%% (%d) success]\n&quot;, 
											cntRescueFail*100 / (cntRescueFail+cntRescueSuccess), cntRescueFail, 
											cntRescueSuccess*100 / (cntRescueFail+cntRescueSuccess), cntRescueSuccess)
end

local nx

echo(&quot;\n&quot;)

for nx=2, #output, 1 do
	echo(output[nx])
end

end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>HelpScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function showHelp(xindex)
	local index, name
	local found=false
	
	for line in io.lines(mainpath(&quot;helpfile.dat&quot;)) do
		if string.find(line, &quot;;;&quot;) ~= nil then
			if found == false then
				index,name = string.match(line, &quot;;;([0-9]+),([a-zA-Z ]+)&quot;)
			else
				return
			end
		else
			if index == tostring(xindex) or name == xindex then
				found=true
				echo(line .. &quot;\n&quot;)
			end
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>DisconnectEvent</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function DisconnectEvent()
	echo(&quot;DisconnectEvent was just called\n&quot;)

	if charData:get(&quot;reconnect&quot;) ~= false and charData:get(&quot;reconnect&quot;) ~= nil then
		echo(&quot;[Sending reconnect]&quot;)
		tempTimer(30, [[reconnect()]])
	end
end</script>
                    <eventHandlerList>
                        <string>sysDisconnectionEvent</string>
                    </eventHandlerList>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>MiscScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------


-- return true if in combat - incomplete

function inCombat()
	if prompt:get(&quot;enemy&quot;) ~= &quot;&quot; or prompt:get(&quot;tank&quot;) ~= &quot;&quot; then
		return(true)
	end

	return(false)
end

-- return true if hidden

function getHide()
	hidden = hidden or false

	return(hidden)
end

function setHide(xval)
	hidden = xval
end

-- echo debug messages to screen

function echoDebug(xline)
	if charData:get(&quot;condensed&quot;, true)[&quot;debug&quot;] then
		cecho(xline)
	end
end

-- basic button script: button (spell) name, chardata entry, command button recieved

function shiftButton(xname, xchardata, xcommand)

	if xcommand == &quot;update&quot; then
		updateButton(xname)
		return
	end

	if xcommand ~= &quot;init&quot; then
		shiftSetting(xchardata, xname)
	end

	local current=charData:get(xchardata)

	if type(current) == &quot;boolean&quot; then
		if charData:get(xchardata) then
			setLabelImage(xname, xname .. &quot;-on.png&quot;)
		else
			setLabelImage(xname, xname .. &quot;-off.png&quot;)
		end
	else
		setLabelImage(xname, xname .. &quot;-&quot; .. current .. &quot;.png&quot;)
	end

	-- only call if a spell
	updateSpellCount(xname)

	mud:send(&quot;\n&quot;)
end

-- basic button script: button (spell) name, chardata entry, command button recieved
-- this button does not place spell counts on it

function shiftSkillButton(xname, xchardata, xcommand)
	if xcommand == &quot;update&quot; then
		return
	end

	--display( charData:get(xchardata) )

	if xcommand ~= &quot;init&quot; then
		shiftSetting(xchardata, xname)
	end

	--display( charData:get(xchardata) )

	local current=charData:get(xchardata)

	if current == nil then
		cecho(&quot;&lt;red&gt;[Error: &quot; .. xchardata .. &quot; is nil in table]\n&quot;)
		return
	end

	if type(current) == &quot;boolean&quot; then
		if charData:get(xchardata) then
			setLabelImage(xname, xname .. &quot;-on.png&quot;)
		else
			setLabelImage(xname, xname .. &quot;-off.png&quot;)
		end
	else
		setLabelImage(xname, xname .. &quot;-&quot; .. current .. &quot;.png&quot;)
	end

	--updateSpellCount(xname)

	mud:send(&quot;\n&quot;)
end

-- shiftSetting moves a setting to the right, and echoes any attached information

function shiftSetting(xsetting, xfname)
	local setting = charData:get(xsetting)

	-- convert boolean to &quot;true&quot;/ &quot;false&quot;
	if setting == false then
		setting = &quot;false&quot;
	elseif setting == true then
		setting = &quot;true&quot;
	end

	for k,v in pairs(setvar) do
		if v[1] == xsetting then
			local element=table.index_of(v[3], setting) or 0

			element=element+1

			if element &gt; table.size(v[3]) then
				element=1
			end

			local tosetvalue= v[3][element]

			-- convert &quot;true&quot;/ &quot;false&quot; to boolean
			if tosetvalue == &quot;true&quot; then
				tosetvalue=true
			elseif tosetvalue == &quot;false&quot; then
				tosetvalue=false
			end

			charData:set(xsetting, tosetvalue )

			-- display message on screen
			local screenecho= v[6+element-1]

			if screenecho ~= nil then
				-- substitute xfname in string for @ if value was passed 
				if xfname ~= nil then
					screenecho = string.gsub(screenecho, &quot;@&quot;, to_english(xfname) )
				end

				cecho( screenecho )
			end
		end
	end
end

-- rtrim(xstring) - trim trailing spaces

function rtrim(xstring)
  local n = #xstring
  while n &gt; 0 and xstring:find(&quot;^%s&quot;, n) do n = n - 1 end
  return xstring:sub(1, n)
end

-- condenseLine(newline) - delete line if identical to previous and suffix with x#


function previousLine()
	local previousline = getLines(getLineNumber()-1, getLineNumber())[1]

	return(previousline)
end

function condenseLine(newline)
	local previousline = getLines(getLineNumber()-1, getLineNumber())[1]

	if newline == &quot;&quot; and previousline == &quot;&quot; then
		eraseLine()
	end

	if newline == &quot;&quot; then
		return
	end

	-- new line is prompt, previous line blank, and line prior is prompt
	if previousline == &quot;&quot; then
		if string.find(newline, &quot;^&lt; .* &gt; &quot;) then
			if string.find(getLines(getLineNumber()-2, getLineNumber())[1], &quot;&lt;&quot;) then
				-- delete empty line prior to current line   TODO - change to copy current line to previous + blank it
				moveCursor(0, getLineCount()-1)	
				eraseLine()

				condenseLine(rtrim(newline))
				return
			end
		end
	end

	if string.len(previousline) &gt; 10 and string.len(newline) &gt; 10 then
		if string.find(previousline, newline, 1, true) ~= nil then
			-- delete previous line
			moveCursor(0, getLineCount()-1)
			eraseLine()

			-- if previous line had (x#) at the end, echo (x#+1)
			if string.findPattern(previousline, &quot;(x[0-9]+)&quot; ) ~= nil then
				cecho(&quot; &lt;red&gt;(x&quot; .. (tonumber(string.findPattern(string.findPattern(previousline, &quot;%(x([0-9]+)%)&quot; ), &quot;[0-9]+&quot; ))+1) .. &quot;)&quot;)
			else
				cecho(&quot; &lt;red&gt;(x2)&quot;)
			end
		end
	end
end

function printSorted(xlist)
	local sortedlist=xlist

	table.sort(sortedlist)

	for nx=1, #sortedlist, 1 do
		cecho(&quot;&lt;green&gt;&quot; .. sortedlist[nx])
	end
end

function homepath(xname)
	if xname == nil then
		cecho(&quot;\n&lt;red&gt;[Homepath Error: xname is nil]\n&quot;)
		return
	end

	local path = getMudletHomeDir() .. &quot;\\&quot; .. xname

	path=string.gsub(path, &quot;\\&quot;, &quot;/&quot;)	

	return(path)
end


function mainpath(xname)
	local pathname= string.gsub(NyyLIB.homedir .. xname, &quot;\\&quot;, &quot;/&quot;)

	local is_file = io.open(pathname)

	if is_file == nil then
		cecho(&quot;&lt;red&gt;[Error: file &quot; .. pathname .. &quot; not found]\n&quot;)
	else
		io.close(is_file)
	end

	return(pathname)
end

function soundpath(xname)
	local pathname= string.gsub(NyyLIB.homedir .. &quot;sounds\\&quot; .. xname, &quot;\\&quot;, &quot;/&quot;)

	local is_file = io.open(pathname)

	if is_file == nil then
		cecho(&quot;&lt;red&gt;[Error: file &quot; .. pathname .. &quot; not found]\n&quot;)
	else
		io.close(is_file)
	end

	return(pathname)
end


function iconpath(xname)
	local pathname= string.gsub(NyyLIB.homedir .. &quot;buttons\\&quot; .. xname, &quot;\\&quot;, &quot;/&quot;)

	local is_file = io.open(pathname)

	if is_file == nil then
		cecho(&quot;&lt;red&gt;[Error: file &quot; .. pathname .. &quot; not found]\n&quot;)
	else
		io.close(is_file)
	end

	return(pathname)
end

-- togBoolean will return the true/false reverse of the boolean provided

function togBoolean(xvar)
	if xvar then
		xvar=false
	else
		xvar=true
	end

	return(xvar)
end

-- The sendStatus(xcharname) command requests status for that char

function sendStatus(xcharname)

	sendingStatus = true

	if xcharname == nil then
		mud:send(&quot;status&quot;)
	else
		cecho(&quot;&lt;red&gt;\n[Sending status: &quot; .. xcharname .. &quot;]\n&quot;)
		mud:send(&quot;status &quot; .. xcharname )
	end
end

-- The sendLook() command will send a single look command to the mud.

function sendLook()
	echoDebug(&quot;&lt;red&gt; [look room tolook: &quot; .. NyyLIB.tolook .. &quot;]&quot;)
	if NyyLIB.tolook == 0 then
		NyyLIB.haslooked = 0
		mud:send(&quot;LOOK&quot;)
		NyyLIB.tolook = 1
	end
end


function sendAssist(xchar)
	if NyyLIB.castertrain then
		return
	end

	-- if hp not listed send group
	if groupList:getHP(xchar) == 0 then
		sendGroup()
	end

	if charData:get(&quot;autoassist&quot;) == false then
		return
	end

	-- already in combat: why assist again?
	if inCombat() then
		return
	end

	-- sm caster train is active : flee to mem?
	if isActive(&quot;SMTrainCaster&quot;, &quot;trigger&quot;) ~= 0 then
		if not fightreturn then
			-- send flee
			fleeMem()
			return
		end
	end

	echoDebug(&quot;&lt;red&gt;[assist]&quot;)

	if assistSent == nil then
		assistSent = true

		sendPoison()

		if checkMask(&quot;rog&quot;) then
			local enemytarget = getEnemy()

			if enemytarget ~= &quot;&quot; then
				if sendAssassinate() then
					return
				end

				-- nonpowers backstab for practice
				local backstab


				if prompt:get(&quot;hp&quot;) &gt; 1000 then
					backstab = &quot;backstab &quot; .. enemytarget
				else
					backstab = &quot;bs &quot; .. enemytarget
				end

				cecho(&quot;\n&lt;red&gt;[&quot; .. backstab .. &quot;]\n&quot;)
				mud:send(backstab)
			end

			sendLook()

			return
		end

		-- mount before assisting
		if mount:get() ~= nil and not mount:getMounted() then
			--send(&quot;mount &quot; .. mount:get() )
			mud:send(&quot;mount&quot;)
		end

		-- if memorizing stand before sending assist
		if spell:getMem() or memsent then
			mud:send(&quot;st&quot;)
		end

		echoDebug(&quot;&lt;red&gt;[assist &quot; .. xchar .. &quot;]\n&quot;)

		mud:send(&quot;assist &quot; .. xchar)
	end
end

-- The sendGroup() command will send a single (gagged) group command to the mud
-- The output from it will update the display, but not show on the main window.
-- Multiple calls to the command will not complete.

function sendGroup(xval)
	if xval == false then
		groupSent=nil
		return
	end

	if groupSent then
		echoDebug(&quot;\n&lt;blue&gt;[group command already sent]&quot;)
	end

	if groupSent == nil then
		groupSent = true
		mud:send(&quot;group&quot;)
	end
end

function g(xitem)
	local container= charData:get(&quot;container&quot;)

	if container == &quot;&quot; then
		cecho(&quot;&lt;red&gt;[Container not set: set container containername]\n&quot;)
	end

	return ( &quot;get &quot; .. xitem .. &quot; &quot; .. container )
end

function p(xitem)
	local container= charData:get(&quot;container&quot;)

	if container == &quot;&quot; then
		cecho(&quot;&lt;red&gt;[Container not set: set container containername]\n&quot;)
	end

	return ( &quot;put &quot; .. xitem .. &quot; &quot; .. container )
end

function eraseLine()
	if not charData:get(&quot;condensed&quot;, true)[&quot;debug&quot;] then
		deleteLine()
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>GroupClassScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

groupList = groupList or {}
tankingList = tankingList or {}

-- return grouplist in a table

function groupList:get()
	return (self)
end

-- number of members in current grouplist

function groupList:size()
	return (#groupList)
end

-- delete all members in current grouplist

function groupList:reset()
	local nx

	for nx=1, groupList:size(), 1 do
		groupList[nx]=nil
	end
end

-- reset tanking to 0

function groupList:resetTanking()
	tankingList = {}
end

-- add 1 to tank

function groupList:incTanking(xchar)
	tankingList[xchar] = tankingList[xchar] or 0
	tankingList[xchar] = tankingList[xchar] + 1
end

-- who is tanking? is so, return who, how many

function groupList:whoTanking()
	if next(tankingList) == nil then
		return(false)
	end

	return(tankingList)
end

-- return how many mobs xchar is known to be tanking

function groupList:getTanking(xchar)
	tankingList[xchar] = tankingList[xchar] or 0

	return(tankingList[xchar])
end


-- check if xchar exists in current grouplist

function groupList:ingroup(xchar)
	local nx

	if xchar == &quot;&quot; then
		return(false)
	end

	for nx=1, groupList:size(), 1 do
		if groupList[nx][1] == xchar then
			return(true)
		end
	end
	
	return(false)
end

-- set hp, maxhp for xchar in grouplist

function groupList:setHP(xchar, xhp, xmaxhp)
	local nx

	for nx=1, groupList:size(), 1 do
		if groupList[nx][1] == xchar then
			groupList[nx][3] = xhp
			groupList[nx][4] = xmaxhp
			return
		end
	end
end

-- return hp, maxhp for xchar in grouplist

function groupList:getHP(xchar)
	local nx

	for nx=1, groupList:size(), 1 do
		if groupList[nx][1] == xchar then
			return(groupList[nx][3])
		end
	end

	if xchar ~= &quot;gray&quot; and xchar ~= &quot;spirit&quot; then
		--cecho(&quot;\n&lt;red&gt;[Error: &quot; .. xchar .. &quot; does not exist in groupList]\n&quot;)
	end
end

function groupList:getMaxHP(xchar)
	local nx

	for nx=1, groupList:size(), 1 do
		if groupList[nx][1] == xchar then
			return(groupList[nx][4])
		end
	end

	if xchar ~= &quot;gray&quot; and xchar ~= &quot;spirit&quot; then
		--cecho(&quot;\n&lt;red&gt;[Error: &quot; .. xchar .. &quot; does not exist in groupList]\n&quot;)
	end
end


-- return list of all pc chars in grouplist, or matching mask

function groupList:pc(xmask)
	local temp={}, nx

	if xmask == nil then
		xmask=&quot;classes&quot;
	end

	for nx=1, groupList:size(), 1 do
		local charname=groupList[nx][1]

		-- Don't add if Someone, 2.Someone, etc
		if not string.find( charname, &quot;Someone&quot;) then
			if checkMask(xmask, charname) then
				table.insert(temp, charname)
			end
		end
	end

	return(temp)
end

-- add xchar to grouplist

function groupList:add(xchar, xcls, xhp, xmaxhp)
	--if xchar == &quot;a gray slaad&quot; then
	--	table.insert(self, 1, {xchar, xcls, xhp, xmaxhp})
	--	return;
	--end

	if xchar == &quot;doppelganger&quot; then
		return
	end

	-- change hell hound to wolf

	if xchar == &quot;hound&quot; then
		xchar= &quot;wolf&quot;
	end

	-- If name already exists in table, rename to 2. 3. etc

	for nx=1, #groupList, 1 do
		if groupList[nx][1] == xchar then
			local test=string.findPattern(xchar, &quot;([0-9]+)[.]&quot; )

			if test==nil then
				xchar = &quot;2.&quot; .. xchar
			else
				xchar = tonumber(string.findPattern( string.findPattern(xchar, &quot;([0-9]+)[.]&quot; ), &quot;[0-9]+&quot; ) )+1 .. &quot;.&quot; .. string.sub(xchar, 3)
			end
		end
	end

	local newc = table.index_of(NyyLIB.classes, xcls)

	-- TODO: reorder insert to x, 2., 3.

	for nx=1, #groupList, 1 do
		if table.index_of(NyyLIB.classes, groupList[nx][2] ) &gt; newc then
			table.insert(groupList, nx, {xchar, xcls, xhp, xmaxhp})
			return(nil)
		end
	end

	table.insert(groupList, #groupList+1, {xchar, xcls, xhp, xmaxhp})

	--for nx=#groupList, 1, -1 do
	--	if table.index_of(NyyLIB.classes, groupList[nx][2] ) &lt; newc then
	--		table.insert(groupList, nx+1, {xchar, xcls, xhp, xmaxhp})
	--		return(nil)
	--	end
	--end

	--table.insert(groupList, 1, {xchar, xcls, xhp, xmaxhp})
end

-- modifed group display 

function groupList:display(xname, xhp, xmaxhp, xmv, xmaxmv, xpsp, xmaxpsp )
	local profilename=inwho(xname)

	local charClass = whoclass(xname)

	local color=&quot;&lt;green&gt;&quot;

	if xhp ~= nil then
		color=colorNumber(xhp, xmaxhp)
	end

	if charClass ~= nil then
		if charData:get(&quot;group&quot;, true) then
			eraseLine()

			if xhp ~= nil then
				cecho ( string.format(&quot;\n%s%4d/%-4d&quot;, color, xhp, xmaxhp ) ) --hp
			else
				cecho ( &quot;\n    /    &quot; )
			end

			if profilename then
				cecho ( string.format(&quot;[%s] %s%-16s @%-15s&quot;, charClass, color, xname, profilename)) -- class, name, profilename
			else
				cecho ( string.format(&quot;[UNK] %s%-16s @%-15s&quot;, color, xname, &quot;unknown&quot;)) -- name, profilename
			end

			if xmv ~= nil then
				cecho ( string.format(&quot;&lt;green&gt;%3d/%-3d &quot;, xmv, xmaxmv) )
			else
				cecho ( color .. &quot;   /    &quot; )
			end

			if xpsp ~= nil then
				cecho ( string.format(&quot;&lt;green&gt;%4d/%-4d &quot;, xpsp, xmaxpsp) )
			else
				cecho ( color .. &quot;    /     &quot; )
			end

		end

		if charClass ~= &quot;UNK&quot; then
			groupStatsDisplay(xname)
		end
	else
	-- pet
		if charData:get(&quot;group&quot;, true) then
			local linecheck = string.find(matches[1], xname)

			selectSection(linecheck-1, string.len(matches[1])-linecheck+1)
			copy()

			selectCurrentLine()
			replace(&quot;&quot;)

			if xhp ~= nil then
				cecho ( string.format(&quot;%s%4d/%-4d&quot;, color, xhp, xmaxhp ) ) --hp
			else
				cecho ( &quot;    /    &quot; )
			end

			echo ( &quot;[UNK] &quot; )

			paste()

			moveCursor(0, getLineCount())
			eraseLine()
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>BuffScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- TODO - call buff function (if exists) every second with charname as argument

buff = buff or {}

power = {
 armor=1200, 
 haste=324, 
 dragonscales=360,
 blur=202,	
 globe_of_invulnerability=324,
 displace=1200,
 time_stop=175,
 stoneskin=240,
 elemental_ward=180,
 vitality=480
}

function power:get(powername)
	return( power[powername] )
end

function power:set(xname, xdur)
	power[xname] = xdur
end

function buff:set(xname, xbuff, xdur)
	self[xname] = self[xname] or {}

	if xdur == -1 then
		self[xname][xbuff] = nil
	elseif xdur == nil then
		-- get from db based on xbuff
		self[xname][xbuff] = power:get(xbuff)
	else
		self[xname][xbuff] = xdur
	end
end


-- function buff:set(xname, xbuff, xdur)	: Add buff to character
-- function buff:get(xbuff, xname) 		: Return time left on buff. whoami() substituted for xname if nil
-- function buff:del(xname, xbuff, xsuppress) : Remove an individual or all buffs from xchar
-- function decreasebuffs() 				   	: internal - decrement all buffs by 1 second

function buff:get(xbuff, xname)
-- 111616 changed to xbuff, xname. if xname is left blank, whoami is inserted

	if xname == nil then
		xname=whoami()
	end

	if self[xname] ~= nil then
		if self[xname][xbuff] ~= nil then
			return(self[xname][xbuff])
		end
	end

	return nil
end

function buff:del(xname, xbuff, xsuppress)
	if xbuff == nil then
		self[xname]={}
		return
	end

	buff:set(xname, xbuff, -1)

	if xsuppress ~= nil then
		buffexpired(xname, xbuff)
	end
end

-- substitute underscore for spaces, make all lower case
function to_snake(xname)
	local newname

	newname=string.trim(xname)

	newname=string.lower(newname)

	newname=string.gsub(newname, &quot; &quot;, &quot;_&quot;) -- replace space with underscore

	return(newname)
end

function to_english(xname)
	local newname

	if xname == nil or xname == &quot;&quot; then
		return(&quot;&quot;)
	end

	newname=string.title(xname)

	newname=string.gsub(newname, &quot;_&quot;, &quot; &quot;)


	local cappedname=&quot;&quot;

	-- change capitalization

	for k,v in pairs( string.split(newname, &quot; &quot;) ) do
		if #v &gt; 3 then
			cappedname = cappedname .. string.title(v) .. &quot; &quot;
		else
			cappedname = cappedname .. v .. &quot; &quot;
		end
	end

	return( string.trim(cappedname) )
end

function decreasebuffs()
	for key, value in pairs(buff) do 
		if type(value) == &quot;table&quot; then
			for k, v in pairs(value) do 
				buff[key][k] = v-1

				if (v-1) == 0 or v &lt; -10 then
					buffexpired(key, k)

					buff:del(key, k)
				end
			end
		end
	end
end

function buffexpired(xname, xbuff)
	if groupList:ingroup(xname) then
		cecho(&quot;\n&lt;red&gt;[&quot; .. to_english(xbuff) .. &quot; has expired on &lt;green&gt;&quot; .. xname .. &quot;&lt;red&gt;.]\n&quot;)
	end

	if xbuff == &quot;combatmind&quot; and checkMask(&quot;psi&quot;) then
		dropcombatmind()
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>GUIGroup</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function colorNumber(xhp, xmaxhp)
	local pct = 1
	local col=&quot;&lt;green&gt;&quot;

	if xhp == nil then
		pct=100
	else
		if tonumber(xhp) then
			pct=(xhp*100)/xmaxhp
		end
	end

	if not tonumber(xmaxhp) then
		cecho(&quot;&lt;red&gt;[Prompt appears incorrect: Rent/Re-enter Toril]\n&quot;)
		display(xmaxhp)
	end

	pct=(xhp*100)/xmaxhp

	if pct &gt;= 100 then
		col = &quot;&lt;green&gt;&quot;
	elseif pct &lt; 100 and pct &gt; 91 then
		col = &quot;&lt;DarkGoldenrod&gt;&quot;
	elseif pct &lt;= 91 and pct &gt; 75 then
 		col = &quot;&lt;yellow&gt;&quot;
	elseif pct &lt;= 75 and pct &gt; 50 then
 		col = &quot;&lt;magenta&gt;&quot;
	elseif pct &lt;= 50 and pct &gt; 33 then
		col = &quot;&lt;magenta&gt;&quot;
	elseif pct &lt;= 33 and pct &gt; 15 then
 		col = &quot;&lt;OrangeRed&gt;&quot;
	elseif pct &lt;= 15 and pct &gt; -500 then
		col = &quot;&lt;red&gt;&quot;
	end

	if xhp == &quot;&quot; then
  		col = &quot;&lt;green&gt;&quot;
	end

	return(col)
end

function countlines(xstr)
	local n=0
	local len=string.len(xstr)

	for i in xstr:gmatch(&quot;\n&quot;) do n=n+1 end

	if xstr:sub(len,len) ~= &quot;\n&quot; then
		n=n+1 -- last char is not newline
	end

	if xstr == &quot;&quot; then
		n=0
	end

	return(n)
end


function genline(xchar, xcls, xhp, xmaxhp)
	
	local pct = 1
	local col=colorNumber(xhp, xmaxhp)
	local cls = &quot;&quot;	

	local buffdisplay = &quot;&quot;
	local var

	if xcls == &quot;UNK&quot; then
		cls = &quot;&lt;red&gt;&quot; .. xcls .. &quot;&lt;green&gt;&quot;
	else
  		cls = xcls
	end

	-- scale/stone

	if buff:get(&quot;dragonscales&quot;, xchar) then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;dragonscales&quot;, &quot;scl&quot;)
	else
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;stoneskin&quot;, &quot;stn&quot;)
	end	

	-- blur

	buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;blur&quot;, &quot;blr&quot;)

	-- globe/ward

	if buff:get(&quot;elemental_ward&quot;, xchar) then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;elemental_ward&quot;, &quot;wrd&quot;)
	else
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;globe_of_invulnerability&quot;, &quot;glb&quot;)
	end

	-- display final item on each group display line

	local endspell=charData:get(&quot;endspell&quot;)

	if endspell == &quot;vit&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;vitality&quot;, &quot;vit&quot;)
	elseif endspell == &quot;dsp&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;displacement&quot;, &quot;dsp&quot;)
	elseif endspell == &quot;pwt&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;pass_without_trace&quot;, &quot;pwt&quot;)
	elseif endspell == &quot;fly&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;fly&quot;, &quot;fly&quot;)
	elseif endspell == &quot;grp&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;greater_realm_of_protecti&quot;, &quot;grp&quot;)
	elseif endspell == &quot;pfu&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;protection_from_undead&quot;, &quot;pfu&quot;)
	elseif endspell == &quot;hst&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;haste&quot;, &quot;hst&quot;)
	elseif endspell == &quot;dop&quot; then
		buffdisplay = buffdisplay .. createBuffDisplay(xchar, &quot;doppleganger&quot;, &quot;dop&quot;)
	end

	-- various display formats


	if table.contains(NyyLIB.deadpeople, xchar) then
		-- This group member is dead

		return (&quot;&lt;navy&gt;&quot; .. string.format(&quot;[%s]            %-16s                                    &quot;, xcls, xchar))
	else
		-- blind, paralyzed, or silenced

		if buff:get(&quot;blindness&quot;, xchar) or buff:get(&quot;blind&quot;, xchar) then
			return (col .. string.format(&quot;[%s] %4s/%4s  %-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, &quot;          [[ BLIND ]]              &quot;))
		end

		if buff:get(&quot;major_paralysis&quot;, xchar) then
			return (col .. string.format(&quot;[%s] %4s/%4s  %-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, &quot;           [[ PARA ]]              &quot;))
		end

		if buff:get(&quot;silence_person&quot;, xchar) then
			return (col .. string.format(&quot;[%s] %4s/%4s  %-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, &quot;          [[ SILENT ]]             &quot;))
		end

		if buff:get(&quot;venom&quot;, xchar) then
			return (col .. string.format(&quot;[%s] %4s/%4s  %-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, &quot;           [[ VENOM ]]             &quot;))
		end

		-- No major penalties on char

		if xhp == 0 then
			-- character is not in room

			return (col .. string.format(&quot;[%s] %4s/%4s  %-16s&lt;green&gt; %s&quot;, xcls, &quot;----&quot;, &quot;----&quot;, xchar, buffdisplay))
		else
			-- default group line

			if xchar == whoami() and groupList:size() ~= 1 then
				return (col .. string.format(&quot;[%s] %4d/%-4d  &lt;cyan&gt;%-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, buffdisplay))
			else
				return (col .. string.format(&quot;[%s] %4d/%-4d  %-16s&lt;green&gt; %s&quot;, xcls, xhp, xmaxhp, xchar, buffdisplay))
			end
		end
	end
end

function createBuffDisplay(xchar, xbuff, xdsp)
	local var = buff:get(xbuff, xchar)
	local time = bufftimedisplay(var)

	if var then	
		if string.starts(time, &quot;0&quot;) then
			return ( &quot;&lt;red&gt;&quot; .. xdsp:upper() .. &quot;:&quot; .. time .. &quot; &quot;)
		else
			return ( &quot;&lt;green&gt;&quot; .. xdsp:upper() .. &quot;:&quot; .. time .. &quot; &quot;)
		end
	else
		return ( &quot;&lt;grey&gt;&quot; .. xdsp .. &quot;    &quot;)
	end
end

function RedrawGroupStatus()
	local bottomwin = &quot;&quot;
	local rightwin = &quot;&quot;
	local count=0
	local i=0

	if groupRedraw ~= nil then
		return
	end

	if charData:get(&quot;groupwindow&quot;) == &quot;bottom&quot;	and groupList:size() &gt; 4 then
		charData:set(&quot;groupwindow&quot;, &quot;split&quot;)
		selectGroupWindows()
	end

	if charData:get(&quot;groupwindow&quot;) == &quot;split&quot;	and groupList:size() &lt; 5 then
		charData:set(&quot;groupwindow&quot;, &quot;bottom&quot;)
		selectGroupWindows()
	end

	for k,char in pairs(groupList:pc()) do
		i=i+1

		local cls=whoclass(char) or &quot;UNK&quot;

		local charline = genline( char, cls, groupList:getHP(char), groupList:getMaxHP(char) )

		if charData:get(&quot;groupwindow&quot;) == &quot;split&quot; then
			if checkMask(&quot;rightWindow&quot;, char) then
				rightwin = rightwin .. charline .. &quot;\n&quot;
			else
				count=count+1	
							
				if charData:get(&quot;iconbar&quot;) == &quot;left&quot; then
					if count % 2 ~= 0 then	-- indent window for left iconbar
						bottomwin = bottomwin .. &quot;          &quot;
					end
				end

				bottomwin = bottomwin .. charline
						
				if count % 2 == 0 then
					bottomwin = bottomwin .. &quot;\n&quot;
				end
			end			
		else
			if i &gt; 1 and (i % 2) == 0 then		
				bottomwin = bottomwin .. &quot;                  &quot;
			end

			bottomwin = bottomwin .. charline
			rightwin = rightwin .. charline .. &quot;\n&quot;

			if i ~= groupList:size() and (i % 2) == 0 then
				bottomwin = bottomwin .. &quot;\n&quot;
			end
		end
	end

	bottomGroupWindowLines=countlines(bottomwin)

	if rightGroupWindowLines ~= countlines(rightwin) then
		force=true
	end

	rightGroupWindowLines=countlines(rightwin)

	if bottomGroupWindowLines == 1 then
		bottomGroupWindowLines=2
	end

	resizeGroupWindow(force)
	force=nil


	local grw=charData:get(&quot;groupwindow&quot;)

	if grw == &quot;bottom&quot; or grw == &quot;all&quot; or grw == &quot;split&quot; then
		local bottomWindow=Geyser.Label:getWindow(&quot;gGroupStatusWindow&quot;)

		clearWindow(&quot;gGroupStatusWindow&quot;)
		bottomWindow:show()

		bottomWindow:echo( parseLine(bottomwin) )
	end

	if grw == &quot;right&quot; or grw == &quot;all&quot; or grw == &quot;split&quot; then
		clearWindow(&quot;gGroupStatusWindow2&quot;)
		showWindow(&quot;gGroupStatusWindow2&quot;)		

		gGroupStatusWindow2:cecho(rightwin)
	end
end

-- this function is always the bottom window
function parseLine(xline)
	local fontsize = charData:get(&quot;grpfontsize&quot;, true)
	local WindowWidth, WindowHeight = getMainWindowSize()
	local retval=&quot;&quot;

	-- calculate/set font size of lower window
	if groupList:size() &lt; 3 and charData:get(&quot;grpfontsize&quot;, true) == &quot;auto&quot; then
		--fontsize= maxfont(55, WindowWidth)
		fontsize= maxfont(40, WindowWidth)	

		--display(fontsize)

		if fontsize &gt; 14 then
			fontsize = 14
		end
	end

	for k,v in pairs( string.split(xline, &quot;&lt;&quot;) ) do
		if v ~= &quot;&quot; then
			local tmp = 	string.split(v, &quot;&gt;&quot;)
		
			retval = retval .. [[&lt;span style=&quot;color:]] .. tmp[1] .. [[&quot;&gt;]] .. 
				 string.gsub(tmp[2], &quot; &quot;, &quot;&amp;nbsp;&quot;)
				 .. [[&lt;/span&gt;]]
		end
	end

	retval = [[&lt;p style=&quot;font-size:]] .. fontsize .. [[px;font-style:normal;font-family: 'Bitstream Vera Sans Mono'&quot;&gt;]] .. retval .. [[&lt;/font&gt;&lt;/p&gt;]]
	retval = string.gsub(retval, &quot;\n&quot;, &quot;&lt;br&gt;&quot;)

	return(retval)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>GUIButtons</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
buttons = {}

function updateButton(xname, nest)
	local label

	if nest == nil then
		label=findlabel(xname)		
	else
		label=findlabel(nest)
	end

	if label ~= nil then
		label:echo([[&lt;p style=&quot;font-size:24px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;]] .. charData:get(&quot;numcolor&quot;, true) .. [[&quot;&gt;]] .. getSpellCount(xname) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
	end
end

function buttons:sync()
	-- highlight buttons re: new charData
	for i,v in pairs(NyyLIB.buttonarray) do
		-- TODO changed
		--if i &lt; NyyLIB.equipicon then
			initButton( v[1])
		--end
	end
end

function buttons:id(xname)
	for i,v in pairs(NyyLIB.buttonarray) do
		if v[1] == xname then
			return(i)
		end
	end

	return(nil)
end

function	showIconbar()
	local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

	if charData:get(&quot;hideicons&quot;, true) then
		window:hide()
	else
		window:show()
	end
end

-- return true if label is not hidden

function isIconActive(xname)
	local label=findlabel(xname)

	if label == nil then
		return(false)
	end

	if label[&quot;hidden&quot;] then
		return(false)
	else
		return(true)
	end
end


function closeNests()
	-- close all open nests
	local nx
	local label

	for nx=1, 20, 1 do
		label=findlabel(&quot;button&quot; .. nx)

		if label ~= nil then
			closeNestChildren(label.name)
		end
	end
end

function setLabelImage(xname, ximage)
	local label=findlabel(xname)

	if label ~= nil then
		label:setStyleSheet([[border-image: url(]] .. iconpath(ximage) .. [[)]])
		return(label)
	else
		echo(&quot;\n[Error: unable to locate label: &quot; .. xname .. &quot;]&quot;)
		return(nil)
	end
end

function findlabel(xname)
	local othername=xname
	local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)
	local leftwindow=Geyser.Label:getWindow(&quot;LeftPanel&quot;)

	if window == nil then
		return(nil)
	end

	for i,v in pairs(NyyLIB.buttonarray) do
		if v[1] == xname then
			othername = &quot;button&quot; .. i
		end
	end

	for i,v in pairs(window.windowList) do
		if v.name == othername then
			return v
		end
	end

	for i,v in pairs(NyyLIB.leftbuttonarray) do
		if v[1] == xname then
			othername = &quot;lbutton&quot; .. i
		end
	end

	for i,v in pairs(leftwindow.windowList) do
		if v.name == othername then
			return v
		end
	end

	if string.find(xname, &quot;^button[0-9][0-9]$&quot;) == nil then
		echoDebug(&quot;&lt;red&gt;[label not found &quot; .. xname .. &quot;]&quot;)
	end

	return(nil)
end

function addLeftbutton(xname, xid, xlevel, xwidth, xheight)
	local newbutton=nil
	local createname=&quot;lbutton&quot; .. xid

	xwidth= xwidth or &quot;95%&quot;
	xheight = xheight or &quot;8%&quot;

	if xid == nil then
		cecho(&quot;\n&lt;red&gt;[addLeftbutton: nil xid]\n&quot;)
	end

	if xid &gt; 20 then
		display(xname)
		display(xid)
	end

	assert( tonumber(xlevel), xlevel )

	if charData:get(&quot;level&quot;) &gt;= xlevel then
		local window=Geyser.Label:getWindow(&quot;LeftPanel&quot;)

		-- reuse button if previously created
		if NyyLIB.leftbuttonarray[xid] ~= nil then
			newbutton = NyyLIB.leftbuttonarray[xid][2]
		else
			newbutton = Geyser.Label:new({name=createname, x=3, y=lefticonyp(xid), width=xwidth, height=xheight}, window)
		end

		newbutton:setFontSize(window.fontSize)

		newbutton:echo([[&lt;p style=&quot;font-size:12px&quot;&gt;&lt;b&gt;&lt;center&gt;     &lt;br&gt;     &lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])

		newbutton:setClickCallback(xname, xname)
		newbutton:setOnEnter( &quot;closeNests&quot; )

		newbutton:show()

		NyyLIB.leftbuttonarray[xid] = {xname, newbutton}

		initButton(xname)
	end

	return(newbutton)
end

-- button name, position (1-20), minimum level to create, width (or nil), height (or nil)

-- Button will callback to self on click IF a function exists for it.
-- If no function exists, information is taken from the powerAliases[Classname] table
-- A spell button is populated with the highest known memorized spell matching the charData entry

function addbutton(xname, xid, xlevel, xwidth, xheight)
	local newbutton=nil

	if xid == nil then
		cecho(&quot;\n&lt;red&gt;[addbutton: nil xid : non-existant button: &quot; .. xname .. &quot;]\n&quot;)
		return
	end

	local createname=&quot;button&quot; .. xid

	xwidth= xwidth or &quot;4.8%&quot;
	xheight = xheight or &quot;2c&quot;

	if xid &gt; 20 then
		display(xname)
		display(xid)
	end

	assert( tonumber(xlevel), xlevel )

	if charData:get(&quot;level&quot;) &gt;= xlevel then
		local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

		-- reuse button if previously created
		if NyyLIB.buttonarray[xid] ~= nil then
			newbutton = NyyLIB.buttonarray[xid][2]
		else
			newbutton = Geyser.Label:new({name=createname, x=iconxp(xid), y=iconyp(xid), width=xwidth, height=xheight}, window)
		end

		newbutton:setFontSize(window.fontSize)

		newbutton:echo([[&lt;p style=&quot;font-size:12px&quot;&gt;&lt;b&gt;&lt;center&gt;     &lt;br&gt;     &lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])


		-- if no existing function use the generic spell button function
		if _G[xname] == nil then
			newbutton:setClickCallback(&quot;updateSpellCount&quot;, xname, xname)
		else
			newbutton:setClickCallback(xname, xname)
		end

		newbutton:setOnEnter( &quot;closeNests&quot; )

		newbutton:show()

		NyyLIB.buttonarray[xid] = {xname, newbutton}

		initButton(xname)
	end

	return(newbutton)
end

function findbutton(xid)
	local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

	if xid == nil then
		cecho(&quot;\n&lt;red&gt;[findbutton: nil xid]\n&quot;)
	end

	for i,v in pairs(window.windowList) do
		if v.name == &quot;button&quot; .. xid then
			return v
		end
	end

	return(nil)
end

function iconxp(xnum)
	if xnum &gt; 19 then
		xnum = 19
	end

	return( xnum/20*100 .. &quot;%&quot; )
end

function lefticonyp(xnum)
	if xnum &gt; 10 then
		xnum = 10
	end

	xnum=10-xnum

	return( xnum/10*100 .. &quot;%&quot; )
end

function iconyp(xnum)
	-- bottom row only
	return(5)
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>GUIScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- RightLabel - Righthand side image label that runs top to bottom
-- RightPanel - Righthand side container that holds other windows, just inside RightLabel

-- demonnic.chat.container is created inside RightPanel
-- tab box is 25px, created inside demonnic.chat.container

-- iconbar height is always 40 pixels
-- currenty top left corner of icon bar
-- Geyser.Label:getWindow(&quot;gIconBarWindow&quot;).y  will return in the format -78px


function leftIcons()
	local WindowWidth, WindowHeight = getMainWindowSize()
	local lLabel=Geyser.Label:getWindow(&quot;LeftLabel&quot;)
	local exitLabel=Geyser.Label:getWindow(&quot;LeftExitLabel&quot;)

	if charData:get(&quot;hideequip&quot;, true) then
		setBorderLeft( 10 )

		exitLabel:hide()

		lLabel:resize(5, nil)
	else
		setBorderLeft ( math.ceil(WindowWidth/20) )

		exitLabel:show()

		lLabel:resize(&quot;5%&quot;, nil)
	end
end

function hideLeftIcons()

	local WindowWidth, WindowHeight = getMainWindowSize()

	if charData:get(&quot;hideequip&quot;, true) then
		local lLabel=Geyser.Label:getWindow(&quot;LeftLabel&quot;)
		local exitLabel=Geyser.Label:getWindow(&quot;LeftExitLabel&quot;)

		exitLabel:hide()

		lLabel:resize(5, nil)

		setBorderLeft( 10 )
	else
		setBorderLeft ( math.ceil(WindowWidth/20) )
	end
end

function showLeftIcons()
	local lLabel=Geyser.Label:getWindow(&quot;LeftLabel&quot;)
	local exitLabel=Geyser.Label:getWindow(&quot;LeftExitLabel&quot;)
	local WindowWidth, WindowHeight = getMainWindowSize()

	if charData:get(&quot;hideequip&quot;, true) then
		exitLabel:show()
	else
		exitLabel:hide()
	end

	lLabel:resize(&quot;5%&quot;, nil)

	setBorderLeft ( math.ceil(WindowWidth/20) )
end

function leftsideOnEnter()
	showLeftIcons()
end

function leftsideOnLeave()
	hideLeftIcons()
end

function createLeftsideContainers()
	local WindowWidth, WindowHeight = getMainWindowSize()

--	local label = Geyser.Label:new({name=&quot;LeftLabel&quot;, x=&quot;0%&quot;, y=0, width=&quot;5%&quot;, height=WindowHeight-200,})
--	Geyser.Container:new({name=&quot;LeftPanel&quot;, x=&quot;1%&quot;, y=&quot;2%&quot;, width=&quot;98%&quot;, height=&quot;90%&quot;,}, label)

	local label = Geyser.Label:new({name=&quot;LeftLabel&quot;, x=&quot;0%&quot;, y=0, width=&quot;5%&quot;, height=&quot;100%&quot;,})
	Geyser.Container:new({name=&quot;LeftPanel&quot;, x=&quot;1%&quot;, y=&quot;2%&quot;, width=&quot;98%&quot;, height=&quot;70%&quot;,}, label)

	local exitlabel = Geyser.Label:new({name=&quot;LeftExitLabel&quot;, x=&quot;5%&quot;, y=0, width=&quot;10%&quot;, height=&quot;100%&quot;,})
	exitlabel:setStyleSheet([[background-color : transparent]]);

	label:setOnEnter( &quot;leftsideOnEnter&quot; )
	exitlabel:setOnEnter( &quot;leftsideOnLeave&quot; )

	leftsideOnLeave()
end

function createRightsideContainers()
	local label = Geyser.Label:new({name=&quot;RightLabel&quot;, x=&quot;66%&quot;, y=&quot;0%&quot;, width=&quot;34%&quot;, height=&quot;100%&quot;,})
	Geyser.Container:new({name=&quot;RightPanel&quot;, x=&quot;1%&quot;, y=&quot;2%&quot;, width=&quot;98%&quot;, height=&quot;90%&quot;,}, label)
end


function setBorder()
	local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)
	local rLabel=Geyser.Label:getWindow(&quot;RightLabel&quot;)
	local lLabel=Geyser.Label:getWindow(&quot;LeftLabel&quot;)

	if charData:get(&quot;border&quot;, true) == &quot;default&quot; then

		if window ~= nil then
			window:setStyleSheet([[border-image: url(]] .. iconpath(&quot;frame-1.png&quot;) .. [[)]])
		end

		if rLabel ~= nil then
			rLabel:setStyleSheet([[border-image: url(]] .. iconpath(&quot;frame-1.png&quot;) .. [[)]])
		end

		if lLabel ~= nil then
			lLabel:setStyleSheet([[border-image: url(]] .. iconpath(&quot;frame-1.png&quot;) .. [[)]])
		end

		return
	end

	if charData:get(&quot;border&quot;, true) == &quot;none&quot; then
		if window ~= nil then
			window:setStyleSheet([[border-image: url(&quot;&quot;)]])
		end

		if rLabel ~= nil then
			rLabel:setStyleSheet([[border-image: url(&quot;&quot;)]])
		end

		if lLabel ~= nil then
			lLabel:setStyleSheet([[border-image: url(&quot;&quot;)]])
		end

		return
	end

	if window ~= nil then
		window:setStyleSheet([[border-image: url(]] .. charData:get(&quot;border&quot;, true) .. [[)]])
	end

	if rLabel ~= nil then
		rLabel:setStyleSheet([[border-image: url(]] .. charData:get(&quot;border&quot;, true) .. [[)]])
	end

	if lLabel ~= nil then
		lLabel:setStyleSheet([[border-image: url(]] .. charData:get(&quot;border&quot;, true) .. [[)]])
	end
end

function GUIScripts( event, x, y )
	local rightGroupWindow=gGroupStatusWindow2

	-- called on sysWindowResizeEvent

	if NyyLIB == nil or NyyLIB == {} then
		return
	end

	if 	NyyLIB.initcompleted ~= true then
		return
	end

	if NyyLIB.homedir == nil then
		return
	end

	local WindowWidth, WindowHeight = getMainWindowSize()

	if (NyyLIB.windowx == nil or NyyLIB.windowy == nil) or (NyyLIB.windowx ~= x or NyyLIB.windowy ~= y) then 
		-- window size has changed

		NyyLIB.windowx = x
		NyyLIB.windowy = y

		if rightGroupWindow ~= nil then
			rightGroupWindow:setFontSize(maxfont(40, x/3-15))
		end

		if demonnic ~= nil then
			if demonnic.chat ~= nil then
				if demonnic.chat.config.fontSize == nil then
					demonnic.chat.config.fontSize=12
				end

				demonnic.chat:redo()
			end
		end

		setBorderRight( math.ceil(WindowWidth/3)+15 )	

		resizeGroupWindow(true)
	end
end

-- return the maximum fontsize that can display xchars in space of xpixelwidth

function maxfont(xchars, xpixelwidth)
	local fontSize=5
	local fontWidth,fontHeight = calcFontSize(5)

	while xpixelwidth/fontWidth &gt; xchars do
		fontSize=fontSize+1
		fontWidth,fontHeight = calcFontSize(fontSize)

		if fontSize == 16 then break end
	end

	fontSize=fontSize-1

	return(fontSize)
end

function initgui()
	local WindowWidth, WindowHeight = getMainWindowSize()
	local wwidth,wheight = calcFontSize(11)
	local rPanel = Geyser.Label:getWindow(&quot;RightPanel&quot;)

	NyyLIB = NyyLIB or {}

	-- lower group status window

	if gGroupStatusWindow == nil then
		gGroupStatusWindow = Geyser.Label:new({name=&quot;gGroupStatusWindow&quot;, x=&quot;0%&quot;, y=&quot;-1c&quot;, width=&quot;100%&quot;, height=&quot;1c&quot;,})
		gGroupStatusWindow:setOnEnter( &quot;closeNests&quot; )
	end

	setBackgroundColor(&quot;gGroupStatusWindow&quot;, 0,0,0,255)
	gGroupStatusWindow:setFontSize(11)

	-- right group status window
	
	if rPanel == nil then
		display(&quot;Error: Rightpanel is nil&quot;)
	end


	-- can't be looked up because miniconsole?
	if gGroupStatusWindow2 == nil then
		gGroupStatusWindow2 = Geyser.MiniConsole:new(
			{name=&quot;gGroupStatusWindow2&quot;, x=0, y=&quot;55%&quot;, width=&quot;100%&quot;, height=&quot;48%&quot;,}, Geyser.Label:getWindow(&quot;RightPanel&quot;) )
	end

	setBackgroundColor(&quot;gGroupStatusWindow2&quot;, 0,0,0,255)

	-- icon bar (bottom)
	local window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

	if window == nil then
		window = Geyser.Label:new({name=&quot;gIconBarWindow&quot;, x=&quot;0%&quot;, y=-51, width=&quot;100%&quot;, height=&quot;40&quot;,})
		setBorder()

		--window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

		window:show()
		window:hide()
	end

	window:setFontSize(8)

	--setBorderLeft ( math.ceil(WindowWidth/20) )

	for i,v in pairs(window.windowList) do
		v:show()
		v:hide()
	end

	showIconbar()

	-- room window
	
	if NyyLIB.gRoomWindow == nil then
		NyyLIB.gRoomWindow = Geyser.MiniConsole:new({name=&quot;gRoomWindow&quot;, x=&quot;33%&quot;, y=&quot;0%&quot;, width=&quot;33%&quot;, height=&quot;15c&quot;,}) -- -92c, -80c

		--createBuffer( &quot;roomwindow&quot; )
	end

	NyyLIB.gRoomWindow:setFontSize(9)

	charData:init(&quot;roomwindow&quot;, false)

	if charData:get(&quot;roomwindow&quot;) == false then
		NyyLIB.gRoomWindow:show()
		NyyLIB.gRoomWindow:hide()
	end

	-- non-specific buttons

	baseButtons()

	-- groupwindow

	initGroupWindow()

	timer:init()

	-- map window

	local currentmap =	charData:get(&quot;map&quot;)
	expandAlias(&quot;#map on&quot;, false)

	charData:set(&quot;map&quot;, currentmap)

	if charData:get(&quot;map&quot;) == &quot;off&quot; then
		expandAlias(&quot;#map off&quot;, false)
	end
end

function initGroupWindow()
	selectGroupWindows()

	local groupWindowsType=charData:get(&quot;groupwindow&quot;)

	if table.contains( { &quot;right&quot;, &quot;split&quot;, &quot;all&quot; }, groupWindowsType) then
		showWindow(&quot;gGroupStatusWindow2&quot;)
	end
		
	if table.contains( { &quot;bottom&quot;, &quot;split&quot;, &quot;all&quot; }, groupWindowsType) then
		showWindow(&quot;gGroupStatusWindow&quot;)
	end

	if groupWindowsType == &quot;right&quot; then
		window=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)

		window:move(nil,-40)
		NyyLIB.IconBarLabel:move(nil,-40)
	end

	bottomGroupWindowLines=0
	rightGroupWindowLines=0
end

-- This function displays the correct windows

function	selectGroupWindows()
	local rPanel=Geyser.Label:getWindow(&quot;RightLabel&quot;) 

	-- rPanel is container with demonnic.chat.container inside it - The Label however is the container that's moved

	hideWindow(&quot;gGroupStatusWindow&quot;)
	hideWindow(&quot;gGroupStatusWindow2&quot;)
	clearWindow(&quot;gGroupStatusWindow&quot;)
	clearWindow(&quot;gGroupStatusWindow2&quot;)

	-- resizing of map window - rightlabel is 34%
	if charData:get(&quot;groupwindow&quot;) == &quot;bottom&quot; then
		demonnic.chat.container:move(nil, 0)

		if NyyLIB.mapwindow ~= nil then
			NyyLIB.mapwindow:move(&quot;66%&quot;, nil)
			NyyLIB.mapwindow:resize(&quot;34%&quot;, &quot;50%&quot;)
		end
	end

	if charData:get(&quot;groupwindow&quot;) == &quot;split&quot; then
		demonnic.chat.container:move(nil, 0)

		if NyyLIB.mapwindow ~= nil then
			NyyLIB.mapwindow:move(&quot;46%&quot;, nil)
			NyyLIB.mapwindow:resize(&quot;20%&quot;, &quot;33%&quot;)
		end
	end

	RedrawGroupStatus()
end

-- This function resizes the group windows if needed

function resizeGroupWindow(xforce)
	local iconBar=Geyser.Label:getWindow(&quot;gIconBarWindow&quot;)
	local bottomWindow=Geyser.Label:getWindow(&quot;gGroupStatusWindow&quot;)
	local rightGroupWindow=gGroupStatusWindow2 -- Geyser.Label:getWindow(&quot;gGroupStatusWindow2&quot;) miniconsole doesn't work
	local rLabel=Geyser.Label:getWindow(&quot;RightLabel&quot;) 
	local WindowWidth, WindowHeight = getMainWindowSize()
	local currenty	-- holds the positive yp of the iconbar

	if iconBar ~= nil then
		currenty = tonumber(string.match(iconBar.y, '[0-9]+'))
	else
		-- windows haven't been created yet
		return
	end

	-- calculate/set font size of lower window
	local fontSize
	
	if charData:get(&quot;grpfontsize&quot;, true) == &quot;auto&quot; then
		--fontSize= maxfont(60, (WindowWidth/3-15))
	
		fontSize= maxfont(40, (WindowWidth/3-15))

		if fontSize &gt; 14 then
			fontSize = 14
		end	
	else
		fontSize= tonumber(charData:get(&quot;grpfontsize&quot;, true))
	end
	-- max font is 13
	

	local fontWidth,fontHeight = calcFontSize(fontSize)	
   bottomWindow:setFontSize(fontSize)

	local bottomWindowSize = fontHeight * bottomGroupWindowLines

	-- move and resize the windows
	if currenty ~= (bottomWindowSize+40) or xforce then
		local groupWindowsType=charData:get(&quot;groupwindow&quot;)

		-- move icon window up/or down .y is top 
		if groupWindowsType == &quot;bottom&quot; or groupWindowsType == &quot;all&quot; then
			iconBar:move(nil,-(bottomWindowSize+40) )

			-- move RLabel if map on/off
			if charData:get(&quot;map&quot;) == &quot;on&quot; then
				rLabel:move(nil, &quot;50%&quot;)
			else
				rLabel:move(nil, &quot;0&quot;)
			end
		elseif groupWindowsType == &quot;split&quot; then
			iconBar:move(nil, -(bottomWindowSize+40) )
		else
			iconBar:move(nil,-(40))
		end
		
		-- update currenty to the new iconbar position
		currenty = tonumber(string.match(iconBar.y, '[0-9]+'))

		-- lower window
		bottomWindow:move(nil, &quot;-&quot; .. bottomGroupWindowLines .. &quot;c&quot;)	
		bottomWindow:resize(nil, bottomGroupWindowLines .. &quot;c&quot;)
		setBackgroundColor(&quot;gGroupStatusWindow&quot;, 0,0,0,255)
	
		-- resize RightPanel
		Geyser.Label:getWindow(&quot;RightPanel&quot;):resize(nil, WindowHeight-currenty )

		-- lua display(Geyser.Label:getWindow(&quot;RightPanel&quot;):get_height() )
		--826


		-- move right window, resize chat window
		local rFontSize=rightGroupWindow.fontSize
		local rFontWidth,rFontHeight = calcFontSize(rFontSize)	

		local newyp=-( rightGroupWindowLines*rFontHeight+(.02*WindowHeight ) ) -- correct

		if groupWindowsType == &quot;split&quot; then

			Geyser.Label:getWindow(&quot;RightLabel&quot;):move(nil, 0)
			-- resize and move right group window

			rightGroupWindow:resize(nil, rightGroupWindowLines .. &quot;c&quot;) -- correct

			rightGroupWindow:move(nil, newyp) -- correct note: newyp is a negative number

			-- resize chat window

			-- newyp is a negative number
			demonnic.chat.container:resize(nil, WindowHeight+newyp - (currenty) - 40 )
			--demonnic.chat.container:resize(nil, (WindowHeight*.82)+newyp ) -- TODO fix
		else
			-- *** rightpanel has been resized. .chat.container is inside right panel

			if charData:get(&quot;map&quot;) == &quot;on&quot; then
				demonnic.chat.container:resize(nil, (Geyser.Label:getWindow(&quot;RightPanel&quot;):get_height()*.98)/2-currenty) -- correct?
			else
				demonnic.chat.container:resize(nil, (Geyser.Label:getWindow(&quot;RightPanel&quot;):get_height()*.98)-40 ) -- almost correct
			end
		end

		demonnic.chat:redo()
	end

	-- adjust left border

	--setBorderLeft ( math.ceil(WindowWidth/20) )

	-- set bottom border if window sizes have changed
	bottomBorderPX = bottomBorderPX or 0

	if bottomBorderPX ~= currenty then
		bottomBorderPX = currenty
		setBorderBottom(bottomBorderPX)
	end
end

-- credit to Akaya @ http://forums.mudlet.org/viewtopic.php?f=5&amp;t=4610&amp;start=10#p21770

function setStyle()
local background_color = &quot;#26192f&quot;
local border_color = &quot;#b8731b&quot;

--		spacing: 10;
-- 	QToolButton:pressed {	background-color: red;}

 
setAppStyleSheet([[
  QMainWindow {
     background: ]]..background_color..[[;
  }

  QMainWindow::separator {
     background: ]]..background_color..[[;
  }

  QToolBar {
     background: ]]..background_color..[[;
  }

  QToolButton {
     background: ]]..background_color..[[;
     border-style: solid;
     border-width: 2px;
     border-color: ]]..border_color..[[;
     border-radius: 5px;
	  font-family: BigNoodleTitling;
     color: white;
     margin: 2px;
     font-size: 12pt;
  }

	QToolButton:hover { background-color: grey;}
	QToolButton:focus { background-color: grey;}

	QMenuBar{ background-color: ]]..background_color..[[;}

	QMenuBar::item{ background-color: ]]..background_color..[[;}

  QDockWidget::title {
     background: ]]..border_color..[[;
  }

  QStatusBar {
     background: ]]..border_color..[[;
  }
  QScrollBar:vertical {
     background: ]]..background_color..[[;
     width: 15px;
     margin: 22px 0 22px 0;
  }
  QScrollBar::handle:vertical {
     background-color: ]]..background_color..[[;
     min-height: 20px;
     border-width: 2px;
     border-style: solid;
     border-color: ]]..border_color..[[;
     border-radius: 7px;
  }
  QScrollBar::add-line:vertical {
   background-color: ]]..background_color..[[;
   border-width: 2px;
   border-style: solid;
   border-color: ]]..border_color..[[;
   border-bottom-left-radius: 7px;
   border-bottom-right-radius: 7px;
        height: 15px;
        subcontrol-position: bottom;
        subcontrol-origin: margin;
  }
  QScrollBar::sub-line:vertical {
   background-color: ]]..background_color..[[;
   border-width: 2px;
   border-style: solid;
   border-color: ]]..border_color..[[;
   border-top-left-radius: 7px;
   border-top-right-radius: 7px;
        height: 15px;
        subcontrol-position: top;
        subcontrol-origin: margin;
  }
  QScrollBar::up-arrow:vertical, QScrollBar::down-arrow:vertical {
     background: white;
     width: 4px;
     height: 3px;
  }
  QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {
     background: none;
  }
]])

	setBackgroundColor(&quot;gGroupStatusWindow&quot;, 0,0,0,255)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>saveNyyLIB</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function saveNyyLIB()
	local ver=getMudletVersion()

	if ver[&quot;major&quot;] == 3 then
		if ver[&quot;build&quot;] == &quot;&quot; or ver[&quot;build&quot;] == &quot;-dev&quot; then
			disableAlias(&quot;restart&quot;)
		end
	end

	charData:save()

	-- save to map folder
	saveMap( &quot;&quot; )

	expandAlias(&quot;#map save&quot;, false)

	savewholist()
end</script>
                    <eventHandlerList>
                        <string>sysExitEvent</string>
                    </eventHandlerList>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>initNyyLIB</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function initNyyLIB()

	echo(&quot;\n\n\n&quot;)

	cecho([[&lt;green&gt;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO]])
	cecho(&quot;&lt;green&gt;THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&quot;)
	cecho(&quot;&lt;green&gt;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,&quot;)
	cecho(&quot;&lt;green&gt;TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&quot;)
	cecho(&quot;&lt;green&gt;THE SOFTWARE.&quot;)

	echo(&quot;\n\n\n&quot;)

	cecho(&quot;&lt;red&gt;[Initializing NyyLIB...]\n&quot;)

	NyyLIB = NyyLIB or {}

	expandAlias(&quot;version&quot;, false)

	NyyLIB.homedir = getMudletHomeDir() .. &quot;\\&quot; .. NyyLIB.version .. &quot;\\&quot;

	NyyLIB.areaTable = {}

	-- load list of all area names on the mud
	for line in io.lines(mainpath(&quot;arealist.txt&quot;)) do
		local areainfo = string.split(line, &quot;   &quot;)

		local areaid = areainfo[1]:trim()
		local areaname = areainfo[2]

		NyyLIB.areaTable[tonumber(areaid)] = areaname
	end

	-- loading charData table
	charData:load()

	NyyLIB.buttonarray = {}
	NyyLIB.leftbuttonarray = {}

	NyyLIB.deadpeople = NyyLIB.deadpeople or {}

	NyyLIB.initgui = false
	NyyLIB.ticktimer = 60

	if charData:get(&quot;style&quot;, true) then
		setStyle()
	end

	NyyLIB.classes = { &quot;War&quot;, &quot;UNK&quot;, &quot;A-P&quot;, &quot;Pal&quot;, &quot;Cle&quot;, &quot;Dru&quot;, &quot;Sha&quot;, &quot;Ctr&quot;, 
 	 &quot;Bar&quot;, &quot;Enc&quot;, &quot;Psi&quot;, &quot;Inv&quot;, &quot;Lic&quot;, &quot;Ill&quot;, &quot;Ele&quot;, &quot;Nec&quot;, &quot;Rog&quot;, &quot;Dir&quot;, &quot;Ran&quot; }

	NyyLIB.fullclasslist = { {&quot;Rogue&quot;, &quot;Rog&quot;},
								{&quot;Cleric&quot;, &quot;Cle&quot;},
								{&quot;Paladin&quot;, &quot;Pal&quot;},
								{&quot;Shaman&quot;, &quot;Sha&quot;},
								{&quot;Illusionist&quot;, &quot;Ill&quot;},
								{&quot;Ranger&quot;, &quot;Ran&quot;},
								{&quot;Lich&quot;, &quot;Lic&quot;},
								{&quot;Anti-Paladin&quot;, &quot;A-P&quot;},
								{&quot;Necromancer&quot;, &quot;Nec&quot;},
								{&quot;Battlechanter&quot;, &quot;Ctr&quot;},
								{&quot;Invoker&quot;, &quot;Inv&quot;},
								{&quot;Enchanter&quot;, &quot;Enc&quot;},
								{&quot;Druid&quot;, &quot;Dru&quot;},
								{&quot;Warrior&quot;, &quot;War&quot;},
								{&quot;Elementalist&quot;, &quot;Ele&quot;},
								{&quot;Dire Raider&quot;, &quot;Dir&quot;},
								{&quot;Bard&quot;, &quot;Bar&quot;},
								{&quot;Psionicist&quot;, &quot;Psi&quot;}
							}

	NyyLIB.fullracelist = { {&quot;Human&quot;, &quot;M&quot;},
									{&quot;Barbarian&quot;, &quot;M&quot;},
									{&quot;Drow Elf&quot;, &quot;M&quot;},
									{&quot;Moon Elf&quot;, &quot;M&quot;},
									{&quot;Half-Elf&quot;, &quot;M&quot;},
									{&quot;Shield Dwarf&quot;, &quot;M&quot;},
									{&quot;Half-Orc&quot;, &quot;M&quot;},
									{&quot;Duergar Dwarf&quot;, &quot;M&quot;},
									{&quot;Gnome&quot;, &quot;S&quot;},
									{&quot;Halfling&quot;, &quot;S&quot;},
									{&quot;Ogre&quot;, &quot;L&quot;},
									{&quot;Troll&quot;, &quot;M&quot;},
									{&quot;Illithid&quot;, &quot;M&quot;},
									{&quot;Orc&quot;, &quot;M&quot;},
									{&quot;Yuan-Ti&quot;, &quot;M&quot;}
								}

	NyyLIB.reversedirs   =   {
                     n   = &quot;s&quot;,
                     e   = &quot;w&quot;,
                     s   = &quot;n&quot;,
                     w   = &quot;e&quot;,
                     u   = &quot;d&quot;,
                     d   = &quot;u&quot;,
						  north = &quot;south&quot;,
						  east = &quot;west&quot;,
						  south = &quot;north&quot;,
						  west = &quot;east&quot;,
						  up = &quot;down&quot;,
						  down = &quot;up&quot;
                     }

	NyyLIB.statuschar=&quot;&quot;


	NyyLIB.damagelevels = { &quot;Excellent&quot;, &quot;Few Scratches&quot;, &quot;Small Wounds&quot;, &quot;Few Wounds&quot;, &quot;nasty wounds&quot;, &quot;Pretty Hurt&quot;, &quot;Awful&quot; }

	NyyLIB.equip = {
		{&quot;TiaScale&quot;, &quot;a silvered scale of deepest blue hue&quot;},
		{&quot;TiaOcular&quot;, &quot;an ocular disc of mighty sight&quot;},
		{&quot;TiaWarmaul&quot;, &quot;the warmaul of celestial glory&quot;},
		{&quot;TiaStaff&quot;, &quot;an ancient staff of the arch-magi&quot;},
		{&quot;TiaSandals&quot;, &quot;a pair of leathern sandals of Mystra's holy high order&quot;},
		{&quot;Baatorian&quot;, &quot;a smoking bracer forged from Baatorian steel&quot;},
		{&quot;WornBoots&quot;, &quot;worn boots with mithril inlays&quot;},
		{&quot;TiaMask&quot;, &quot;a set of gem studded tentacle rings&quot;},
		{&quot;TiaSleeves&quot;, &quot;a set of gossamer sleeves of the mystic&quot;},
		{&quot;TiaBracers&quot;, &quot;the quickly pulsing bracers of time&quot;},
		{&quot;TiaClaws&quot;, &quot;the wickedly sharp claws of a gelugon devil&quot;},
		{&quot;TiaStaff&quot;, &quot;an ancient staff of the arch&quot;},
		{&quot;TiaBane&quot;, &quot;the infernal stiletto of bane&quot;},
		{&quot;TiaLoop&quot;, &quot;a fighter's loop of sorcerous ability&quot;},
		{&quot;TiaManacle&quot;, &quot;an unfettered manacle of thickly woven metallic mesh&quot;},
		{&quot;FrenziedGrin&quot;, &quot;a frenzied bloodthirsty grin&quot;},
		{&quot;VermSleeves&quot;, &quot;vermillion chainmail sleeves&quot;},
		{&quot;TiaValhalla&quot;, &quot;the mighty scepter of valhalla&quot;},
		{&quot;SuppleGirdle&quot;, &quot;a supple leather girdle with golden studs&quot;},
		{&quot;TiaCincture&quot;, &quot;a luminous cincture of nightfallen stars&quot;},
		{&quot;TiaStability&quot;, &quot;the mystical boots of stability&quot;},
		{&quot;TiaVolance&quot;, &quot;a thick titanium band of volance&quot;},
		{&quot;TiaWarder&quot;, &quot;a dark gray cloak with a rune embroidered hem&quot;},
		{&quot;DragonCult&quot;, &quot;the ceremonial robes of the Dragon Cult&quot;}
				}

	NyyLIB.torescue=&quot;&quot;
	NyyLIB.tolook = 0
	NyyLIB.haslooked = 0
	NyyLIB.lookstart=0

	NyyLIB.psilag=&quot;none&quot;

	loadwholist()

	opendb()

	createconsumabledb()
	
	demonnicOnStart()

	setBorder()

	-- enable mapper

	NyyLIB.Mapper = NyyLIB.Mapper or {}

	mudlet = mudlet or {}; mudlet.mapper_script = true
	expandAlias(&quot;#map init&quot;, false)

	-- only load mapfile if loaded map is &lt; 35000 rooms i.e. not mudlet loaded mapfile

	if map:count() &lt; 35000 then
		loadTorilMap( &quot;toril.map&quot; )
	end

	NyyLIB.initcompleted = true

	registerAnonymousEventHandler(&quot;sysWindowResizeEvent&quot;, &quot;GUIScripts&quot;)
	registerAnonymousEventHandler(&quot;newRoomEvent&quot;, &quot;newRoomEvent&quot;)

	expandAlias(&quot;#stats reset&quot;, false)

	--local WindowWidth, WindowHeight = getMainWindowSize()
	--setBorderLeft ( math.ceil(WindowWidth/20) )

	cecho (&quot;&lt;red&gt;[NyyLIB initialized.]\n&quot;)
end

function initFullData()
	echoDebug(&quot;&lt;red&gt;[initFullData called]\n&quot;)

	charData:init(whoami(), {}, true)

	charData:init(&quot;memcount&quot;, 0)
	charData:init(&quot;groupwindow&quot;, &quot;split&quot;)
	charData:init(&quot;iconbar&quot;, &quot;bottom&quot;)

	charData:init(&quot;statname&quot;, &quot;unset&quot;)

	if NyyLIB.initgui == false then
		if NyyLIB.mapwindow == nil then
			cecho(&quot;&lt;red&gt;[error: mapwindow is nil]\n&quot;)
		else
			map:hide()
		end

		if whoami() == nil then
			cecho(&quot;&lt;red&gt;[error: whoami() is nil]\n&quot;)
		end

		if whoclass(whoami()) == nil then
			cecho(&quot;&lt;red&gt;[error: whoclass(whoami) is nil]\n&quot;)
		end

		local nx
		local label

		for nx=1, 20, 1 do
			label=findlabel(&quot;button&quot; .. nx)

			if label ~= nil then
				label:hide()
			end
		end

		NyyLIB.buttonarray = {}

		-- only load mapfile if loaded map is &lt; 35000 rooms i.e. not mudlet loaded mapfile

		--if map:count() &lt; 35000 then
		--	loadTorilMap( &quot;toril.map&quot; )
		--end

		initgui()

		-- call class initialization script

		local fname=&quot;init&quot; .. string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

		if _G[fname] ~= nil then
			_G[fname]()
		else
			echoDebug(&quot;\n&lt;red&gt;[Class script &quot; .. fname .. &quot; does not exist]\n&quot;)
		end

		-- call custom initaliziation script 'initCustom()' if it exists

		if _G[&quot;initCustom&quot;] ~= nil then
			_G[&quot;initCustom&quot;]()
		else
			echoDebug(&quot;\n&lt;red&gt;[Custom script initCustom() does not exist]\n&quot;)
		end

		NyyLIB.initgui = true
	end
end</script>
                    <eventHandlerList>
                        <string>sysLoadEvent</string>
                    </eventHandlerList>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>TimerScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
timer = timer or {}
timer.values = timer.values or {}

-- Usage:
--
-- timer:init() - create master timer
-- timer:get(xname) - return current value or nil
-- timer:set(xname, xduration) -- set timer 'xname' to value 'xduration' (duration=nil removes timer)
-- timer:custom - if created, this script will be called every second after timers update
--
-- When timers expire (reach 0) if a function exists matching the name of the timer, the timer will be
-- deleted and the associated function will be called with arguments (&quot;expire&quot;, functionname)

-- Look at the alias and script 'sampleTimer' in the samples folders

function timer:init()
	-- disable v1 timer if present, create v2 timer

	if exists(&quot;MudTimer&quot;, &quot;timer&quot;) == 1 then
		disableTimer(&quot;MudTimer&quot;)
	end

	if exists(&quot;MudTimer2&quot;, &quot;timer&quot;) == 0 then
		permTimer(&quot;MudTimer2&quot;, &quot;&quot;, 1, [[timer:script()]] )
	end


	enableTimer(&quot;MudTimer2&quot;)
end

function timer:set(xname, xduration)
	self.values[xname] = xduration
end

function timer:get(xname)
	if self.values[xname] == nil then
		return(nil)
	end

	return (self.values[xname])
end

function timer:script()
	-- decrement all timers
	for k, v in pairs(timer.values) do
		timer.values[k] = timer.values[k]-1

		-- Timer has reached 0 (expired)
		if timer.values[k] &lt; 1 and k ~= &quot;&quot; then
			timer.values[k] = nil	

			if _G[k] == nil then
				--echoDebug(&quot;&lt;red&gt;[ &quot; .. k .. &quot; function is nil]\n&quot;)
			else
				_G[k](&quot;expire&quot;, k)
			end
		else
			-- have timer called every second with &quot;timer&quot; as argument
			if _G[k] == nil then
				--echoDebug(&quot;&lt;red&gt;[ &quot; .. k .. &quot; function is nil]\n&quot;)
			else
				_G[k](&quot;timer&quot;, k)
			end
		end
	end

	if timer.custom ~= nil then
		timer:custom()
	end
end

function timer:custom()
	local label
	NyyLIB.ticktimer= NyyLIB.ticktimer-1

	if NyyLIB == nil or Geyser.Label:getWindow(&quot;gIconBarWindow&quot;) == nil then
		return
	end

	if NyyLIB.ticktimer &lt; 1 then
		NyyLIB.ticktimer = 60
	end

	label=findbutton(&quot;0.2&quot;)

	-- this displays the number in the bottom left corner
	if label ~= nil then
		-- clear current value
		setBackgroundColor(label.name, 0, 0, 0, 0)
		label:echo([[&lt;p style=&quot;font-size:20px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt; &lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])	

		-- display assassinate timer

		local value=timer:get(&quot;assassinatetimer&quot;)

		if value ~= nil then
			label:echo([[&lt;p style=&quot;font-size:20px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;]] .. bufftimedisplay(value) .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])	
		end

		-- display stun count
		local value=buff:get(&quot;stun&quot;)

		if value ~= nil then
			label:echo([[&lt;p style=&quot;font-size:20px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;white&quot;&gt;]] .. value .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])	
		end
	end

	if NyyLIB.songtimer ~= nil and NyyLIB.songtimer ~= &quot;&quot; then
		if NyyLIB.songtimer &gt; 0 then
			NyyLIB.songtimer = NyyLIB.songtimer - 1

			label=findlabel(&quot;StopMusic&quot;)
				
			if label ~= nil then
				clearWindow(&quot;StopMusic&quot;)
				label:echo([[&lt;p style=&quot;font-size:25px&quot;&gt;&lt;b&gt;&lt;center&gt;&lt;font color=&quot;red&quot;&gt;]] .. NyyLIB.songtimer .. [[&lt;/font&gt;&lt;/center&gt;&lt;/b&gt;&lt;/p&gt;]])
			end
		end
	end

	if timer:get(&quot;baatorian&quot;) ~= nil then
		baatorian(&quot;update&quot;)
	end

	if checkMask(&quot;enc&quot;) then
		if buff:get(&quot;time_stop&quot;) then
			PopulateTimestop()
		end
	end

	decreasebuffs()

	RedrawGroupStatus()
end

function timedisplay(seconds)

	local sec
	local min

	min=math.floor(seconds/60)

	sec=seconds-(min*60)

	return ( string.format(&quot;%d:%02d&quot;, min, sec))
end

function bufftimedisplay(seconds)

	local sec
	local min

	if seconds == nil then
		return(&quot;X&quot;)
	end

	min=math.floor(seconds/60)

	sec=seconds-(min*60)

	if min &gt; 0 then
		return( string.format(&quot;%2d&quot;, min) )
	end

	if sec &lt; 10 then
		return( string.format(&quot;%02d&quot;, sec) ) 
	end

	return ( string.format(&quot;%02d&quot;, sec) )
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>PromptScripts</name>
                    <packageName></packageName>
                    <script>prompt = prompt or {}

function prompt:set(xkey, xvalue)
	self[xkey]=xvalue
end

function prompt:get(xkey)
	return(self[xkey])
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>SpellQueue</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

spell = spell or {}
spell.spellcastqueue = spell.spellcastqueue or {}		-- queued spells
--spell.varsendqueue = spell.varsendqueue or {}  -- queued non-spell cmds

failedSpell = failedSpell or {}

mud = mud or {}

mud.varsendqueue = mud.varsendqueue or {}

function mud:sendCommands()
	local nx

	if mud.sending ~= nil then
		return
	end

	mud.sending = true

	if mud.varsendqueue ~= nil and mud.varsendqueue ~= {} then

		while #self.varsendqueue ~= 0 do
			local sendcommand = self.varsendqueue[1]

			table.remove(self.varsendqueue, 1)

			local assistcheck = string.match(sendcommand, &quot;^assist (.*)&quot;)

			if assistcheck == nil then
				echoDebug(&quot;&lt;green&gt;[Sending: &quot; .. sendcommand .. &quot;] : &quot;)
				lastsent = sendcommand
				expandAlias(sendcommand, charData:get(&quot;condensed&quot;, true)[&quot;debug&quot;])
			else
				if prompt:get(&quot;tank&quot;) == &quot;&quot; then
					echoDebug(&quot;&lt;green&gt;[Sending: &quot; .. sendcommand .. &quot;] &quot;)
					lastsent = sendcommand
					expandAlias(sendcommand, charData:get(&quot;condensed&quot;, true)[&quot;debug&quot;])
				else
					echoDebug(&quot;&lt;blue&gt;[Not sending assist]\n&quot;)
				end
			end
		end
	end

	mud.sending = nil
end

function mud:send(xcmd)
	mud.varsendqueue = mud.varsendqueue or {}

	-- don't queue duplicates commands?

	if table.contains(mud.varsendqueue, xcmd) == false then
		echoDebug(&quot;\n&lt;red&gt;[Queuing: &quot; .. xcmd .. &quot;]&quot;)
		table.insert(mud.varsendqueue, xcmd)
	else
		echoDebug(&quot;\n&lt;red&gt;[NOT Queuing: &quot; .. xcmd .. &quot;]&quot;)
	end

	-- send all queued commands if not casting or in fugue 

	if 	spell:getCurrent() == nil or map:getRoom() == 93848 then
		-- send queue contents
		mud:sendCommands() 
	end
end

function spell:setCast(xspell)
	if xspell ~= nil then
		self.spellsCast[xspell] = true
	else
		self.spellsCast = {}
	end
end

function spell:getCast()
	self.spellsCast = self.spellsCast or {}

	return ( self.spellsCast )
end


-- spell:attempt(tank, &quot;dragonscales&quot;, &quot;ds&quot;) then

function spell:attempt(xchar, xspell, xcommand) -- if xchar doesn't have xspell and spells available/memorized, cast it

	-- if failedSpell matches then return false

	--if xcommand .. &quot; &quot; .. xchar == failedSpell then
	--	echoDebug(&quot;&lt;red&gt;[failedSpell: &quot; .. failedSpell .. &quot;]\n&quot;)
	--	return(false)
	--end

	-- trim to 25 chars

	-- no target set for spell
	if not xchar then
		if getSpellCount(xspell) &gt; 0 then
			spell:cast(xcommand)
			return(true)
		end
		return(false)
	end

	if not buff:get(string.sub(xspell, 1, 25), xchar) then

		-- dragonscales/stoneskin are exclusive
		if xspell == &quot;dragonscales&quot; and buff:get(&quot;stoneskin&quot;, xchar) then
			return(false)
		end

		if xspell == &quot;stoneskin&quot; and buff:get(&quot;dragonscales&quot;, xchar) then
			return(false)
		end

		if getSpellCount(xspell) &gt; 0 then
			if groupList:getHP(xchar) ~= 0 then
				spell:cast(xcommand .. &quot; &quot; .. xchar)
				return(true)	
			end
		end
	end

	return(false)
end

function spell:getMoving()
	self.moving = self.moving or false

	return ( self.moving )
end

function spell:setMoving(xstatus)

	if self.moving ~= xstatus then
		echoDebug(&quot;&lt;green&gt;\n[spell:setMoving(xstatus) : &quot; .. tostring(xstatus) .. &quot;]\n&quot;)
	end

	if xstatus then
		automem = 0
	end

	self.moving = xstatus
end

function spell:getMem()
	self.memorize = self.memorize or false

	return ( self.memorize )
end

function spell:setMem(xstatus)

	if xstatus ~= self.memorize then
		echoDebug(&quot;&lt;green&gt;\n[spell:setMem(xstatus) : &quot; .. tostring(xstatus) .. &quot;]\n&quot;)
	end

	memsent = false

	self.memorize = xstatus
end

-- return who cast the spell that just completed

function spell:whocast()
	--Mizes completes his spell... (his|her|its)
	--You complete your spell...
	--You are surrounded in a brilliant aura of holy power.
	
	local castline = getLines(getLineNumber()-1, getLineNumber())[1]
	local charname

	if string.find(castline, &quot;You complete your spell...&quot;) ~= nil then
		return(whoami())
	end

	charname = string.match(castline, &quot;([A-Za-z]+) completes &quot;)

	return(charname)
end

function spell:setCurrent(xspell)
	self.casting=xspell
end

function spell:getCurrent()
	return(self.casting)
end

-- no spell is currently being cast
function spell:stop()
	self.casting=nil
	echoDebug(&quot;\n&lt;blue&gt;[Setting spell.casting to nil]&quot;)
end


function spell:count()
	return( #self.spellcastqueue )
end


function spell:eraseQueue()
	self.spellcastqueue = {}
end


-- remove all queued spells matching pattern xspell - if xspell not set, clear entire spellqueue

function spell:clear(xspell)
	if xspell == nil then

		-- abort spell if casting - need to fix for stun (don't send abort)
		if spell:getCurrent() ~= nil and not nomagic then
			send(&quot;abort&quot;)
		end

		spell:eraseQueue()

		spell:stop()

		cecho(&quot;\n&lt;blue&gt;[Spellqueue cleared.]\n&quot;)

		memsent = false

		mud:sendCommands()

		return
	end

	local ix=0

	if spell:count() ~= 0 then
		for ix=spell:count(), 1, -1 do
			if self.spellcastqueue[ix] == nil then
				cecho(&quot;\n&lt;red&gt;[Error: clear spell &quot; .. xspell .. &quot;]\n&quot;)
				display(ix)
			end

			if string.find(self.spellcastqueue[ix], &quot;^&quot; .. xspell) then
				table.remove(self.spellcastqueue, ix)
			end
		end
	end

	if string.find(spell:getCurrent() or &quot;&quot;, &quot;^&quot; .. xspell) then
		echoDebug(&quot;&lt;red&gt;[Sending abort: &quot; .. spell:getCurrent() or &quot;&quot; .. &quot; : &quot; .. xspell .. &quot;]\n&quot;)
		send(&quot;abort&quot;)
	end
end

function spell:cast(xspell)
	-- if escapedir set don't cast

	if NyyLIB.escapedir ~= nil then
		return
	end

	if self.casting == &quot;group&quot; or self.casting == &quot;look&quot; then
		spell:eraseQueue()
	end

	if not self.casting then
		mud:sendCommands()
	end

	-- don't cast spells when sending status or waiting on look

	if sendingStatus then
		return
	end

	-- don't cast spells when mem'ing or moving

	if spell:getMem() or memsent or spell:getMoving() then
		return
	end

	-- can't cast if bashed/sitting

	if prompt:get(&quot;position&quot;) ~= &quot;std&quot; then
		return
	end

	-- don't cast if trying to mem or look sent/not received
	if spell:getMem() or memsent or NyyLIB.tolook ~= 0 then
		return
	end

	-- don't queue spells if already casting
	if self.casting then
		if xspell == nil then
			echoDebug(&quot;&lt;red&gt;[Currently casting: &quot; .. self.casting .. &quot;]\n&quot;)
			return
		end

		return
	end

	if xspell ~= nil then
		echoDebug(&quot;\n&lt;red&gt;[ spell:cast &quot; .. xspell .. &quot; ]&quot; )
	end

	if xspell ~= nil then
		-- remove spell from queue if already present
		for ix=spell:count(), 1, -1 do
			if string.find(self.spellcastqueue[ix], &quot;^&quot; .. xspell) then
				--echoDebug(&quot;&lt;red&gt;[Removing from spellcastqueue: &quot; .. xspell .. &quot;]\n&quot;)
				table.remove(self.spellcastqueue, ix)
			end
		end

		-- do not queue spell if casting that spell
		if self.casting ~= xspell then
			self.spellcastqueue[spell:count()+1] = xspell
		end
	end

	if self.casting == nil then
		mud:sendCommands()

		-- if inside fugue return

		if map:getRoom() == 93848 then
			return
		end

		if spell:count() &gt; 0 then
			local tocast = self.spellcastqueue[1]

			-- stunned, can't cast

			if buff:get(&quot;stun&quot;) then
				return
			end

			-- paralyzed, can't cast

			if buff:get(&quot;minor_paralysis&quot;) or buff:get(&quot;major_paralysis&quot;) then
				return
			end

			-- if fh spell and &gt; 80% hp, remove from queue

			local fhchar = string.match(tocast, &quot;^fh (.*)&quot;)

			if groupList:ingroup(fhchar) then
				local hp=tonumber(groupList:getHP(fhchar))
				local maxhp= tonumber(groupList:getMaxHP(fhchar))

				if hp &gt; .8 * maxhp then
					-- remove spell from queue, try casting next spell
					table.remove(self.spellcastqueue, 1)
					spell:cast()
					return
				end
			end

			self.casting = tocast
			table.remove(self.spellcastqueue, 1)

			echoDebug(&quot;\n&lt;green&gt;[Sending spellcast: &quot; .. self.casting .. &quot;] &quot;)
			send(self.casting, true)
		end
	end
end

function spell:setNext(xcommand)
	-- move to top of queue, or add if non-existant

	-- don't cast spells when sending status

	if sendingStatus then
		return
	end

	-- if currently casting this spell return
	if self.casting ~= nil then
		if self.casting == xcommand then
			echoDebug(&quot;\n&lt;red&gt;[Not queuing, already casting: &quot; .. self.casting .. &quot;]\n&quot;)
			return
		end
	end

	-- this is supposed to remove from queue if already present

	if table.contains (self.spellcastqueue, xcommand) then
		table.remove(self.spellcastqueue, table.index_of(self.spellcastqueue, xcommand) )
	end

	-- only queue spells if not in fugue

	if map:getRoom() ~= 93848 then
		table.insert(self.spellcastqueue, 1, xcommand)
	else
		self.casting=nil
	end

	spell:cast()
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>WhoScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- NyyLIB.WhoClass.wholist xname={xclass,xrace,xprofilename}

function fixwholist()
	-- internal, not called
	local removed=0
	local total=0

	for k,v in pairs(NyyLIB.WhoClass.wholist) do
		if #(sqlclist(k)) &gt; 0 then
			removed=removed+1
			NyyLIB.WhoClass.wholist[k]=nil
		end

		total=total+1
	end

	display(removed)
	display(total)
end

function savewholist()
	table.save( homepath(&quot;wholist_v2&quot;), NyyLIB.WhoClass.wholist)
end

function loadwholist()
	NyyLIB.WhoClass = NyyLIB.WhoClass or {}
	NyyLIB.WhoClass.wholist = NyyLIB.WhoClass.wholist or {}

	local is_file = io.open( homepath(&quot;wholist_v2&quot;) )
	
	if is_file == nil then
		echo(&quot;[Creating wholist]\n&quot;)

		table.load( mainpath(&quot;wholist_v2&quot;), NyyLIB.WhoClass.wholist )
		savewholist()
	end

	table.load( homepath(&quot;wholist_v2&quot;), NyyLIB.WhoClass.wholist)
end

-- inwho(xname) - returns false or profilename

function inwho(xname)
	local profilename


	if string.findPattern(xname, &quot; &quot;) ~= nil then
		return(false)
	end

	if xname == &quot;Someone&quot; then
		return(false)
	end

	if NyyLIB.WhoClass.wholist[xname] ~= nil then
		return(NyyLIB.WhoClass.wholist[xname][3])
	end

	profilename = sqlinwho(xname)

	if profilename ~= false then
		return(profilename)
	end

	return(false)
end

-- k charname, v {x,x,x}
function whoclist(xname)
	for k,v in pairs(NyyLIB.WhoClass.wholist) do
		if k == xname or v[3] == xname then
			if sqlprofilename(k) == false then
				echo(string.format(&quot;[-- %15s] %20s %-15s (@%s)\n&quot;, v[1], k, 
					string.format(&quot;(%s)&quot;, v[2]), v[3]))
			end
		end
	end
end

function whoadd(xname, xclass, xrace, xprofile)
	NyyLIB.WhoClass.wholist = NyyLIB.WhoClass.wholist or {}

	-- find correct class name 
	for k, v in pairs(NyyLIB.fullclasslist) do
		if v[1] == xclass then
			xclass=v[2]
		end
	end

	if NyyLIB.WhoClass.wholist[xname] == nil then
		if xprofile == nil then
			NyyLIB.WhoClass.wholist[xname] = {xclass, xrace, &quot;unknown&quot;}
		else
			NyyLIB.WhoClass.wholist[xname] = {xclass, xrace, xprofile}
		end
	else
		-- use setProfile?
		--if xprofile ~= nil and xprofile ~= &quot;unknown&quot; then
		--	NyyLIB.WhoClass.wholist[xname][3] = xprofile
		--end
	end
end

function setProfile(xname, xprofile)
	NyyLIB.WhoClass.wholist[xname][3] = xprofile 
end

function getProfile(xname)
	if NyyLIB.WhoClass.wholist[xname] ~= nil then
		return ( NyyLIB.WhoClass.wholist[xname][3] )
	end

	return(nil)
end

function whoaccount(xname)
	for k,v in pairs(NyyLIB.WhoClass.wholist) do
		if v[3] == xname then
			return(k)	
		end
	end

	if NyyLIB.WhoClass.wholist[xname] ~= nil then
		return ( NyyLIB.WhoClass.wholist[xname][3] )
	end

	return(nil)
end

function whoclass(xname)
	-- if xname = nil then replace it with whoami()

	if xname == nil then
		xname = whoami()
	end

	if xname == &quot;a gray slaad&quot; then
		return(&quot;UNK&quot;)
	end

	if NyyLIB.WhoClass.wholist[xname] ~= nil then
		return ( NyyLIB.WhoClass.wholist[xname][1] )
	end

	return(nil)	
end


function whorace(xname)
	if xname == &quot;a gray slaad&quot; then
		return(&quot;UNK&quot;)
	end

	if NyyLIB.WhoClass.wholist[xname] ~= nil then
		return ( NyyLIB.WhoClass.wholist[xname][2] )
	end

	return(nil)	
end

function whoami()
	return(NyyLIB.charname)
end

function whosize(xname)
	local nx

	if xname == nil then
		xname=whoami()
	end

	local race=whorace(xname)

	for nx=1, #NyyLIB.fullracelist, 1 do
		if NyyLIB.fullracelist[nx][1] == race then
			return(NyyLIB.fullracelist[nx][2])
		end
	end

	return(nil)	
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>ConsentScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
consent = consent or {}

consent.chars = consent.chars or {}

function consent:get(xchar)
	if self.chars[xchar] == nil then
		self.chars[xchar] = false
	end

	return ( self.chars[xchar] )
end

function consent:set(xchar, xval)
	self.chars[xchar]=xval
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>PowerAliases</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

powerAliases= powerAliases or {}
-- { &quot;banshee_wail&quot;, &quot;bw&quot;, 46, &quot;&quot;, &quot;&quot;}

powerAliases = powerAliases or {}


-- return the charData entry associated with this spell

function powerAliases:getChardata(xspellname)
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	-- check if powers table exists for current class
	if powerAliases[charclass] == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return(nil)
	end

	for nx=#powerAliases[charclass], 1, -1 do
		if powerAliases[charclass][nx][1] == xspellname then
			return( powerAliases[charclass][nx][4] )
		end
	end

	return(&quot;&quot;)
end

-- { &quot;needle_swarm&quot;, &quot;ns&quot;, 26, &quot;automissile&quot;, &quot;&quot;},

function powerAliases:addButtons()
--	addbutton(&quot;beltyns_burning_blood&quot;, 6, 31) -- hlmissile
--	addbutton(&quot;rain_of_blood&quot;, 3, 46)
--	addbutton(&quot;magic_missile&quot;, 5, 1)
--	addbutton(&quot;ward_undead&quot;, 12, 26)

	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	-- check if powers table exists for current class
	if powerAliases[charclass] == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return
	end

	-- loop through all spells, and add button if it matches

	for nx=1, #powerAliases[charclass], 1 do
		local name=powerAliases[charclass][nx][1]
		local level=powerAliases[charclass][nx][3]
		local spellkey=powerAliases[charclass][nx][4]

		if spellkey == &quot;autohlmissile&quot; then
			addbutton(name, 3, level)
		end

		if spellkey == &quot;autoarea&quot; then
			addbutton(name, 4, level)
		end

		if spellkey == &quot;autovit&quot; then
			addbutton(name, 7, level)
		end

		if spellkey == &quot;automissile&quot; then
			addbutton(name, 5, level)
		end

		if spellkey == &quot;autohlarea&quot; then
			addbutton(name, 6, level)
		end

		if spellkey == &quot;autostorm&quot; then
			addbutton(name, 7, level)
		end

		if spellkey == &quot;autoheal&quot; then
			addbutton(name, 8, level)
		end

		if spellkey == &quot;autoharm&quot; then
			addbutton(name, 9, level)
		end

		if spellkey == &quot;turnundead&quot; then
			addbutton(name, 12, level)
		end

		if spellkey == &quot;autoquake&quot; then
			addbutton(name, 13, level)
		end
	end
end


function powerAliases:castDamage()
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	local charDataEntries= {}

	-- not in combat or other spells currently queued
	if not inCombat() or spell:count() &gt; 0 then
		return(false)
	end

	-- faerie fire
	if charData:get(&quot;autoffire&quot;) then
		if not (spell:getCast())[&quot;ff&quot;] then
			if getSpellCount(&quot;faerie_fire&quot;) &gt; 0 then
				if table.size( spell:getCast() ) == 0 then
					spell:cast(&quot;c 'faerie fire'&quot;)
					return
				end
			end
		end
	end

	if charData:get(&quot;turnundead&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;turnundead&quot;
	end

	if charData:get(&quot;autohlarea&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;autohlarea&quot;
	end

	if charData:get(&quot;autohlmissile&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;autohlmissile&quot;
	end

	if charData:get(&quot;autoarea&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;autoarea&quot;
	end

	if charData:get(&quot;automissile&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;automissile&quot;
	end

	if charData:get(&quot;autoharm&quot;) then
		charDataEntries[#charDataEntries+1] = &quot;autoharm&quot;
	end

	-- loop through all spells, and cast the first spell that matches

	for nx=#powerAliases[charclass], 1, -1 do
		if table.contains(charDataEntries, powerAliases[charclass][nx][4]) then
			if getSpellCount(powerAliases[charclass][nx][1]) &gt; 0 then
				spell:cast( powerAliases[charclass][nx][2] )
				return(true)
			end
		end
	end

	return(false)
end

function powerAliases:findChardataButton(xchardata)
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	-- check if powers table exists for current class
	if powerAliases[charclass] == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return
	end

	-- loop through table
	for nx=#powerAliases[charclass], 1, -1 do
		if powerAliases[charclass][nx][4] == xchardata then
			local spellname= powerAliases[charclass][nx][1]
			local buttonid = buttons:id(spellname)

			if buttonid ~= nil then
				return(buttonid)
			end
		end
	end

	-- no existing button
	return(nil)
end

-- display correct button for highest level memd spell

function powerAliases:updateButton(xchardata)
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	if xchardata == &quot;&quot; then
		return
	end

	-- check if powers table exists for current class
	if powerAliases[charclass] == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return
	end

	for nx=#powerAliases[charclass], 1, -1 do
		if powerAliases[charclass][nx][4] == xchardata then
			local spellname= powerAliases[charclass][nx][1]
			local spelllevel= tonumber(powerAliases[charclass][nx][3])

			if getSpellCount(spellname) &gt; 0 then
				if not isIconActive(spellname) then
					-- TODO need to identify correct button number
					addbutton(spellname, powerAliases:findChardataButton(xchardata), spelllevel)
				end

				return
			end
		end
	end				
end

-- return the power (without target)

function powerAliases:toPower(xcommand)
--	local charclass = whoclass(whoami())
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	-- non-powers spells
	if string.match(xcommand, &quot;c[ast]* +'&quot;) ~= nil then
		return(nil)
	end

	-- check if powers table exists for current class
	if powerAliases[charclass] == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return(nil)
	end

	-- extract power if string includes a target
	local powername = string.match(xcommand, &quot;^([a-z]+) .*&quot;)

	if powername == nil then
		powername = xcommand
	end

	return(powername)
end

-- return the (fixed) spellname associated with a power

function powerAliases:toSpell(xcommand)
--	local charclass = whoclass(whoami())
	local charclass = string.gsub(whoclass(whoami()), &quot;-&quot;, &quot;_&quot;)

	-- non-powers spells
	if string.match(xcommand, &quot;c[ast]* +'&quot;) ~= nil then
		local _, _, spellname = string.find(xcommand, &quot;c[ast]* +' *(.*) *'.*&quot;)
		return( to_snake(spellname) )
	end

	local powername = powerAliases:toPower(xcommand)

	if powername == nil then
		echoDebug(&quot;&lt;red&gt;[Power aliases not assigned for this class]\n&quot;)
		return(nil)
	end

	local spell=nil

	for nx=1, #powerAliases[charclass], 1 do
		if powerAliases[charclass][nx][2] == powername then
			return( powerAliases[charclass][nx][1] )
		end
	end

	echoDebug(&quot;&lt;red&gt;[Missing spell: &quot; .. tostring(powername) .. &quot;]\n&quot;)

	return(nil)	
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>PetScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

pet = pet or {}
pet.followers = pet.followers or {}

-- pet:add(petname) - add a pet
-- pet:delete(petname) - remove one pet of name petname
-- pet:status() - return true if currently have any tracked pets


function pet:reset()
	self.followers = {}
end

function pet:member(xfullname)
	for k,v in pairs(self.followers) do
		if v[2]:lower() == xfullname:lower() then
			return(true)
		end
	end

	return(false)
end


function pet:list()
-- return table of pet keywords



end

function pet:add(petname, fullname, xhp, xmaxhp)
	self.followers[petname] = self.followers[petname] or {0, &quot;&quot;, 0, 0}
	self.followers[petname][1] = self.followers[petname][1] + 1
	self.followers[petname][2] = fullname

	self.followers[petname][3] = xhp
	self.followers[petname][4] = xmaxhp
end

function pet:delete(petname)
	if self.followers[petname] ~= nil then
		if self.followers[petname][1] &gt; 1 then
			self.followers[petname][1] = self.followers[petname][1] - 1
		else
			self.followers[petname] = nil
		end
	end
end

function pet:status(petname)

	if petname == nil then
		if table.size(self.followers) &gt; 0 then
			return(true)
		else
			return(false)
		end
	else
		if self.followers[petname] == nil then
			return(false)
		else
			return(true)
		end
	end
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>SoundScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

noSound = noSound or false

function sound(xname, xvolume, xlimited)
	local soundmode=charData:get(&quot;sound&quot;, false)

	if soundmode == &quot;off&quot; or (soundmode == &quot;limited&quot; and not xlimited) then
		return
	end
	
	if xvolume == nil then
		xvolume=100
	end

	-- if noSound has been set, this sound is one-time silenced
	if not noSound then
		echoDebug(&quot;\n&lt;red&gt;[sound: &quot; .. xname .. &quot;]\n&quot;)
		playSoundFile( soundpath(xname), xvolume )
	end

	noSound=false
end

</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>RescueScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
rescuelist = rescuelist or {}

function rescuelist:generate()
	self.list= {}

	for k,char in pairs(groupList:pc(&quot;petRescue&quot;)) do
		table.insert(self.list, char)
	end
end	

function rescuelist:get()
	return(self.list)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>EnemyScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- The ghoul of an opulent merchant

function idMob(xname)
	local mobnames=
				{ &quot;zombie&quot;, &quot;ghoul&quot;, &quot;skeleton&quot;, &quot;wight&quot;, &quot;spectre&quot;, &quot;ghast&quot;, &quot;ghost&quot;}

	local enemytable = string.split(xname, &quot; &quot;)

	if string.find(xname, &quot;elderly priest of Mielikki&quot;) then
		return(&quot;priest&quot;)
	end

	if string.find(xname, &quot;doppelganger&quot;) then
		return(&quot;doppelganger&quot;)
	end

	-- check for containing a matching name
	for nx=1, #mobnames, 1 do

		--if string.find(&quot;hell hound&quot;, mobnames[nx]) then
		--	return(&quot;wolf&quot;)
		--end

		if string.find(xname, mobnames[nx]) then
			return(mobnames[nx])
		end
	end

	-- return the final word in the string
	return( enemytable[#enemytable] )
end

function getEnemy()
	enemy = enemy or &quot;&quot;

	return(enemy)
end

function setEnemy(xval)
	if getEnemy() ~= xval then
		echoDebug(&quot;&lt;red&gt;\n[Setting enemy to: &lt;blue&gt;&quot; .. xval .. &quot;&lt;red&gt;]\n&quot;)
	end

	enemy = xval
end

function sendCon(xname)
	if conSent == nil then
		conSent=true

		mud:send(&quot;con &quot; .. xname )
	end
end
</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>SpellAlerts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function getQuake()
	bcastQuake = bcastQuake or false

	return(bcastQuake)
end

function setQuake(xval)
	bcastQuake = xval
end

function castQuake()
	if getQuake() then
		if getSpellCount(&quot;earthquake&quot;) &gt; 0 then
			spell:setNext(&quot;c 'earthquake'&quot;)
			--spell:setNext(&quot;eaq human&quot;)
			setQuake(false)
			return(true)
		end
	end

	return(false)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>MountScripts</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

mount = mount or {}

-- addbutton(&quot;SummonMount&quot;, 10, 15)

function mount:set(xname)
	self.mountname = xname

	if xname ~= nil and NyyLIB.initgui then
		addbutton(&quot;MountDismount&quot;, 10, 15)
	else
		if checkMask(&quot;summonmount&quot;) then
			addbutton(&quot;SummonMount&quot;, 10, 15)
		end
	end
end

function mount:get()
	return( self.mountname )
end

function mount:setMounted(xval)
	self.mounted=xval

	dismounted=false

	if xval then
		addbutton(&quot;mounted_charge&quot;, 3, 1)
	else
		addbutton(&quot;bashing&quot;, 3, 1)
	end
end

function mount:getMounted()
	if self.mounted == nil then
		self.mounted=false
	end

	return(self.mounted)
end

function mount:charge(xtarget)
	if not timer:get(&quot;mountedcharge&quot;) then
		if xtarget ~= nil then
			if checkMask(&quot;dire&quot;) then
				mud:send(&quot;mc &quot; .. xtarget)
			else
				mud:send(&quot;charge &quot; .. xtarget)
			end
		else
			if checkMask(&quot;dire&quot;) then
				mud:send(&quot;mc&quot;)
			else
				mud:send(&quot;charge&quot;)
			end
		end

		timer:set(&quot;mountedcharge&quot;, 8)

		return(true)
	end

	return(false)
end</script>
                    <eventHandlerList/>
                </Script>
                <Script isActive="yes" isFolder="no">
                    <name>TrainScript</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- fightreturn false: send flee
-- fightreturn true: send assist



function fleeMem()
	-- ignore trigger if in fugue
	if map:getRoom() == 93848 then
		return
	end

	if charData:get(&quot;memcount&quot;) == nil or charData:get(&quot;memcount&quot;) == 0 and not checkMask(&quot;psi&quot;) then
		fightreturn=true
		return
	end

	if not NyyLIB.castertrain then
		-- mud:send(&quot;status &quot; .. matches[2])
		mud:send(&quot;flee&quot;)
	end

	fightreturn=true
	NyyLIB.castertrain=true
end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <Script isActive="yes" isFolder="no">
                <name>promptEvent</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- This event will be called whenever the mud prompt has been received

mobs = mobs or {}

function promptEvent(event)
	local current=spell:getCurrent() or &quot;nil&quot;
	local memcount= charData:get(&quot;memcount&quot;) or 0

	if inCombat() then
		assistSent = nil

		-- send con to update database if needed

		local roomid = map:getRoom()

		if roomid ~= nil then
			if mobs[roomid] == nil then
				sendCon(prompt:get(&quot;enemy&quot;))
			end
		end
	end

	-- If engaged in combat AND a look command was not sent/unreceived, set not moving
	if inCombat() or type(groupList:whoTanking()) == &quot;table&quot; and NyyLIB.tolook == 0 then
		automem=0

		if spell:getMoving() then
			echoDebug(&quot;&lt;red&gt;[Currently in combat]\n&quot;)
		end

		spell:setMem(false)
		spell:setMoving(false)
	end

	-- send furious assault
	if whorace( whoami() ) == &quot;Half-Orc&quot; then
		if inCombat() then
			if timer:get(&quot;furiousassult&quot;) == nil then
				timer:set(&quot;furiousassult&quot;, 90)
				mud:send(&quot;fa&quot;)
			end
		end
	end

	-- dire: howl - howl if in combat and enabled
	if mount:getMounted() then
		if charData:get(&quot;autohowl&quot;) and inCombat() then
			if not timer:get(&quot;howcd&quot;) then
				timer:set(&quot;howlcd&quot;, 7)
				mud:send(&quot;howl&quot;)	
			end
		end
	end

	-- dire: outflank - outflank if in combat and enabled
	if mount:getMounted() then
		if charData:get(&quot;outflank&quot;) and inCombat() then
			if not timer:get(&quot;outflankcd&quot;) then
				timer:set(&quot;outflankcd&quot;, 6)
				mud:send(&quot;outflank&quot;)	
			end
		end
	end

	if prompt:get(&quot;enemy&quot;) == &quot;nightmare&quot; then
		if getZone() ~= &quot;Ashstone&quot; then
			mud:send(&quot;disengage&quot;)
			return
		end
	end

	-- send all queued commands if not casting or in fugue 

	if 	spell:getCurrent() == nil or map:getRoom() == 93848 then
		-- send queue contents
		mud:sendCommands() 
	end

	-- if moving don't cast
	if spell:getMoving() then
		return
	end

	-- proc equipment if needed and not currently in fugue

	if map:getRoom() ~= 93848 then
		procEquipment()
	end

	-- Process cast/send queue 

	--if checkMask(&quot;caster&quot;) then
		spell:cast()
	--end

	-- if inside fugue return
	if map:getRoom() == 93848 then
		-- Remove any fugue proc'd buffs
		buff:del(whoami())
		return
	end

	-- don't cast if trying to mem or look sent/not received or nomagic is set
	if spell:getMem() or memsent or NyyLIB.tolook ~= 0 or nomagic then
		return
	end

	-- call class specific spell script if autocast enabled
	if charData:get(&quot;autocast&quot;) then

		if not timer:get(&quot;ghostcast&quot;) then
			--timer:set(&quot;ghostcast&quot;, 8)
			--mud:send(&quot;o ghost cast 'globe of invul' &quot; ..)
		end

		local cname=&quot;Spells&quot; .. string.gsub(whoclass(), &quot;-&quot;, &quot;_&quot;)
		-- local cname=&quot;Spells&quot; .. whoclass()

		if _G[cname] ~= nil then
			_G[cname]()
		end
	end

	-- automem segment

	memsent = memsent or false

	if (automem ~= 0 and automem ~= 1) or groupList:size() == 1 and not roomCombat then
		if spell:count() ~= 0 or spell:getCurrent() ~= nil then
			return
		end
		if checkMask(&quot;casterPsi&quot;) or checkMask(&quot;nonPriestCaster&quot;) then
			if charData:get(&quot;autocast&quot;) then
				if charData:get(&quot;memcount&quot;) ~= 0 and not spell:getMem() and spell:getCurrent() == nil and not memsent then
					if not inCombat() then
						echoDebug(&quot;&lt;red&gt;[initiating automem]\n&quot;)
						mud:send(&quot;mem&quot;)
						memsent = true
						--automem = 0
					end
				end
			end
		end
	end
end

function procEquipment()
	local hp=prompt:get(&quot;hp&quot;)
	local maxhp=prompt:get(&quot;maxhp&quot;)
	local percent=hp/maxhp

	-- exit if not in combat (no tank in prompt)
	-- this should prevent (some) proc commands from being issued in fugue

	if prompt:get(&quot;tank&quot;) == &quot;&quot; then
		return
	end

	-- proc manacle on &lt; 70% hp if not already blurred

	if not buff:get(&quot;blur&quot;) then
		if percent &lt; .70 then
			if isIconActive(&quot;TiaManacle&quot;) and timer:get(&quot;TiaManacle&quot;) == nil then
				TiaManacle()
			end
		end
	end

	-- proc volance on &lt; 60% hp

	if percent &lt; .60 then
		if isIconActive(&quot;TiaVolance&quot;) and timer:get(&quot;TiaVolance&quot;) == nil then
			TiaVolance()
		end
	end

	-- proc warder on &lt; 30% hp

	if percent &lt; .30 then
		if isIconActive(&quot;TiaWarder&quot;) and timer:get(&quot;TiaWarder&quot;) == nil then
			TiaWarder()
		end
	end

	-- proc items on &lt; 25% hp

	if percent &lt; .25 then
		-- proc supple girdle
		if isIconActive(&quot;SuppleGirdle&quot;) and not mount:getMounted() and timer:get(&quot;SuppleGirdle&quot;) == nil then
			SuppleGirdle()
			return
		end

		-- proc skill: layhands if paladin

		if checkMask(&quot;pal&quot;) then
			if not timer:get(&quot;layhand&quot;) then
				mud:send(&quot;layhand me&quot;)
				timer:set(&quot;layhand&quot;, 24*60)
			end
		end

		if checkMask(&quot;anti&quot;) then
			if not timer:get(&quot;lifetap&quot;) then
				mud:send(&quot;lifetap&quot;)
				timer:set(&quot;lifetap&quot;, 24*60)
			end
		end

		-- proc tiamat sleeves
		if isIconActive(&quot;TiaSleeves&quot;) and timer:get(&quot;TiaSleeves&quot;) == nil then
			TiaSleeves()
		end
	end
end
</script>
                <eventHandlerList>
                    <string>promptEvent</string>
                </eventHandlerList>
            </Script>
            <Script isActive="yes" isFolder="no">
                <name>statusEvent</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function statusEvent(event, xcharname)

end</script>
                <eventHandlerList>
                    <string>statusEvent</string>
                </eventHandlerList>
            </Script>
            <Script isActive="yes" isFolder="no">
                <name>sysManualLocationSetEvent</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function sysManualLocationSetEvent(xtmp)
	--display(&quot;X&quot;)
end</script>
                <eventHandlerList>
                    <string>sysManualLocationSetEvent</string>
                </eventHandlerList>
            </Script>
            <ScriptGroup isActive="yes" isFolder="yes">
                <name>Samples</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
                <eventHandlerList/>
                <Script isActive="yes" isFolder="no">
                    <name>sampleTimer</name>
                    <packageName></packageName>
                    <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

-- This function when used in a timer will display the countdown on screen
-- and then print an expired message

function sampleTimer(event)
	local current=timer:get(&quot;sampleTimer&quot;)

	if event == &quot;timer&quot; then
		cecho(&quot;&lt;green&gt;[Timer: &quot; .. current .. &quot;]\n&quot;)
	end

	if event == &quot;expire&quot; then
		cecho(&quot;&lt;red&gt;[Timer has expired]\n&quot;)
	end
end</script>
                    <eventHandlerList/>
                </Script>
            </ScriptGroup>
            <Script isActive="yes" isFolder="no">
                <name>installEvent</name>
                <packageName></packageName>
                <script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
-- sysInstallPackage

-- this function will be called with mudlet 3.1+ on package installation

function installEvent()
	cecho(&quot;&lt;red&gt;[\n[New package install event called]\n&quot;)

	-- mudlet 3.1+ in use, restart not required
	disableAlias(&quot;restart&quot;)

	initNyyLIB()
end</script>
                <eventHandlerList>
                    <string>sysInstallPackage</string>
                </eventHandlerList>
            </Script>
        </ScriptGroup>
    </ScriptPackage>
    <KeyPackage>
        <KeyGroup isActive="yes" isFolder="yes">
            <name>NyyLIB</name>
            <packageName>NyyLIB011dev</packageName>
            <script></script>
            <command></command>
            <keyCode>103</keyCode>
            <keyModifier>2949176</keyModifier>
            <Key isActive="yes" isFolder="no">
                <name>north</name>
                <packageName></packageName>
                <script>mud:send(&quot;n&quot;)</script>
                <command></command>
                <keyCode>56</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
            <Key isActive="yes" isFolder="no">
                <name>south</name>
                <packageName></packageName>
                <script>mud:send(&quot;s&quot;)</script>
                <command></command>
                <keyCode>53</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
            <Key isActive="yes" isFolder="no">
                <name>east</name>
                <packageName></packageName>
                <script>mud:send(&quot;e&quot;)</script>
                <command></command>
                <keyCode>54</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
            <Key isActive="yes" isFolder="no">
                <name>west</name>
                <packageName></packageName>
                <script>mud:send(&quot;w&quot;)</script>
                <command></command>
                <keyCode>52</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
            <Key isActive="yes" isFolder="no">
                <name>down</name>
                <packageName></packageName>
                <script>mud:send(&quot;d&quot;)</script>
                <command></command>
                <keyCode>55</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
            <Key isActive="yes" isFolder="no">
                <name>up</name>
                <packageName></packageName>
                <script>mud:send(&quot;u&quot;)</script>
                <command></command>
                <keyCode>57</keyCode>
                <keyModifier>536870912</keyModifier>
            </Key>
        </KeyGroup>
    </KeyPackage>
</MudletPackage>
